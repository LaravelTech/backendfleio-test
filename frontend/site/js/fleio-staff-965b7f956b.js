!function(){"use strict";function e(n,e){var t={api_url:"http://localhost:8000/staffapi",app_name:"fleioStaff",home_url:"/staff",base_url:"/staff/",base_title:"Fleio Admin: @",paginate_by:"20",distro_img_path:"/images/os_distro",min_search_length:3,toast_hide_delay:3e3,confirm_dialog_message:e("Are you sure?"),confirm_dialog_title:e("Confirm your action"),menu:[{label:e("Dashboard"),state:"dashboard",icon:"dashboard",feature:"dashboard"},{category:e("Clients & users"),items:[{label:e("Users"),state:"users",icon:"users",feature:"clients&users.users"},{label:e("User groups"),state:"usergroups",icon:"group",feature:"clients&users.usergroups"},{label:e("Clients"),state:"clients",icon:"clients",feature:"clients&users.clients"},{label:e("Client groups"),state:"clientgroups",icon:"group",feature:"clients&users.clientgroups"}]},{category:e("Cloud"),main_feature:"openstack",items:[{label:e("Instances"),state:"openstackInstances",icon:"instances",feature:"openstack.instances"},{label:e("Clusters"),state:"openstackClusters",icon:"folder",feature:"openstack.coe.clusters"},{label:e("Cluster Templates"),state:"openstackClusterTemplates",icon:"folder",feature:"openstack.coe.cluster_templates"},{label:e("Networks"),state:"openstackNetworks",icon:"networks",feature:"openstack.networks"},{label:e("Routers"),state:"openstackRouters",icon:"routers",feature:"openstack.routers"},{label:e("Zones"),state:"zones",icon:"dns_zones",feature:"openstack.dns.zones"},{label:e("Security groups"),state:"securityGroups",icon:"security_groups",feature:"openstack.securitygroups"},{label:e("Subnet pools"),state:"openstackSubnetpools",icon:"subnetpools",feature:"openstack.subnetpools"},{label:e("Floating IPs"),state:"floatingIps",icon:"floating_ip",feature:"openstack.floatingips"},{label:e("Flavor Groups"),state:"openstackFlavorGroups",icon:"flavors",feature:"openstack.flavors"},{label:e("Flavors"),state:"openstackFlavors",icon:"flavors",feature:"openstack.flavors"},{label:e("SSH keys"),state:"openstackSshKeys",icon:"keys",feature:"openstack.sshkeys"},{label:e("Volumes"),state:"openstackVolumes",icon:"volumes",feature:"openstack.volumes"},{label:e("Volume backups"),state:"openstackVolumeBackups",icon:"volumes",feature:"openstack.volumes.backups"},{label:e("Volume snapshots"),state:"openstackVolumeSnapshots",icon:"volumes",feature:"openstack.volumes.snapshots"},{label:e("Images"),state:"images",icon:"images",feature:"openstack.images"},{label:e("Projects"),state:"projects",icon:"folder",feature:"openstack.projects"},{label:e("API users"),state:"apiUsers",icon:"group",feature:"openstack.apiusers"}]},{category:e("Billing"),main_feature:"billing",items:[{label:e("Journal"),state:"billingJournal",icon:"journal",feature:"billing.journal"},{label:e("Gateways"),state:"billingGateways",icon:"gateways",feature:"billing.gateways"},{label:e("Invoices"),state:"billingInvoices",icon:"invoice_item",feature:"billing.invoices"},{label:e("Services"),state:"billingServices",icon:"services",feature:"billing.services"},{label:e("Orders"),state:"billingOrders",icon:"shopping_cart",feature:"billing.orders"},{label:e("Products"),state:"billingProducts",icon:"product",feature:"billing.products"},{label:e("Config. options"),state:"billingConfigurableOptionList",icon:"tax_rules",feature:"billing"},{label:e("Tax rules"),state:"billingTaxRules",icon:"tax_rules",feature:"billing.taxrules"}]},{category:e("Servers"),main_feature:"servers",items:[{label:e("Groups"),state:"serverGroupList",icon:"product",feature:"servers"},{label:e("Server list"),state:"serverList",icon:"instances",feature:"servers"}]},{category:e("Utilities"),main_feature:"utils",items:[{label:e("Activity log"),state:"utilsActivityLog",icon:"activity_log",feature:"utils.activitylog"},{label:e("Reports"),state:"fleioReports",icon:"activity_log",feature:"utils.reports"}]},{category:e("Settings"),main_feature:"settings",items:[{label:e("General"),state:"generalSettings",icon:"settings",feature:"settings.general"},{label:e("Configurations"),state:"configurationsList",icon:"tiled_grid",feature:"settings.configurations"},{label:e("Authorization"),state:"authorizationSettings",icon:"security_groups",feature:"settings.authorization"},{label:e("Notifications"),state:"notificationTemplates",icon:"notifications",feature:"settings.notifications.templates"},{label:"OpenStack",state:"openstackSettings",icon:"openstack",feature:"openstack.settings"},{label:e("OpenStack plans"),state:"openstackPlans",icon:"ruler",feature:"openstack.plans"}]}],default_theme:"Spring",logo_light:"/images/logo-staff.svg",logo_dark:"/images/logo-staff-dark.svg",djangoCsrf:{cookieName:"csrftoken",headerName:"X-CSRFToken"},dashboard:[[{name:"os",label:e("Operating systems"),feature:"openstack"},{name:"flavors",label:e("Flavors"),feature:"openstack.flavors"}],[{name:"hypervisors",label:e("Hypervisors"),feature:"openstack"},{name:"instances",label:e("Instances"),feature:"openstack.instances"}],[{name:"system_services",label:e("App services"),feature:"app-status"},{name:"clients",label:e("Clients"),feature:"clients&users.clients"},{name:"billing",label:e("Invoices"),feature:"billing.invoices"}]],tiny_mce_options:{relative_urls:!0,convert_urls:!1,inline:!1,plugins:"link code image lists autolink",toolbar:["undo redo | styleselect | bold italic underline | alignleft aligncenter alignright alignjustify | link code image | bullist numlist | removeformat"],skin:"lightgray",theme:"modern",menubar:""},flavors_as_cards:!1,local_compute_storage_enabled:!0,preselect_public_networks:!0,hide_networks_if_only_one_available:!0,show_root_password_field_on_new_instance_form:!0,root_password_mandatory_on_new_instance_form:!1,show_userdata_on_new_instance_form:!0,interceptorConfig:function(e,t){return e},customThemesCallback:function(e){},registeredThemes:["Spring","Navy","Dusk"],new_object_arrow_img_source:"images/arrow.png",verify_resize_message:null,reseller_url:"/reseller"};angular.forEach(t,function(e,t){n.hasOwnProperty(t)||(n[t]=e)}),n.__baseUrlSlashed=n.base_url.replace(/\/?$/,"/"),n.joinBaseUrl=function(e){return n.__baseUrlSlashed+e.replace(/^\/+/g,"")}}angular.module("fleiostaff.baseconfig",["fleiostaff.config"]).config(e),e.$inject=["CONFIG","gettext"]}(),function(){"use strict";angular.module("fleiostaff.config",[])}(),function(){"use strict";function e(e,t,n){!1===t.enable_debug&&e.debugInfoEnabled(!1),e.commentDirectivesEnabled(!1),e.cssClassDirectivesEnabled(!1),n.setOptions({colors:["#803690","#00ADF9","#DCDCDC","#46BFBD","#FDB45C","#949FB1","#4D5360"]})}function t(n,i,e,t,o,r){n.licenseDialogShown=!1,e.setCurrentLanguage(t.language),n.$on("fl:licenseNotSet",function(e,t){!0!==n.licenseDialogShown&&(n.licenseDialogShown=!0,o.add(t),i.show({templateUrl:"staff/apps/settings/general/license/flsetlicense.html",controller:"FlSetLicenseController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{canCancel:!1}}).finally(function(){n.licenseDialogShown=!1}))}),n.$on("fl:configurationError",function(e,t){var n=void 0;t.detail&&(n=t.detail),i.show({templateUrl:"staff/apps/settings/flsettingserror.html",controller:"FlSettingsErrorController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{section:t.section,configuration_id:t.configuration_id,detail:n}})}),n.$on("fl:noSfaAdded",function(){"SFAOptions"!==n.nextState&&r.go("SFAConfirmPassword")})}angular.module("fleioStaff",["gettext","fleiostaff.config","fleiostaff.baseconfig","fleio.commons","fleio.oscommons","ngCookies","ngResource","ngSanitize","ngMessages","ui.router","http-auth-interceptor","ngMaterial","dndLists","chart.js"]).config(e).run(t),e.$inject=["$compileProvider","CONFIG","ChartJsProvider"],t.$inject=["$rootScope","$mdDialog","gettextCatalog","CONFIG","FlNotificationService","$state"]}(),function(){"use strict";function e(e,r,a,t,n){var s=this;function i(){var e=a.get("staff.dashboard",!0),t=angular.copy(r.dashboard),n=null;n=null!==e?function(e,t){return[].concat.apply([],e).length>[].concat.apply([],t).length?t:e}(JSON.parse(e),t):t,function(e){angular.forEach(e,function(e){angular.forEach(e,function(e){s.widgetData[e.name]={}})})}(t);for(var i=0;i<n.length;i++)for(var o=0;o<n[i].length;o++)!1===s.features[n[i][o].feature]&&(n[i].splice(o,1),o--);return n[0].length<1&&!e&&n[1].length<1&&(n[0]=n[2],n[2]=[]),n}function o(){for(var e=r.dashboard,t=0;t<e.length;t++)for(var n=0;n<e[t].length;n++)!1===s.features[e[t][n].feature]&&(e[t].splice(n,1),n--);e=[].concat.apply([],e);var i=[].concat.apply([],s.widgets);s.deletedWidgets=e.filter(function(t){return 0===i.filter(function(e){return t.name===e.name}).length})}s.removeRules=function(){for(var e=s.style.sheet.cssRules.length-1;0<=e;)"deleteRule"in s.style.sheet?s.style.sheet.deleteRule(e):"removeRule"in s.style.sheet&&s.style.sheet.removeRule(e),e--},s.addCanvasRule=function(){s.style.sheet.cssRules.length<2&&s.style.sheet.insertRule("iframe { display: none !important; }",0)},s.onDragStart=function(e){s.removeRules();var t=e.path[0].offsetHeight-20,n=e.path[0].offsetWidth-40;s.style.sheet.insertRule(".dndPlaceholder { min-height: "+t+"px; min-width: "+n+"px;}",0),s.style.sheet.insertRule("iframe { display: none !important; }",0)},s.$onInit=function(){s.features=n.features,s.widgetData={},s.style=e[0].createElement("style"),s.style.appendChild(e[0].createTextNode("")),e[0].head.appendChild(s.style),s.widgets=i(),o()},s.saveState=function(){s.removeRules(),a.set("staff.dashboard",angular.toJson(s.widgets),!0),o()},s.getColumnFlex=function(){return t("xs")||t("sm")?100:33},s.isTouchDevice=function(){var e=document.createElement("div");return e.setAttribute("ontouchstart","return;"),"function"==typeof e.ontouchstart},s.appendWidget=function(e){var t=Math.floor(3*Math.random());s.widgets[t].push(e),s.saveState()}}angular.module("fleioStaff").component("flDashboard",{templateUrl:"staff/apps/dashboard/fldashboard.html",controller:e,bindings:{userInfo:"<"}}),e.$inject=["$document","CONFIG","FlLocalStorage","$mdMedia","FlFeatureService"]}(),function(){"use strict";function e(e,t,n){e.state("dashboard",{url:t.home_url,component:"flDashboard",authenticate:!0,data:{stateInfo:{display:n("Staff"),parent:null},feature:"dashboard"},resolve:{userInfo:["FlAuthService",function(e){return e.getUserInfo().then(function(e){return e})}]}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/openstack/regions")}function t(e,t){var n,i,o,r,a,s,l,c,u,d,p,f,g,m,h,v,_,b,S,y;return d=e(t.api_url+"/osbackup/:id",{id:"@id"}),(r=e(t.api_url+"/openstack/instances/:uuid:options/:action",{uuid:"@uuid",action:"@action",options:"@options"})).prototype.allowedAction=function(e){return-1<this.allowed_actions.indexOf(e)},r.prototype.execute=function(e){return r.save(angular.extend({uuid:this.uuid},e))},r.prototype.fldelete=function(){return this.$delete()},(u=e(t.api_url+"/openstack/flavorgroups/:id/:action",{id:"@id",action:"@action"})).prototype.hasPermission=function(e){return this.permissions[e]},c=e(t.api_url+"/openstack/flavors/:id:options/:action",{id:"@id",options:"@options",action:"@action"}),p=e(t.api_url+"/openstack/floatingips/:id/:options",{id:"@id",options:"@options"}),(o=e(t.api_url+"/openstack/images/:id:options/:action",{id:"@id",options:"@options",action:"@action"})).prototype.isUnderTask=function(){return-1===["active","unknown","deactivated","killed","deleted"].indexOf(this.status)},(a=e(t.api_url+"/openstack/volumes/:id:options/:action",{id:"@id",options:"@options",action:"@action"})).prototype.isUnderTask=function(){return-1===["available","in-use","deleted","unknown","error","error_deleting","error_restoring","error_extending"].indexOf(this.status)},a.prototype.isDisabled=function(){return-1===["available","in-use","unknown","error","error_restoring","error_extending"].indexOf(this.status)},a.prototype.fldelete=function(){return this.$delete()},(s=e(t.api_url+"/openstack/volumebackups/:id/:action",{id:"@id",action:"@action"})).prototype.isUnderTask=function(){return-1===["available","error","error_deleting"].indexOf(this.status)},s.prototype.fldelete=function(){return this.$delete()},(l=e(t.api_url+"/openstack/volumesnapshots/:id/:action",{id:"@id",action:"@action"})).prototype.isUnderTask=function(){return-1===["available","error","error_deleting","unmanaging"].indexOf(this.status)},l.prototype.fldelete=function(){return this.$delete()},(n=e(t.api_url+"/openstack/clusters/:id/:action",{id:"@id",action:"@action"})).prototype.fldelete=function(){return this.$delete()},(i=e(t.api_url+"/openstack/cluster-templates/:id/:action",{id:"@id",action:"@action"})).prototype.fldelete=function(){return this.$delete()},f=e(t.api_url+"/openstack/networks/:id/:options",{id:"@id",options:"@options"}),g=e(t.api_url+"/openstack/subnets/:id/:options",{id:"@id",options:"@options"}),m=e(t.api_url+"/openstack/subnetpools/:id/:options",{id:"@id",options:"@options"}),h=e(t.api_url+"/openstack/ports/:id:options/:action",{id:"@id",options:"@options",action:"@action"}),v=e(t.api_url+"/openstack/routers/:id/:options",{id:"@id",options:"@options"}),_=e(t.api_url+"/openstack/summary/:action",{action:"@action"}),b=e(t.api_url+"/openstack/dns/:id/:actions",{id:"@id",actions:"@actions"}),y=e(t.api_url+"/openstack/hypervisors/:id/:actions",{id:"@id",actions:"@actions"}),S=e(t.api_url+"/openstack/securitygroups/:id/:options",{id:"@id",options:"@options"}),{Clusters:n,ClusterTemplates:i,Instances:r,Flavors:c,FlavorGroups:u,Images:o,Volumes:a,FloatingIps:p,Networks:f,Subnets:g,SubnetPools:m,Ports:h,Routers:v,Summary:_,Dns:b,Hypervisors:y,SecurityGroups:S,BackupSchedules:d,VolumeBackups:s,VolumeSnapshots:l}}angular.module("fleioStaff").factory("FlOsApi",t).factory("FlRegionApi",e),e.$inject=["FlResourceService","CONFIG"],t.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n){e.state("apiUsers",{url:t.joinBaseUrl("openstack/apiusers"),component:"flApiUsers",authenticate:!0,reloadOnSearch:!1,resolve:{users:["$stateParams","FlApiUsersApi",function(e,t){return t.query().$promise}],editData:["$stateParams","FlApiUsersApi",function(e,t){return t.query({action:"edit_user_data"}).$promise}],permissions:["$stateParams","FlApiUsersApi",function(e,t){return t.get({action:"permissions"}).$promise}]},data:{stateInfo:{display:n("API users"),parent:"dashboard"},feature:"openstack.apiusers"}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/openstack/users/:id:action",{id:"@id",action:"@action"})}angular.module("fleioStaff").factory("FlApiUsersApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(t,e,i,n,o,r,a,s,l){var c=this;function u(){o.query().$promise.then(function(e){c.users=e})}c.TRANSLATED_STRINGS_MAP={delete:r.getString("Delete"),edit:r.getString("Edit"),add_api_user:r.getString("Add API user"),no_permission:r.getString("You are not\nallowed to do this")},c.addAPIUser=function(e){return t.go(t.current,{dlg:"add"}),i.show({templateUrl:"staff/apps/osapiusers/flapiuseredit.html",controller:"FlApiUserAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,targetEvent:e,locals:{editData:c.editData}}).then(function(){u()}).finally(function(){t.go(t.current,{dlg:"false"})}).catch(function(){})},c.editAPIUser=function(e,t){return i.show({templateUrl:"staff/apps/osapiusers/flapiuseredit.html",controller:"FlApiUserEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{editData:c.editData,user:t},targetEvent:e}).then(function(){u(),s.add(r.getString("API user edited"))}).catch(function(){})},c.getOpenrcFile=function(t,n){l.get().$promise.then(function(e){return i.show({templateUrl:"oscommons/apiusers/getopenrcfile.dialog.html",controller:"FlApiUserGetOpenrcController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{user:n,regions:e.objects},targetEvent:t}).then(function(){}).catch(function(){})})},c.deleteAPIUser=function(e){return n.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete user {{name}}",{name:e.name}),r.getString("Delete user")).then(function(){o.delete({id:e.id}).$promise.then(function(){u(),s.add(r.getString("API user deleted"))},function(){s.add(r.getString("Could not delete API User"))})}).catch(function(){})},"add"===e.dlg&&c.addKey(null)}angular.module("fleioStaff").component("flApiUsers",{templateUrl:"staff/apps/osapiusers/flapiusers.html",controller:e,bindings:{users:"<",editData:"<",permissions:"<"}}),e.$inject=["$state","$stateParams","$mdDialog","FlUiUtilsService","FlApiUsersApi","gettextCatalog","gettext","FlNotificationService","FlRegionApi"]}(),function(){"use strict";function e(t,e,n){var i=this;i.$onInit=function(){i.user=angular.copy(n),i.isEdit=!0},i.saveAPIUser=function(){if(document.activeElement.blur(),!i.editAPIUser.$invalid&&!i.submitPending)return i.submitPending=!0,e.update({id:i.user.id},i.user).$promise.then(function(e){return t.hide(e),e}).catch(function(e){i.submitPending=!1,i.backendErrors=e.data})},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlApiUserEditController",e),e.$inject=["$mdDialog","FlApiUsersApi","user"]}(),function(){"use strict";function e(t,e,n,i){var o=this;o.user={},o.editData=i,o.isEdit=!1,o.$onInit=function(){o.projects=o.editData},o.querySearch=function(e){return e?o.projects.filter(function(e){var t=e.toLowerCase();return function(e){return 0===e.name.toLowerCase().indexOf(t)}}(e)):o.projects},o.selectedProjectChange=function(e){e&&(o.selectedProject=e)},o.saveAPIUser=function(){if(document.activeElement.blur(),!o.editAPIUser.$invalid&&!o.submitPending)return o.user.default_project=o.selectedProject.id,o.submitPending=!0,e.save(o.user).$promise.then(function(e){return t.hide(e),e}).catch(function(e){o.submitPending=!1,o.backendErrors=e.data})},o.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlApiUserAddController",e),e.$inject=["$mdDialog","FlApiUsersApi","gettext","editData"]}(),function(){"use strict";function e(e,t,n,i,o,r){var a,s=this;function l(){return s.instances.fetchData().then(s.checkForTaskChange)}s.$onInit=function(){n.info.enabled=!0,n.info.label=o("Search instances"),n.info.service=s.instances,(a=e(l,1e4)).start(),t.init(a.start.bind(a),a.stop.bind(a)),s.checkForTaskChange(s.instances),s.TRANSLATED_STRINGS_MAP={create:i.getString("Create virtual server"),no_permission:i.getString("You are not\nallowed to do this"),instance_resized_info:i.getString("Check if files have been successfully\nmigrated to the new instance disk. \nChoose Verify resize from the instance menu\nto confirm migration was successful, otherwise\nchoose Revert resize to revert back to the initial disk.")},r.verify_resize_message&&(s.TRANSLATED_STRINGS_MAP.instance_resized_info+="\n"+r.verify_resize_message)},s.onInstanceAction=function(e){return e?l():a.boost()},s.checkForTaskChange=function(e){return angular.forEach(e.objects,function(e){if(null!==e.display_task)return a.boost()})},s.$onDestroy=function(){a.teardown(),t.uninit()}}angular.module("fleioStaff").component("flInstances",{templateUrl:"staff/apps/osinstances/flinstances.html",controller:e,bindings:{instances:"<"}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlSearchService","gettextCatalog","gettext","CONFIG"]}(),function(){"use strict";function e(e,t,l){e.state("openstackInstances",{url:t.joinBaseUrl("openstack/instances?ordering?page_size?search?filtering"),component:"flInstances",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0,dynamic:!0},ordering:{value:"-created",squash:!0,dynamic:!0},filtering:{value:"",squash:!0,dynamic:!0}},resolve:{instances:["$state","$transition$","FlObjectList","FlOsApi","FlFeatureService",function(a,e,t,n,s){return n.Instances.get({options:"filter_options"}).$promise.then(function(e){for(var t=e.region,n=[],i=0,o=t.length;i<o;++i)n.push({display:t[i].id,value:t[i].id});if(a.get("openstackInstances").data.filtering.region.choices=n,a.get("openstackInstances").data.filtering.status.choices=e.statuses,a.get("openstackInstances").data.filtering.task_state.choices=e.task_states,s.features["openstack.instances.traffic"]){var r=a.get("openstackInstances").data.orderOptions;r.current_cycle_traffic=l("Current cycle traffic"),r.current_month_traffic=l("Current month traffic")}}),t(n.Instances,e.params())}]},data:{stateInfo:{display:l("Instances"),parent:"dashboard"},feature:"openstack.instances",orderOptions:{name:l("Name"),status:l("Status"),region:l("Region"),created:l("Date created")},filtering:{project__service__client__id:{display:l("Client"),field_name:"project__service__client__id",type:"client"},created:{display:l("Date of creation"),field_name:"created",type:"date"},status:{display:l("Status"),field_name:"status",type:"choices",choices:[]},task_state:{display:l("Task state"),field_name:"task_state",type:"choices",choices:[]},flavor:{display:l("flavor"),field_name:"flavor",type:"customModelInstance",service:"FlOsApi",service_details:{type:"openstack",items:"Flavors"}},flavor__name:{display:l("Flavor name"),field_name:"flavor__name",type:"lookup",case_sensitive:!1},flavor__name__iendswith:{display:l("Flavor name ends with"),hidden:!0},flavor__name__istartswith:{display:l("Flavor name starts with"),hidden:!0},flavor__name__icontains:{display:l("Flavor name contains"),hidden:!0},host_name:{display:l("Host name"),field_name:"host_name",type:"lookup",case_sensitive:!1},host_name__iendswith:{display:l("Host name ends with"),hidden:!0},host_name__istartswith:{display:l("Host name starts with"),hidden:!0},host_name__icontains:{display:l("Host name contains"),hidden:!0},image:{display:l("image"),field_name:"image",type:"customModelInstance",service:"FlOsApi",service_details:{type:"openstack",items:"Images"}},image__os_distro:{display:l("Image os distro name"),field_name:"image__os_distro",type:"lookup",case_sensitive:!1},image__os_distro__iendswith:{display:l("Image os distro name ends with"),hidden:!0},image__os_distro__istartswith:{display:l("Image os distro name starts with"),hidden:!0},image__os_distro__icontains:{display:l("Image os distro name contains"),hidden:!0},region:{display:l("Region"),field_name:"region",type:"choices",choices:[]}}}}).state("openstackInstanceCreate",{url:t.joinBaseUrl("openstack/instances/create?img"),component:"flInstanceCreate",authenticate:!0,params:{img:null,image:null,region:null,client:null,fromLaunchImage:!1,fromNewImage:!1},resolve:{createOptions:["$transition$","FlOsApi",function(e,t){var n={action:"create_options",region:e.params().region,client:e.params().client};return e.params().image&&(n.image=e.params().image.id),e.params().volume&&(n.volume=e.params().volume.id),t.Instances.get(n).$promise}]},data:{feature:"openstack.instances",stateInfo:{display:l("Create instance"),parent:"openstackInstances"}}}).state("openstackInstanceDetails",{url:t.joinBaseUrl("openstack/instances/:id"),component:"flInstanceDetails",authenticate:!0,resolve:{instance:["$transition$","FlOsApi","FlInstanceStateAllowed","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i,o){return t.Instances.get({uuid:e.params().id}).$promise.then(function(e){return i.setParams({name:e.name}),n(e,e,"details")}).catch(o.handleError)}],permissions:["$transition$","FlOsApi",function(e,t){return t.Instances.get({action:"permissions"}).$promise}]},data:{feature:"openstack.instances",stateInfo:{display:l("Instance {:name}"),parent:"openstackInstances",default:l("Instance details")}}}).state("openstackInstanceRebuild",{url:t.joinBaseUrl("openstack/instances/:id/rebuild"),component:"flInstanceRebuild",authenticate:!0,resolve:{rebuildOptions:["$transition$","FlOsApi","FlInstanceStateAllowed","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i,o){return t.Instances.get({uuid:e.params().id,action:"rebuild"}).$promise.then(function(e){return i.setParams({name:e.instance.name}),n(e,e.instance,"rebuild")}).catch(o.handleError)}]},data:{feature:"openstack.instances",stateInfo:{display:l("Rebuild"),parent:"openstackInstanceDetails"}}}).state("openstackInstanceResize",{url:t.joinBaseUrl("openstack/instances/:id/resize"),component:"flInstanceResize",authenticate:!0,resolve:{resizeOptions:["$transition$","FlOsApi","FlInstanceStateAllowed","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i,o){return t.Instances.get({uuid:e.params().id,action:"resize"}).$promise.then(function(e){return i.setParams({name:e.instance.name}),n(e,e.instance,"resize")}).catch(o.handleError)}]},data:{feature:"openstack.instances",stateInfo:{display:l("Resize"),parent:"openstackInstanceDetails"}}}).state("openstackInstanceRescue",{url:t.joinBaseUrl("openstack/instances/:id/rescue"),component:"flInstanceRescue",authenticate:!0,resolve:{rescueOptions:["$transition$","FlOsApi","FlInstanceStateAllowed","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i,o){return t.Instances.get({uuid:e.params().id,action:"rescue"}).$promise.then(function(e){return i.setParams({name:e.instance.name}),n(e,e.instance,"rescue")}).catch(o.handleError)}]},data:{feature:"openstack.instances",stateInfo:{display:l("Rescue"),parent:"openstackInstanceDetails"}}}).state("openstackInstanceBootFromIso",{url:t.joinBaseUrl("openstack/instances/:id/boot-from-iso"),component:"flInstanceBootFromIso",authenticate:!0,resolve:{bootFromIsoOptions:["$transition$","FlOsApi","FlInstanceStateAllowed","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i,o){return t.Instances.get({uuid:e.params().id,action:"boot_from_iso"}).$promise.then(function(e){return i.setParams({name:e.instance.name}),n(e,e.instance,"boot_from_iso")}).catch(o.handleError)}]},data:{feature:"openstack.instances",stateInfo:{display:l("Boot from ISO"),parent:"openstackInstanceDetails"}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(r,t,n,i,a,s,l,e){return{restrict:"E",replace:"true",scope:{instance:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"staff/apps/osinstances/actions/flinstanceactions.html",controller:["$scope","$element",function(o,e){return o.consoleWindow=null,o.deleteInstance=function(){return r.yesNoDlg(s.getString("Are you sure you want to delete the instance? Files will be permanently lost."),s.getString("Delete instance {{name}}",{name:o.instance.name}),s.getString("Delete instance")).then(function(){return l.add(s.getString("Instance delete scheduled")),o.isDetail&&t.go("openstackInstances"),o.instance.fldelete()}).catch(function(){})},o.execute=function(e){if(o.instance.execute(e),"function"==typeof o.callback)return o.instance.display_task="pending",o.callback.call(null)},o.openConsole=function(){o.consoleWindow&&o.consoleWindow.close();o.consoleWindow=window.open("",o.instance.uuid,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no"),o.consoleWindow.focus(),a.Instances.get({uuid:o.instance.uuid,action:"get_console_url"}).$promise.then(function(e){e.lxc?o.consoleWindow.location=e.url:e.remote_console?o.consoleWindow.location=e.remote_console.url:o.consoleWindow.location=e.console.url}).catch(function(e){l.add(e.data.detail),o.consoleWindow.close()})},o.changePassword=function(e,t){return n.show({templateUrl:"staff/apps/osinstances/password/flinstancechangepassword.html",controller:"FlInstanceChangePasswordController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:e},targetEvent:t}).catch(function(){})},o.renameInstance=function(e,t){return n.show({templateUrl:"staff/apps/osinstances/rename/flinstancerename.html",controller:"FlInstanceRenameController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:e},targetEvent:t}).then(function(e){return i.updateParams({name:e}),o.callback(!0)}).catch(function(){})},o.migrateInstance=function(e,t){return n.show({templateUrl:"staff/apps/osinstances/migrate/flinstancemigrate.html",controller:"FlInstanceMigrateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:e},targetEvent:t}).then(function(){return l.add(s.getString("Instance migrate scheduled"))}).catch(function(){})},o.moveInstance=function(e,t){return n.show({templateUrl:"staff/apps/osinstances/move/flinstancemove.html",controller:"FlInstanceMoveController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:e},targetEvent:t}).then(function(){return l.add(s.getString("Instance move scheduled"))}).catch(function(){})},o.action=function(e){var t,n,i;switch(i=t=n=null,e.action){case"reboot":n=s.getString("Reboot instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure you want to reboot the instance?"),i=s.getString("Reboot instance");break;case"stop":n=s.getString("Shut down instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure you want to shut down the instance?"),i=s.getString("Shut down instance");break;case"start":break;case"suspend":n=s.getString("Suspend instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure to suspend the instance?"),i=s.getString("Suspend instance");break;case"resume":n=s.getString("Resume instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure to resume the instance?"),i=s.getString("Resume instance");break;case"lock":n=s.getString("Lock instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure to lock the instance?"),i=s.getString("Lock instance");break;case"unlock":n=s.getString("Unlock instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure to unlock the instance?"),i=s.getString("Unlock instance");break;case"abort_migrate":n=s.getString("Abort migrate instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure you want to abort migrating?"),i=s.getString("Abort migrate instance")}return null==n?o.execute(e):r.yesNoDlg(t,n,i).then(function(){return o.execute(e)}).catch(function(){})},o.TRANSLATED_STRINGS_MAP={start:s.getString("Start"),shut_down:s.getString("Shut down"),suspend:s.getString("Suspend"),unlock:s.getString("Unlock"),lock:s.getString("Lock"),resume:s.getString("Resume"),reboot:s.getString("Reboot"),reset_state:s.getString("Reset state"),delete:s.getString("Delete"),abort_migrate:s.getString("Abort migrate"),no_permission:s.getString("You are not\nallowed to do this")},o.action}]}}angular.module("fleioStaff").directive("flInstanceActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlBreadCrumbService","FlOsApi","gettextCatalog","FlNotificationService","CONFIG"]}(),function(){"use strict";function e(r,t,n,i,a,s,l){return{restrict:"E",replace:"true",scope:{instance:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"staff/apps/osinstances/actions/flxsinstanceactions.html",controller:["$scope","$element",function(o,e){return o.consoleWindow=null,o.deleteInstance=function(){return r.yesNoDlg(s.getString("Are you sure you want to delete the instance? Files will be permanently lost."),s.getString("Delete instance {{name}}",{name:o.instance.name}),s.getString("Delete instance")).then(function(){return l.add(s.getString("Instance delete scheduled")),o.isDetail&&t.go("openstackInstances"),o.instance.fldelete().then(function(){})}).catch(function(){})},o.execute=function(e){if(o.instance.execute(e),"function"==typeof o.callback)return o.instance.display_task="pending",o.callback.call(null)},o.openConsole=function(){o.consoleWindow&&o.consoleWindow.close();o.consoleWindow=window.open("",o.instance.uuid,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no"),o.consoleWindow.focus(),a.Instances.get({uuid:o.instance.uuid,action:"get_console_url"}).$promise.then(function(e){e.lxc?o.consoleWindow.location=e.url:e.remote_console?o.consoleWindow.location=e.remote_console.url:o.consoleWindow.location=e.console.url}).catch(function(e){l.add(e.data.detail),o.consoleWindow.close()})},o.changePassword=function(e,t){return n.show({templateUrl:"staff/apps/osinstances/password/flinstancechangepassword.html",controller:"FlInstanceChangePasswordController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:e},targetEvent:t}).catch(function(){})},o.renameInstance=function(e,t){return n.show({templateUrl:"staff/apps/osinstances/rename/flinstancerename.html",controller:"FlInstanceRenameController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:e},targetEvent:t}).then(function(e){return i.updateParams({name:e}),o.callback(!0)}).catch(function(){})},o.migrateInstance=function(e,t){return n.show({templateUrl:"staff/apps/osinstances/migrate/flinstancemigrate.html",controller:"FlInstanceMigrateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:e},targetEvent:t}).then(function(){return l.add(s.getString("Instance migrate scheduled"))}).catch(function(){})},o.moveInstance=function(e,t){return n.show({templateUrl:"staff/apps/osinstances/move/flinstancemove.html",controller:"FlInstanceMoveController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:e},targetEvent:t}).then(function(){return l.add(s.getString("Instance move scheduled"))}).catch(function(){})},o.action=function(e){var t,n,i;switch(i=t=n=null,e.action){case"reboot":n=s.getString("Reboot instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure you want to reboot the instance?"),i=s.getString("Reboot instance");break;case"stop":n=s.getString("Shut down instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure you want to shut down the instance?"),i=s.getString("Shut down instance");break;case"start":n=s.getString("Start instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure to start the instance?"),i=s.getString("Start instance");break;case"suspend":n=s.getString("Suspend instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure to suspend the instance?"),i=s.getString("Suspend instance");break;case"resume":n=s.getString("Resume instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure to resume the instance?"),i=s.getString("Resume instance");break;case"lock":n=s.getString("Lock instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure to lock the instance?"),i=s.getString("Lock instance");break;case"unlock":n=s.getString("Unlock instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure to unlock the instance?"),i=s.getString("Unlock instance");break;case"abort_migrate":n=s.getString("Abort migrate instance {{name}}",{name:o.instance.name}),t=s.getString("Are you sure you want to abort migrating?"),i=s.getString("Abort migrate instance")}return t?r.yesNoDlg(t,n,i).then(function(){return o.execute(e)}).catch(function(){}):o.execute(e)},o.action}]}}angular.module("fleioStaff").directive("flXsInstanceActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlBreadCrumbService","FlOsApi","gettextCatalog","FlNotificationService"]}(),function(){"use strict";function e(r,a,s,l){return function(e,t,n){var i;if(i=a.defer(),t.objects)return i.reject(),i.promise;if(t=new s.Instances(t),"details"==n||t.allowedAction(n))return e;var o=l.getString("Action not allowed");return r.add(o),i.reject({detail:o}),i.promise}}angular.module("fleioStaff").factory("FlInstanceStateAllowed",e),e.$inject=["FlNotificationService","$q","FlOsApi","gettextCatalog"]}(),function(){"use strict";function e(o,e,i,t,n,a,r,s,l,c,u,d,p,f,g){var m,h=this;function v(){"snapshots"===h.activeTab&&h.fetch_snapshots(),"volumes"===h.activeTab&&h.fetch_attachments(),"securityGroups"===h.activeTab&&h.fetch_security_groups(),o.Instances.get({uuid:e.id}).$promise.then(function(e){h.instance=e,h.checkForTaskChange(e),"networking"===h.activeTab&&h.markNewIps()}).catch(function(e){404===e.status&&s.go("openstackInstances")})}h.$onInit=function(){(m=t(v,1e4)).start(),n.init(m.start.bind(m),m.stop.bind(m)),h.checkForTaskChange(h.instance),h.TRANSLATED_STRINGS_MAP={delete_port:d.getString("Delete port"),remove_ip:d.getString("Remove IP"),dissociate_ip:d.getString("Dissociate floating IP"),dissociate_security_group:d.getString("Dissociate security group"),associate_security_group:d.getString("Associate security group"),detach_volume:d.getString("Detach volume"),no_permission:d.getString("You are not\nallowed to do this"),instance_resized_info:d.getString("Check if files have been successfully\nmigrated to the new instance disk. \nChoose Verify resize from the instance menu\nto confirm migration was successful, otherwise\nchoose Revert resize to revert back to the initial disk.")},u.verify_resize_message&&(h.TRANSLATED_STRINGS_MAP.instance_resized_info+="\n"+u.verify_resize_message)},h.features=r.features,h.FlOsChartService=p,h.console_output=null,h.history_log_selected=!1,h.metrics={value:"1",index:"cpu"},h.activeTab="info",h.snapshots={},h.attachments={},h.syslogParams={},h.loaders={},h.graphPeriods=[{label:d.getString("Last hour"),value:"1"},{label:d.getString("24 hours"),value:"24"},{label:d.getString("7 days"),value:"168"},{label:d.getString("30 days"),value:"720"}],h.history_log_resolve=function(){h.loaders.histlog=!0,l(c(u.api_url+"/openstack/instances/"+h.instance.uuid+"/actions"),{page_size:u.paginate_by}).then(function(e){h.history_log_selected=!0,h.history_logs=e}).finally(function(){h.loaders.histlog=!1})},h.loadGraphs=function(e,t){return"cpu"===h.metrics.index?h.loadCpuData(e,t):h.loadPortData(e,t)},h.fetch_snapshots=function(){return o.Images.get({action:"get_snapshots_for_instance",instance_uuid:h.instance.id}).$promise.then(function(e){h.snapshots=e})},h.fetchPortsPermissions=function(){return o.Ports.get({action:"permissions"}).$promise.then(function(e){h.portsPermissions=e})},h.fetch_attachments=function(){return o.Volumes.get({options:"get_attachments",instance_uuid:h.instance.uuid}).$promise.then(function(e){return h.attachments=e})},h.fetch_security_groups=function(){return h.security_groups||(h.loaders.secgroup=!0),o.Instances.get({uuid:h.instance.uuid,action:"list_security_groups"}).$promise.then(function(e){h.security_groups=e.security_groups}).finally(function(){h.loaders.secgroup=!1})},h.onInstanceAction=function(){return m.boost()},h.checkForTaskChange=function(e){if(null!=e.display_task)return m.boost()},h.markNewIps=function(){if(h.prev_net_details)for(var e=0;e<h.prev_net_details.ports.length;e++){for(var t=h.prev_net_details.ports[e],n=0;n<h.instance.net_details.ports[e].ipv4s.length;n++){for(var i=0;i<t.ipv4s.length&&t.ipv4s[i].ip_address!==h.instance.net_details.ports[e].ipv4s[n].ip_address;i++);i===t.ipv4s.length&&(h.instance.net_details.ports[e].ipv4s[n].new=!0)}for(n=0;n<h.instance.net_details.ports[e].ipv6s.length;n++){for(i=0;i<t.ipv6s.length&&t.ipv6s[i].ip_address!==h.instance.net_details.ports[e].ipv6s[n].ip_address;i++);i===t.ipv6s.length&&(h.instance.net_details.ports[e].ipv6s[n].new=!0)}}},h.get_console_output=function(e){return h.loaders.syslog=!0,o.Instances.get({uuid:e.uuid,action:"get_console_output",length:h.syslogParams.selected_length}).$promise.then(function(e){return h.syslogParams.length=e.length,h.syslogParams.selected_length=e.length,e.console_text?h.console_output=e.console_text:h.console_output=" "}).finally(function(){h.loaders.syslog=!1})},h.readableBytes=function(e){if(null===e)return d.getString("Size info not available.");if(0===e)return"0 bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","KB","MB","GB"][t]},h.createSnapshot=function(e,t){return a.show({templateUrl:"staff/apps/osinstances/snapshot/flinstancesnapshot.html",controller:"FlInstanceSnapshotController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:h.instance},targetEvent:t}).then(function(e){return i.add(d.getString("Snapshot "+e+" create scheduled"))}).catch(function(){})},h.attachVolume=function(e,t){return a.show({templateUrl:"staff/apps/osvolumes/attach/flvolumeattach.html",controller:"FlVolumeAttachController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:h.instance},targetEvent:t}).then(function(){return i.add(d.getString("Attaching volume to instance"))}).catch(function(){})},h.detachVolume=function(e){return f.yesNoDlg(d.getString("Are you sure?"),d.getString("Detach volume {{volume_name}}",{volume_name:e.volume_id})).then(function(){return i.add(d.getString("Detaching volume from instance")),o.Instances.save({action:"detach_volume",volume_id:e.volume_id,uuid:h.instance.uuid}).$promise.catch(g.handleError)})},h.loadCpuData=function(e,t){h.loaders.metrics=!0;var n={uuid:e.uuid,hours:t,metric:"cpu_util",action:"measures"};return h.cpuGraphLabels=[],h.cpuGraphData=[],o.Instances.get(n).$promise.then(function(e){return angular.forEach(e.measures,function(e){h.cpuGraphLabels.push(moment(e.date)),h.cpuGraphData.push(e.value)}),e}).catch(function(e){return e}).finally(function(){h.loaders.metrics=!1})},h.loadPortData=function(e,t){h.loaders.metrics=!0,h.packetsData=[[],[]],h.bytesData=[[],[]],h.portLabels=[];var n={uuid:e.uuid,hours:t,metric:"interface_traffic",action:"measures"};return o.Instances.get(n).$promise.then(function(e){return angular.forEach(e.measures,function(e){h.portLabels.push(moment(e.date)),h.packetsData[0].push(e.packets_in),h.packetsData[1].push(e.packets_out),h.bytesData[0].push(e.bytes_in),h.bytesData[1].push(e.bytes_out)}),e}).catch(function(e){return e}).finally(function(){return h.loaders.metrics=!1})},h.showLogDetails=function(t,e){t.expanded=!t.expanded;var n={uuid:h.instance.uuid,action:"action_details",request_id:t.request_id};t.details||(t.details_loading=!0,t.details=o.Instances.get(n),t.details.$promise.then(function(e){t.details=e}).catch(function(e){return t.details=null,e}).finally(function(){t.details_loading=!1}))},h.associateIp=function(t,n){o.Instances.get({uuid:t.uuid,action:"associate_ip_create_options"}).$promise.then(function(e){return a.show({templateUrl:"staff/apps/osinstances/associateip/flinstanceassociateip.html",controller:"FlInstanceAssociateIpController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:t,ports:e.ports,freeIps:e.free_ips},targetEvent:n}).then(function(){return m.boost()}).catch(function(){})})},h.dissociateIp=function(e,t){return f.yesNoDlg(d.getString("Are you sure?"),d.getString("Disassociate floating IP {{ip_address}}",{ip_address:t}),d.getString("Disassociate floating IP")).then(function(){o.Instances.save({uuid:e.uuid,action:"remove_floating_ip",ip:t}).$promise.then(function(){i.add(d.getString("Disassociate IP scheduled")),a.hide()},function(e){i.add(e)})}).catch(function(){})},h.addPort=function(t,n){o.Instances.get({uuid:t.uuid,action:"add_port_options"}).$promise.then(function(e){return a.show({templateUrl:"staff/apps/osinstances/addport/flinstanceaddport.html",controller:"FlInstanceAddPortController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{instance:t,networks:e.networks,project_id:e.project_id},targetEvent:n}).then(function(){return m.boost()}).catch(function(){})})},h.removePort=function(e){return f.yesNoDlg(d.getString("Are you sure?"),d.getString("Delete port {{port_name}}",{port_name:e.name}),d.getString("Delete port")).then(function(){o.Ports.delete({id:e.id}).$promise.then(function(){return i.add(d.getString("Remove port scheduled")),a.hide(),m.boost()})}).catch(function(){})},h.addIp=function(t,n,i){o.Instances.get({uuid:t.uuid,action:"add_ip_options"}).$promise.then(function(e){!function(e,t,n,i){var o=!1;if(void 0!==n){for(var r=0;r<e.ports.length;r++)e.ports[r].id===n.id&&(e.ports=[e.ports[r]]);o=!0}a.show({templateUrl:"staff/apps/osinstances/addip/flinstanceaddip.html",controller:"FlInstanceAddIpController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{instance:i,networks:e.networks,ports:e.ports,select_port_locked:o},targetEvent:t}).then(function(){return m.boost()}).catch(function(){})}(e,n,i,t)})},h.automaticAddIp=function(t,n){o.Instances.get({uuid:t.uuid,action:"add_ip_options"}).$promise.then(function(e){return a.show({templateUrl:"staff/apps/osinstances/automaticaddips/flinstanceautomaticaddips.html",controller:"FlInstanceAutomaticAddIpController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{instance:t,networks:e.networks,ports:e.ports},targetEvent:n}).then(function(){return h.prev_net_details=angular.copy(h.instance.net_details),m.boost()}).catch(function(){})})},h.removeIp=function(e,t,n){return f.yesNoDlg(d.getString("Are you sure?"),d.getString("Delete IP {{ip}}",{ip:t.ip_address}),d.getString("Delete IP")).then(function(){o.Ports.save({id:e.id,action:"remove_ip"},{fixed_ips:[{ip_address:t.ip_address,subnet_id:t.subnet_id}],region:n}).$promise.then(function(){i.add(d.getString("Remove IP scheduled")),h.submitPending=!1,a.hide()})}).catch(function(){})},h.associateSecurityGroup=function(t,n){o.Instances.get({uuid:t.uuid,action:"associate_security_group_create_options"}).$promise.then(function(e){return a.show({templateUrl:"staff/apps/osinstances/associatesecuritygroup/flassociatesecuritygroup.html",controller:"FlAssociateSecurityController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:t,securityGroups:angular.copy(e.groups)},targetEvent:n}).then(m.boost.bind(m)).catch(function(){})})},h.dissociateSecurityGroup=function(e,t){return f.yesNoDlg(d.getString("Are you sure?"),d.getString("Dissociate security group {{sec_group}} from instance {{instance}}",{sec_group:t.name,instance:e.name}),d.getString("Dissociate security group")).then(function(){o.Instances.save({uuid:e.uuid,action:"dissociate_security_group",group:t.id}).$promise.then(function(){return i.add(d.getString("Dissociate security group scheduled")),a.hide(),m.boost()})}).catch(function(){})},h.fetchInstanceBackups=function(e){return h.loaders.backups=e,o.Instances.get({uuid:h.instance.uuid,action:"get_instance_backups_and_backup_schedules"}).$promise.then(function(e){h.backupSchedules=e.schedules,h.backups=e.backups,h.loaders.backups=!1}).catch(function(e){g.handleError(e),h.loaders.backups=!1})},h.deleteBackupSchedule=function(e,t){return f.yesNoDlg(d.getString("Are you sure?"),d.getString("Delete backup schedule {{name}}",{name:t}),d.getString("Delete")).then(function(){return o.BackupSchedules.delete({id:e}).$promise.then(function(e){h.fetchInstanceBackups(!0),i.add(d.getString("Backup schedule deleted"))}).catch(g.handleError)}).catch(function(){})},h.addBackupSchedule=function(e){return a.show({templateUrl:"commons/osbackup/fl-backupschedules-create-dialog.html",controller:"FlBackupSchedulesController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:h.instance},targetEvent:e}).then(function(){}).catch(function(){h.fetchInstanceBackups(!1)})},h.createNewBackup=function(e){return a.show({templateUrl:"commons/osbackup/fl-osbackups-create-dialog.html",controller:"FlOsBackupsController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:h.instance},targetEvent:e}).then(function(){}).catch(function(){h.fetchInstanceBackups(!1)})},h.$onDestroy=function(){m.teardown(),n.uninit()}}angular.module("fleioStaff").component("flInstanceDetails",{templateUrl:"staff/apps/osinstances/flinstancedetail.html",controller:e,bindings:{instance:"<",permissions:"<"}}),e.$inject=["FlOsApi","$stateParams","FlNotificationService","FlOsTimer","FlDetectIdleService","$mdDialog","FlFeatureService","$state","FlObjectList","FlResourceService","CONFIG","gettextCatalog","FlOsChartService","FlUiUtilsService","FlResolveErrorHandler"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s){var l=this;l.$onInit=function(){l.instance={},l.rebuildOptions&&l.rebuildOptions.instance&&l.rebuildOptions.instance.name&&(l.instance.name=l.rebuildOptions.instance.name),l.goBackOrToState=o.goBackOrToState,l.showUserData=s.show_userdata_on_new_instance_form,l.showRootPasswordFieldOnNewInstanceForm=s.show_root_password_field_on_new_instance_form,l.rootPasswordMandatory=s.root_password_mandatory_on_new_instance_form},l.toggleSidenav=function(e){a.toggle(e)},l.onSelectBootSource=function(e){(l.bootSource=e).object&&e.object.id&&(l.instance.image=e.object.id),l.toggleSidenav("bootSource")},l.bootSourceIsWindows=function(){return l.bootSource&&l.bootSource.object&&"windows"===l.bootSource.object.os_distro},l.rebuildInstance=function(){if(document.activeElement.blur(),!l.submitPending&&!l.newInstance.$invalid)return l.submitPending=!0,l.instance.uuid=n.id,l.instance.action="rebuild",l.instance.ssh_keys&&(l.instance.ssh_keys=JSON.stringify(l.instance.ssh_keys)),e.Instances.save(l.instance).$promise.then(function(e){i.add(r.getString("Instance rebuild scheduled")),t.go("openstackInstances")}).catch(function(e){l.backendErrors=e.data,l.submitPending=!1})}}angular.module("fleioStaff").component("flInstanceRebuild",{templateUrl:"staff/apps/osinstances/rebuild/flinstancerebuild.html",controller:e,bindings:{rebuildOptions:"<"}}),e.$inject=["FlOsApi","$state","$stateParams","FlNotificationService","FlUiUtilsService","gettextCatalog","FlRightNavService","CONFIG"]}(),function(){"use strict";function e(t,e,n){var i=this;i.name=n.name,i.instance=n,i.renameInstance=function(){if(document.activeElement.blur(),!i.renameInstanceForm.$invalid&&!i.submitPending)return i.submitPending=!0,e.Instances.save({uuid:i.instance.uuid,action:"rename",name:i.name}).$promise.then(function(e){return t.hide(i.name)},function(e){return i.backendErrors=e.data,i.submitPending=!1})},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlInstanceRenameController",e),e.$inject=["$mdDialog","FlOsApi","instance"]}(),function(){"use strict";function e(t,e,n){var i=this;function o(){i.submitPending=!0,e.Instances.get({uuid:n.uuid,action:"migrate_options"}).$promise.then(function(e){i.instance=n,i.migrate_options=e,i.migrate={hypervisor:i.migrate_options.hypervisors.length?i.migrate_options.hypervisors[0].name:"",current_hypervisor:i.migrate_options.current_hypervisor,block_migration:!1,live_migrate:!0},i.submitPending=!1},function(e){i.submitPending=!1})}i.onInit=o,i.migrateInstance=function(){if(document.activeElement.blur(),!i.migrateInstanceForm.$invalid&&!i.submitPending)return i.submitPending=!0,e.Instances.save({uuid:i.instance.uuid,action:"migrate"},i.migrate).$promise.then(function(e){return t.hide(i.name)},function(e){return i.backendErrors=e.data,i.submitPending=!1})},i.close=function(){return t.cancel()},o()}angular.module("fleioStaff").controller("FlInstanceMigrateController",e),e.$inject=["$mdDialog","FlOsApi","instance"]}(),function(){"use strict";function e(t,e,n){var i=this;i.client_id=null,i.instance=n,i.moveInstance=function(){if(document.activeElement.blur(),!i.moveInstanceForm.$invalid&&!i.submitPending)return i.submitPending=!0,e.Instances.save({uuid:i.instance.uuid,action:"move",client:i.client_id}).$promise.then(function(e){return t.hide(i.name)},function(e){return i.backendErrors=e.data,i.submitPending=!1})},i.close=function(){return t.cancel()},i.onClientChanged=function(e){}}angular.module("fleioStaff").controller("FlInstanceMoveController",e),e.$inject=["$mdDialog","FlOsApi","instance"]}(),function(){"use strict";function e(t,n,i,o,e,r){var a=this;a.goBackOrToState=e.goBackOrToState,a.image_type="pub",a.instance={},a.bootFromIsoInstance=function(e){if(document.activeElement.blur(),!a.submitPending&&!a.newInstance.$invalid)return a.submitPending=!0,t.Instances.save({image:e.image,uuid:i.id,action:"boot_from_iso"}).$promise.then(function(e){return o.add(r.getString("Instance boot from ISO scheduled")),n.go("openstackInstanceDetails",{id:i.id}),e},function(e){return a.backendErrors=e.data,a.submitPending=!1})}}angular.module("fleioStaff").component("flInstanceBootFromIso",{templateUrl:"staff/apps/osinstances/bootfromiso/flinstancebootfromiso.html",controller:e,bindings:{bootFromIsoOptions:"<"}}),e.$inject=["FlOsApi","$state","$stateParams","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(t,n,i,e,o,r,a){var s=this;s.$onInit=function(){s.goBackOrToState=r.goBackOrToState,s.instance=s.resizeOptions.instance,delete s.instance.flavor,s.current_flavor=e("filter")(s.resizeOptions.flavors,{id:s.resizeOptions.instance.flavor})[0],s.flavorChanged=function(e){e?s.instance.flavor=e.id:delete s.instance.flavor}},s.resizeInstance=function(e){return s.instance.flavor?r.yesNoDlgCustom(null,a.getString("Resize instance?"),a.getString("Resize instance"),a.getString("Instance resize will cause downtime. The instance will shutdown and the disk image will be copied to a new disk. This may take a while, depending on the disk size."),"warning","").then(function(){if(document.activeElement.blur(),!s.submitPending&&!s.newInstance.$invalid)return s.submitPending=!0,t.Instances.save({uuid:s.instance.uuid,flavor:s.instance.flavor,action:"resize"}).$promise.then(function(e){return o.add(a.getString("Instance resize scheduled")),n.go("openstackInstanceDetails",{id:i.id})}).catch(function(e){return s.backendErrors=e.data,s.submitPending=!1})}).catch(function(){}):o.add(a.getString("You must select a flavor first!"))}}angular.module("fleioStaff").component("flInstanceResize",{templateUrl:"staff/apps/osinstances/resize/flinstanceresize.html",controller:e,bindings:{resizeOptions:"<"}}),e.$inject=["FlOsApi","$state","$stateParams","$filter","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(t,n,i,o,e,r){var a=this;a.goBackOrToState=e.goBackOrToState,a.image_type="pub",a.instance={},a.rescueInstance=function(e){if(document.activeElement.blur(),!a.submitPending&&!a.newInstance.$invalid)return a.submitPending=!0,t.Instances.save({image:e.image,root_password:e.root_password,uuid:i.id,action:"rescue"}).$promise.then(function(e){return o.add(r.getString("Instance rescue scheduled")),n.go("openstackInstanceDetails",{id:i.id}),e},function(e){return a.backendErrors=e.data,a.submitPending=!1})}}angular.module("fleioStaff").component("flInstanceRescue",{templateUrl:"staff/apps/osinstances/rescue/flinstancerescue.html",controller:e,bindings:{rescueOptions:"<"}}),e.$inject=["FlOsApi","$state","$stateParams","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,i,o,r,a){var s=this;s.instance={ports:r,free_ips:a,port:r[0],ip:a[0]},s.associateIp=function(){document.activeElement.blur(),s.associateIpForm.$invalid||s.submitPending||(s.submitPending=!0,t.Instances.save({uuid:i.uuid,action:"add_floating_ip",floating_ip:s.instance.ip,fixed_ip:s.instance.port}).$promise.then(function(){n.add(o.getString("Associate IP scheduled")),e.hide()},function(e){s.backendErrors=e.data,s.submitPending=!1}))},s.close=function(){return e.cancel()}}angular.module("fleioStaff").controller("FlInstanceAssociateIpController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog","ports","freeIps"]}(),function(){"use strict";function e(e,t,n,i,o,r){var a=this;a.instance={ips:r,ip:r[0].floating_ip_address},a.dissociateIp=function(){document.activeElement.blur(),a.dissociateIpForm.$invalid||a.submitPending||(a.submitPending=!0,t.Instances.save({uuid:i.uuid,action:"remove_floating_ip",ip:a.instance.ip}).$promise.then(function(){n.add(o.getString("IP dissociated")),e.hide()},function(e){a.backendErrors=e.data,a.submitPending=!1}))},a.close=function(){return e.cancel()}}angular.module("fleioStaff").controller("FlInstanceDissociateIpController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog","ips"]}(),function(){"use strict";function e(t,n,i,e,o,r,a){var s=this;s.init=function(){s.networks=r,s.port={fixed_ips:[],project:a,network:r[0].id,device_id:e.uuid,device_owner:"compute:nova",region:e.region,attach_to:"instance"},s.changeSubnets()},s.changeSubnets=function(){for(var e=0;e<s.networks.length;e++)if(s.networks[e].id==s.port.network){s.subnets=s.networks[e].subnets,s.port.subnet=s.subnets[0].id;break}},s.addPort=function(){if(document.activeElement.blur(),!s.addPortForm.$invalid&&!s.submitPending){s.submitPending=!0;var e=angular.copy(s.port);0===s.port.fixed_ips.length&&s.port.subnet&&(e.fixed_ips=[{subnet_id:s.port.subnet}]),n.Ports.save(e).$promise.then(function(){i.add(o.getString("Add port scheduled")),s.submitPending=!1,t.hide()},function(e){s.backendErrors=e.data,s.submitPending=!1})}},s.addIp=function(){s.port.fixed_ips.push({ip_address:""})},s.removeIp=function(e){0<s.port.fixed_ips.length&&s.port.fixed_ips.splice(e,1)},s.close=function(){return t.cancel()},s.init()}angular.module("fleioStaff").controller("FlInstanceAddPortController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog","networks","project_id"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s){var l=this;l.init=function(){l.networks=r,l.ports=a,l.select_port_locked=s,l.port={fixed_ips:[{ip_address:""}],device_id:i.uuid,device_owner:"compute:nova",region:i.region,append_ip:!0,port:a[0].id},l.changeSubnets()},l.changeSubnets=function(){for(var e=0;e<l.ports.length;e++)if(l.port.port==l.ports[e].id){for(var t=0;t<l.networks.length;t++)if(l.ports[e].network===l.networks[t].id){l.subnets=l.networks[t].subnets,l.port.subnet=l.subnets[0].id;break}break}},l.updatePort=function(){document.activeElement.blur(),l.addPortForm.$invalid||l.submitPending||(l.submitPending=!0,t.Ports.save({id:l.port.port,action:"add_ip"},l.port).$promise.then(function(){n.add(o.getString("Add IP(s) scheduled")),l.submitPending=!1,e.hide()},function(e){l.backendErrors=e.data,l.submitPending=!1}))},l.addIp=function(){l.port.fixed_ips.push({ip_address:""})},l.removeIp=function(e){1<l.port.fixed_ips.length&&l.port.fixed_ips.splice(e,1)},l.close=function(){return e.cancel()},l.init()}angular.module("fleioStaff").controller("FlInstanceAddIpController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog","networks","ports","select_port_locked"]}(),function(){"use strict";function e(n,i,o,r,a,e,t){var s=this;s.init=function(){s.networks=e,s.ports=t,s.$ips=1,s.port={region:r.region,port:t[0].id},s.changeSubnets()},s.changeSubnets=function(){for(var e=0;e<s.ports.length;e++)if(s.port.port==s.ports[e].id){for(var t=0;t<s.networks.length;t++)if(s.ports[e].network===s.networks[t].id){s.subnets=s.networks[t].subnets,s.port.subnet=s.subnets[0].id;break}break}},s.updatePort=function(){if(document.activeElement.blur(),!s.addPortForm.$invalid&&!s.submitPending){s.submitPending=!0;var e={fixed_ips:[]};e.region=r.region;for(var t=0;t<s.ips;t++)e.fixed_ips.push({subnet_id:s.port.subnet});i.Ports.save({id:s.port.port,action:"automatic_add_ips"},e).$promise.then(function(){o.add(a.getString("Add IP(s) scheduled")),s.submitPending=!1,n.hide()},function(e){s.backendErrors=e.data,s.submitPending=!1})}},s.close=function(){return n.cancel()},s.init()}angular.module("fleioStaff").controller("FlInstanceAutomaticAddIpController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog","networks","ports"]}(),function(){"use strict";function e(e,t,n,i){var o=this;o.init=function(){o.instance={ports:i};for(var e=0;e<o.instance.ports.length;e++){o.instance.ports[e].ips="";for(var t=0;t<o.instance.ports[e].fixed_ips.length;t++)t==o.instance.ports[e].fixed_ips.length-1?o.instance.ports[e].ips+=o.instance.ports[e].fixed_ips[t].ip_address:o.instance.ports[e].ips+=o.instance.ports[e].fixed_ips[t].ip_address+", "}},o.removePort=function(){document.activeElement.blur(),o.removePortForm.$invalid||o.submitPending||(o.submitPending=!0,i[o.instance.port].$delete().then(function(){t.add(n.getString("Port removed")),e.hide()},function(e){o.backendErrors=e.data,o.submitPending=!1}))},o.close=function(){return e.cancel()},o.init()}angular.module("fleioStaff").controller("FlInstanceRemovePortController",e),e.$inject=["$mdDialog","FlNotificationService","gettextCatalog","ports"]}(),function(){"use strict";function e(n,i,o,r,a,s){var l=this;l.init=function(){l.instance={ips:[]};for(var e=0;e<r.length;e++)for(var t=0;t<r[e].fixed_ips.length;t++)r[e].fixed_ips[t].port_index=e,l.instance.ips.push(r[e].fixed_ips[t])},l.updatePort=function(){if(document.activeElement.blur(),!l.removeIpForm.$invalid&&!l.submitPending){l.submitPending=!0;var e=l.instance.ips[l.instance.ip].port_index;if(1==r[e].fixed_ips.length)r[e].$delete().then(function(){i.add(o.getString("IP removed")),n.hide()},function(e){l.backendErrors=e.data,l.submitPending=!1});else{var t=l.instance.ips[l.instance.ip];a.Ports.save({id:r[e].id,action:"remove_ip"},{fixed_ips:[{ip_address:t.ip_address,subnet_id:t.subnet_id}],region:s}).$promise.then(function(){i.add(o.getString("IP removed")),l.submitPending=!1,n.hide()},function(e){l.backendErrors=e.data,l.submitPending=!1})}}},l.close=function(){return n.cancel()},l.init()}angular.module("fleioStaff").controller("FlInstanceRemoveIpController",e),e.$inject=["$mdDialog","FlNotificationService","gettextCatalog","ports","FlOsApi","region"]}(),function(){"use strict";function e(e,t,n,i,o){var r=this;r.password="",r.changePasswordForm={},r.instance=i,r.changePassword=function(){document.activeElement.blur(),r.changePasswordForm.$invalid||r.submitPending||(r.submitPending=!0,t.Instances.save({uuid:i.uuid,action:"change_password",password:r.password}).$promise.then(function(){n.add(o.getString("Admin password changed successfully")),e.hide()},function(e){r.backendErrors=e.data,r.submitPending=!1}))},r.close=function(){return e.cancel()}}angular.module("fleioStaff").controller("FlInstanceChangePasswordController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog"]}(),function(){"use strict";function e(r,t,a,n,i,e,o,s,l,c,u,d,p){var f=this;function g(e,t){return e.filter(function(e){return e.id===t})}function m(e,t){var n=null,i=!1,o=!1,r=!1;if(f.createOptions&&f.createOptions.bootSources&&f.createOptions.bootSources.requested_boot_source&&(i=!0,f.createOptions.bootSources.requested_image&&f.createOptions.bootSources.requested_image.length?r=!0:f.createOptions.bootSources.requested_volume&&f.createOptions.bootSources.requested_volume.length&&(o=!0)),t=t||{},i&&r)n={type:"requested_image",object:f.createOptions.bootSources.requested_image[0],options:t};else if(i&&o)n={type:"requested_volume",object:f.createOptions.bootSources.requested_volume[0],options:t};else{var a=g(f.createOptions.bootSources.image,e);if(a.length)n={type:"image",object:a[0],options:t};else{var s=g(f.createOptions.bootSources.shared_image,e);if(s.length)n={type:"shared_image",object:s[0],options:t};else{var l=g(f.createOptions.bootSources.owned_image,e);if(l.length)n={type:"owned_image",object:l[0],options:t};else{var c=g(f.createOptions.bootSources.volume,e);if(c.length)n={type:"volume",object:c[0],options:t};else{var u=g(f.createOptions.bootSources.volume_snapshot,e);u.length&&(n={type:"volume_snapshot",object:u[0],options:t})}}}}}return n}function h(e,t){e&&t&&(t.boot_source={source_type:e.type,source_id:e.object.id},e.options&&(t.boot_source.delete_on_termination=e.options.delete_on_termination,t.boot_source.create_new_volume=e.options.create_new_volume,t.boot_source.volume_size=e.options.volume_size,t.boot_source.volume_type=e.options.volume_type))}function v(e,t){return!0===t||!!(f.instance.boot_source&&-1<["image","owned_image","shared_image","community_image"].indexOf(f.bootSource.type)&&f.instance.boot_source.source_id===e.id)&&e.assigned_to_flavor}function _(e){var t=Number.MAX_VALUE,n=Number.MAX_VALUE;e&&(t=e.memory_gb,n=e.root_gb);var i,o,r=!1;for(i=0;i<f.createOptions.bootSources.image.length;i++)(o=f.createOptions.bootSources.image[i]).disabled=o.min_disk>n||o.min_ram/1024>t,r=v(o,r);for(i=0;i<f.createOptions.bootSources.owned_image.length;i++)(o=f.createOptions.bootSources.owned_image[i]).disabled=o.min_disk>n||o.min_ram/1024>t,r=v(o,r);for(i=0;i<f.createOptions.bootSources.shared_image.length;i++)(o=f.createOptions.bootSources.shared_image[i]).disabled=o.min_disk>n||o.min_ram/1024>t,r=v(o,r);for(i=0;i<f.createOptions.bootSources.community_image.length;i++)(o=f.createOptions.bootSources.community_image[i]).disabled=o.min_disk>n||o.min_ram/1024>t,r=v(o,r);!f.isFlavorDisabled(e)&&r||(f.instance.boot_source=null,f.bootSource=null)}f.$onInit=function(){f.flavorsAsCards=p.flavors_as_cards,f.hideNetworksIfOnlyOneAvailable=p.hide_networks_if_only_one_available,f.showRootPasswordFieldOnNewInstanceForm=p.show_root_password_field_on_new_instance_form,f.rootPasswordMandatory=p.root_password_mandatory_on_new_instance_form,f.showUserData=p.show_userdata_on_new_instance_form,f.current_state=t.current.name,f.features=s.features,f.computeStorageEnabled=p.local_compute_storage_enabled,f.fromLaunchImage=a.fromLaunchImage,f.flavors=f.createOptions.flavor,a.fromNewImage?(f.instance=d.popObject("instance"),f.instance.region=f.createOptions.selected_region,f.selectedClient=d.popObject("instanceSelectedClient")):f.instance={region:f.createOptions.selected_region,share_image:!1},f.createOptions.bootSources&&f.createOptions.bootSources.requested_boot_source&&(f.createOptions.bootSources.requested_image?(f.bootSource=m(f.createOptions.bootSources.requested_image[0].id),f.instance.region=f.createOptions.bootSources.requested_image[0].region):f.createOptions.bootSources.requested_volume&&(f.bootSource=m(f.createOptions.bootSources.requested_volume[0].id),f.instance.region=f.createOptions.bootSources.requested_volume[0].region)),f.bootSource&&h(f.bootSource,f.instance),f.preselectPublicNics(f.createOptions.nics),f.goBackOrToState=e.goBackOrToState,f.translatedStringsMap={flavor_incompatibility_brief:l.getString("Not compatible with\nselected boot source"),flavor_incompatibility:l.getString("The selected image source requires\na flavor with more resources.\nSelect a flavor with more resources\nor use a different image source.")}},f.shareImageDialog=function(e){return n.show({templateUrl:"staff/apps/osinstances/create/flshareimage.html",controller:"FlShareImageController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,bindToController:!0,locals:{client:f.selectedClient},targetEvent:e}).then(function(e){f.instance.share_image=!0}).catch(function(e){f.instance.share_image=!1,f.selectedClient.id!==f.previousSelectedClient.id&&(f.selectedClient=f.previousSelectedClient)})},f.getFlavorSelectDisplay=function(){return f.flavor?"<span class='fl-ellipsis-text'>"+f.flavor.name+"</span>":"Select a configuration"},f.setInstanceFlavor=function(){f.flavor&&f.flavor.id?f.instance.flavor=f.flavor.id:f.instance.flavor=null},f.onSelectBootSource=function(e){c.toggle("bootSource"),f.bootSource=e,h(f.bootSource,f.instance),f.flavorsAsCards||function(){f.bootSource&&"image"===f.bootSource.type?f.refreshFlavors():f.flavors=f.createOptions.flavor;if(!f.bootSource){if(f.flavorsAsCards)return f.selectedFlavorIsIncompatible=!0;f.instance.flavor=null,f.flavor=null}if(!(f.bootSource&&f.bootSource.options&&f.bootSource.options.create_new_volume)&&f.flavor&&f.bootSource&&-1<["image","owned_image","shared_image"].indexOf(f.bootSource.type)&&(f.bootSource.object.min_disk>f.flavor.root_gb||f.bootSource.object.min_ram>f.flavor.memory_mb)){if(f.flavorsAsCards)return f.selectedFlavorIsIncompatible=!0;f.instance.flavor=null,f.flavor=null}f.selectedFlavorIsIncompatible=!1}()},f.toggleSidenav=function(e){d.pushObject("instance",f.instance),d.pushObject("instanceSelectedClient",f.selectedClient),c.toggle(e)},f.closeNetworkSelect=function(){u.hide()},f.refreshCreateOptions=function(e,t,n,i){var o={action:"create_options",region:e,client:t};return a.image&&!n?n=a.image.id:a.volume&&!i&&(i=a.volume.id),n?o.image=n:i&&(o.volume=i),r.Instances.get(o).$promise.then(function(e){return f.instance.nics=[],f.createOptions=e,f.newInstance.$setPristine(),f.bootSource={},f.instance.boot_source=null,f.preselectPublicNics(f.createOptions.nics),e})},f.preselectPublicNics=function(e){if(1===e.length&&f.hideNetworksIfOnlyOneAvailable)f.instance.nics=[e[0].id];else if(e&&e.length&&p.preselect_public_networks)for(var t=0;t<e.length;t++)for(var n=0;n<e[t].tags.length;n++)if("public"===e[t].tags[n].tag_name)return void(f.instance.nics=[e[t].id])},f.searchClient=function(e){return o.get({search:e,has_enabled_project:"True"}).$promise.then(function(e){return e.objects})},f.onRegionChange=function(){f.refreshCreateOptions(f.instance.region,f.instance.client).then(function(e){f.flavors=e.flavor,function(e){if(e&&f.flavor&&f.flavor.name&&f.flavor.memory_mb)for(var t=0;t<e.length;t++)if(e[t].name===f.flavor.name&&e[t].memory_mb===f.flavor.memory_mb)return f.flavor=e[t],f.instance.flavor=f.flavor.id,f.flavorChanged(f.flavor);f.flavor=null,f.instance.flavor=null}(e.flavor)})},f.refreshFlavors=function(){var e={image_id:f.bootSource.object.id,action:"get_flavors_assigned_to_image"};f.selectedClient&&(e.selected_client_id=f.selectedClient.id),f.loading=!0,r.Instances.get(e).$promise.then(function(e){f.flavors=e.flavors;for(var t=!1,n=0;n<f.flavors.length;n++)f.flavor&&f.flavors[n].id===f.flavor.id&&(t=!0);t?f.selectedFlavorIsIncompatible=!!f.isFlavorDisabled(f.flavor):(f.instance.flavor=null,f.flavor=null,f.selectedFlavorIsIncompatible=!1)}).catch(function(e){f.loading=!1,i.add(e.data.detail)})},f.refreshImages=function(t){var e;!0===f.fromLaunchImage&&f.flavorsAsCards||(t?(f.loading=!0,e={selected_flavor_id:t.id,region:f.instance.region,action:"get_images_assigned_to_flavors_or_flavor_group"},f.selectedClient&&(e.selected_client_id=f.selectedClient.id),r.Instances.get(e).$promise.then(function(e){f.loading=!1,e.hasOwnProperty("bootSources")&&(f.createOptions.bootSources.image=e.bootSources.image,f.createOptions.bootSources.owned_image=e.bootSources.owned_image,f.createOptions.bootSources.shared_image=e.bootSources.shared_image,f.createOptions.bootSources.community_image=e.bootSources.community_image),_(t)}).catch(function(e){i.add(e.data.detail),f.loading=!1})):(e={region:f.instance.region,action:"get_images_assigned_to_flavors_or_flavor_group"},f.selectedClient&&(e.selected_client_id=f.selectedClient.id),r.Instances.get(e).$promise.then(function(e){f.loading=!1,f.createOptions.bootSources.image=e.bootSources.image,f.createOptions.bootSources.owned_image=e.bootSources.owned_image,f.createOptions.bootSources.shared_image=e.bootSources.shared_image,f.createOptions.bootSources.community_image=e.bootSources.community_image,_(t)}).catch(function(e){i.add(e.data.detail),f.loading=!1})))},f.flavorChanged=function(e){f.flavorsAsCards&&f.refreshImages(e)},f.isFlavorDisabled=function(e){return!!(f.bootSource&&-1<["image","owned_image","community_image"].indexOf(f.bootSource.type))&&(f.bootSource.object.min_disk>e.root_gb||f.bootSource.object.min_ram>e.memory_mb)},f.selectedClientChange=function(n){if(void 0!==n){f.instance.client=n.id;var t={};f.bootSource&&f.bootSource.options&&angular.copy(f.bootSource.options,t),f.refreshCreateOptions(f.instance.region,f.instance.client).then(function(e){return e.bootSources&&e.bootSources.requested_boot_source&&(e.bootSources.requested_image&&e.bootSources.requested_image[0].id?f.bootSource=m(e.bootSources.requested_image[0].id,t):e.bootSources.requested_volume&&e.bootSources.requested_volume[0].id&&(f.bootSource=m(e.bootSources.requested_volume[0].id,t)),f.bootSource&&h(f.bootSource,f.instance)),-1<["image","owned_image","shared_image","requested_image"].indexOf(f.bootSource.type)&&function(e,t){r.Images.save({id:e,action:"available_to_client"},{client:t}).$promise.then(function(e){if(e.needsSharing&&!f.instance.share_image)return f.shareImageDialog()})}(f.instance.boot_source.source_id,n.id),f.flavor&&f.flavorsAsCards&&f.refreshImages(f.flavor),e}).catch(function(e){n.id!==f.previousSelectedClient.id&&(f.selectedClient=f.previousSelectedClient);var t="An error occurred while changing client";e&&e.data&&e.data.detail&&(t=e.data.detail),i.add(t)})}},f.bootSourceIsWindows=function(){return f.bootSource&&f.bootSource.object&&"windows"===f.bootSource.object.os_distro},f.bootSourceIsIso=function(){return f.bootSource&&f.bootSource.object&&f.bootSource.object.is_iso},f.switchUserData=function(){!0!==f.userdata&&delete f.instance.user_data},f.newInstanceSubmit=function(){if(document.activeElement.blur(),!f.submitPending&&!f.newInstance.$invalid)return f.submitPending=!0,f.instance.ssh_keys&&(f.instance.ssh_keys=JSON.stringify(f.instance.ssh_keys)),r.Instances.save(f.instance).$promise.then(function(e){return i.add(l.getString("Instance create scheduled")),t.current.name===f.current_state&&t.go("openstackInstances"),e}).catch(function(e){f.backendErrors=e.data}).finally(function(){f.submitPending=!1})}}angular.module("fleioStaff").component("flInstanceCreate",{templateUrl:"staff/apps/osinstances/create/flinstancecreate.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["FlOsApi","$state","$stateParams","$mdDialog","FlNotificationService","FlUiUtilsService","FlClientApi","FlFeatureService","gettextCatalog","FlRightNavService","$mdSelect","GlobalData","CONFIG"]}(),function(){"use strict";function e(t,n,e,o,r){var a=this;a.$onInit=function(){if(a.selected={image:null,owned_image:null,shared_image:null,volume:null,volume_snapshot:null,requested_image:null,requested_volume:null},a.features=o.features,a.computeStorageEnabled=!!a.computeStorageEnabled,a.storageType=a.computeStorageEnabled?"local":"",a.volumesEnabled=!!a.volumesEnabled,a.selSource={type:"image",options:{create_new_volume:!a.computeStorageEnabled,delete_on_termination:!1,volume_type:""}},a.initial&&a.initial.type&&a.initial.object&&a.bootSources&&a.bootSources[a.initial.type])for(var e=a.initial.type,t=a.bootSources[e],n=0;n<t.length;n++)if(t[n].id===a.initial.object.id){if(a.selected[e]=t[n],a.selSource.type=e,a.selSource.object=a.initial.object,a.initial.options){for(var i in a.initial.options)a.initial.options.hasOwnProperty(i)&&(a.selSource.options[i]=a.initial.options[i]);a.initial.options.volume_type&&a.initial.options.create_new_volume&&(a.storageType=a.initial.options.volume_type)}break}a.getImageDisabledReason=function(e){return e.assigned_to_flavor?r.getString("Image requires a flavor\nwith more resources."):r.getString("Image is not assigned\nto the selected flavor\nor flavor group.")},a.selectStorageType(),a.setBootVolumeSize()},a.selectStorageType=function(){if("local"!==a.storageType){a.selSource.options.create_new_volume=!0,a.selSource.options.volume_type=a.storageType,a.sizeIncrement||(a.sizeIncrement=1),a.setBootVolumeSize();var t=1;a.selSource.options.volume_type&&a.bootSources.volume_types.forEach(function(e){e.name===a.selSource.options.volume_type&&(t=e.sizeIncrement)}),a.sizeIncrement=t}else a.selSource.options.create_new_volume=!1},a.sourceNotSelected=function(){return null===a.selected[a.selSource.type]},a.invalidSelection=function(){return"local"===a.storageType?a.sourceNotSelected():a.sourceNotSelected()||!a.validVolumeSize()},a.validVolumeSize=function(){var e=-1<["image","owned_image","community_image","shared_image","requested_image"].indexOf(a.selSource.type);return void 0!==a.selSource.options.volume_size&&!(e&&a.selected[a.selSource.type]&&a.selected[a.selSource.type].min_disk&&a.selSource.options.volume_size<a.selected[a.selSource.type].min_disk)},a.doubleClickedImage=function(){a.setBootVolumeSize(),a.selectBootSource()},a.setBootVolumeSize=function(){if(-1<["image","owned_image","community_image","shared_image","requested_image"].indexOf(a.selSource.type)&&a.selSource.options){var e=a.selSource.options.volume_size?a.selSource.options.volume_size:a.sizeIncrement;a.selected&&a.selected[a.selSource.type]&&a.selected[a.selSource.type].min_disk>e?a.selSource.options.volume_size=a.selected[a.selSource.type].min_disk:a.selSource.options.volume_size=e}},a.changeBootSource=function(e){a.selSource.type=e},a.showVolumeOptions=function(){return a.volumesEnabled&&-1<["image","owned_image","shared_image","community_image","requested_image"].indexOf(a.selSource.type)},a.selectBootSource=function(){if("image"===a.selSource.type&&a.selected.image.is_iso&&a.selSource.options.create_new_volume)t.messagesDlg([n("Booting from ISO only works with local storage, please select another image.")],n("Cannot boot from ISO to volume"));else{var e=a.selSource.type;a.selSource.object=a.selected[e],a.onSelect({source:a.selSource})}},a.cancelSelection=function(){a.onCancel()},a.uploadImage=function(){e.go("imageCreate")}}angular.module("fleioStaff").component("flBootSourceSelect",{templateUrl:"staff/apps/osinstances/create/flbootsourceselect.html",controller:e,bindings:{bootSources:"<",initial:"<",computeStorageEnabled:"<",volumesEnabled:"<",snapshotsEnabled:"<",onSelect:"&",onCancel:"&"}}),e.$inject=["FlUiUtilsService","gettext","$state","FlFeatureService","gettextCatalog"]}(),function(){"use strict";function e(t){this.$onInit=function(){},this.close=function(e){return e?t.hide(e):t.cancel()}}angular.module("fleioStaff").controller("FlShareImageController",e),e.$inject=["$mdDialog"]}(),function(){"use strict";function e(e,t,n){var i=this;i.$onInit=function(){i.name="",i.instance=n,i.create_snapshot_as_client=!1},i.createSnapshot=function(){i.createSnapshotForm.$invalid||i.submitPending||(i.submitPending=!0,t.Instances.save({uuid:i.instance.uuid,action:"create_snapshot",name:i.name,create_snapshot_as_client:i.create_snapshot_as_client}).$promise.then(function(){e.hide(i.name)},function(e){i.backendErrors=e.data,i.submitPending=!1}))},i.close=function(){e.cancel()}}angular.module("fleioStaff").controller("FlInstanceSnapshotController",e),e.$inject=["$mdDialog","FlOsApi","instance"]}(),function(){"use strict";function e(e,t,n,i,o,r){var a=this;a.securityGroups=r,a.instance=i,a.group=a.securityGroups.length?a.securityGroups[0].id:"",a.associateSecurityGroup=function(){document.activeElement.blur(),a.associateForm.$invalid||a.submitPending||(a.submitPending=!0,t.Instances.save({uuid:i.uuid,action:"associate_security_group",group:a.group}).$promise.then(function(){n.add(o.getString("Associate group scheduled")),e.hide()},function(e){a.backendErrors=e.data,a.submitPending=!1}))},a.close=function(){return e.cancel()}}angular.module("fleioStaff").controller("FlAssociateSecurityController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog","securityGroups"]}(),function(){"use strict";function e(e,t,n){e.state("openstackFlavors",{url:t.joinBaseUrl("openstack/flavors?page_size?ordering?filtering?search"),component:"flFlavors",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"name",squash:!0},filtering:{value:"",squash:!0}},resolve:{flavors:["$state","$stateParams","FlObjectList","FlOsApi",function(r,e,t,n){return n.Flavors.get({options:"create_options"}).$promise.then(function(e){for(var t=e.regions,n=[],i=0,o=t.length;i<o;++i)n.push({display:t[i].id,value:t[i].id});r.get("openstackFlavors").data.filtering.region.choices=n}),t(n.Flavors,e)}]},data:{stateInfo:{display:n("Flavors"),parent:"dashboard"},feature:"openstack.flavors",orderOptions:{name:n("Name"),vcpus:n("Virtual CPUs"),memory_mb:n("Memory"),root_gb:n("Disk size")},filtering:{region:{display:n("Region"),field_name:"region",type:"choices",choices:[]},memory_mb:{display:n("Memory mb"),field_name:"memory_mb",type:"decimal"},root_gb:{display:n("Root gb"),field_name:"root_gb",type:"decimal"},vcpus:{display:n("vCPUs"),field_name:"vcpus",type:"decimal"},is_public:{display:n("Is public"),field_name:"is_public",type:"bool"},flavor_group:{display:n("flavor group"),field_name:"flavor_group",type:"customModelInstance",service:"FlOsApi",service_details:{type:"openstack",items:"FlavorGroups"}}}}}).state("openstackFlavorCreate",{url:t.joinBaseUrl("openstack/flavor/create"),component:"flFlavorEdit",authenticate:!0,resolve:{createOptions:["FlOsApi",function(e){return e.Flavors.get({action:"create_options"}).$promise}]},data:{feature:"openstack.flavors",stateInfo:{display:n("Create flavor"),parent:"openstackFlavors"}}}).state("openstackFlavorEdit",{url:t.joinBaseUrl("openstack/flavor/:id/edit"),component:"flFlavorEdit",authenticate:!0,resolve:{createOptions:["FlOsApi",function(e){return e.Flavors.get({action:"create_options"}).$promise}],flavor:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.Flavors.get(e).$promise.then(function(e){return n.setParams({name:e.name}),e}).catch(i.handleError)}]},data:{feature:"openstack.flavors",stateInfo:{display:n("Edit flavor {:name}"),default:n("Edit flavor"),parent:"openstackFlavors"}}}).state("openstackFlavorsDetails",{url:t.joinBaseUrl("openstack/flavors/:id"),component:"flFlavorDetails",authenticate:!0,data:{feature:"openstack.flavors",stateInfo:{display:n("Flavor {:name}"),default:n("Flavor details"),parent:"openstackFlavors"}},resolve:{flavor:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.Flavors.get(e).$promise.then(function(e){return n.setParams({name:e.name}),e}).catch(i.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.Flavors.get({action:"permissions"}).$promise}]}}).state("openstackFlavorToClientGroups",{url:t.joinBaseUrl("openstack/flavors/:id/show-to-client-groups"),component:"flFlavorToClientGroups",authenticate:!0,data:{feature:"openstack.flavors",stateInfo:{display:n("Show flavor {:name} to client groups"),default:n("Show flavor to client groups"),parent:"openstackFlavors"}},resolve:{flavor:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.Flavors.get(e).$promise.then(function(e){return n.setParams({name:e.name}),e}).catch(i.handleError)}]}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(t,e,n,i,o,r,a){var s,l=this;function c(){return l.flavors.fetchData()}l.$onInit=function(){o.info.enabled=!0,o.info.label=a("Search flavors"),o.info.service=l.flavors,(s=n(c,1e4)).start(),e.init(s.start.bind(s),s.stop.bind(s)),l.TRANSLATED_STRINGS_MAP={delete:r.getString("Delete"),edit:r.getString("Edit"),create:r.getString("Create flavor"),no_permission:r.getString("You are not\nallowed to do this")}},l.deleteFlavor=function(e){return t.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete flavor {{name}}",{"name:":e.name}),r.getString("Delete flavor")).then(function(){return e.$delete().then(function(e){return i.add(r.getString("Flavor delete scheduled")),e}).finally(c)}).catch(function(){})},l.$onDestroy=function(){s.teardown(),e.uninit()}}angular.module("fleioStaff").component("flFlavors",{templateUrl:"staff/apps/osflavors/flflavors.html",controller:e,bindings:{flavors:"<"}}),e.$inject=["FlUiUtilsService","FlDetectIdleService","FlOsTimer","FlNotificationService","FlSearchService","gettextCatalog","gettext"]}(),function(){"use strict";function e(t,n,e,i,o,r,a){var s,l=this;function c(){o.Flavors.get({id:l.flavor.id}).$promise.then(function(e){l.flavor=e})}l.$onInit=function(){(s=i(c,1e4)).start(),e.init(s.start.bind(s),s.stop.bind(s)),l.TRANSLATED_STRINGS_MAP={delete:a.getString("Delete"),edit:a.getString("Edit"),no_permission:a.getString("You are not\nallowed to do this")},l.flavor.properties?l.flavorProperties=JSON.parse(l.flavor.properties):l.flavorProperties=null,l.hasProperties=l.flavorProperties&&0<Object.keys(l.flavorProperties).length&&l.flavorProperties.constructor===Object},l.updateFlavor=function(){o.Flavors.patch({id:l.flavor.id,show_in_fleio:l.flavor.show_in_fleio,out_of_stock:l.flavor.out_of_stock}).$promise.finally(c)},l.deleteFlavor=function(e){return t.yesNoDlg(a.getString("Are you sure?"),a.getString("Delete flavor {{name}}",{name:e.name}),a.getString("Delete flavor")).then(function(){return e.status="pending",e.$delete().then(function(){return r.add(a.getString("Flavor delete scheduled")),n.go("openstackFlavors")}).catch(c)})},l.$onDestroy=function(){s.teardown(),e.uninit()}}angular.module("fleioStaff").component("flFlavorDetails",{templateUrl:"staff/apps/osflavors/flflavordetails.html",controller:e,bindings:{flavor:"<",permissions:"<"}}),e.$inject=["FlUiUtilsService","$state","FlDetectIdleService","FlOsTimer","FlOsApi","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(n,t,i,e,o){var r=this;r.$onInit=function(){r.flavor||(r.flavor={region:r.createOptions.selected_region,is_public:!0,show_in_fleio:!0,ephemeral_gb:0,swap:0,vcpus:1,root_gb:1}),r.goBackOrToState=e.goBackOrToState,r.isEdit=!!r.flavor.id,r.isEdit&&(r.flavor.preserve_id=!0,r.loadingProperties=!0,r.keys=[],r.flavor.properties?(r.flavorProperties=JSON.parse(r.flavor.properties),r.propertiesDictToPropertiesList()):r.flavorProperties=null,r.loadingProperties=!1)},r.propertiesDictToPropertiesList=function(){r.keys=[];var e=0;for(var t in r.flavorProperties)r.flavorProperties.hasOwnProperty(t)&&(r.keys[e]={},r.keys[e].key=t,r.keys[e].value=r.flavorProperties[t],r.keys[e].keyDisabled=!0,e++)},r.propertiesListToPropertiesDict=function(){for(var e={},t=0;t<r.keys.length;t++)e[r.keys[t].key]=r.keys[t].value;return e},r.deleteKey=function(e,t){if(""===e)return r.keys.splice(t,1);r.loadingProperties=!0,n.Flavors.post({id:r.flavor.id,action:"unset_property",property_key:e}).$promise.then(function(e){i.add(o.getString("Property removed")),r.refreshFlavorAndProperties()}).catch(function(e){r.backendPropsErrors=e.data,r.refreshFlavorAndProperties()})},r.addImageProperty=function(){r.keys.push({key:"",value:""})},r.refreshFlavorAndProperties=function(){r.loadingProperties=!0,n.Flavors.get({id:r.flavor.id}).$promise.then(function(e){r.flavor=e,r.flavor.properties?(r.flavorProperties=JSON.parse(r.flavor.properties),r.propertiesDictToPropertiesList()):r.flavorProperties=null}).finally(function(){r.loadingProperties=!1})},r.updateFlavorPropsSubmit=function(){document.activeElement.blur(),r.submitPending||r.updateFlavorProps.$invalid||(r.backendPropsErrors=null,r.loadingProperties=!0,n.Flavors.post({id:r.flavor.id,action:"set_properties",new_properties:r.propertiesListToPropertiesDict()}).$promise.then(function(e){i.add(o.getString("Flavor properties updated")),r.refreshFlavorAndProperties()}).catch(function(e){r.backendPropsErrors=e.data,r.loadingProperties=!1}))},r.flavorSubmit=function(){if(document.activeElement.blur(),!r.submitPending&&!r.newFlavor.$invalid)return r.submitPending=!0,r.flavor.id?n.Flavors.update(r.flavor).$promise.then(function(e){return i.add(o.getString("Flavor update scheduled")),t.go("openstackFlavors"),e},function(e){return r.backendErrors=e.data,r.submitPending=!1}):n.Flavors.save(r.flavor).$promise.then(function(e){return i.add(o.getString("Flavor create scheduled")),t.go("openstackFlavors"),e},function(e){return r.backendErrors=e.data,r.submitPending=!1})}}angular.module("fleioStaff").component("flFlavorEdit",{templateUrl:"staff/apps/osflavors/edit/flflavoredit.html",controller:e,bindings:{createOptions:"<",flavor:"="}}),e.$inject=["FlOsApi","$state","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(e,n,t,i,o,r){var a=this;function s(){n.Flavors.get({id:a.flavor.id}).$promise.then(function(e){a.flavor=e})}a.$onInit=function(){a.currentPage=1,a.nextPage=!1,a.previousPage=!1,a.loading=!0,a.refreshClientGroups()},a.refreshClientGroups=function(){a.loading=!0,n.Flavors.get({id:a.flavor.id,action:"get_client_groups_related_to_flavor",page:a.currentPage,page_size:10}).$promise.then(function(e){a.loading=!1,a.nextPage=!!e.next,a.previousPage=!!e.previous,a.clientGroups=e.objects})},a.changeClientsPage=function(e){"next"===e&&(a.currentPage=a.currentPage+1,a.refreshClientGroups()),"previous"===e&&(a.currentPage=a.currentPage-1,a.refreshClientGroups())},a.searchClientGroup=function(e){return n.Flavors.get({action:"get_available_client_groups_to_assign",flavor_id:a.flavor.id,search:e}).$promise.then(function(e){return e.objects})},a.selectedClientChange=function(e){void 0!==e&&(a.addClientGroupError=null)},a.assignToFlavor=function(e){if(a.submitPending=!0,!a.selectedClientGroup)return a.addClientGroupError=o.getString("Invalid input for client group"),void(a.submitPending=!1);a.addClientGroupError=null,n.Flavors.post({id:a.flavor.id,action:"assign_client_group_to_flavor",client_group:a.selectedClientGroup.id}).$promise.then(function(e){return s(),a.refreshClientGroups(),i.add(o.getString("Client group assigned to flavor")),a.submitPending=!1,a.selectedClientGroup=null,e},function(e){a.backendErrors=e.data,a.submitPending=!1})},a.removeFromGroup=function(e,t){r.yesNoDlg(o.getString("Are you sure?"),o.getString("Remove client group from flavor")).then(function(){n.Flavors.post({id:a.flavor.id,action:"remove_client_group_from_flavor",client_group:t}).$promise.then(function(e){return s(),a.refreshClientGroups(),i.add(o.getString("Client group removed from flavor")),a.selectedClientGroup=null,e}).catch(function(e){a.backendErrors=e.data})}).catch(function(){})}}angular.module("fleioStaff").component("flFlavorToClientGroups",{templateUrl:"staff/apps/osflavors/flavortoclientgroups/flavortoclientgroups.component.html",controller:e,bindings:{flavor:"<"}}),e.$inject=["FlClientGroupsApi","FlOsApi","$mdDialog","FlNotificationService","gettextCatalog","FlUiUtilsService"]}(),function(){"use strict";function e(e,t,n){e.state("openstackFlavorGroups",{url:t.base_url+"openstack/flavorgroups?page_size?ordering?filtering?search",component:"flFlavorGroups",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{flavorgroups:["$stateParams","FlObjectList","FlOsApi",function(e,t,n){return t(n.FlavorGroups,e)}]},data:{feature:"openstack.flavors",stateInfo:{display:n("Flavor groups"),parent:"dashboard"},orderOptions:{id:n("Id"),name:n("Name"),created_at:n("Created at"),priority:n("Priority")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"}}}}).state("openstackFlavorGroupDetails",{url:t.base_url+"openstack/flavorgroups/:id",component:"flFlavorGroupDetails",authenticate:!0,resolve:{flavorgroup:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.FlavorGroups.get(e).$promise.then(function(e){return n.setParams({name:e.name}),e}).catch(i.handleError)}]},data:{feature:"openstack.flavors",stateInfo:{default:n("Flavor group details"),display:n("Flavor group {:name}"),parent:"openstackFlavorGroups"}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(t,n,e,i,o){var r=this;function a(){return r.flavorgroups.fetchData()}r.$onInit=function(){e.info.enabled=!0,e.info.label=i("Search flavor groups"),e.info.service=r.flavorgroups},r.refreshFlavorGroups=a,r.addFlavorGroup=function(e){return o.show({templateUrl:"staff/apps/osflavorgroups/flflavorgroupedit.html",controller:"FlFlavorGroupAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:e}).then(function(){return a(),t.add(n.getString("Flavor group added"))}).catch(function(){})}}angular.module("fleioStaff").component("flFlavorGroups",{templateUrl:"staff/apps/osflavorgroups/flflavorgroups.html",controller:e,bindings:{flavorgroups:"<"}}),e.$inject=["FlNotificationService","gettextCatalog","FlSearchService","gettext","$mdDialog"]}(),function(){"use strict";function e(n,e,i,o,r){var a=this;function s(){n.FlavorGroups.get({id:a.flavorgroup.id}).$promise.then(function(e){a.flavorgroup=e})}a.$onInit=function(){a.currentPage=1,a.nextPage=!1,a.previousPage=!1,a.loading=!0,a.refreshFlavors()},a.refreshFlavors=function(){a.loading=!0,n.Flavors.get({group_id:a.flavorgroup.id,action:"get_flavors_in_group",page:a.currentPage,page_size:10}).$promise.then(function(e){a.loading=!1,a.nextPage=!!e.next,a.previousPage=!!e.previous,a.flavors=e.objects})},a.changeFlavorsPage=function(e){"next"===e&&(a.currentPage=a.currentPage+1,a.refreshFlavors()),"previous"===e&&(a.currentPage=a.currentPage-1,a.refreshFlavors())},a.searchFlavor=function(e){return n.Flavors.get({action:"get_available_flavors_for_group",group:a.flavorgroup.id,search:e}).$promise.then(function(e){return e.objects})},a.selectedFlavorChange=function(e){void 0!==e&&(a.addFlavorError=null)},a.addToGroup=function(e){if(a.submitPending=!0,!e)return a.addFlavorError=o.getString("Invalid input for flavor"),void(a.submitPending=!1);a.addFlavorError=null,n.Flavors.save({id:e.id,action:"add_to_group",group_id:a.flavorgroup.id}).$promise.then(function(e){return s(),a.refreshFlavors(),i.add(o.getString("Flavor added to group")),a.submitPending=!1,a.selectedFlavor=null,e},function(e){a.backendErrors=e.data,a.submitPending=!1})},a.removeFromGroup=function(e,t){r.yesNoDlg(o.getString("Are you sure?"),o.getString("Remove flavor from group")).then(function(){n.Flavors.save({id:t.id,action:"remove_from_group",group_id:a.flavorgroup.id}).$promise.then(function(e){return s(),a.refreshFlavors(),i.add(o.getString("Flavor removed from group")),a.selectedFlavor=null,e},function(e){a.backendErrors=e.data})}).catch(function(){})}}angular.module("fleioStaff").component("flFlavorGroupDetails",{templateUrl:"staff/apps/osflavorgroups/flflavorgroupdetails.html",controller:e,bindings:{flavorgroup:"<"}}),e.$inject=["FlOsApi","$mdDialog","FlNotificationService","gettextCatalog","FlUiUtilsService"]}(),function(){"use strict";function e(t,e,n){var i=this;i.flavorGroup={},i.isEdit=!1,i.saveFlavorGroup=function(){if(document.activeElement.blur(),!i.editFlavorGroup.$invalid&&!i.submitPending)return i.submitPending=!0,e.FlavorGroups.save(i.flavorgroup).$promise.then(function(e){return t.hide(e),e},function(e){return i.submitPending=!1,i.backendErrors=e.data})},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlFlavorGroupAddController",e),e.$inject=["$mdDialog","FlOsApi","gettext"]}(),function(){"use strict";function e(t,e,n,i,o){var r=this;r.flavorgroup=angular.copy(n),r.isEdit=!0,r.submitPending=!1,r.saveFlavorGroup=function(){if(document.activeElement.blur(),!r.editFlavorGroup.$invalid&&!r.submitPending)return r.submitPending=!0,e.FlavorGroups.update({id:r.flavorgroup.id},r.flavorgroup).$promise.then(function(e){return t.hide(e),"openstackFlavorGroupDetails"===i.current.name&&o.updateParams({name:e.name}),e}).catch(function(e){r.submitPending=!1,r.backendErrors=e.data})},r.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlFlavorGroupEditController",e),e.$inject=["$mdDialog","FlOsApi","flavorgroup","$state","FlBreadCrumbService"]}(),function(){"use strict";function e(t,n,i,o,r,a){var s=this;function l(){return s.flavorgroups.fetchData()}s.editFlavorGroup=function(e,t){return i.show({templateUrl:"staff/apps/osflavorgroups/flflavorgroupedit.html",controller:"FlFlavorGroupEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{flavorgroup:t},targetEvent:e}).then(function(){return s.flavorgroups?l():function(e){n.FlavorGroups.get({id:e.id}).$promise.then(function(e){s.customFlavorGroup=e})}(t),o.add(r.getString("Flavor group updated"))}).catch(function(){})},s.deleteFlavorGroup=function(e){return t.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete flavor group {{name}}",{name:e.name}),r.getString("Delete flavor group")).then(function(){n.FlavorGroups.delete({id:e.id}).$promise.then(function(){s.flavorgroups?l():a.go("flavorgroups"),o.add(r.getString("Flavor group deleted")),a.go("openstackFlavorGroups")}).catch(function(e){e.data.detail?o.add(e.data.detail):o.add(r.getString("Could not delete flavor group"))})}).catch(function(){})}}angular.module("fleioStaff").component("flFlavorGroupsActions",{restrict:"E",bindings:{flavorgroups:"<",customFlavorGroup:"="},templateUrl:"staff/apps/osflavorgroups/flflavorgroupsactions.html",controller:e}),e.$inject=["FlUiUtilsService","FlOsApi","$mdDialog","FlNotificationService","gettextCatalog","$state"]}(),function(){"use strict";function e(e,t,n){e.state("images",{url:t.joinBaseUrl("openstack/images?page_size?ordering?filtering?search"),component:"flImages",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{images:["$state","$stateParams","FlObjectList","FlOsApi",function(o,e,t,n){return n.Images.get({options:"create_options"}).$promise.then(function(e){o.get("images").data.filtering.status.choices=e.statuses;var t,n=[],i=[];for(t=0;t<e.hypervisor_types.length;t++)n.push({display:e.hypervisor_types[t],value:e.hypervisor_types[t]});if(e.regions)for(t=0;t<e.regions.length;t++)i.push({display:e.regions[t].id,value:e.regions[t].id});o.get("images").data.filtering.hypervisor_type.choices=n,o.get("images").data.filtering.region.choices=i}),t(n.Images,e)}]},data:{stateInfo:{display:n("Images"),parent:"dashboard"},feature:"openstack.images",orderOptions:{name:n("Name"),status:n("Status"),type:n("Type"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},project__service__client:{display:n("Client"),field_name:"project__service__client",type:"client"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},region:{display:n("Region"),field_name:"region",type:"choices",choices:[]},status:{display:n("Status"),field_name:"status",type:"choices",choices:[]},hypervisor_type:{display:n("Hypervisor type"),field_name:"hypervisor_type",type:"choices",choices:[]},visibility:{display:n("Visibility"),field_name:"visibility",type:"choices",choices:[{display:n("Private"),value:"private"},{display:n("Public"),value:"public"}]},protected:{display:n("Protected"),field_name:"protected",type:"bool"},min_disk:{display:n("Min disk"),field_name:"min_disk",type:"decimal"},min_ram:{display:n("Min ram"),field_name:"min_ram",type:"decimal"},volume_snapshot_uuid:{display:n("Volume snapshot"),field_name:"volume_snapshot_uuid",type:"customModelInstance",service:"FlOsApi",service_details:{type:"openstack",items:"VolumeSnapshots"}}}}}).state("imagesDetails",{url:t.joinBaseUrl("openstack/images/:id"),component:"flImageDetails",authenticate:!0,resolve:{image:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.Images.get(e).$promise.then(function(e){return n.setParams({name:e.name}),e}).catch(i.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.Images.get({action:"permissions"}).$promise}]},data:{feature:"openstack.images",stateInfo:{display:n("Image {:name}"),parent:"images",default:n("Snapshot details")}}}).state("imageCreate",{url:t.joinBaseUrl("openstack/image/create"),component:"flImageCreate",authenticate:!0,data:{feature:"openstack.images",stateInfo:{display:n("Create image"),parent:"images"}},resolve:{createOptions:["FlOsApi",function(e){return e.Images.get({action:"create_options"}).$promise}]}}).state("imageUpdate",{url:t.joinBaseUrl("openstack/images/:id/edit"),component:"flImageUpdate",authenticate:!0,resolve:{createOptions:["FlOsApi","FlResolveErrorHandler",function(e,t){return e.Images.get({action:"create_options"}).$promise.catch(t.handleError)}],image:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.Images.get(e).$promise.then(function(e){return n.setParams({name:e.name}),e}).catch(i.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.Images.get({action:"permissions"}).$promise}]},data:{feature:"openstack.images",stateInfo:{display:n("Edit image {:name}"),default:n("Edit image"),parent:"images"}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(t,e,n,i,o,r,a,s,l){var c=this;function u(){return c.images.fetchData().then(c.checkForTaskChange)}c.$onInit=function(){i.info.enabled=!0,i.info.label=r("Search images"),i.info.service=c.images,c.refreshTimer=n(u,1e4),c.refreshTimer.start(),e.init(c.refreshTimer.start.bind(c.refreshTimer),c.refreshTimer.stop.bind(c.refreshTimer)),c.checkForTaskChange(c.images),c.TRANSLATED_STRINGS_MAP={create:o.getString("Create image"),delete:o.getString("Delete"),download:o.getString("Download image"),update:o.getString("Update"),no_permission:o.getString("You are not\nallowed to do this")},c.features=s.features},c.deleteImage=function(e){return t.yesNoDlg(o.getString("Are you sure?"),o.getString("Delete image {{name}}",{name:e.name}),o.getString("Delete image")).then(function(){return e.status=r("pending"),a.add(o.getString("Image delete scheduled")),e.$delete().finally(u)}).catch(function(){})},c.downloadImage=function(e){var t=l.api_url+"/openstack/images/"+e.id+"/download";window.open(t)},c.checkForTaskChange=function(e){return angular.forEach(e.objects,function(e){if(e.isUnderTask())return c.refreshTimer.boost()})},c.$onDestroy=function(){c.refreshTimer.teardown(),e.uninit()}}angular.module("fleioStaff").component("flImages",{templateUrl:"staff/apps/osimages/flimages.html",controller:e,bindings:{images:"<"}}),e.$inject=["FlUiUtilsService","FlDetectIdleService","FlOsTimer","FlSearchService","gettextCatalog","gettext","FlNotificationService","FlFeatureService","CONFIG"]}(),function(){"use strict";function e(n,t,e,i,o,r,a,s,l,c){var u,d=this;function p(){o.Images.get({id:d.image.id}).$promise.then(function(e){d.image=e,d.checkForTaskChange(d.image)})}d.$onInit=function(){(u=i(p,1e4)).start(),e.init(u.start.bind(u),u.stop.bind(u)),d.checkForTaskChange(d.image),"object"==typeof d.image.properties&&(d.imageHasProperties=0!==Object.keys(d.image.properties).length),d.TRANSLATED_STRINGS_MAP={delete:r.getString("Delete"),download:r.getString("Download"),update:r.getString("Update"),no_permission:r.getString("You are not\nallowed to do this")},d.currentFlavorPage=1,d.nextFlavorPage=!1,d.previousFlavorPage=!1,d.loading=!0,d.refreshFlavors(),d.currentFlavorGroupPage=1,d.nextFlavorGroupPage=!1,d.previousFlavorGroupPage=!1,d.loading=!0,d.refreshFlavorGroups(),d.features=l.features},d.refreshFlavors=function(){d.loading=!0,o.Flavors.get({image_id:d.image.id,action:"get_flavors_assigned_to_image",page:d.currentFlavorPage,page_size:5}).$promise.then(function(e){d.loading=!1,d.nextFlavorPage=!!e.next,d.previousFlavorPage=!!e.previous,d.flavors=e.objects})},d.changeFlavorsPage=function(e){"next"===e&&(d.currentFlavorPage=d.currentFlavorPage+1,d.refreshFlavors()),"previous"===e&&(d.currentFlavorPage=d.currentFlavorPage-1,d.refreshFlavors())},d.searchFlavor=function(e){return o.Flavors.get({action:"get_available_flavors_for_image",image_id:d.image.id,search:e}).$promise.then(function(e){return e.objects})},d.selectedFlavorChange=function(e){void 0!==e&&(d.addFlavorError=null)},d.addFlavorToImage=function(e){if(d.submitPending=!0,!e)return d.addFlavorError=r.getString("Invalid input for flavor"),void(d.submitPending=!1);d.addFlavorError=null,o.Flavors.save({id:e.id,action:"add_to_image",image_id:d.image.id}).$promise.then(function(e){return p(),d.refreshFlavors(),s.add(r.getString("Flavor added to image")),d.submitPending=!1,d.selectedFlavor=null,e},function(e){d.backendErrors=e.data,d.submitPending=!1})},d.removeFlavorFromImage=function(e,t){n.yesNoDlg(r.getString("Are you sure?"),r.getString("Remove flavor from image")).then(function(){o.Flavors.save({id:t.id,action:"remove_from_image",image_id:d.image.id}).$promise.then(function(e){return p(),d.refreshFlavors(),s.add(r.getString("Flavor removed from image")),d.selectedFlavor=null,e},function(e){d.backendErrors=e.data})}).catch(function(){})},d.refreshFlavorGroups=function(){d.loading=!0,o.FlavorGroups.get({image_id:d.image.id,action:"get_flavor_groups_assigned_to_image",page:d.currentFlavorGroupPage,page_size:5}).$promise.then(function(e){d.loading=!1,d.nextFlavorGroupPage=!!e.next,d.previousFlavorGroupPage=!!e.previous,d.flavorGroups=e.objects})},d.changeFlavorGroupsPage=function(e){"next"===e&&(d.currentFlavorGroupPage=d.currentFlavorGroupPage+1,d.refreshFlavorGroups()),"previous"===e&&(d.currentFlavorGroupPage=d.currentFlavorGroupPage-1,d.refreshFlavorGroups())},d.searchFlavorGroup=function(e){return o.FlavorGroups.get({action:"get_available_flavor_groups_for_image",image_id:d.image.id,search:e}).$promise.then(function(e){return e.objects})},d.selectedFlavorGroupChange=function(e){void 0!==e&&(d.addFlavorGroupError=null)},d.addFlavorGroupToImage=function(e){if(d.submitPending=!0,!e)return d.addFlavorGroupError=r.getString("Invalid input for flavor group"),void(d.submitPending=!1);d.addFlavorGroupError=null,o.FlavorGroups.save({id:e.id,action:"add_to_image",image_id:d.image.id}).$promise.then(function(e){return p(),d.refreshFlavorGroups(),s.add(r.getString("Flavor group added to image")),d.submitPending=!1,d.selectedFlavorGroup=null,e},function(e){d.backendErrors=e.data,d.submitPending=!1})},d.removeFlavorGroupFromImage=function(e,t){n.yesNoDlg(r.getString("Are you sure?"),r.getString("Remove flavor group from image")).then(function(){o.FlavorGroups.save({id:t.id,action:"remove_from_image",image_id:d.image.id}).$promise.then(function(e){return p(),d.refreshFlavorGroups(),s.add(r.getString("Flavor group removed from image")),d.selectedFlavorGroup=null,e},function(e){d.backendErrors=e.data})}).catch(function(){})},d.deleteImage=function(e){return n.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete image {{name}}",{name:e.name}),r.getString("Delete image")).then(function(){return e.status=a("pending"),e.$delete().then(function(){return s.add(r.getString("Image delete scheduled")),t.go("images")}).catch(p)}).catch(function(){})},d.downloadImage=function(e){var t=c.api_url+"/openstack/images/"+e.id+"/download";window.open(t)},d.checkForTaskChange=function(e){e.isUnderTask()&&u.boost()},d.$onDestroy=function(){u.teardown(),e.uninit()}}angular.module("fleioStaff").component("flImageDetails",{templateUrl:"staff/apps/osimages/flimagedetails.html",controller:e,bindings:{image:"<",permissions:"<"}}),e.$inject=["FlUiUtilsService","$state","FlDetectIdleService","FlOsTimer","FlOsApi","gettextCatalog","gettext","FlNotificationService","FlFeatureService","CONFIG"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s){var l=this;l.$onInit=function(){if(l.image={},l.image.container_format="bare",l.image.disk_format="qcow2",l.image.visibility=l.createOptions.visibilities[0],l.image.region=l.createOptions.selected_region,l.image.architecture="x86_64",l.image.hypervisor_type=null,l.architectures=["x86_64","i386","i686"],l.image.source="url",l.goBackOrToState=n.goBackOrToState,l.uploadProgress=0,l.features=s.features,l.allowedFormats="",l.createOptions.allowed_formats.length)for(var e=0;e<l.createOptions.allowed_formats.length;e++)l.allowedFormats=l.allowedFormats+"."+l.createOptions.allowed_formats[e],e!==l.createOptions.allowed_formats.length-1&&(l.allowedFormats=l.allowedFormats+",")},l.upload=function(e){var t=new FormData;if("file"===l.image.source){var n=document.getElementById("file");null!==n&&n.files.length&&t.append("file",n.files[0])}for(var i in e)e.hasOwnProperty(i)&&"file"!==i&&t.append(i,e[i]);return r({method:"POST",url:o.api_url+"/openstack/images",data:t,headers:{"Content-Type":void 0},uploadEventHandlers:{progress:function(e){var t=100*e.loaded/e.total;l.uploadProgress=t.toFixed(1)}}})},l.newImageSubmit=function(){document.activeElement.blur(),l.submitPending||l.newImage.$invalid||(l.uploadProgress=0,l.submitPending=!0,l.upload(l.image).then(function(e){return t.add(i.getString("Image create scheduled")),a.Images.get({id:e.data.id}).$promise.then(function(e){var t={image:e,region:e.region,client:null,fromLaunchImage:!0,fromNewImage:!0};n.goBackOrToState("images",t,!0)}),e}).catch(function(e){413===e.status?l.backendErrors={detail:i.getString("File to large, please check server upload limit.")}:l.backendErrors=e.data}).finally(function(){l.submitPending=!1}))},l.osDistroQuerySearch=function(e){return e?l.createOptions.os_distros.filter(function(e){var t=e.toLowerCase();return function(e){return 0===e.toLowerCase().indexOf(t)}}(e)):l.createOptions.os_distros},l.selectedOSDistroChange=function(e){l.image.os_distro=e}}angular.module("fleioStaff").component("flImageCreate",{templateUrl:"staff/apps/osimages/create/flimagecreate.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["$state","FlNotificationService","FlUiUtilsService","CONFIG","gettextCatalog","$http","FlOsApi","FlFeatureService"]}(),function(){"use strict";function e(n,i,o,e,r){var a=this;a.$onInit=function(){a.architectures=["x86_64","i386","i686"],a.goBackOrToState=e.goBackOrToState,a.imagePropertiesLoaded=!1,a.selectedOSDistro=a.image.os_distro,"object"==typeof a.image.properties?a.imageHasProperties=0!==Object.keys(a.image.properties).length:a.imageHasProperties=!1,a.TRANSLATED_STRINGS_MAP={no_permission:r.getString("You are not\nallowed to do this")}},a.setImageProperties=function(){if(!1===a.imageHasProperties&&!1===a.imagePropertiesLoaded)a.image.properties={},a.keys=[],a.imagePropertiesLoaded=!0;else if(!0===a.imageHasProperties&&!1===a.imagePropertiesLoaded){a.keys=[];var e=0;for(var t in a.image.properties)a.image.properties.hasOwnProperty(t)&&(a.keys[e]={},a.keys[e].key=t,a.keys[e].value=a.image.properties[t],e++);a.imagePropertiesLoaded=!0}},a.deactivateImage=function(){a.changeImageActiveState=!0,n.Images.save({id:a.image.id,action:"deactivate"}).$promise.then(function(e){o.add(e.detail),a.image.status="deactivated"}).catch(function(e){404!==e.status&&o.add(e.data.detail)}).finally(function(){a.changeImageActiveState=!1})},a.reactivateImage=function(){a.changeImageActiveState=!0,n.Images.save({id:a.image.id,action:"reactivate"}).$promise.then(function(e){o.add(e.detail),a.image.status="active"}).catch(function(e){404!==e.status&&o.add(e.data.detail)}).finally(function(){a.changeImageActiveState=!1})},a.deleteKey=function(e,t){a.image.properties[e]="",a.keys.splice(t,1)},a.addImageProperty=function(){a.keys.push({key:"",value:""})},a.updateImagePropsSubmit=function(){if(document.activeElement.blur(),!a.submitPending&&!a.updateImageProps.$invalid){for(var e in a.submitPending=!0,a.image.properties)a.image.properties.hasOwnProperty(e)&&(a.image.properties[e]="");for(var t=0;t<a.keys.length;t++)a.image.properties[a.keys[t].key]=a.keys[t].value;return n.Images.update(a.image).$promise.then(function(e){return o.add(r.getString("Image update scheduled")),i.go("images"),e}).catch(function(e){e.data&&e.data.properties&&e.data.properties.length?a.backendPropsErrors={detail:e.data.properties[0]}:a.backendPropsErrors=e.data,a.submitPending=!1})}},a.updateButtonDisabled=function(){return a.submitPending||a.changeImageActiveState},a.updateImageSubmit=function(){if(document.activeElement.blur(),!a.submitPending&&!a.updateImage.$invalid)return a.submitPending=!0,a.selectedOSDistro&&(a.image.os_distro=a.selectedOSDistro),n.Images.update(a.image).$promise.then(function(e){return o.add(r.getString("Image update scheduled")),i.go("images"),e}).catch(function(e){a.backendErrors=e.data,a.submitPending=!1})},a.osDistroQuerySearch=function(e){return e?a.createOptions.os_distros.filter(function(e){var t=e.toLowerCase();return function(e){return 0===e.toLowerCase().indexOf(t)}}(e)):a.createOptions.os_distros},a.selectedOSDistroChange=function(e){a.image.os_distro=e}}angular.module("fleioStaff").component("flImageUpdate",{templateUrl:"staff/apps/osimages/update/flimageupdate.html",controller:e,bindings:{createOptions:"<",image:"<",permissions:"<"}}),e.$inject=["FlOsApi","$state","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(t,e,n){var i=this;i.project={},i.isEdit=!1,i.saveProject=function(){if(document.activeElement.blur(),!i.editProject.$invalid&&!i.submitPending)return i.submitPending=!0,e.save(i.project).$promise.then(function(e){return t.hide(e),e},function(e){return i.submitPending=!1,i.backendErrors=e.data})},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlProjectAddController",e),e.$inject=["$mdDialog","FlProjectsApi","gettext"]}(),function(){"use strict";function e(t,e,n){var i=this;i.project=angular.copy(n),i.deleteAssociatedProject=!1,i.performDelete=function(){if(!i.deleteProject.$invalid&&!i.submitPending)return i.submitPending=!0,e.save({id:i.project.id,action:"delete_project",delete_all_resources:i.deleteAssociatedProject}).$promise.then(function(e){return t.hide(e),e},function(e){return i.submitPending=!1,i.backendErrors=e.data})},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlProjectDeleteController",e),e.$inject=["$mdDialog","FlProjectsApi","project"]}(),function(){"use strict";function e(t,e,n){var i=this;i.project=angular.copy(n),i.isEdit=!0,i.submitPending=!1,i.saveProject=function(){if(document.activeElement.blur(),!i.editProject.$invalid&&!i.submitPending)return i.submitPending=!0,e.update({id:i.project.id},i.project).$promise.then(function(e){return t.hide(e),e},function(e){i.submitPending=!1,i.backendErrors=e.data})},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlProjectEditController",e),e.$inject=["$mdDialog","FlProjectsApi","project"]}(),function(){"use strict";function e(n,e,i,t,o,r,a,s,l,c,u){var d,p=this;function f(){return p.projects.fetchData()}p.$onInit=function(){l.info.enabled=!0,l.info.label=a("Search projects"),l.info.service=p.projects,(d=u(f,1e4,!1,[500,500,500,500,1e3,1e3,2e3,3e3,5e3])).start(),c.init(function(){return d.start()},function(){return d.stop()}),p.TRANSLATED_STRINGS_MAP={delete:r.getString("Delete"),edit:r.getString("Edit"),create:r.getString("Add project"),no_permission:r.getString("You are not\nallowed to do this")}},p.$onDestroy=function(){d.teardown(),c.uninit()},p.deleteProject=function(e,t){return n.go(n.current,{dlg:"delete"}),i.show({templateUrl:"staff/apps/osprojects/flprojectdelete.html",controller:"FlProjectDeleteController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,targetEvent:e,locals:{project:t}}).then(function(){return d.boost(),s.add(r.getString("Project deleted"))}).catch(function(){}).finally(function(){n.go(n.current,{dlg:"false"})})},p.addProject=function(e){return n.go(n.current,{dlg:"add"}),i.show({templateUrl:"staff/apps/osprojects/flprojectedit.html",controller:"FlProjectAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,targetEvent:e,locals:{}}).then(function(){return d.boost(),s.add(r.getString("Project added"))}).catch(function(){}).finally(function(){n.go(n.current,{dlg:"false"})})},p.editProject=function(e,t){if(p.projects.permissions["projects.update"])return i.show({templateUrl:"staff/apps/osprojects/flprojectedit.html",controller:"FlProjectEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{project:t},targetEvent:e}).then(function(){return d.boost(),s.add(r.getString("Project updated"))}).catch(function(){}).finally(function(){n.go(n.current,{dlg:"false"})})}}angular.module("fleioStaff").component("flProjects",{templateUrl:"staff/apps/osprojects/flprojects.html",controller:e,bindings:{projects:"<"}}),e.$inject=["$state","$stateParams","$mdDialog","FlUiUtilsService","FlProjectsApi","gettextCatalog","gettext","FlNotificationService","FlSearchService","FlDetectIdleService","FlOsTimer"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/openstack/projects/:id/:action",{id:"@id",action:"@action"})}angular.module("fleioStaff").factory("FlProjectsApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n){e.state("projects",{url:t.joinBaseUrl("openstack/projects?page_size?ordering?filtering?search"),component:"flProjects",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{projects:["$stateParams","FlProjectsApi","FlObjectList",function(e,t,n){return n(t,e)}]},data:{stateInfo:{display:n("Projects"),parent:"dashboard"},feature:"openstack.projects",orderOptions:{project_id:n("Project id"),project_domain_id:n("Project domain id"),disabled:n("Disabled"),name:n("Name"),created_at:n("Created at"),updated_at:n("Updated at")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},disabled:{display:n("Disabled"),field_name:"disabled",type:"bool"},is_domain:{display:n("Is domain"),field_name:"is_domain",type:"bool"},services_count:{display:n("Services count"),field_name:"services_count",type:"decimal"}}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/openstack/regions/:id/:action",{id:"@id",action:"@action"})}angular.module("fleioStaff").factory("FlRegionsApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(i,t,n,o,r,e,a,s,l){var c,u=this,d=o.current.name;function p(){i.SecurityGroups.get({id:u.securityGroup.id}).$promise.then(function(e){u.securityGroup=e})}u.editSecurityGroup=function(t,n){i.SecurityGroups.get({options:"create_options"}).$promise.then(function(e){return d!==o.current.name?e:(o.go(o.current,{dlg:"add"}),r.show({templateUrl:"staff/apps/ossecuritygroups/flsecuritygroupedit.html",controller:"FlSecurityGroupEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{securityGroup:angular.copy(n),regions:e.regions,selected_region:e.selected_region}}).then(function(){c.boost()}).finally(function(){o.go(o.current,{dlg:"false"})}).catch(function(){}))})},u.addRule=function(t,n){i.SecurityGroups.get({options:"get_security_groups_for_project",project_id:n.project}).$promise.then(function(e){return d!==o.current.name?e:(o.go(o.current,{dlg:"add"}),r.show({templateUrl:"staff/apps/ossecuritygroups/flsecuritygrouprulecreate.html",controller:"FlSecurityGroupRuleCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{securityGroup:angular.copy(n),securityGroups:angular.copy(e.security_groups)}}).then(function(){return c.boost()}))}).catch(function(e){e&&(u.backendErrors=e.data)})},u.deleteSecurityGroup=function(e){return t.yesNoDlg(n.getString("Are you sure?"),n.getString("Delete security group {{name}}",{name:e.name}),n.getString("Delete security group")).then(function(){return e.$delete().then(function(){return l.add(n.getString("Security group delete scheduled")),o.go("securityGroups")})}).catch(function(){})},u.deleteRule=function(e){return t.yesNoDlg(n.getString("Are you sure?"),n.getString("Delete rule {{rule}}",{rule:e.id}),n.getString("Delete rule")).then(function(){return i.SecurityGroups.save({id:u.securityGroup.id,options:"delete_rule"},{rule_id:e.id}).$promise.then(function(e){l.add(n.getString("Rule delete scheduled")),c.boost()})}).catch(function(){})},u.$onInit=function(){(c=a(p,1e4)).start(),e.init(c.start.bind(c),c.stop.bind(c)),u.TRANSLATED_STRINGS_MAP={delete:n.getString("Delete"),edit:n.getString("Edit security group"),add_rule:n.getString("Add rule"),delete_rule:n.getString("Delete rule"),no_permission:n.getString("You are not\nallowed to do this")},n.getString("ingress"),n.getString("egress")},u.$onDestroy=function(){c.teardown(),e.uninit()}}angular.module("fleioStaff").component("flSecurityGroupDetails",{templateUrl:"staff/apps/ossecuritygroups/flsecuritygroupdetails.html",controller:e,bindings:{securityGroup:"<",permissions:"<"}}),e.$inject=["FlOsApi","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlDetectIdleService","FlOsTimer","$scope","FlNotificationService"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s,l,c){var u,d=this,p=a.current.name;function f(){return d.securityGroups.fetchData()}d.$onInit=function(){n.info.enabled=!0,n.info.label=i("Search security groups"),n.info.service=d.securityGroups,(u=e(f,2e4,!0,[3e3,5e3])).start(),t.init(u.start.bind(u),u.stop.bind(u)),d.TRANSLATED_STRINGS_MAP={delete:r.getString("Delete"),edit:r.getString("Edit security group"),add_rule:r.getString("Add rule"),create:r.getString("Create security group"),no_permission:r.getString("You are not\nallowed to do this")}},d.editSecurityGroup=function(t,n){l.SecurityGroups.get({options:"create_options"}).$promise.then(function(e){return p!==a.current.name?e:(a.go(a.current,{dlg:"add"}),s.show({templateUrl:"staff/apps/ossecuritygroups/flsecuritygroupedit.html",controller:"FlSecurityGroupEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{securityGroup:angular.copy(n),regions:e.regions,selected_region:e.selected_region}}).then(function(){u.boost()}).finally(function(){a.go(a.current,{dlg:"false"})}).catch(function(){}))})},d.deleteSecurityGroup=function(e){return o.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete security group {{name}}",{name:e.name}),r.getString("Delete security group")).then(function(){return e.$delete().then(function(){c.add(r.getString("Security group delete scheduled")),u.boost()})}).catch(function(){})},d.addRule=function(t,n){l.SecurityGroups.get({options:"get_security_groups_for_project",project_id:n.project}).$promise.then(function(e){return p!==a.current.name?e:(a.go(a.current,{dlg:"add"}),s.show({templateUrl:"staff/apps/ossecuritygroups/flsecuritygrouprulecreate.html",controller:"FlSecurityGroupRuleCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{securityGroup:angular.copy(n),securityGroups:angular.copy(e.security_groups)}}))}).catch(function(e){e&&(d.backendErrors=e.data)})},d.$onDestroy=function(){u.teardown(),t.uninit()}}angular.module("fleioStaff").component("flSecurityGroups",{templateUrl:"staff/apps/ossecuritygroups/flsecuritygroups.html",controller:e,bindings:{securityGroups:"<"}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlSearchService","gettext","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlOsApi","FlNotificationService"]}(),function(){"use strict";function e(t,e,n,i,o){var r=this;function a(e){return o.get({search:e}).$promise.then(function(e){return e.objects})}function s(e){void 0!==e&&(r.securityGroup.client=e.id)}function l(){if(document.activeElement.blur(),!r.submitPending&&!r.securityGroup_form.$invalid){if(r.submitPending=!0,!r.securityGroup.id)return e.SecurityGroups.save(r.securityGroup).$promise.then(function(e){return t.hide(e),n.add(i.getString("Security group create scheduled")),e},function(e){return r.submitPending=!1,r.backendErrors=e.data},function(e){r.submitPending=!1,r.backendErrors=e.data});e.SecurityGroups.update({id:r.securityGroup.id},r.securityGroup).$promise.then(function(e){return t.hide(e),n.add(i.getString("Security group update scheduled")),e},function(e){r.submitPending=!1,r.backendErrors=e.data})}}function c(){return t.cancel()}r.$onInit=function(){r.saveSecurityGroup=l,r.close=c,r.searchClient=a,r.selectedClientChange=s,r.securityGroup||(r.securityGroup={region:r.selected_region})}}angular.module("fleioStaff").controller("FlSecurityGroupEditController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog","FlClientApi"]}(),function(){"use strict";function e(n,i,o,r){var a=this;function e(){if(document.activeElement.blur(),!a.submitPending&&!a.rule_form.$invalid){if(a.port_field&&a.rule.port_range){var e=a.rule.port_range.split(":");1<e.length?(a.rule.port_range_min=e[0],a.rule.port_range_max=e[1]):a.rule.port_range_min=a.rule.port_range_max=e[0]}if("cidr"===a.remote?delete a.rule.remote_group_id:a.rule.remote_ip_prefix="",a.rule_types[a.rule_type].hasOwnProperty("protocol")&&(a.rule.protocol=a.rule_types[a.rule_type].protocol),a.rule_types[a.rule_type].hasOwnProperty("port_range"))if(-1!==a.rule_types[a.rule_type].port_range.indexOf(":")){var t=a.rule_types[a.rule_type].port_range.split(":");a.rule.port_range_min=t[0],a.rule.port_range_max=t[1]}else a.rule.port_range_min=a.rule_types[a.rule_type].port_range,a.rule.port_range_max=a.rule_types[a.rule_type].port_range;return a.icmp_type_field&&(a.rule.port_range_min=a.rule.icmp_type),a.icmp_code_field&&(a.rule.port_range_max=a.rule.icmp_code),"cidr"===a.remote&&delete a.rule.ethertype,a.submitPending=!0,i.SecurityGroups.save({id:a.securityGroup.id,options:"add_rule"},a.rule).$promise.then(function(e){return a.submitPending=!1,n.hide(e),o.add(r.getString("Add rule scheduled")),e}).catch(function(e){return a.backendErrors=e.data,e}).finally(function(){a.submitPending=!1})}}function t(e){a.rule.port_range=e?"1:65535":""}function s(e){var t=a.rule_types[e];if(a.rule_types[e].hasOwnProperty("fields"))a.port_field=-1!==t.fields.indexOf("port"),a.protocol_field=-1!==t.fields.indexOf("protocol"),a.icmp_type_field=-1!==t.fields.indexOf("icmp_type"),a.icmp_code_field=-1!==t.fields.indexOf("icmp_code");else{if(a.rule_types[e].hasOwnProperty("protocol")&&(a.rule.protocol=a.rule_types[a.rule_type].protocol),a.rule_types[e].hasOwnProperty("port_range"))if(-1!==a.rule_types[e].port_range.indexOf(":")){var n=a.rule_types[e].port_range.split(":");a.rule.port_range_min=n[0],a.rule.port_range_max=n[1]}else a.rule.port_range_min=a.rule_types[e].port_range,a.rule.port_range_max=a.rule_types[e].port_range;a.port_field=a.protocol_field=a.icmp_type_field=a.icmp_code_field=!1}}function l(){return n.cancel()}a.$onInit=function(){a.rule_types={},a.rule_types[r.getString("Custom TCP rule")]={fields:["port"],protocol:"TCP"},a.rule_types[r.getString("Custom UDP rule")]={fields:["port"],protocol:"UDP"},a.rule_types[r.getString("Custom ICMP rule")]={fields:["icmp_type","icmp_code"],protocol:"ICMP"},a.rule_types[r.getString("Other protocol")]={fields:["protocol","port"]},a.rule_types[r.getString("All TCP")]={port_range:"1:65535",protocol:"TCP"},a.rule_types[r.getString("All UDP")]={port_range:"1:65535",protocol:"UDP"},a.rule_types[r.getString("All ICMP")]={protocol:"ICMP"},a.rule_types.DNS={protocol:"UDP",port_range:"53"},a.rule_types.FTP={protocol:"TCP",port_range:"21"},a.rule_types.HTTP={protocol:"TCP",port_range:"80"},a.rule_types.HTTPS={protocol:"TCP",port_range:"443"},a.rule_types.IMAP={protocol:"TCP",port_range:"143"},a.rule_types.IMAPS={protocol:"TCP",port_range:"993"},a.rule_types.LDAP={protocol:"TCP",port_range:"389"},a.rule_types["MS SQL"]={protocol:"TCP",port_range:"1433"},a.rule_types.MySQL={protocol:"TCP",port_range:"3306"},a.rule_types.POP3={protocol:"TCP",port_range:"110"},a.rule_types.POP3S={protocol:"TCP",port_range:"995"},a.rule_types.RDP={protocol:"TCP",port_range:"3389"},a.rule_types.SFTP={protocol:"TCP",port_range:"115"},a.rule_types.SMTP={protocol:"TCP",port_range:"25"},a.rule_types.SMTPS={protocol:"TCP",port_range:"465"},a.rule_types.SSH={protocol:"TCP",port_range:"22"},a.rule_types.WHOIS={protocol:"TCP",port_range:"43"},a.saveRule=e,a.setPortRange=t,a.changeFields=s,a.close=l,a.rule_type=Object.keys(a.rule_types)[0],a.rule={direction:"ingress",security_group_id:a.securityGroup.id,remote_group_id:a.securityGroups.length?a.securityGroups[0].id:"",remote_ip_prefix:"0.0.0.0/0"},a.changeFields(a.rule_type)}}angular.module("fleioStaff").controller("FlSecurityGroupRuleCreateController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){e.state("securityGroups",{url:t.joinBaseUrl("openstack/security_groups?page_size?ordering?filtering?search"),component:"flSecurityGroups",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-name",squash:!0},filtering:{value:"",squash:!0}},data:{stateInfo:{display:n("Security groups"),parent:"dashboard"},feature:"openstack.securitygroups",orderOptions:{name:n("Name"),created_at:n("Created at"),region:n("Region")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},region:{display:n("Region"),field_name:"region",type:"choices",choices:[]}}},resolve:{securityGroups:["$state","$stateParams","FlObjectList","FlOsApi",function(r,e,t,n){return n.SecurityGroups.get({options:"create_options"}).$promise.then(function(e){for(var t=e.regions,n=[],i=0,o=t.length;i<o;++i)n.push({display:t[i].id,value:t[i].id});r.get("securityGroups").data.filtering.region.choices=n}),t(n.SecurityGroups,e)}]}}).state("securityGroupDetails",{url:t.joinBaseUrl("openstack/security_groups/:id"),component:"flSecurityGroupDetails",authenticate:!0,resolve:{securityGroup:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.SecurityGroups.get(e).$promise.then(function(e){return n.setParams({securityGroup:e.name}),e}).catch(i.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.SecurityGroups.get({options:"permissions"}).$promise}]},data:{feature:"openstack.securitygroups",stateInfo:{display:n("Security group {:securityGroup}"),parent:"securityGroups",default:n("Security group details")}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,i,o){var r,a=this;function s(){return a.clusters.fetchData().then(function(){})}a.$onInit=function(){n.info.enabled=!0,n.info.label=i("Search clusters"),n.info.service=a.clusters,(r=e(s,1e4)).start(),t.init(r.start.bind(r),r.stop.bind(r)),a.TRANSLATED_STRINGS_MAP={create:o.getString("Create cluster"),no_permission:o.getString("You are not\nallowed to do this")}},a.$onDestroy=function(){r.teardown(),t.uninit()},a.onClusterAction=function(){return r.boost()}}angular.module("fleioStaff").component("flClustersList",{templateUrl:"staff/apps/osclusters/flclusters.component.html",controller:e,bindings:{clusters:"<"}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlSearchService","gettext","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s,l){var c=this;c.$onInit=function(){c.cluster.master_addresses&&(c.cluster.master_addresses=JSON.parse(c.cluster.master_addresses.replace(/'/g,'"'))),c.cluster.node_addresses&&(c.cluster.node_addresses=JSON.parse(c.cluster.node_addresses.replace(/'/g,'"'))),c.cluster.labels=JSON.parse(c.cluster.labels)}}angular.module("fleioStaff").component("flClusterDetails",{templateUrl:"staff/apps/osclusters/flclusterdetails.component.html",controller:e,bindings:{cluster:"<",permissions:"<"}}),e.$inject=["$state","$stateParams","FlOsTimer","FlDetectIdleService","$mdDialog","FlSearchService","FlOsApi","gettext","gettextCatalog"]}(),function(){"use strict";function e(t,e,n,i,o){var r=this;r.cluster=n,r.resizeCluster=function(){if(document.activeElement.blur(),!r.submitPending&&!r.resizeClusterForm.$invalid)return r.submitPending=!0,e.Clusters.post({id:r.cluster.id},{action:"resize_cluster",node_count:r.node_count,nodes_to_remove:r.nodes_to_remove}).$promise.then(function(e){return o.add(i.getString("Resize started.")),t.hide()},function(e){return r.backendErrors=e.data,r.submitPending=!1})},r.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlClusterResizeController",e),e.$inject=["$mdDialog","FlOsApi","cluster","gettextCatalog","FlNotificationService"]}(),function(){"use strict";function e(t,i,o,r,e,a,n,s,l){return{restrict:"E",replace:"true",scope:{cluster:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"staff/apps/osclusters/actions/flclusteractions.html",controller:["$scope","$element",function(n,e){n.TRANSLATED_STRINGS_MAP={delete:a.getString("Delete"),edit:a.getString("Edit"),resize:a.getString("Resize"),get_certificate:a.getString("Get certificate"),no_permission:a.getString("You are not\nallowed to do this")},n.deleteCluster=function(){return t.yesNoDlg(a.getString("Are you sure you want to delete the cluster?"),a.getString("Delete cluster {{name}}",{name:n.cluster.name}),a.getString("Delete cluster")).then(function(){return n.cluster.fldelete().then(function(){if(r.add(a.getString("Cluster deleted scheduled")),n.isDetail)return i.go("openstackClusters");n.callback()}).catch(function(e){r.add(e.data.detail)})}).catch(function(){})},n.getClusterCertificate=function(){var e=l.api_url+"/openstack/clusters/"+n.cluster.id+"/get_certificate";window.open(e)},n.resizeCluster=function(e,t){return o.show({templateUrl:"staff/apps/osclusters/resize/flclusterresize.html",controller:"FlClusterResizeController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{cluster:n.cluster},targetEvent:t}).then(function(e){}).catch(function(){})}}]}}angular.module("fleioStaff").directive("flClusterActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlResolveErrorHandler","FlOsApi","CONFIG"]}(),function(){"use strict";function e(t,i,o,r,e,a){return{restrict:"E",replace:"true",scope:{cluster:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"staff/apps/osclusters/actions/flxsclusteractions.html",controller:["$scope","$element",function(n,e){n.deleteCluster=function(){return t.yesNoDlg(a.getString("Are you sure you want to delete the cluster?"),a.getString("Delete cluster {{name}}",{name:n.cluster.name}),a.getString("Delete cluster")).then(function(){return n.cluster.fldelete().then(function(){if(r.add(a.getString("Cluster deleted scheduled")),n.isDetail)return i.go("openstackClusters");n.callback()}).catch(function(e){r.add(e.data.detail)})}).catch(function(){})},n.getClusterCertificate=function(){var e=CONFIG.api_url+"/openstack/clusters/"+n.cluster.id+"/get_certificate";window.open(e)},n.resizeCluster=function(e,t){return o.show({templateUrl:"staff/apps/osclusters/resize/flclusterresize.html",controller:"FlClusterResizeController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{cluster:n.cluster},targetEvent:t}).then(function(){}).catch(function(){})}}]}}angular.module("fleioStaff").directive("flXsClusterActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog"]}(),function(){"use strict";function e(t,n,e,i,o){var r=this;r.$onInit=function(){r.goBackOrToState=i.goBackOrToState,r.cluster={master_count:1,node_count:1,create_timeout:60},r.searchClusterTemplates=function(e){return t.ClusterTemplates.get({search:e}).$promise.then(function(e){return e.objects})},r.matchFlavor=function(e,t){for(var n=!1,i=null,o=0;o<r.createOptions.flavors.length;o++)r.createOptions.flavors[o].id===t[e]&&(n=!0,r.cluster[e]=t[e]),r.createOptions.flavors[o].name===t[e]&&(i=r.createOptions.flavors[o]);n||(r.cluster[e]=i.id)},r.formatLabelsToStr=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t=t+n+"="+e[n]+",");return t.substring(0,t.length-1)},r.clusterTemplateChanged=function(){r.selectedClusterTemplate&&t.Clusters.get({cluster_template_id:r.selectedClusterTemplate.id,action:"create_options"}).$promise.then(function(e){r.createOptions=e,t.ClusterTemplates.get({id:r.selectedClusterTemplate.id}).$promise.then(function(e){r.cluster.docker_volume_size=e.docker_volume_size,e.master_flavor_id&&r.matchFlavor("master_flavor_id",e),e.flavor_id&&r.matchFlavor("flavor_id",e),e.labels&&(r.cluster.labels=r.formatLabelsToStr(JSON.parse(e.labels.replace(/'/g,'"')))),e.keypair_id&&(r.cluster.keypair=e.keypair_id)})})},r.submitForm=function(){if(!r.newCluster.$invalid){if(r.submitPending=!0,!r.selectedClusterTemplate)return r.submitPending=!1,e.add(o.getString("Please select a valid cluster template"));r.cluster.cluster_template_id=r.selectedClusterTemplate.id,t.Clusters.save(r.cluster).$promise.then(function(e){r.submitPending=!1,n.go("openstackClusters")}).catch(function(e){r.backendErrors=e.data,r.submitPending=!1})}}}}angular.module("fleioStaff").component("flClusterCreate",{templateUrl:"staff/apps/osclusters/create/flclustercreate.component.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["FlOsApi","$state","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){e.state("openstackClusters",{url:t.joinBaseUrl("openstack/clusters?page_size?ordering?filtering?search"),component:"flClustersList",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{clusters:["$state","$stateParams","FlObjectList","FlOsApi",function(r,e,t,n){return n.Clusters.get({action:"filter_options"}).$promise.then(function(e){for(var t=e.regions,n=[],i=0,o=t.length;i<o;++i)n.push({display:t[i].id,value:t[i].id});r.get("openstackClusters").data.filtering.region.choices=n,r.get("openstackClusters").data.filtering.status.choices=e.statuses}),t(n.Clusters,e)}]},data:{stateInfo:{display:n("Clusters"),parent:"dashboard"},feature:"openstack.coe.clusters",orderOptions:{name:n("Name"),status:n("Status"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},project__service__client:{display:n("Client"),field_name:"project__service__client",type:"client"},region:{display:n("Region"),field_name:"region",type:"choices",choices:[]},status:{display:n("Status"),field_name:"status",type:"choices",choices:[]},cluster_template:{display:n("Cluster template"),field_name:"cluster_template",type:"customModelInstance",service:"FlOsApi",service_details:{type:"openstack",items:"ClusterTemplates"}}}}}).state("openstackClusterCreate",{url:t.joinBaseUrl("openstack/clusters/create"),component:"flClusterCreate",authenticate:!0,resolve:{createOptions:["FlOsApi",function(e){return e.Clusters.get({action:"create_options"}).$promise}]},data:{feature:"openstack.coe.clusters",stateInfo:{display:n("Create cluster"),parent:"openstackClusters"}}}).state("openstackClusterDetails",{url:t.joinBaseUrl("openstack/clusters/:id"),component:"flClusterDetails",authenticate:!0,resolve:{cluster:["FlOsApi","$stateParams","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return e.Clusters.get(t).$promise.then(function(e){var t;return t=e.name?e.name:e.id,n.setParams({clusterTitle:t}),e}).catch(i.handleError)}],permissions:["FlOsApi",function(e){return e.Clusters.get({action:"permissions"}).$promise}]},data:{feature:"openstack.coe.clusters",stateInfo:{display:n("Cluster {:clusterTitle}"),parent:"openstackClusters",default:n("Cluster details")}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s,l){var c,u=this;function d(){return u.clusterTemplates.fetchData().then(function(){})}u.$onInit=function(){r.info.enabled=!0,r.info.label=s("Search cluster templates"),r.info.service=u.clusterTemplates,(c=n(d,1e4)).start(),i.init(c.start.bind(c),c.stop.bind(c)),u.TRANSLATED_STRINGS_MAP={create:l.getString("Create cluster template"),no_permission:l.getString("You are not\nallowed to do this")}},u.$onDestroy=function(){c.teardown(),i.uninit()},u.onClusterTemplateAction=function(){return c.boost()}}angular.module("fleioStaff").component("flClusterTemplatesList",{templateUrl:"staff/apps/osclustertemplates/flclustertemplates.component.html",controller:e,bindings:{clusterTemplates:"<"}}),e.$inject=["$state","$stateParams","FlOsTimer","FlDetectIdleService","$mdDialog","FlSearchService","FlOsApi","gettext","gettextCatalog"]}(),function(){"use strict";function e(){var e=this;e.$onInit=function(){e.clusterTemplate.labels=JSON.parse(e.clusterTemplate.labels.replace(/'/g,'"').replace(/None/g,"null"))}}angular.module("fleioStaff").component("flClusterTemplateDetails",{templateUrl:"staff/apps/osclustertemplates/flclustertemplatedetails.component.html",controller:e,bindings:{clusterTemplate:"<",permissions:"<"}}),e.$inject=[]}(),function(){"use strict";function e(e,t,n,i,o){var r=this;r.$onInit=function(){r.goBackOrToState=i.goBackOrToState,r.clusterTemplate={coe:"kubernetes",network_driver:"flannel",docker_storage_driver:"devicemapper",volume_driver:"cinder",server_type:"vm",fixed_network:null},r.coeOptions=[{name:"kubernetes",display_name:"Kubernetes"},{name:"swarm",display_name:"Docker Swarm"},{name:"mesos",display_name:"Mesos"}],r.refreshCreateOptions=function(){e.ClusterTemplates.get({action:"create_options",region:r.selectedRegion}).$promise.then(function(e){r.createOptions=e}).catch(function(e){})},r.createOptions.regions.length&&(r.selectedRegion=r.createOptions.regions[0].id,r.refreshCreateOptions()),r.regionChanged=function(){r.clusterTemplate.external_network_id=null,r.clusterTemplate.flavor_id=null,r.clusterTemplate.master_flavor_id=null,r.clusterTemplate.fixed_network=null,r.clusterTemplate.image_id=null,delete r.clusterTemplate.fixed_subnet,r.selectedFixedSubnet=null,r.refreshCreateOptions()},r.createFilterFor=function(e){var t=angular.lowercase(e);return function(e){return 0===angular.lowercase(e.name).indexOf(t)}},r.selectedFixedSubnetChange=function(e){e?r.clusterTemplate.fixed_subnet=e.id:delete r.clusterTemplate.fixed_subnet},r.querySearchSubnets=function(e){return e?r.createOptions.fixed_subnets.filter(r.createFilterFor(e)):r.createOptions.fixed_subnets},r.submitForm=function(){r.submitPending=!0,r.newClusterTemplate.$invalid?r.submitPending=!1:(r.clusterTemplate.region=r.selectedRegion,e.ClusterTemplates.save(r.clusterTemplate).$promise.then(function(e){return r.submitPending=!1,n.add(o.getString("Successfully created cluster template.")),t.go("openstackClusterTemplates")}).catch(function(e){r.submitPending=!1,r.backendErrors=e.data}))}}}angular.module("fleioStaff").component("flClusterTemplateCreate",{templateUrl:"staff/apps/osclustertemplates/create/flclustertemplate-create.component.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["FlOsApi","$state","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(n,i,e,o,t,r,a){return{restrict:"E",replace:"true",scope:{clusterTemplate:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"staff/apps/osclustertemplates/actions/flclustertemplateactions.html",controller:["$scope","$element",function(e,t){e.TRANSLATED_STRINGS_MAP={delete:r.getString("Delete"),edit:r.getString("Edit"),no_permission:r.getString("You are not\nallowed to do this")},e.deleteClusterTemplate=function(){return n.yesNoDlg(r.getString("Are you sure you want to delete the cluster template?"),r.getString("Delete cluster template {{name}}",{name:e.clusterTemplate.name}),r.getString("Delete cluster template")).then(function(){return e.clusterTemplate.fldelete().then(function(){if(o.add(r.getString("Cluster template deleted")),e.isDetail)return i.go("openstackClusterTemplates");e.callback()}).catch(function(e){o.add(e.data.detail)})}).catch(function(){})}}]}}angular.module("fleioStaff").directive("flClusterTemplateActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlResolveErrorHandler"]}(),function(){"use strict";function e(n,i,e,o,r){return{restrict:"E",replace:"true",scope:{clusterTemplate:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"staff/apps/osclustertemplates/actions/flxsclustertemplateactions.html",controller:["$scope","$element",function(e,t){e.deleteClusterTemplate=function(){return n.yesNoDlg(r.getString("Are you sure you want to delete the cluster template?"),r.getString("Delete cluster template {{name}}",{name:e.clusterTemplate.name}),r.getString("Delete cluster template")).then(function(){return e.clusterTemplate.fldelete().then(function(){if(o.add(r.getString("Cluster template deleted")),e.isDetail)return i.go("openstackClusterTemplates");e.callback()}).catch(function(e){o.add(e.data.detail)})}).catch(function(){})}}]}}angular.module("fleioStaff").directive("flXsClusterTemplateActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){e.state("openstackClusterTemplates",{url:t.joinBaseUrl("openstack/cluster-templates?page_size?ordering?filtering?search"),component:"flClusterTemplatesList",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{clusterTemplates:["$state","$stateParams","FlObjectList","FlOsApi",function(r,e,t,n){return n.ClusterTemplates.get({action:"filter_options"}).$promise.then(function(e){for(var t=e.regions,n=[],i=0,o=t.length;i<o;++i)n.push({display:t[i].id,value:t[i].id});r.get("openstackClusterTemplates").data.filtering.region.choices=n}),t(n.ClusterTemplates,e)}]},data:{stateInfo:{display:n("Cluster templates"),parent:"dashboard"},feature:"openstack.coe.cluster_templates",orderOptions:{name:n("Name"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},project__service__client:{display:n("Client"),field_name:"project__service__client",type:"client"},coe:{display:n("Container orchestration engine"),field_name:"coe",type:"choices",choices:[{display:n("Kubernetes"),value:"kubernetes"},{display:n("Mesos"),value:"mesos"},{display:n("Swarm"),value:"swarm"}]},public:{display:n("Is public"),field_name:"public",type:"bool"},floating_ip_enabled:{display:n("Floating IP enabled"),field_name:"floating_ip_enabled",type:"bool"},region:{display:n("Region"),field_name:"region",type:"choices",choices:[]}}}}).state("openstackClusterTemplateCreate",{url:t.joinBaseUrl("openstack/cluster-templates/create"),component:"flClusterTemplateCreate",authenticate:!0,resolve:{createOptions:["FlOsApi",function(e){return e.ClusterTemplates.get({action:"create_options"}).$promise}]},data:{feature:"openstack.coe.cluster_templates",stateInfo:{display:n("Create cluster template"),parent:"openstackClusterTemplates"}}}).state("openstackClusterTemplateDetails",{url:t.joinBaseUrl("openstack/cluster-templates/:id"),component:"flClusterTemplateDetails",authenticate:!0,resolve:{clusterTemplate:["FlOsApi","$stateParams","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return e.ClusterTemplates.get(t).$promise.then(function(e){var t;return t=e.name?e.name:e.id,n.setParams({clusterTemplateTitle:t}),e}).catch(i.handleError)}],permissions:["FlOsApi",function(e){return e.ClusterTemplates.get({action:"permissions"}).$promise}]},data:{feature:"openstack.coe.cluster_templates",stateInfo:{display:n("Cluster template {:clusterTemplateTitle}"),parent:"openstackClusterTemplates",default:n("Cluster template details")}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n){e.state("openstackVolumeBackups",{url:t.joinBaseUrl("openstack/volume-backups?page_size?ordering?filtering?search?dlg"),component:"flVolumeBackupsList",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{volumeBackups:["$state","$stateParams","FlObjectList","FlOsApi",function(t,e,n,i){return i.VolumeBackups.get({action:"filter_options"}).$promise.then(function(e){t.get("openstackVolumeBackups").data.filtering.status.choices=e.statuses}),n(i.VolumeBackups,e)}]},data:{stateInfo:{display:n("Volume backups"),parent:"dashboard"},feature:"openstack.volumes.backups",orderOptions:{name:n("Name"),status:n("Status"),size:n("Size"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},volume:{display:n("related volume"),field_name:"volume",type:"customModelInstance",service:"FlOsApi",service_details:{type:"openstack",items:"Volumes"}},is_incremental:{display:n("Is incremental"),field_name:"is_incremental",type:"bool"},status:{display:n("Status"),field_name:"status",type:"choices",choices:[]},size:{display:n("Size"),field_name:"size",type:"decimal"},object_count:{display:n("Object count"),field_name:"object_count",type:"decimal"},has_dependent_backups:{display:n("Has dependent backups"),field_name:"has_dependent_backups",type:"bool"}}}}).state("openstackVolumeBackupDetails",{url:t.joinBaseUrl("openstack/volume-backups/:id"),component:"flVolumeBackupDetails",authenticate:!0,resolve:{volumeBackup:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.VolumeBackups.get(e).$promise.then(function(e){var t;return t=e.name?e.name:e.id,n.setParams({volumeBackupTitle:t}),e}).catch(i.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.VolumeBackups.get({action:"permissions"}).$promise}]},data:{feature:"openstack.volumes.backups",stateInfo:{display:n("Volume backup {:volumeBackupTitle}"),parent:"openstackVolumeBackups",default:n("Volume backup details")}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s,l){var c,u=this;function d(){return u.volumeBackups.fetchData().then(u.checkForTaskChange)}u.$onInit=function(){r.info.enabled=!0,r.info.label=s("Search volume backups"),r.info.service=u.volumeBackups,(c=n(d,1e4)).start(),i.init(c.start.bind(c),c.stop.bind(c)),u.TRANSLATED_STRINGS_MAP={create:l.getString("Create volume backup"),no_permission:l.getString("You are not\nallowed to do this")}},u.checkForTaskChange=function(){angular.forEach(u.volumeBackups.objects,function(e){if(e.isUnderTask())return c.boost()})},u.$onDestroy=function(){c.teardown(),i.uninit()},u.onVolumeAction=function(){return c.boost()},u.createNewBackup=function(e){return o.show({templateUrl:"staff/apps/osvolumebackups/create/fl-volumebackups-create.template.html",controller:"FlVolumeBackupsCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:null},targetEvent:e}).then(function(){}).catch(function(){d()})}}angular.module("fleioStaff").component("flVolumeBackupsList",{templateUrl:"staff/apps/osvolumebackups/flvolumebackups.html",controller:e,bindings:{volumeBackups:"<"}}),e.$inject=["$state","$stateParams","FlOsTimer","FlDetectIdleService","$mdDialog","FlSearchService","FlOsApi","gettext","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,i){var o,r=this;function a(){return t.VolumeBackups.get({id:e.id}).$promise.then(function(e){r.volumeBackup=e,r.checkForTaskChange(e)})}r.$onInit=function(){(o=n(a,1e4)).start(),i.init(o.start.bind(o),o.stop.bind(o)),r.checkForTaskChange(r.volumeBackup)},r.checkForTaskChange=function(e){if(e.isUnderTask())return o.boost()},r.onVolumeAction=function(){return o.boost()},r.$onDestroy=function(){o.teardown(),i.uninit()}}angular.module("fleioStaff").component("flVolumeBackupDetails",{templateUrl:"staff/apps/osvolumebackups/flvolumebackupdetails.html",controller:e,bindings:{volumeBackup:"<",permissions:"<"}}),e.$inject=["$stateParams","FlOsApi","FlOsTimer","FlDetectIdleService"]}(),function(){"use strict";function e(n,i,o,r,e,a,t){return{restrict:"E",replace:"true",scope:{backup:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"staff/apps/osvolumebackups/actions/flvolumebackupactions.html",controller:["$scope","$element",function(t,e){t.TRANSLATED_STRINGS_MAP={delete:a.getString("Delete"),edit:a.getString("Edit"),restore:a.getString("Restore"),no_permission:a.getString("You are not\nallowed to do this")},t.deleteVolumeBackup=function(){return n.yesNoDlg(a.getString("Are you sure you want to delete the volume backup?"),a.getString("Delete volume backup {{name}}",{name:t.backup.name}),a.getString("Delete volume backup")).then(function(){return t.backup.fldelete().then(function(){if(r.add(a.getString("Volume backup delete scheduled")),t.isDetail)return i.go("openstackVolumeBackups")}).catch(function(e){r.add(e.data.detail)})}).catch(function(){})},t.restoreBackup=function(e){return o.show({templateUrl:"staff/apps/osvolumebackups/restore/fl-volumebackups-restore.template.html",controller:"FlVolumeBackupsRestoreController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{backup:t.backup},targetEvent:e}).then(function(){}).catch(function(){})},t.editBackup=function(e){return o.show({templateUrl:"staff/apps/osvolumebackups/edit/fl-volumebackups-edit.template.html",controller:"FlVolumeBackupsEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{backupId:t.backup.id,backupName:t.backup.name,backupDescription:t.backup.description},targetEvent:e}).then(function(){}).catch(function(){})}}]}}angular.module("fleioStaff").directive("flVolumeBackupActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlResolveErrorHandler"]}(),function(){"use strict";function e(n,i,o,r,e,a,t){return{restrict:"E",replace:"true",scope:{backup:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"staff/apps/osvolumebackups/actions/flxsvolumebackupactions.html",controller:["$scope","$element",function(t,e){t.TRANSLATED_STRINGS_MAP={delete:a.getString("Delete"),restore:a.getString("Restore"),no_permission:a.getString("You are not\nallowed to do this")},t.deleteVolumeBackup=function(){return n.yesNoDlg(a.getString("Are you sure you want to delete the volume backup?"),a.getString("Delete volume backup {{name}}",{name:t.backup.name}),a.getString("Delete volume backup")).then(function(){return t.backup.fldelete().then(function(){if(r.add(a.getString("Volume backup delete scheduled")),t.isDetail)return i.go("openstackVolumeBackups")}).catch(function(e){r.add(e.data.detail)})}).catch(function(){})},t.restoreBackup=function(e){return o.show({templateUrl:"staff/apps/osvolumebackups/restore/fl-volumebackups-restore.template.html",controller:"FlVolumeBackupsRestoreController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{backup:t.backup},targetEvent:e}).then(function(){}).catch(function(){})},t.editBackup=function(e){return o.show({templateUrl:"staff/apps/osvolumebackups/edit/fl-volumebackups-edit.template.html",controller:"FlVolumeBackupsEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{backupId:t.backup.id,backupName:t.backup.name,backupDescription:t.backup.description},targetEvent:e}).then(function(){}).catch(function(){})}}]}}angular.module("fleioStaff").directive("flXsVolumeBackupActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlResolveErrorHandler"]}(),function(){"use strict";function e(t,e,n,i,o){var r=this;r.$onInit=function(){e?(r.volumeIsPreselected=!0,r.volume=angular.copy(e),r.backup={volume_id:r.volume.id}):(r.volumeIsPreselected=!1,r.backup={}),r.createBackupForClient=!1,r.submitPending=!1},r.volumeSearch=function(e){return t.Volumes.get({search:e}).$promise.then(function(e){return e.objects})},r.selectedVolumeChange=function(e){r.backup.volume_id=e.id},r.close=function(){n.cancel()},r.createBackup=function(){if(document.activeElement.blur(),!r.submitPending&&!r.backupForm.$invalid)return r.submitPending=!0,r.backup.for_client=r.createBackupForClient,t.VolumeBackups.save(r.backup).$promise.then(function(e){return i.add(o.getString("Backup was scheduled for creation")),r.submitPending=!1,n.cancel(e)}).catch(function(e){r.backendErrors=e.data,r.submitPending=!1})}}angular.module("fleioStaff").controller("FlVolumeBackupsCreateController",e),e.$inject=["FlOsApi","volume","$mdDialog","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,i,o,r,a){var s=this;s.$onInit=function(){t&&(s.backup={id:angular.copy(t),name:angular.copy(n),description:angular.copy(i)})},s.close=function(){o.cancel()},s.updateBackup=function(){if(document.activeElement.blur(),!s.submitPending&&!s.backupForm.$invalid)return s.submitPending=!0,e.VolumeBackups.update(s.backup).$promise.then(function(e){return r.add(a.getString("Backup was scheduled for updating")),s.submitPending=!1,o.cancel(e)}).catch(function(e){s.backendErrors=e.data,s.submitPending=!1})}}angular.module("fleioStaff").controller("FlVolumeBackupsEditController",e),e.$inject=["FlOsApi","backupId","backupName","backupDescription","$mdDialog","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(t,e,n,i,o){var r=this;r.$onInit=function(){e&&(r.backup=angular.copy(e)),r.requestData={}},r.close=function(){n.cancel()},r.restoreBackup=function(){if(document.activeElement.blur(),!r.submitPending&&!r.backupForm.$invalid){r.submitPending=!0;var e={id:r.backup.id,action:"restore"};return r.requestData.newVolume&&r.requestData.name&&(e.name=r.requestData.name),!r.requestData.newVolume&&r.selectedVolume&&(e.volume_id=r.selectedVolume.id),t.VolumeBackups.post(e).$promise.then(function(e){return i.add(o.getString("Backup was scheduled for restoration")),r.submitPending=!1,n.cancel(e)}).catch(function(e){r.backendErrors=e.data,r.submitPending=!1})}},r.volumesSearch=function(e){return t.VolumeBackups.post({backup_id:r.backup.id,action:"get_volumes_available_for_restoration",search:e}).$promise.then(function(e){return e.objects})}}angular.module("fleioStaff").controller("FlVolumeBackupsRestoreController",e),e.$inject=["FlOsApi","backup","$mdDialog","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s,l){var c,u=this;function d(){return u.volumeSnapshots.fetchData().then(u.checkForTaskChange)}u.$onInit=function(){r.info.enabled=!0,r.info.label=s("Search volume snapshots"),r.info.service=u.volumeSnapshots,(c=n(d,1e4)).start(),i.init(c.start.bind(c),c.stop.bind(c)),u.TRANSLATED_STRINGS_MAP={create:l.getString("Create volume snapshot"),no_permission:l.getString("You are not\nallowed to do this")}},u.checkForTaskChange=function(){angular.forEach(u.volumeSnapshots.objects,function(e){if(e.isUnderTask())return c.boost()})},u.$onDestroy=function(){c.teardown(),i.uninit()},u.onVolumeAction=function(){return c.boost()},u.createNewSnapshot=function(e){return o.show({templateUrl:"staff/apps/osvolumesnapshots/create/fl-volumesnapshots-create.template.html",controller:"FlVolumeSnapshotsCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:null},targetEvent:e}).then(function(){}).catch(function(){d()})}}angular.module("fleioStaff").component("flVolumeSnapshotsList",{templateUrl:"staff/apps/osvolumesnapshots/flvolumesnapshots.html",controller:e,bindings:{volumeSnapshots:"<"}}),e.$inject=["$state","$stateParams","FlOsTimer","FlDetectIdleService","$mdDialog","FlSearchService","FlOsApi","gettext","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,i){var o,r=this;function a(){return t.VolumeSnapshots.get({id:e.id}).$promise.then(function(e){r.volumeSnapshot=e,r.checkForTaskChange(e)})}r.$onInit=function(){(o=n(a,1e4)).start(),i.init(o.start.bind(o),o.stop.bind(o)),r.checkForTaskChange(r.volumeSnapshot)},r.checkForTaskChange=function(e){if(e.isUnderTask())return o.boost()},r.onVolumeAction=function(){return o.boost()},r.$onDestroy=function(){o.teardown(),i.uninit()}}angular.module("fleioStaff").component("flVolumeSnapshotDetails",{templateUrl:"staff/apps/osvolumesnapshots/flvolumesnapshotdetails.html",controller:e,bindings:{volumeSnapshot:"<",permissions:"<"}}),e.$inject=["$stateParams","FlOsApi","FlOsTimer","FlDetectIdleService"]}(),function(){"use strict";function e(t,e,n,i,o){var r=this;r.$onInit=function(){e?(r.volumeIsPreselected=!0,r.volume=angular.copy(e),r.snapshot={volume_id:r.volume.id}):(r.volumeIsPreselected=!1,r.snapshot={}),r.submitPending=!1},r.volumeSearch=function(e){return t.Volumes.get({search:e}).$promise.then(function(e){return e.objects})},r.selectedVolumeChange=function(e){r.snapshot.volume_id=e.id},r.close=function(){n.cancel()},r.createSnapshot=function(){if(document.activeElement.blur(),!r.submitPending&&!r.snapshotForm.$invalid)return r.submitPending=!0,t.VolumeSnapshots.save(r.snapshot).$promise.then(function(e){return i.add(o.getString("Volume snapshot was scheduled for creation")),r.submitPending=!1,n.cancel(e)}).catch(function(e){r.backendErrors=e.data,r.submitPending=!1})}}angular.module("fleioStaff").controller("FlVolumeSnapshotsCreateController",e),e.$inject=["FlOsApi","volume","$mdDialog","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,i,o){var r=this;r.$onInit=function(){r.snapshot=angular.copy(t),r.submitPending=!1},r.close=function(){n.cancel()},r.updateSnapshot=function(){if(document.activeElement.blur(),!r.submitPending&&!r.snapshotForm.$invalid)return r.submitPending=!0,e.VolumeSnapshots.update(r.snapshot).$promise.then(function(e){return i.add(o.getString("Volume snapshot update started.")),r.submitPending=!1,n.cancel(e)}).catch(function(e){r.backendErrors=e.data,r.submitPending=!1})}}angular.module("fleioStaff").controller("FlVolumeSnapshotsUpdateController",e),e.$inject=["FlOsApi","snapshot","$mdDialog","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(n,i,o,r,e,a){return{restrict:"E",replace:"true",scope:{snapshot:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"staff/apps/osvolumesnapshots/actions/flvolumesnapshotactions.html",controller:["$scope","$element",function(e,t){e.TRANSLATED_STRINGS_MAP={delete:a.getString("Delete"),edit:a.getString("Edit"),reset_state:a.getString("Reset state"),no_permission:a.getString("You are not\nallowed to do this")},e.deleteVolumeSnapshot=function(){return n.yesNoDlg(a.getString("Are you sure you want to delete the volume snapshot?"),a.getString("Delete volume snapshot {{name}}",{name:e.snapshot.name}),a.getString("Delete volume snapshot")).then(function(){return e.snapshot.fldelete().then(function(){if(r.add(a.getString("Volume snapshot delete scheduled")),e.isDetail)return i.go("openstackVolumeSnapshots")}).catch(function(e){r.add(e.data.detail)})}).catch(function(){})},e.resetVolumeSnapshotState=function(e,t){return o.show({templateUrl:"staff/apps/osvolumesnapshots/reset_state/flvolumesnapshot-reset-state.html",controller:"FlVolumeSnapResetStateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{snapshot:e},targetEvent:t}).then(function(){return r.add(a.getString("Resetting state of volume..."))}).catch(function(){})},e.updateVolumeSnapshot=function(e,t){return o.show({templateUrl:"staff/apps/osvolumesnapshots/update/fl-volumesnapshots-update.template.html",controller:"FlVolumeSnapshotsUpdateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{snapshot:e},targetEvent:t}).then(function(){return r.add(a.getString("Volume snapshot update started."))}).catch(function(){})}}]}}angular.module("fleioStaff").directive("flVolumeSnapshotActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog"]}(),function(){"use strict";function e(n,i,o,r,e,a,t){return{restrict:"E",replace:"true",scope:{snapshot:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"staff/apps/osvolumesnapshots/actions/flxsvolumesnapshotactions.html",controller:["$scope","$element",function(e,t){e.TRANSLATED_STRINGS_MAP={delete:a.getString("Delete"),no_permission:a.getString("You are not\nallowed to do this")},e.deleteVolumeSnapshot=function(){return n.yesNoDlg(a.getString("Are you sure you want to delete the volume snapshot?"),a.getString("Delete volume snapshot {{name}}",{name:e.snapshot.name}),a.getString("Delete volume snapshot")).then(function(){return e.snapshot.fldelete().then(function(){if(r.add(a.getString("Volume snapshot delete scheduled")),e.isDetail)return i.go("openstackVolumeSnapshots")}).catch(function(e){r.add(e.data.detail)})}).catch(function(){})},e.resetVolumeSnapshotState=function(e,t){return o.show({templateUrl:"staff/apps/osvolumesnapshots/reset_state/flvolumesnapshot-reset-state.html",controller:"FlVolumeSnapResetStateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{snapshot:e},targetEvent:t}).then(function(){return r.add(a.getString("Resetting state of volume..."))}).catch(function(){})},e.updateVolumeSnapshot=function(e,t){return o.show({templateUrl:"staff/apps/osvolumesnapshots/update/fl-volumesnapshots-update.template.html",controller:"FlVolumeSnapshotsUpdateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{snapshot:e},targetEvent:t}).then(function(){return r.add(a.getString("Volume snapshot update started."))}).catch(function(){})}}]}}angular.module("fleioStaff").directive("flXsVolumeSnapshotActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlResolveErrorHandler"]}(),function(){"use strict";function e(e,t,n,i){var o=this;o.$onInit=function(){o.snapshot=angular.copy(t),o.states=[{value:"available",display:i.getString("Available")},{value:"error",display:i.getString("Error")}],o.state=o.states[0].value},o.resetState=function(){if(document.activeElement.blur(),!o.submitPending&&!o.resetStateForm.$invalid)return o.submitPending=!0,e.VolumeSnapshots.save({id:o.snapshot.id,action:"reset_state",state:o.state}).$promise.then(function(e){return n.hide(),e}).catch(function(e){o.backendErrors=e.data,o.submitPending=!1})},o.close=function(){return n.cancel()}}angular.module("fleioStaff").controller("FlVolumeSnapResetStateController",e),e.$inject=["FlOsApi","snapshot","$mdDialog","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){e.state("openstackVolumeSnapshots",{url:t.joinBaseUrl("openstack/volume-snapshots?page_size?ordering?filtering?search?dlg"),component:"flVolumeSnapshotsList",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{volumeSnapshots:["$state","$stateParams","FlObjectList","FlOsApi",function(t,e,n,i){return i.VolumeSnapshots.get({action:"filter_options"}).$promise.then(function(e){t.get("openstackVolumeSnapshots").data.filtering.status.choices=e.statuses}),n(i.VolumeSnapshots,e)}]},data:{stateInfo:{display:n("Volume snapshots"),parent:"dashboard"},feature:"openstack.volumes.snapshots",orderOptions:{name:n("Name"),status:n("Status"),size:n("Size"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},volume:{display:n("related volume"),field_name:"volume",type:"customModelInstance",service:"FlOsApi",service_details:{type:"openstack",items:"Volumes"}},status:{display:n("Status"),field_name:"status",type:"choices",choices:[]},size:{display:n("Size"),field_name:"size",type:"decimal"}}}}).state("openstackVolumeSnapshotDetails",{url:t.joinBaseUrl("openstack/volume-snapshots/:id"),component:"flVolumeSnapshotDetails",authenticate:!0,resolve:{volumeSnapshot:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.VolumeSnapshots.get(e).$promise.then(function(e){var t;return t=e.name?e.name:e.id,n.setParams({volumeSnapshotTitle:t}),e}).catch(i.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.VolumeSnapshots.get({action:"permissions"}).$promise}]},data:{feature:"openstack.volumes.snapshots",stateInfo:{display:n("Volume snapshot {:volumeSnapshotTitle}"),parent:"openstackVolumeSnapshots",default:n("Volume snapshot details")}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n){e.state("openstackVolumes",{url:t.joinBaseUrl("openstack/volumes?page_size?ordering?filtering?search?dlg"),component:"flVolumes",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{dlg:{value:"false",squash:!0},page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{volumes:["$state","$stateParams","FlObjectList","FlOsApi",function(r,e,t,n){return n.Volumes.get({options:"filter_options"}).$promise.then(function(e){for(var t=e.regions,n=[],i=0,o=t.length;i<o;++i)n.push({display:t[i].id,value:t[i].id});r.get("openstackVolumes").data.filtering.region.choices=n,r.get("openstackVolumes").data.filtering.status.choices=e.statuses}),t(n.Volumes,e)}]},data:{stateInfo:{display:n("Volumes"),parent:"dashboard"},feature:"openstack.volumes",orderOptions:{name:n("Name"),status:n("Status"),size:n("Size"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},status:{display:n("Status"),field_name:"status",type:"choices",choices:[]},size:{display:n("Size"),field_name:"size",type:"decimal"},region:{display:n("Region"),field_name:"region",type:"choices",choices:[]}}}}).state("openstackVolumeCreate",{url:t.joinBaseUrl("openstack/volumes/create"),component:"flVolumeCreateComponent",authenticate:!0,resolve:{createOptions:["$transition$","FlOsApi",function(e,t){return t.Volumes.get({action:"create_options",region:e.params().region,client:e.params().client}).$promise}]},data:{feature:"openstack.volumes",stateInfo:{display:n("New"),parent:"openstackVolumes",default:n("Create")}}}).state("openstackVolumeDetails",{url:t.joinBaseUrl("openstack/volumes/:id"),component:"flVolumeDetails",authenticate:!0,resolve:{volume:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.Volumes.get(e).$promise.then(function(e){var t;return t=e.name?e.name:e.id,n.setParams({volumeTitle:t}),e}).catch(i.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.Volumes.get({action:"permissions"}).$promise}]},data:{feature:"openstack.volumes",stateInfo:{display:n("Volume {:volumeTitle}"),parent:"openstackVolumes",default:n("Volume details")}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s,l){var c,u=this;function d(){return u.volumes.fetchData().then(u.checkForTaskChange)}u.$onInit=function(){r.info.enabled=!0,r.info.label=s("Search volumes"),r.info.service=u.volumes,(c=n(d,1e4)).start(),i.init(c.start.bind(c),c.stop.bind(c)),u.TRANSLATED_STRINGS_MAP={create:l.getString("Create volume"),no_permission:l.getString("You are not\nallowed to do this")}},u.checkForTaskChange=function(){angular.forEach(u.volumes.objects,function(e){if(e.isUnderTask())return c.boost()})},u.$onDestroy=function(){c.teardown(),i.uninit()},u.onVolumeAction=function(){return c.boost()}}angular.module("fleioStaff").component("flVolumes",{templateUrl:"staff/apps/osvolumes/flvolumes.html",controller:e,bindings:{volumes:"<"}}),e.$inject=["$state","$stateParams","FlOsTimer","FlDetectIdleService","$mdDialog","FlSearchService","FlOsApi","gettext","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,i,o,r){var a,s=this;function l(){return t.Volumes.get({id:e.id}).$promise.then(function(e){s.volume=e,s.checkForTaskChange(e)})}s.$onInit=function(){s.features=o.features,(a=n(l,1e4)).start(),i.init(a.start.bind(a),a.stop.bind(a)),s.checkForTaskChange(s.volume),s.numberOfSnapshotsStr=r.getString("Snapshots ("+s.volume.number_of_snapshots+")")},s.checkForTaskChange=function(e){if(e.isUnderTask())return a.boost()},s.onVolumeAction=function(){return a.boost()},s.$onDestroy=function(){a.teardown(),i.uninit()}}angular.module("fleioStaff").component("flVolumeDetails",{templateUrl:"staff/apps/osvolumes/flvolumedetails.html",controller:e,bindings:{volume:"<",permissions:"<"}}),e.$inject=["$stateParams","FlOsApi","FlOsTimer","FlDetectIdleService","FlFeatureService","gettextCatalog"]}(),function(){"use strict";function e(t,e,n,i,o,r){var a,s=this;s.$onInit=function(){s.currentPage=1,s.nextPage=!1,s.previousPage=!1,s.loading=!0,s.refreshVolumeBackups=function(){return n.VolumeBackups.get({volume__id:e.id,page:s.currentPage}).$promise.then(function(e){s.loading=!1,s.nextPage=!!e.next,s.previousPage=!!e.previous,s.volumeBackups=e}).catch(r.handleError)},s.refreshVolumeBackups(),(a=i(s.refreshVolumeBackups,1e4)).start(),o.init(a.start.bind(a),a.stop.bind(a))},s.createNewBackup=function(e){return t.show({templateUrl:"staff/apps/osvolumebackups/create/fl-volumebackups-create.template.html",controller:"FlVolumeBackupsCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:s.volume},targetEvent:e}).then(function(){}).catch(function(){s.refreshVolumeBackups()})},s.onVolumeAction=function(){return a.boost()},s.changePage=function(e){"next"===e&&(s.currentPage=s.currentPage+1,s.refreshVolumeBackups()),"previous"===e&&(s.currentPage=s.currentPage-1,s.refreshVolumeBackups())},s.$onDestroy=function(){a.teardown(),o.uninit()}}angular.module("fleioStaff").component("flVolumeBackups",{templateUrl:"staff/apps/osvolumes/backups/flvolumebackups.template.html",controller:e,bindings:{volume:"<"}}),e.$inject=["$mdDialog","$stateParams","FlOsApi","FlOsTimer","FlDetectIdleService","FlResolveErrorHandler"]}(),function(){"use strict";function e(t,e,n,i,o,r){var a,s=this;s.$onInit=function(){s.currentPage=1,s.nextPage=!1,s.previousPage=!1,s.loading=!0,s.refreshVolumeSnapshots=function(){return n.VolumeSnapshots.get({volume__id:e.id,page:s.currentPage}).$promise.then(function(e){s.loading=!1,s.nextPage=!!e.next,s.previousPage=!!e.previous,s.volumeSnapshots=e}).catch(r.handleError)},s.refreshVolumeSnapshots(),(a=i(s.refreshVolumeSnapshots,1e4)).start(),o.init(a.start.bind(a),a.stop.bind(a))},s.createNewSnapshot=function(e){return t.show({templateUrl:"staff/apps/osvolumesnapshots/create/fl-volumesnapshots-create.template.html",controller:"FlVolumeSnapshotsCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:s.volume},targetEvent:e}).then(function(){}).catch(function(){s.refreshVolumeSnapshots()})},s.onVolumeAction=function(){return a.boost()},s.changePage=function(e){"next"===e&&(s.currentPage=s.currentPage+1,s.refreshVolumeSnapshots()),"previous"===e&&(s.currentPage=s.currentPage-1,s.refreshVolumeSnapshots())},s.$onDestroy=function(){a.teardown(),o.uninit()}}angular.module("fleioStaff").component("flVolumeSnapshots",{templateUrl:"staff/apps/osvolumes/snapshots/flvolumesnapshots.template.html",controller:e,bindings:{volume:"<"}}),e.$inject=["$mdDialog","$stateParams","FlOsApi","FlOsTimer","FlDetectIdleService","FlResolveErrorHandler"]}(),function(){"use strict";function e(t,i,o,r,a,s,e,l){return{restrict:"E",replace:"true",scope:{volume:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"staff/apps/osvolumes/actions/flvolumeactions.html",controller:["$scope","$element",function(n,e){return n.TRANSLATED_STRINGS_MAP={delete:s.getString("Delete"),extend:s.getString("Extend"),rename:s.getString("Rename"),no_permission:s.getString("You are not\nallowed to do this")},n.features=l.features,n.deleteVolume=function(){return t.yesNoDlg(s.getString("Are you sure you want to delete the volume?"),s.getString("Delete volume {{name}}",{name:n.volume.name}),s.getString("Delete volume")).then(function(){return n.volume.fldelete().then(function(){if(r.add(s.getString("Volume delete scheduled")),n.isDetail)return i.go("openstackVolumes")}).catch(function(e){e.data.detail?r.add(e.data.detail):r.add(s.getString("Unable to delete volume."))})}).catch(function(){})},n.renameVolume=function(e,t){return o.show({templateUrl:"staff/apps/osvolumes/rename/flvolumerename.html",controller:"FlVolumeRenameController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:e},targetEvent:t}).then(function(e){n.volume.name=e,a.updateParams({name:e})}).catch(function(){})},n.revertToSnapshot=function(e,t){return o.show({templateUrl:"oscommons/revert_volume_to_snapshot_dialog/fl-revert-volume-to-snapshot-dialog.template.html",controller:"FlVolumeRevertController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:e},targetEvent:t}).then(function(e){r.add(e.detail)}).catch(function(){})},n.changeBootableStatus=function(e,t){return o.show({templateUrl:"oscommons/change_bootable_status_dialog/fl-change-bootable-status-dialog.template.html",controller:"FlVolumeChangeBootableStatusController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:e},targetEvent:t}).then(function(e){r.add(e.detail)}).catch(function(){})},n.extendVolume=function(e){return o.show({templateUrl:"staff/apps/osvolumes/extend/flvolumeextend.html",controller:"FlVolumeExtendController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:n.volume},targetEvent:e}).then(function(){return"function"==typeof n.callback&&(n.volume.status="pending",n.callback.call(null)),r.add(s.getString("Volume extend scheduled"))}).catch(function(){})}}]}}angular.module("fleioStaff").directive("flVolumeActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlOsApi","FlFeatureService"]}(),function(){"use strict";function e(t,i,o,r,a,s,e,l){return{restrict:"E",replace:"true",scope:{volume:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"staff/apps/osvolumes/actions/flxsvolumeactions.html",controller:["$scope","$element",function(n,e){return n.features=l.features,n.deleteVolume=function(){return t.yesNoDlg(s.getString("Are you sure you want to delete the volume?"),s.getString("Delete volume {{name}}",{name:n.volume.name}),s.getString("Delete volume")).then(function(){return n.volume.fldelete().then(function(){if(r.add(s.getString("Volume delete scheduled")),n.isDetail)return i.go("openstackVolumes")}).catch(function(e){e.data.detail?r.add(e.data.detail):r.add(s.getString("Unable to delete volume."))})}).catch(function(){})},n.renameVolume=function(e,t){return o.show({templateUrl:"staff/apps/osvolumes/rename/flvolumerename.html",controller:"FlVolumeRenameController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:e},targetEvent:t}).then(function(e){n.volume.name=e,a.updateParams({name:e})}).catch(function(){})},n.revertToSnapshot=function(e,t){return o.show({templateUrl:"oscommons/revert_volume_to_snapshot_dialog/fl-revert-volume-to-snapshot-dialog.template.html",controller:"FlVolumeRevertController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:e},targetEvent:t}).then(function(e){r.add(e.detail)}).catch(function(){})},n.changeBootableStatus=function(e,t){return o.show({templateUrl:"oscommons/change_bootable_status_dialog/fl-change-bootable-status-dialog.template.html",controller:"FlVolumeChangeBootableStatusController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:e},targetEvent:t}).then(function(e){r.add(e.detail)}).catch(function(){})},n.extendVolume=function(e){return o.show({templateUrl:"staff/apps/osvolumes/extend/flvolumeextend.html",controller:"FlVolumeExtendController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:n.volume},targetEvent:e}).then(function(){return"function"==typeof n.callback&&(n.volume.status="pending",n.callback.call(null)),r.add(s.getString("Volume extend scheduled"))}).catch(function(){})}}]}}angular.module("fleioStaff").directive("flXsVolumeActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlOsApi","FlFeatureService"]}(),function(){"use strict";function e(n,t,i,o,e,r){var a=this;a.sourceTypes=[{name:"new",description:"Create a new empty volume"}],a.features=e.features,a.$onInit=function(){a.volume={region:a.createOptions.selected_region,type:a.createOptions.types.length?a.createOptions.types[0]:"",source:{source_type:"new",source:null}},a.setVolumeType(),a.rebuildSourceTypes()},a.refreshCreateOptions=function(e,t){return n.Volumes.get({action:"create_options",region:t,client:e}).$promise.then(function(e){return a.createOptions=e,a.setVolumeType(),a.rebuildSourceTypes(),a.resetVolumeSources(),e}).catch(function(e){return i.add(e.data),e})},a.searchClient=function(e){return o.get({search:e,has_enabled_project:"True"}).$promise.then(function(e){return e.objects})},a.changeRegion=function(){a.refreshCreateOptions(a.volume.client,a.volume.region)},a.rebuildSourceTypes=function(){a.sourceTypes=[{name:"new",description:r.getString("Create a new empty volume")}],a.createOptions.sources&&(a.createOptions.sources.image&&a.createOptions.sources.image.length&&a.sourceTypes.push({name:"image",description:r.getString("Use image as a source")}),a.createOptions.sources.volume&&a.createOptions.sources.volume.length&&a.sourceTypes.push({name:"volume",description:r.getString("Use an existing volume")})),a.volume.source&&"new"!==a.volume.source.source_type&&(a.createOptions.sources[a.volume.source.source_type].length||(a.volume.source.source_type="new",a.volume.source.source=null))},a.resetVolumeSources=function(){"new"!==a.volume.source.source_type?(delete a.volume.source.source,a.volumeSources=a.createOptions.sources[a.volume.source.source_type]):a.volumeSources=[]},a.selectedClientChange=function(e){void 0!==e?(a.volume.client=e.id,a.refreshCreateOptions(a.volume.client,a.volume.region)):delete a.volume.client},a.setVolumeType=function(){var t={};a.createOptions.types.forEach(function(e){e.name===a.volume.type&&(t=e)}),a.volumeType=t,a.volume.type=t.name},a.close=function(){return t.go("openstackVolumes")},a.newVolumeSubmit=function(){if(document.activeElement.blur(),!a.submitPending&&!a.newVolume.$invalid)return a.submitPending=!0,n.Volumes.save(a.volume).$promise.then(function(e){return i.add(r.getString("Volume create scheduled")),t.go("openstackVolumes"),e}).catch(function(e){a.backendErrors=e.data}).finally(function(){a.submitPending=!1})}}angular.module("fleioStaff").component("flVolumeCreateComponent",{templateUrl:"staff/apps/osvolumes/create/flvolumecreate.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["FlOsApi","$state","FlNotificationService","FlClientApi","FlFeatureService","gettextCatalog"]}(),function(){"use strict";function e(t,e,n){var i=this;i.sizeIncrement=n.size_increment,i.size=n.size,i.volume=n,i.extendVolume=function(){if(document.activeElement.blur(),!i.submitPending&&!i.extendVolumeForm.$invalid)return i.submitPending=!0,e.Volumes.save({id:i.volume.id,action:"extend",size:i.size}).$promise.then(function(e){return t.hide()},function(e){return i.backendErrors=e.data,i.submitPending=!1})},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlVolumeExtendController",e),e.$inject=["$mdDialog","FlOsApi","volume"]}(),function(){"use strict";function e(t,e,n){var i=this;i.name=n.name,i.volume=n,i.renameVolume=function(){if(document.activeElement.blur(),!i.submitPending&&!i.renameVolumeForm.$invalid)return i.submitPending=!0,e.Volumes.save({id:i.volume.id,action:"rename",name:i.name}).$promise.then(function(e){return t.hide(i.name)},function(e){return i.backendErrors=e.data,i.submitPending=!1})},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlVolumeRenameController",e),e.$inject=["$mdDialog","FlOsApi","volume"]}(),function(){"use strict";function e(e,t,n,i){var o=this;o.submitPending=!0,o.instance=t,o.create_options={},o.attachment={uuid:t.uuid,action:"attach_volume"},e.Volumes.get({status:"available",project:o.instance.project,region:o.instance.region,page_size:"100000"}).$promise.then(function(e){o.create_options=e,o.submitPending=!1},function(e){o.submitPending=!1}),o.close=function(){return n.cancel()},o.createNewVolume=function(){return n.cancel(),i.go("openstackVolumeCreate")},o.attachVolume=function(){if(document.activeElement.blur(),!o.submitPending&&!o.attachVolumeForm.$invalid)return o.submitPending=!0,e.Instances.save(o.attachment).$promise.then(function(e){return n.hide(),e},function(e){o.backendErrors=e.data,o.submitPending=!1})}}angular.module("fleioStaff").controller("FlVolumeAttachController",e),e.$inject=["FlOsApi","instance","$mdDialog","$state"]}(),function(){"use strict";function e(e,t,n){e.state("openstackSshKeys",{url:t.joinBaseUrl("openstack/sshkeys?page_size?ordering?filtering?search?dlg"),component:"flPkmKeys",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{dlg:{value:"false",squash:!0},page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{keys:["$transition$","FlObjectList","FlPkmApi",function(e,t,n){return t(n,e.params())}]},data:{stateInfo:{display:n("SSH keys"),parent:"dashboard"},feature:"openstack.sshkeys",orderOptions:{name:n("Name"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},user:{display:n("User"),field_name:"user",type:"user"}}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/pkm/:id:action")}angular.module("fleioStaff").factory("FlPkmApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(t,e,n,i,o,r,a,s,l){var c=this;c.$onInit=function(){o.info.enabled=!0,o.info.label=a("Search keys"),o.info.service=c.keys,"add"===e.dlg&&c.addKey(null),c.TRANSLATED_STRINGS_MAP={delete:r.getString("Delete"),edit:r.getString("Edit"),create:r.getString("Add SSH key"),no_permission:r.getString("You are not\nallowed to do this")}},c.addKey=function(e){return t.go(t.current,{dlg:"add"}),n.show({templateUrl:"staff/apps/pkm/flpkmkeyedit.html",controller:"FlPkmKeyAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,targetEvent:e}).then(function(){return s.add(r.getString("Successfully added SSH key")),c.keys.fetchData()}).finally(function(){t.go(t.current,{dlg:"false"})}).catch(function(){})},c.editKey=function(e,t){if(c.keys.permissions["publickeys.update"])return n.show({templateUrl:"staff/apps/pkm/flpkmkeyedit.html",controller:"FlPkmKeyEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{key:t},targetEvent:e}).then(function(){return s.add(r.getString("SSH key updated successfully")),c.keys.fetchData()}).catch(function(){})},c.deleteKey=function(e){return i.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete key {{name}}",{name:e.name}),r.getString("Delete key")).then(function(){return c.keys.delete({id:e.id}).$promise.then(function(e){s.add(r.getString("SSH key successfully deleted"))}).catch(function(e){l.handleError(e)})}).catch(function(){})}}angular.module("fleioStaff").component("flPkmKeys",{templateUrl:"staff/apps/pkm/flpkmkeys.html",controller:e,bindings:{keys:"<"}}),e.$inject=["$state","$stateParams","$mdDialog","FlUiUtilsService","FlSearchService","gettextCatalog","gettext","FlNotificationService","FlResolveErrorHandler"]}(),function(){"use strict";function e(t,e,n){var i=this;i.key=angular.copy(n),i.saveKey=function(){if(document.activeElement.blur(),!i.editKey.$invalid&&!i.submitPending)return i.submitPending=!0,e.update({id:i.key.id},i.key).$promise.then(function(e){return t.hide(e),e},function(e){i.submitPending=!1,i.backendErrors=e.data})},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlPkmKeyEditController",e),e.$inject=["$mdDialog","FlPkmApi","key"]}(),function(){"use strict";function e(t,e){var n=this;n.enableGenerate=!0,n.keyGen={inProgress:!1,generated:!1},void 0===n.key&&(n.key={}),n.generateKey=function(){n.keyGen={inProgress:!0,generated:!1},e.get({action:"get_generated_key_pair"}).$promise.then(function(e){n.key.private_key=e.private_key,n.key.public_key=e.public_key},function(e){t.hide(e)}).finally(function(){n.keyGen={inProgress:!1,generated:!0}})},n.saveKey=function(){if(document.activeElement.blur(),!n.editKey.$invalid&&!n.submitPending)return n.submitPending=!0,e.save(n.key).$promise.then(function(e){return t.hide(e),e},function(e){return n.submitPending=!1,n.backendErrors=e.data})},n.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlPkmKeyAddController",e),e.$inject=["$mdDialog","FlPkmApi"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/clients/:id:options/:action",{id:"@id",options:"@options",action:"@action"},{upload:{method:"POST",transformRequest:angular.identity,headers:{"Content-Type":void 0}}})}angular.module("fleioStaff").factory("FlClientApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/openstack/clients/:id:options/:action",{id:"@id",options:"@options",action:"@action"})}angular.module("fleioStaff").factory("FlOsClientApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n){e.state("clients",{url:t.joinBaseUrl("clients?page_size?ordering?search?filtering"),component:"flClients",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-date_created",squash:!0},filtering:{value:"",squash:!0}},resolve:{clients:["$stateParams","FlObjectList","FlClientApi",function(e,t,n){return t(n,e)}]},data:{feature:"clients&users.clients",stateInfo:{display:n("Clients"),parent:"dashboard"},orderOptions:{company:n("Company"),country:n("Country"),state:n("State"),date_created:n("Date created"),uptodate_credit:n("Up to date credit"),configuration_name:n("Configuration name"),group_name:n("Group name")},filtering:{date_created:{display:n("Date created"),field_name:"date_created",type:"date"},configuration:{display:n("configuration"),field_name:"configuration",type:"customModelInstance",service:"FlConfigurationsApi"},status:{display:n("Status"),field_name:"status",type:"choices",choices:[{display:n("Active"),value:"active"},{display:n("Suspended"),value:"suspended"},{display:n("Deleting"),value:"deleting"}]},tax_exempt:{display:"Tax exempt",field_name:"tax_exempt",type:"bool"},groups:{display:n("client group"),field_name:"groups",type:"customModelInstance",service:"FlClientGroupsApi"},has_services:{display:n("has services"),field_name:"has_services",type:"bool"},has_billing_agreement:{display:n("Has billing agreement"),field_name:"has_billing_agreement",type:"bool"},services__product:{display:n("has service for product"),field_name:"services__product",type:"customModelInstance",service:"FlBilling",service_details:{type:"billing",items:"Products"}},services__product__product_type:{display:n("has service of type"),field_name:"services__product__product_type",type:"choices",choices:[{display:n("Openstack"),value:"openstack"}]},has_instances:{display:n("Has instances"),field_name:"has_instances",type:"bool"},has_reseller_services:{display:n("Is reseller"),field_name:"has_reseller_services",type:"bool"},assigned_to_reseller:{display:n("Assigned to reseller"),field_name:"assigned_to_reseller",type:"bool"},services__openstack_project__instance__region:{display:n("has instances in region"),field_name:"services__openstack_project__instance__region",type:"customModelInstance",service:"FlRegionsApi"},services__openstack_project__instance__flavor:{display:n("has instances with flavor"),field_name:"services__openstack_project__instance__flavor",filter_display_field:"display_name",type:"customModelInstance",service:"FlOsApi",service_details:{type:"openstack",items:"Flavors"}},services__openstack_project__instance__host_name:{display:n("has instances on hypervisor"),field_name:"services__openstack_project__instance__host_name",filter_display_field:"host_name",type:"lookup",case_sensitive:!1}}}}).state("clientEdit",{url:t.joinBaseUrl("clients/:id/edit"),component:"flClientEdit",authenticate:!0,resolve:{client:["$stateParams","FlClientApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.get(e).$promise.then(function(e){return n.setParams({id:e.id}),e}).catch(i.handleError)}],createOptions:["FlClientApi",function(e){return e.get({options:"create_options"}).$promise}]},data:{feature:"clients&users.clients",stateInfo:{display:n("Edit client"),parent:"clients"}}}).state("clientCreate",{url:t.joinBaseUrl("clients/create"),component:"flClientEdit",authenticate:!0,resolve:{createOptions:["FlClientApi",function(e){return e.get({options:"create_options"}).$promise}]},data:{feature:"clients&users.clients",stateInfo:{display:n("Create client"),parent:"clients"}}}).state("clientsSendMassEmail",{url:t.joinBaseUrl("clients/send-mass-email"),component:"flClientSendMassEmail",authenticate:!0,resolve:{createOptions:["FlClientApi",function(e){return e.get({options:"create_options"}).$promise}]},params:{client_filter:{value:void 0,squash:!0},client_search:{value:void 0,squash:!0}},data:{feature:"clients&users.clients",stateInfo:{display:n("Send mass email to clients"),parent:"clients"}}}).state("client",{url:t.joinBaseUrl("clients/:id"),component:"flClientDetails",authenticate:!0,resolve:{client:["$stateParams","FlClientApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.get(e).$promise.then(function(e){return n.setParams({id:e.id}),e}).catch(i.handleError)}],journal:["$stateParams","FlObjectList","FlBilling","FlFeatureService",function(e,t,n,i){if(i.features.invoicing)return t(n.Journal,{client_id:e.id,page_size:"20"})}],invoices:["$stateParams","FlObjectList","FlBilling","FlFeatureService",function(e,t,n,i){if(i.features.invoicing)return t(n.Invoices,{client:e.client,page_size:"20"})}],plugins:["$stateParams","PluginsApi","FlFeatureService",function(e,t,n){if(n.features.plugins)return t.get({action:"plugins_with_component",component_name:"ClientInfo"}).$promise.then(function(e){return e.plugins})}]},data:{feature:"clients&users.clients",stateInfo:{default:n("Client details"),display:n("Client {:id}"),parent:"clients"}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,i,o,r,a){var s,l=this;function c(){l.clients.fetchData()}l.$onInit=function(){e.info.enabled=!0,e.info.label=t("Search clients"),e.info.service=l.clients,(s=i(c,15e3)).start(),n.init(s.start.bind(s),s.stop.bind(s)),l.features=a.features},l.$onDestroy=function(){s.teardown(),n.uninit()},l.sendMassMail=function(e){r.go("clientsSendMassEmail",{client_filter:r.params.filtering,client_search:r.params.search})}}angular.module("fleioStaff").component("flClients",{templateUrl:"staff/apps/clients/flclients.html",controller:e,bindings:{clients:"<"}}),e.$inject=["FlSearchService","gettext","FlDetectIdleService","FlOsTimer","$mdDialog","$state","FlFeatureService"]}(),function(){"use strict";function e(e,n,t,i,o,r,a,s,l,c,u,d,p,f){var g=this;function m(){g.loading_invoices=!0,e(n.Invoices,{page_size:t.paginate_by,client:g.client.id}).then(function(e){g.invoices=e}).finally(function(){g.loading_invoices=!1})}function h(){g.loading_journal=!0,e(n.Journal,{page_size:t.paginate_by,client_id:g.client.id}).then(function(e){g.journal=e}).finally(function(){g.loading_journal=!1})}function v(){g.loading_openstack_services=!0,r.get({id:g.client.id,action:"openstack_services"}).$promise.then(function(e){g.openstack=e}).finally(function(){g.loading_openstack_services=!1})}function _(){g.loading_users=!0,o.get({id:g.client.id,action:"get_users"}).$promise.then(function(e){g.users=e.users}).finally(function(){g.loading_users=!1})}function b(){g.refreshing_client=!0,o.get({id:g.client.id}).$promise.then(function(e){g.client=e}).finally(function(){g.refreshing_client=!1})}function S(){g.loading_configuration=!0,o.get({id:g.client.id,action:"get_configuration"}).$promise.then(function(e){g.configuration=e}).finally(function(){g.loading_configuration=!1})}function y(){g.loading_summary=!0,o.get({id:g.client.id,action:"get_cloud_summary"}).$promise.then(function(e){g.cloud_summary=e,r.get({id:g.client.id,action:"openstack_services"}).$promise.then(function(e){if(e.services.length){var t=e.services[0].id;g.clientOsProjectId=e.projects[t].project_id,o.get({id:g.client.id,action:"get_users"}).$promise.then(function(e){g.users=e.users,g.loading_summary=!1})}else g.loading_summary=!1})})}function $(e){return a.show({templateUrl:"staff/apps/clients/createopenstackservice/flcreateopenstackservice.html",controller:"FlCreateOpenstackServiceController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{client:g.client},targetEvent:e}).then(function(){return g.getOpenstackServices(),s.add(l.getString("Openstack service created"))}).catch(function(){})}function F(e,t){return a.show({templateUrl:"staff/apps/clients/deleteopenstackservice/fldeleteopenstackservice.html",controller:"FlDeleteOpenstackServiceController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,targetEvent:e,locals:{service:t}}).then(function(e){g.getOpenstackServices(),e.detail?s.add(e.detail):s.add(e)}).catch(function(){})}function k(e){return c.yesNoDlgCustom(l.getString("Are you sure?"),l.getString("Terminate service {{id}}",{id:e}),l.getString("Terminate service"),l.getString("This will permanently delete data."),"warning","attention").then(function(){return n.Services.save({id:e,action:"terminate"}).$promise.then(function(e){e.detail?s.add(e.detail):s.add(e),g.getOpenstackServices()})}).catch(function(){})}function C(e,t){return a.show({templateUrl:"staff/apps/clients/changecredit/flclientchangecredit.html",controller:"FlClientChangeCreditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{client:g.client,credit:t},targetEvent:e}).then(function(){return s.add(l.getString("Credit updated")),g.refreshClient()}).catch(function(){})}function P(e){o.save({id:g.client.id,action:"update_usage"}).$promise.then(function(){return s.add(l.getString("Usage updated")),g.refreshClient()})}function O(e){return c.yesNoDlgCustom(l.getString("Are you sure?"),l.getString("Reset usage"),l.getString("Reset usage"),l.getString("This will permanently delete usage data."),"warning","attention").then(function(){o.save({id:g.client.id,action:"reset_usage"}).$promise.then(function(){return s.add(l.getString("Usage reset")),g.refreshClient()})}).catch(function(){})}function I(e,t){return c.yesNoDlg(l.getString("Are you sure?"),l.getString("Dissociate user {{user}}",{user:t.full_name}),l.getString("Dissociate user")).then(function(){return o.save({id:e.id,user_id:t.id,action:"dissociate_user"}).$promise.then(function(e){return s.add(e.detail),g.getUsers()},function(e){return s.add(e.detail)})}).catch(function(){})}function w(e){return a.show({templateUrl:"staff/apps/clients/associateuser/flclientassociateuser.html",controller:"FlClientAssociateUserController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{client_id:g.client.id},targetEvent:e}).then(function(){return s.add(l.getString("User associated")),g.getUsers()}).catch(function(){})}function D(e){g.loadingServices=!0,n.Services.get({client:e}).$promise.then(function(e){g.clientServices=e}).catch(function(e){s.add(e.detail)}).finally(function(){g.loadingServices=!1})}function A(e){return a.show({templateUrl:"staff/apps/clients/changeconfiguration/flclientchangeconfiguration.html",controller:"FlClientChangeConfigurationController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{client_id:g.client.id},targetEvent:e}).then(function(){return g.getConfiguration(),s.add(l.getString("Configuration changed"))}).catch(function(){})}function E(e,t){return Math.min(e-t,20)}function U(e){return"Ports"===e?(g.loading_summary=!0,o.get({id:g.client.id,action:"get_all_client_ports"}).$promise.then(function(e){g.cloud_summary.Ports=e,g.loading_summary=!1}).catch(FlResolveErrorHandler.handleError)):"SSH keys"===e?u.href("openstackSshKeys",{filtering:"user__clients__id:"+g.client.id}):(t="Networks"===e?"project":"project_id",u.href(e.toLowerCase())?u.href(e.toLowerCase(),{filtering:t+":"+g.clientOsProjectId}):u.href("openstack"+e)?u.href("openstack"+e,{filtering:t+":"+g.clientOsProjectId}):void 0);var t}g.$onInit=function(){g.features=i.features,g.loading_invoices=!1,g.loading_journal=!1,g.loading_project=!1,g.loading_openstack_services=!1,g.loading_reseller_services=!1,g.getInvoices=m,g.getJournalEntries=h,g.getUsers=_,g.refreshClient=b,g.getConfiguration=S,g.getCloudSummary=y,g.getOpenstackServices=v,g.createOpenstackService=$,g.deleteOpenstackService=F,g.terminateOpenstackService=k,g.changeCredit=C,g.updateUsage=P,g.resetUsage=O,g.dissociateUser=I,g.associateUser=w,g.listClientServices=D,g.changeConfiguration=A,g.getLoadMoreText=E,g.loadMoreObjects=U,g.impersonateUser=f.impersonateUser},g.getResellerServices=function(){g.loading_reseller_services=!0,o.get({id:g.client.id,action:"reseller_services"}).$promise.then(function(e){g.reseller=e}).finally(function(){g.loading_reseller_services=!1})},g.createResellerService=function(e){return a.show({templateUrl:"staff/apps/clients/createresellerservice/flcreateresellerservice.html",controller:"FlCreateResellerServiceController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{client:g.client},targetEvent:e}).then(function(){return g.getResellerServices(),s.add(l.getString("Reseller service created"))}).catch(function(){})},g.editPricingPlan=function(e,t){return a.show({templateUrl:"staff/apps/clients/change_pricing_plan/change_pricing_plan.html",controller:"FlClientChangePricingPlanController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{availablePlans:g.client.openstack_billing_plans,selectedPricingPlan:e.id,clientId:g.client.id}}).then(function(e){n.Services.save({id:t,action:"update_billing_plan"},{plan:e}).$promise.then(function(e){s.add(e.detail),v()}).catch(function(e){s.add("Unable to change plan")})}).catch(function(){})},g.editResellerPricingPlan=function(t){return a.show({templateUrl:"staff/apps/clients/change_pricing_plan/change_pricing_plan.html",controller:"FlClientChangePricingPlanController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{availablePlans:g.client.openstack_billing_plans,selectedPricingPlan:g.reseller.resources[t].plan.id,clientId:g.client.id}}).then(function(e){o.save({id:g.client.id,action:"update_reseller_billing_plan"},{plan:e,service:t}).$promise.then(function(e){s.add(e.detail),g.getResellerServices()}).catch(function(e){s.add("Unable to change plan")})}).catch(function(){})},g.editResellerEnduserPanelUrl=function(t){return a.show({templateUrl:"staff/apps/clients/change_enduser_panel_url/change_enduser_panel_url.html",controller:"FlClientChangeEnduserPanelUrlController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{enduserPanelUrl:g.reseller.resources[t].enduser_panel_url,clientId:g.client.id}}).then(function(e){o.save({id:g.client.id,action:"update_reseller_enduser_panel_url"},{enduser_panel_url:e,service:t}).$promise.then(function(e){s.add(e.detail),g.getResellerServices()}).catch(function(e){s.add("Unable to change enduser panel url")})}).catch(function(){})}}angular.module("fleioStaff").component("flClientDetails",{templateUrl:"staff/apps/clients/flclientdetails.html",controller:e,bindings:{client:"<",journal:"<",invoices:"<",project:"<",plugins:"<",openstack_services:"<"}}),e.$inject=["FlObjectList","FlBilling","CONFIG","FlFeatureService","FlClientApi","FlOsClientApi","$mdDialog","FlNotificationService","gettextCatalog","FlUiUtilsService","$state","gettext","FlPkmApi","FlUserApi"]}(),function(){"use strict";function e(e,t,n,i,o,r){var a=this;a.$onInit=function(){a.goBackOrToState=i.goBackOrToState,a.countries=a.createOptions.countries?a.createOptions.countries:[],a.features=r.features,a.client=a.client?a.client:{currency:a.createOptions.default_currency},a.createOptions&&(a.customFieldsDefinition=a.createOptions.custom_fields);if(a.client&&a.client.country&&a.countries.length){var e=a.countries.filter(function(e){return e.value===a.client.country});a.selectedCountry=e[0]}},a.saveClient=function(){if(document.activeElement.blur(),a.editClientForm.$invalid||a.actionPending)return;return a.actionPending=!0,a.client.id?e.update({id:a.client.id},a.client).$promise.then(function(e){a.actionPending=!1,t.go("clients"),n.add(o.getString("Client {{fname}} {{lname}} modified",{fname:e.first_name,lname:e.last_name}))},function(e){a.actionPending=!1,a.backendErrors=e.data}):e.save(a.client).$promise.then(function(e){a.actionPending=!1,t.go("clients"),n.add(o.getString("Client {{fname}} {{lname}} created",{fname:e.first_name,lname:e.last_name}))},function(e){a.actionPending=!1,a.backendErrors=e.data})},a.stateRequired=function(){for(var e=0;e<a.countries.length;e++)if(a.countries[e].value===a.client.country)return a.countries[e].state_required;return!0},a.selectedCountryChange=function(e){e&&(a.client.country=e.value)},a.querySearch=function(e){return e?a.countries.filter(function(e){var t=e.toLowerCase();return function(e){return 0===e.label.toLowerCase().indexOf(t)}}(e)):a.countries}}angular.module("fleioStaff").component("flClientEdit",{templateUrl:"staff/apps/clients/flclientedit.html",controller:e,bindings:{createOptions:"<",client:"<"}}),e.$inject=["FlClientApi","$state","FlNotificationService","FlUiUtilsService","gettextCatalog","FlFeatureService"]}(),function(){"use strict";function e(e,t,n,i,o){var r=this;r.$onInit=function(){r.countries=r.createOptions.countries?r.createOptions.countries:[],r.client=r.client?r.client:{},r.createOptions&&(r.customFieldsDefinition=r.createOptions.custom_fields);if(r.client&&r.client.country&&r.countries.length){var e=r.countries.filter(function(e){return e.value===r.client.country});r.selectedCountry=e[0]}},r.saveClient=function(){if(document.activeElement.blur(),r.editClientForm.$invalid||r.actionPending)return;return r.actionPending=!0,e.update({id:r.client.id},r.client).$promise.then(function(e){r.actionPending=!1,o.hide()},function(e){r.actionPending=!1,r.backendErrors=e.data})},r.selectedCountryChange=function(e){e&&(r.client.country=e.value)},r.querySearch=function(e){return e?r.countries.filter(function(e){var t=e.toLowerCase();return function(e){return 0===e.label.toLowerCase().indexOf(t)}}(e)):r.countries},r.close=function(){return o.cancel()}}angular.module("fleio.commons").controller("EditClientController",e),e.$inject=["FlClientApi","$state","FlNotificationService","gettextCatalog","$mdDialog"]}(),function(){"use strict";function e(e,t,n,i){var o=this;o.$onInit=function(){o.amount=0,o.operation="add"},o.changeCredit=function(){document.activeElement.blur(),o.submitPending||o.changeClientCreditForm.$invalid||(o.submitPending=!0,t.save({id:o.client.id,action:"change_credit",add_credit:"add"===o.operation,amount:o.amount,source_currency:o.credit.currency,currency:o.credit.currency}).$promise.then(function(){return n.add(i.getString("Client credit updated")),e.hide()}).catch(function(e){o.backendErrors=e.data,o.submitPending=!1}))},o.close=function(){return e.cancel()}}angular.module("fleioStaff").controller("FlClientChangeCreditController",e),e.$inject=["$mdDialog","FlClientApi","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(a,s,l,e,c){var u=this;function t(e){var t=Math.floor(Math.log(e)/Math.log(1024));return"Max. "+1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","KB","MB","GB"][t]+" / file"}u.$onInit=function(){u.massMailData={},u.massMailData.send_batch_size=16,u.massMailData.send_interval=30,u.massMailData.filter=c.params.client_filter||"",u.massMailData.search=c.params.client_search||"",u.tinymceOptions=e.tiny_mce_options,u.maxAttachmentSize=10485760,u.maxAttachmentSizeDisplay=t(u.maxAttachmentSize),u.maxAttachmentSize=u.createOptions.max_email_attachment_size,u.maxAttachmentSizeDisplay=t(u.maxAttachmentSize)},u.sendMassEmail=function(){if(document.activeElement.blur(),!u.submitPending&&!u.sendMassEmailForm.$invalid){u.submitPending=!0;var e=new FormData;for(var t in u.massMailData)e.append(t,u.massMailData[t]);var n=document.getElementById("email_attachments").files;if(n.length){for(var i=0;i<n.length;i++)if(n[i].size>u.maxAttachmentSize)return u.backendErrors={detail:l.getString("Attachment file size is too big ("+u.maxAttachmentSizeDisplay+").")},void(u.submitPending=!1);for(var o=0;o<n.length;o++){var r=n[o];e.append("file_data_"+o,r),e.append("file_name_"+o,r.name)}}a.upload({action:"send_mass_email"},e).$promise.then(function(e){s.add(e.detail),c.go("clients")}).catch(function(e){u.backendErrors=e.data,u.submitPending=!1})}},u.close=function(){c.go("clients")},u.clickVariable=function(e){var t=document.createElement("textarea");t.value=e.variable,document.body.appendChild(t),t.select(),document.execCommand("Copy"),t.remove(),s.add(l.getString("Successfully copied"))}}angular.module("fleioStaff").component("flClientSendMassEmail",{templateUrl:"staff/apps/clients/sendmassmail/clientssendmassmail.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["FlClientApi","FlNotificationService","gettextCatalog","CONFIG","$state"]}(),function(){"use strict";function e(e,t){var n=this;n.deleteClient=function(){if(document.activeElement.blur(),!n.submitPending&&!n.deleteClientForm.$invalid)return n.submitPending=!0,t.delete({id:n.client.id,delete_cloud_resources:n.delete_cloud_resources}).$promise.then(function(e){return e},function(e){return n.backendErrors=e.data,n.submitPending=!1}),e.hide()},n.close=function(){return e.cancel()}}angular.module("fleioStaff").controller("FlClientDeleteController",e),e.$inject=["$mdDialog","FlClientApi"]}(),function(){"use strict";function e(n,i,o,r,a,s){var l=this;function c(e){i.get({id:e.id}).$promise.then(function(e){l.customClient=e})}l.suspendClient=function(e,t){return o.yesNoDlg(r.getString("Are you sure?"),r.getString("Suspend client")).then(function(){return l.clients&&(l.clients.loading=!0),i.save({id:t.id,action:"suspend"}).$promise.then(function(e){return l.clients?l.clients.fetchData():c(t),l.clients&&(l.clients.loading=!1),a.add(e.detail)},function(e){if(l.clients&&(l.clients.loading=!1),e)return a.add(e.detail)})}).catch(function(){})},l.resumeClient=function(e,t){return o.yesNoDlg(r.getString("Are you sure?"),r.getString("Resume client")).then(function(){return l.clients&&(l.clients.loading=!0),i.save({id:t.id,action:"resume"}).$promise.then(function(e){return l.clients?l.clients.fetchData():c(t),l.clients&&(l.clients.loading=!1),a.add(e.detail)},function(e){if(l.clients&&(l.clients.loading=!1),e)return a.add(e.detail)})}).catch(function(){})},l.deleteClient=function(e,t){return s.show({templateUrl:"staff/apps/clients/delete/flclientdelete.html",controller:"FlClientDeleteController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{client:t},targetEvent:e}).then(function(){return l.clients?l.clients.fetchData():n.go("clients"),a.add(r.getString("Client delete scheduled"))}).catch(function(){})}}angular.module("fleioStaff").component("flClientActions",{restrict:"E",bindings:{clients:"<",customClient:"="},templateUrl:"staff/apps/clients/actions/flclientactions.html",controller:e}),e.$inject=["$state","FlClientApi","FlUiUtilsService","gettextCatalog","FlNotificationService","$mdDialog"]}(),function(){"use strict";function e(n,i,o,r,a,s){var l=this;function c(e){i.get({id:e.id}).$promise.then(function(e){l.customClient=e})}l.suspendClient=function(e,t){return o.yesNoDlg(r.getString("Are you sure?"),r.getString("Suspend client")).then(function(){return l.clients&&(l.clients.loading=!0),i.save({id:t.id,action:"suspend"}).$promise.then(function(e){return l.clients?l.clients.fetchData():c(t),l.clients&&(l.clients.loading=!1),a.add(e.detail)},function(e){if(l.clients&&(l.clients.loading=!1),e)return a.add(e.detail)})}).catch(function(){})},l.resumeClient=function(e,t){return o.yesNoDlg(r.getString("Are you sure?"),r.getString("Resume client")).then(function(){return l.clients&&(l.clients.loading=!0),i.save({id:t.id,action:"resume"}).$promise.then(function(e){return l.clients?l.clients.fetchData():c(t),l.clients&&(l.clients.loading=!1),a.add(e.detail)},function(e){if(l.clients&&(l.clients.loading=!1),e)return a.add(e.detail)})}).catch(function(){})},l.deleteClient=function(e,t){return s.show({templateUrl:"staff/apps/clients/delete/flclientdelete.html",controller:"FlClientDeleteController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{client:t},targetEvent:e}).then(function(){return l.clients?l.clients.fetchData():n.go("clients"),a.add(r.getString("Client delete scheduled"))}).catch(function(){})}}angular.module("fleioStaff").component("flXsClientActions",{restrict:"E",bindings:{clients:"<",customClient:"="},templateUrl:"staff/apps/clients/actions/flxsclientactions.html",controller:e}),e.$inject=["$state","FlClientApi","FlUiUtilsService","gettextCatalog","FlNotificationService","$mdDialog"]}(),function(){"use strict";function e(e,n,i,o,r,a){var s=e(i.api_url+"/users/:id/:option",{id:"@id",option:"@option"});return s.impersonateUser=function(e){var t=window.location.href;t=i.home_url||t.substring(0,t.lastIndexOf("/")+1),s.get({id:e}).$promise.then(function(e){s.save({id:e.id,option:"impersonate"}).$promise.then(function(){n.set("flStaffUrl",t),n.set("flStaffBackend",i.api_url),e.is_reseller?r.location.href=i.reseller_url:r.location.href=o.home_url})}).catch(a.handleError)},s}angular.module("fleioStaff").factory("FlUserApi",e),e.$inject=["FlResourceService","FlLocalStorage","CONFIG","USER_CONFIG","$window","FlResolveErrorHandler"]}(),function(){"use strict";function e(e,t,n){e.state("users",{url:t.joinBaseUrl("users?page_size?ordering?filtering?search"),component:"flUsers",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-last_login",squash:!0},filtering:{value:"",squash:!0}},resolve:{users:["$stateParams","FlObjectList","FlUserApi",function(e,t,n){return t(n,e)}]},data:{feature:"clients&users.users",stateInfo:{display:n("Users"),parent:"dashboard"},orderOptions:{last_login:n("Last login"),date_joined:n("Sign-up date"),username:n("Username"),email:n("Email")},filtering:{date_joined:{display:n("Date joined"),field_name:"date_joined",type:"date"},last_login:{display:n("Last login"),field_name:"last_login",type:"date"},is_active:{display:n("Is active"),field_name:"is_active",type:"bool"},is_reseller:{display:n("Is reseller"),field_name:"is_reseller",type:"bool"},is_staff:{display:n("Is staff"),field_name:"is_staff",type:"bool"},is_superuser:{display:n("Is superuser"),field_name:"is_superuser",type:"bool"},user_groups:{display:n("user group"),field_name:"user_groups",type:"customModelInstance",service:"FlUserGroupsApi"}}}}).state("user",{url:t.joinBaseUrl("users/:id"),component:"flUserDetails",authenticate:!0,resolve:{user:["FlObjectList","$stateParams","FlUserApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i,o){return n.get(t).$promise.then(function(e){return i.setParams({id:e.id}),e}).catch(o.handleError)}],plugins:["$stateParams","PluginsApi","FlFeatureService",function(e,t,n){if(n.features.plugins)return t.get({action:"plugins_with_component",component_name:"UserInfo"}).$promise.then(function(e){return e.plugins})}]},data:{feature:"clients&users.users",stateInfo:{default:n("User details"),display:n("User {:id}"),parent:"users"}}}).state("impersonateUserIntermediaryState",{url:t.joinBaseUrl("impersonate-user/:id"),authenticate:!0,templateUrl:"staff/apps/users/flimpersonateintermediarystate.template.html",resolve:{user:["FlObjectList","$stateParams","FlUserApi","FlBreadCrumbService",function(e,t,n,i){return i.setParams({id:t.id}),n.impersonateUser(t.id)}]},data:{feature:"clients&users.users",stateInfo:{default:n("Impersonate user"),display:n("Impersonate user {:id}"),parent:"users"}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(n,e,t,i){var o=this;function r(e,t){return n.show({templateUrl:"staff/apps/users/fluseredit.html",controller:"FlUserEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{user:angular.copy(t)},bindToController:!0,targetEvent:e}).then(function(){return o.users.fetchData()}).catch(function(){})}o.$onInit=function(){o.addUser=r,i.info.enabled=!0,i.info.label=t("Search users"),i.info.service=o.users}}angular.module("fleioStaff").component("flUsers",{templateUrl:"staff/apps/users/flusers.html",controller:e,bindings:{users:"<"}}),e.$inject=["$mdDialog","gettextCatalog","gettext","FlSearchService"]}(),function(){"use strict";function e(t,i,n){var o=this;function r(e){t.get({id:e}).$promise.then(function(e){o.user=e}).catch(n.handleError)}function e(e,t){return i.show({templateUrl:"staff/apps/users/usertogroupmanager.html",controller:"FlUserToGroupManagerController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{user:angular.copy(t),isAdd:!0,isDelete:!1},bindToController:!0,targetEvent:e}).then(function(){r(o.user.id)}).catch(function(){r(o.user.id)})}function a(e,t,n){return i.show({templateUrl:"staff/apps/users/usertogroupmanager.html",controller:"FlUserToGroupManagerController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{user:angular.copy(t),groupid:angular.copy(n),isAdd:!1,isDelete:!0},bindToController:!0,targetEvent:e}).then(function(){r(o.user.id)}).catch(function(){r(o.user.id)})}o.$onInit=function(){o.addToNewGroup=e,o.removeFromGroup=a}}angular.module("fleioStaff").component("flUserDetails",{templateUrl:"staff/apps/users/fluserdetails.html",controller:e,bindings:{user:"<",plugins:"<"}}),e.$inject=["FlUserApi","$mdDialog","FlResolveErrorHandler"]}(),function(){"use strict";function e(t,n,e,i,o,r){var a=this;function s(){a.user.use_email_username?(a.user.previous_user_name=a.user.username,a.user.username=a.user.email):a.user.username=a.user.previous_user_name}function l(){a.user.use_email_username&&(a.user.username=a.user.email)}function c(){return t.cancel()}function u(){if(document.activeElement.blur(),!a.submitPending&&!a.userForm.$invalid){if(a.submitPending=!0,!a.user.id)return e.save(a.user).$promise.then(function(e){return t.hide(e),n.add(i.getString("User created")),e},function(e){return a.submitPending=!1,a.backendErrors=e.data},function(e){a.submitPending=!1,a.backendErrors=e.data});e.update({id:a.user.id},a.user).$promise.then(function(e){return t.hide(e),n.add(i.getString("User modified")),e},function(e){a.submitPending=!1,a.backendErrors=e.data})}}a.$onInit=function(){a.changeUserEmailUsername=s,a.changeEmail=l,a.saveUser=u,a.close=c,a.currentUserIsSuperuser=o.userInfo.user.is_superuser,a.features=r.features,a.user?a.user.username==a.user.email&&(a.user.use_email_username=!0):a.user={use_email_username:!0,is_active:!0};a.user.user_groups&&delete a.user.user_groups}}angular.module("fleioStaff").controller("FlUserEditController",e),e.$inject=["$mdDialog","FlNotificationService","FlUserApi","gettextCatalog","FlAuthService","FlFeatureService"]}(),function(){"use strict";function e(e,t,n,i,o,r){var a=this;function s(){return e.cancel()}function l(e){return t.get({user_id:a.user.id,action:"get_groups_available_for_user",search:e}).$promise.then(function(e){return e.objects})}function c(e){a.backendErrors=null,void 0!==e&&a.user.user_groups.push(e.id)}function u(){var e;(document.activeElement.blur(),a.submitPending||a.userForm.$invalid)||(a.groupid?e=a.groupid:a.selectedUserGroup&&(e=a.selectedUserGroup.id),a.isDelete?(a.submitPending=!0,o.save({id:a.user.id,option:"remove_user_from_group",group_id:e},a.user).$promise.then(function(e){return n.add(i.getString("User removed from group")),a.submitPending=!1,a.selectedUser=null,a.close(),e}).catch(function(e){a.backendErrors=e.data,a.submitPending=!1,r.handleError(e),a.close()})):a.isAdd&&(a.submitPending=!0,o.save({id:a.user.id,option:"add_user_to_group",group_id:e},a.user).$promise.then(function(e){return n.add(i.getString("User added to group")),a.submitPending=!1,a.selectedUser=null,a.close(),e}).catch(function(e){a.backendErrors=e.data,a.submitPending=!1,r.handleError(e),a.close()})))}a.$onInit=function(){a.close=s,a.searchGroup=l,a.selectedGroupChange=c,a.updateUser=u}}angular.module("fleioStaff").controller("FlUserToGroupManagerController",e),e.$inject=["$mdDialog","FlUserGroupsApi","FlNotificationService","gettextCatalog","FlUserApi","FlResolveErrorHandler"]}(),function(){"use strict";function e(n,i,o,r,a,s,l){var c=this;c.editUser=function(e,t){return r.show({templateUrl:"staff/apps/users/fluseredit.html",controller:"FlUserEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{user:angular.copy(t)},bindToController:!0,targetEvent:e}).then(function(){c.users?c.users.fetchData():function(e){n.get({id:e}).$promise.then(function(e){c.customUser=e}).catch(s.handleError)}(t.id)}).catch(function(){})},c.deleteUser=function(e,t){return o.yesNoDlg(a.getString("Related objects will not be deleted."),a.getString("Delete user {{username}}?",{username:t.username}),a.getString("Delete")).then(function(){n.delete({id:t.id}).$promise.then(function(){l.add(a.getString("User deleted")),c.users?c.users.fetchData():i.go("users")}).catch(function(e){l.add(e.data.detail)})}).catch(function(){})},c.impersonateUser=n.impersonateUser}angular.module("fleioStaff").component("flUserActions",{restrict:"E",bindings:{users:"<",customUser:"="},templateUrl:"staff/apps/users/actions/fluseractions.html",controller:e}),e.$inject=["FlUserApi","$state","FlUiUtilsService","$mdDialog","gettextCatalog","FlResolveErrorHandler","FlNotificationService"]}(),function(){"use strict";function e(n,i,o,r,a,s,l){var c=this;c.editUser=function(e,t){return r.show({templateUrl:"staff/apps/users/fluseredit.html",controller:"FlUserEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{user:angular.copy(t)},bindToController:!0,targetEvent:e}).then(function(){c.users?c.users.fetchData():function(e){n.get({id:e}).$promise.then(function(e){c.customUser=e}).catch(s.handleError)}(t.id)}).catch(function(){})},c.deleteUser=function(e,t){return o.yesNoDlg(a.getString("Related objects will not be deleted."),a.getString("Delete user {{username}}?",{username:t.username}),a.getString("Delete")).then(function(){n.delete({id:t.id}).$promise.then(function(){l.add(a.getString("User deleted")),c.users?c.users.fetchData():i.go("users")})}).catch(function(){})},c.impersonateUser=n.impersonateUser}angular.module("fleioStaff").component("flXsUserActions",{restrict:"E",bindings:{users:"<",customUser:"="},templateUrl:"staff/apps/users/actions/flxsuseractions.html",controller:e}),e.$inject=["FlUserApi","$state","FlUiUtilsService","$mdDialog","gettextCatalog","FlResolveErrorHandler","FlNotificationService"]}(),function(){"use strict";function e(e,t,n){e.state("usergroups",{url:t.joinBaseUrl("usergroups?page_size?ordering?filtering?search"),component:"flUserGroups",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{usergroups:["$stateParams","FlObjectList","FlUserGroupsApi",function(e,t,n){return t(n,e)}]},data:{feature:"clients&users.usergroups",stateInfo:{display:n("User groups"),parent:"dashboard"},orderOptions:{id:n("Id"),name:n("Name"),created_at:n("Created at")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},is_default:{display:n("Is default"),field_name:"is_default",type:"bool"}}}}).state("usergroup",{url:t.joinBaseUrl("usergroups/:id"),component:"flUserGroupDetails",authenticate:!0,resolve:{usergroup:["$stateParams","FlUserGroupsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.get(e).$promise.then(function(e){return n.setParams({name:e.name}),e}).catch(i.handleError)}],users:["$stateParams","FlUserApi",function(e,t){var n=e.id;return t.get({group_id:n,option:"get_users_in_group",page:1}).$promise}]},data:{feature:"clients&users.usergroups",stateInfo:{default:n("User group details"),display:n("User group {:name}"),parent:"usergroups"}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(t,n,e,i,o){var r=this;function a(){return r.usergroups.fetchData()}r.$onInit=function(){e.info.enabled=!0,e.info.label=i("Search user groups"),e.info.service=r.usergroups},r.refreshUserGroups=a,r.addUserGroup=function(e){return o.show({templateUrl:"staff/apps/usergroups/flusergroupedit.html",controller:"FlUserGroupAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:e}).then(function(){return a(),t.add(n.getString("User group added"))}).catch(function(){})}}angular.module("fleioStaff").component("flUserGroups",{templateUrl:"staff/apps/usergroups/flusergroups.html",controller:e,bindings:{usergroups:"<"}}),e.$inject=["FlNotificationService","gettextCatalog","FlSearchService","gettext","$mdDialog"]}(),function(){"use strict";function e(i,t,o,n,r,a){var s=this;function l(e){t.get({id:e}).$promise.then(function(e){s.usergroup=e})}s.$onInit=function(){s.currentPage=1,s.nextPage=!!s.users.next,s.previousPage=!!s.users.previous},s.refreshUsers=function(e){var t;t=e||s.currentPage,s.loading=!0,i.get({group_id:s.usergroup.id,option:"get_users_in_group",page:t}).$promise.then(function(e){s.loading=!1,s.nextPage=!!e.next,s.previousPage=!!e.previous,s.users=e}).catch(function(){s.refreshUsers(1)})},s.changeUsersPage=function(e){"next"===e?(s.currentPage=s.currentPage+1,s.refreshUsers()):"previous"===e&&(s.currentPage=s.currentPage-1,s.refreshUsers())},s.searchUser=function(e){return i.get({option:"get_available_users_for_group",group:s.usergroup.id,search:e}).$promise.then(function(e){return e.objects})},s.selectedUserChange=function(e){void 0!==e&&(s.addUserError=null)},s.addToGroup=function(e){if(s.submitPending=!0,!e)return s.addUserError=r.getString("Invalid input for user"),void(s.submitPending=!1);s.addUserError=null,i.post({id:e.id,option:"add_user_to_group",group_id:s.usergroup.id},e).$promise.then(function(e){return l(s.usergroup.id),s.refreshUsers(),n.add(r.getString("User added to group")),s.submitPending=!1,s.selectedUser=null,e}).catch(function(e){s.backendErrors=e.data,s.submitPending=!1,a.handleError(e)})},s.removeFromGroup=function(t,e,n){i.get({id:e.id}).$promise.then(function(e){return o.show({templateUrl:"staff/apps/users/usertogroupmanager.html",controller:"FlUserToGroupManagerController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{user:angular.copy(e),groupid:angular.copy(n),isAdd:!1,isDelete:!0},bindToController:!0,targetEvent:t}).then(function(e){s.selectedUser=null,l(n),s.refreshUsers()}).catch(function(){s.selectedUser=null,l(n),s.refreshUsers()})})}}angular.module("fleioStaff").component("flUserGroupDetails",{templateUrl:"staff/apps/usergroups/flusergroupdetails.html",controller:e,bindings:{usergroup:"<",users:"<"}}),e.$inject=["FlUserApi","FlUserGroupsApi","$mdDialog","FlNotificationService","gettextCatalog","FlResolveErrorHandler"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/usergroups/:id/:action",{id:"@id",action:"@action"})}angular.module("fleioStaff").factory("FlUserGroupsApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(t,e,n){var i=this;i.userGroup={},i.isEdit=!1,i.saveUserGroup=function(){if(document.activeElement.blur(),!i.editUserGroup.$invalid&&!i.submitPending)return i.submitPending=!0,e.save(i.usergroup).$promise.then(function(e){return t.hide(e),e},function(e){return i.submitPending=!1,i.backendErrors=e.data})},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlUserGroupAddController",e),e.$inject=["$mdDialog","FlUserGroupsApi","gettext"]}(),function(){"use strict";function e(t,e,n,i,o){var r=this;r.usergroup=angular.copy(n),r.isEdit=!0,r.submitPending=!1,r.saveUserGroup=function(){if(document.activeElement.blur(),!r.editUserGroup.$invalid&&!r.submitPending)return r.submitPending=!0,e.update({id:r.usergroup.id},r.usergroup).$promise.then(function(e){return t.hide(e),"usergroup"===o.current.name&&i.updateParams({name:e.name}),e}).catch(function(e){r.submitPending=!1,r.backendErrors=e.data})},r.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlUserGroupEditController",e),e.$inject=["$mdDialog","FlUserGroupsApi","usergroup","FlBreadCrumbService","$state"]}(),function(){"use strict";function e(t,n,i,o,r,a){var s=this;function l(){return s.usergroups.fetchData()}s.editUserGroup=function(e,t){return i.show({templateUrl:"staff/apps/usergroups/flusergroupedit.html",controller:"FlUserGroupEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{usergroup:t},targetEvent:e}).then(function(){return s.usergroups?l():function(e){n.get({id:e.id}).$promise.then(function(e){s.customUserGroup=e})}(t),o.add(r.getString("User group updated"))}).catch(function(){})},s.deleteUserGroup=function(e){return t.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete user group {{name}}",{name:e.name}),r.getString("Delete user group")).then(function(){n.delete({id:e.id}).$promise.then(function(){s.usergroups?l():a.go("usergroups"),o.add(r.getString("User group deleted"))},function(){o.add(r.getString("Could not delete user group"))})}).catch(function(){})}}angular.module("fleioStaff").component("flUserGroupsActions",{restrict:"E",bindings:{usergroups:"<",customUserGroup:"="},templateUrl:"staff/apps/usergroups/flusergroupsactions.html",controller:e}),e.$inject=["FlUiUtilsService","FlUserGroupsApi","$mdDialog","FlNotificationService","gettextCatalog","$state"]}(),function(){"use strict";function e(e,t){var n=this;n.loadUsers=!0,t.get({id:n.client_id,action:"get_users_not_in_client"}).$promise.then(function(e){n.users=e.users}).finally(function(){n.loadUsers=!1}),n.associateWithUser=function(){document.activeElement.blur(),n.submitPending||n.associateWithUserForm.$invalid||(n.submitPending=!0,t.save({id:n.client_id,action:"associate_user",user_id:n.client.user}).$promise.then(function(){return e.hide()},function(e){n.backendErrors=e.data,n.submitPending=!1}))},n.close=function(){return e.cancel()}}angular.module("fleioStaff").controller("FlClientAssociateUserController",e),e.$inject=["$mdDialog","FlClientApi"]}(),function(){"use strict";function e(e,t,n){var i=this;i.$onInit=function(){i.loadConfigurations=!0,n.get({id:i.client_id,action:"get_configurations_for_client"}).$promise.then(function(e){i.configurations=e.configurations,i.client={configuration:i.configurations.length?i.configurations[0].id:""}}).finally(function(){i.loadConfigurations=!1}),n.get({id:i.client_id,action:"get_configuration"}).$promise.then(function(e){i.currentConfiguration=e})},i.changeConfiguration=function(){if(document.activeElement.blur(),i.submitPending||i.changeConfigurationForm.$invalid)return;i.submitPending=!0,n.save({id:i.client_id,action:"change_configuration",configuration:i.client.configuration}).$promise.then(function(){return t.hide()},function(e){i.backendErrors=e.data,i.submitPending=!1})},i.goToConfigurations=function(){e.go("configurationsList")},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlClientChangeConfigurationController",e),e.$inject=["$state","$mdDialog","FlClientApi"]}(),function(){"use strict";function e(i,e,t,n){var o=this;function r(){o.project_id=void 0,o.selectedProject=void 0}function a(e){void 0!==e&&(o.project_id=e.project_id)}function s(e){return i.get({id:o.client.id,action:"get_os_projects_for_os_service_creation",search:e}).$promise.then(function(e){return e.objects})}function l(){document.activeElement.blur(),o.submitPending||o.createOpenstackServiceForm.$invalid||(o.submitPending=!0,n.save({id:o.client.id,action:"create_openstack_service",product_id:o.product_id,product_cycle_id:o.product_cycle_id,create_new_project:o.create_new_project,project_id:o.project_id}).$promise.then(function(e){return t.hide()}).catch(function(e){o.backendErrors=e.data,o.submitPending=!1}))}o.$onInit=function(){o.selectedProjectChange=a,o.searchProject=s,o.clearProject=r,o.createOpenstackService=l,o.loadData=!0,n.get({id:o.client.id,action:"new_service_data"}).$promise.then(function(e){o.products=e.products,i.get({id:o.client.id,action:"get_os_projects_for_os_service_creation",search:o.client.name}).$promise.then(function(e){o.selectedProject=e.objects[0]}),o.products_by_id={};for(var t=0;t<o.products.length;t++){var n=o.products[t];o.products_by_id[n.id]=n}o.create_new_project=!1,o.product_id=o.products[0].id,o.product_cycle_id=o.products_by_id[o.product_id].cycles[0].id}).finally(function(){o.loadData=!1})},o.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlCreateOpenstackServiceController",e),e.$inject=["FlClientApi","FlProjectsApi","$mdDialog","FlOsClientApi"]}(),function(){"use strict";function e(e,t){var i=this;i.$onInit=function(){i.loadData=!0,e.get({id:i.client.id,action:"new_reseller_service_data"}).$promise.then(function(e){i.products=e.products,i.products_by_id={};for(var t=0;t<i.products.length;t++){var n=i.products[t];i.products_by_id[n.id]=n}i.product_id=i.products[0].id,i.product_cycle_id=i.products_by_id[i.product_id].cycles[0].id}).finally(function(){i.loadData=!1})},i.createResellerService=function(){document.activeElement.blur(),i.submitPending||i.createResellerServiceForm.$invalid||(i.submitPending=!0,e.save({id:i.client.id,action:"create_reseller_service",product_id:i.product_id,product_cycle_id:i.product_cycle_id}).$promise.then(function(e){return t.hide()}).catch(function(e){i.backendErrors=e.data,i.submitPending=!1}))},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlCreateResellerServiceController",e),e.$inject=["FlClientApi","$mdDialog"]}(),function(){"use strict";function e(t,e,n){var i=this;i.service=angular.copy(n),i.deleteAssociatedProject=!1,i.performDelete=function(){if(!i.deleteService.$invalid&&!i.submitPending)return i.submitPending=!0,e.Services.delete({id:i.service.id,delete_associated_resources:i.deleteAssociatedProject}).$promise.then(function(e){return t.hide(e),e},function(e){return i.submitPending=!1,i.backendErrors=e.data})},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlDeleteOpenstackServiceController",e),e.$inject=["$mdDialog","FlBilling","service"]}(),function(){"use strict";function e(e,t,n,i){var o=this;o.$onInit=function(){},o.changePlan=function(){return e.hide(o.selectedPricingPlan)},o.close=function(){return e.cancel()}}angular.module("fleioStaff").controller("FlClientChangePricingPlanController",e),e.$inject=["$mdDialog","availablePlans","selectedPricingPlan","clientId"]}(),function(){"use strict";function e(e,t,n){var i=this;i.$onInit=function(){},i.changeUrl=function(){return e.hide(i.enduserPanelUrl)},i.close=function(){return e.cancel()}}angular.module("fleioStaff").controller("FlClientChangeEnduserPanelUrlController",e),e.$inject=["$mdDialog","enduserPanelUrl","clientId"]}(),function(){"use strict";function e(e,t,n){e.state("clientgroups",{url:t.base_url+"clientgroups?page_size?ordering?filtering?search",component:"flClientGroups",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{clientgroups:["$stateParams","FlObjectList","FlClientGroupsApi",function(e,t,n){return t(n,e)}]},data:{feature:"clients&users.clientgroups",stateInfo:{display:n("Client groups"),parent:"dashboard"},orderOptions:{id:n("Id"),name:n("Name"),created_at:n("Created at")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},is_default:{display:n("Is default"),field_name:"is_default",type:"bool"}}}}).state("clientgroup",{url:t.base_url+"clientgroups/:id",component:"flClientGroupDetails",authenticate:!0,resolve:{clientgroup:["$stateParams","FlClientGroupsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.get(e).$promise.then(function(e){return n.setParams({name:e.name}),e}).catch(i.handleError)}]},data:{feature:"clients&users.clientgroups",stateInfo:{default:n("Client group details"),display:n("Client group {:name}"),parent:"clientgroups"}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(t,n,e,i,o){var r=this;function a(){return r.clientgroups.fetchData()}r.$onInit=function(){e.info.enabled=!0,e.info.label=i("Search client groups"),e.info.service=r.clientgroups},r.refreshClientGroups=a,r.addClientGroup=function(e){return o.show({templateUrl:"staff/apps/clientgroups/flclientgroupedit.html",controller:"FlClientGroupAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:e}).then(function(){return a(),t.add(n.getString("Client group added"))}).catch(function(){})}}angular.module("fleioStaff").component("flClientGroups",{templateUrl:"staff/apps/clientgroups/flclientgroups.html",controller:e,bindings:{clientgroups:"<"}}),e.$inject=["FlNotificationService","gettextCatalog","FlSearchService","gettext","$mdDialog"]}(),function(){"use strict";function e(n,e,t,i,o,r){var a=this;function s(){e.get({id:a.clientgroup.id}).$promise.then(function(e){a.clientgroup=e})}a.$onInit=function(){a.currentPage=1,a.nextPage=!1,a.previousPage=!1,a.loading=!0,a.refreshClients()},a.refreshClients=function(){a.loading=!0,n.get({group_id:a.clientgroup.id,action:"get_clients_in_group",page:a.currentPage,page_size:10}).$promise.then(function(e){a.loading=!1,a.nextPage=!!e.next,a.previousPage=!!e.previous,a.clients=e.objects})},a.changeClientsPage=function(e){"next"===e&&(a.currentPage=a.currentPage+1,a.refreshClients()),"previous"===e&&(a.currentPage=a.currentPage-1,a.refreshClients())},a.searchClient=function(e){return n.get({action:"get_available_clients_for_group",group:a.clientgroup.id,search:e}).$promise.then(function(e){return e.objects})},a.selectedClientChange=function(e){void 0!==e&&(a.addClientError=null)},a.addToGroup=function(e){if(a.submitPending=!0,!e)return a.addClientError=o.getString("Invalid input for client"),void(a.submitPending=!1);a.addClientError=null,n.save({id:e.id,action:"add_to_group",group_id:a.clientgroup.id}).$promise.then(function(e){return s(),a.refreshClients(),i.add(o.getString("Client added to group")),a.submitPending=!1,a.selectedClient=null,e},function(e){a.backendErrors=e.data,a.submitPending=!1})},a.removeFromGroup=function(e,t){r.yesNoDlg(o.getString("Are you sure?"),o.getString("Remove client from group")).then(function(){n.save({id:t.id,action:"remove_from_group",group_id:a.clientgroup.id}).$promise.then(function(e){return s(),a.refreshClients(),i.add(o.getString("Client removed from group")),a.selectedClient=null,e},function(e){a.backendErrors=e.data})}).catch(function(){})}}angular.module("fleioStaff").component("flClientGroupDetails",{templateUrl:"staff/apps/clientgroups/flclientgroupdetails.html",controller:e,bindings:{clientgroup:"<"}}),e.$inject=["FlClientApi","FlClientGroupsApi","$mdDialog","FlNotificationService","gettextCatalog","FlUiUtilsService"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/clientgroups/:id/:action",{id:"@id",action:"@action"})}angular.module("fleioStaff").factory("FlClientGroupsApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(t,e,n){var i=this;i.clientGroup={},i.isEdit=!1,i.saveClientGroup=function(){if(document.activeElement.blur(),!i.editClientGroup.$invalid&&!i.submitPending)return i.submitPending=!0,e.save(i.clientgroup).$promise.then(function(e){return t.hide(e),e},function(e){return i.submitPending=!1,i.backendErrors=e.data})},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlClientGroupAddController",e),e.$inject=["$mdDialog","FlClientGroupsApi","gettext"]}(),function(){"use strict";function e(t,e,n,i,o){var r=this;r.clientgroup=angular.copy(n),r.isEdit=!0,r.submitPending=!1,r.saveClientGroup=function(){if(document.activeElement.blur(),!r.editClientGroup.$invalid&&!r.submitPending)return r.submitPending=!0,e.update({id:r.clientgroup.id},r.clientgroup).$promise.then(function(e){return t.hide(e),"clientgroup"===o.current.name&&i.updateParams({name:e.name}),e}).catch(function(e){r.submitPending=!1,r.backendErrors=e.data})},r.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlClientGroupEditController",e),e.$inject=["$mdDialog","FlClientGroupsApi","clientgroup","FlBreadCrumbService","$state"]}(),function(){"use strict";function e(t,n,i,o,r,a){var s=this;function l(){return s.clientgroups.fetchData()}s.editClientGroup=function(e,t){return i.show({templateUrl:"staff/apps/clientgroups/flclientgroupedit.html",controller:"FlClientGroupEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{clientgroup:t},targetEvent:e}).then(function(){return s.clientgroups?l():function(e){n.get({id:e.id}).$promise.then(function(e){s.customClientGroup=e})}(t),o.add(r.getString("Client group updated"))}).catch(function(){})},s.deleteClientGroup=function(e){return t.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete client group {{name}}",{name:e.name}),r.getString("Delete client group")).then(function(){n.delete({id:e.id}).$promise.then(function(){s.clientgroups?l():a.go("clientgroups"),o.add(r.getString("Client group deleted"))},function(){o.add(r.getString("Could not delete client group"))})}).catch(function(){})}}angular.module("fleioStaff").component("flClientGroupsActions",{restrict:"E",bindings:{clientgroups:"<",customClientGroup:"="},templateUrl:"staff/apps/clientgroups/flclientgroupsactions.html",controller:e}),e.$inject=["FlUiUtilsService","FlClientGroupsApi","$mdDialog","FlNotificationService","gettextCatalog","$state"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/:action",{action:"@action"})}angular.module("fleioStaff").factory("FlLicenseApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(t,n,i,e,o,r){var a=this;a.license_key="",a.canCancel=o,a.setLicense=function(){if(document.activeElement.blur(),!a.setLicenseForm.$invalid&&!a.submitPending)return a.submitPending=!0,e.save({action:"set-license",license_key:a.license_key}).$promise.then(function(e){i.hide(a.name),t.add(n.getString("License set")),r.location.reload()},function(e){return a.backendErrors=e.data,a.submitPending=!1})},a.close=function(){return i.cancel()}}angular.module("fleioStaff").controller("FlSetLicenseController",e),e.$inject=["FlNotificationService","gettextCatalog","$mdDialog","FlLicenseApi","canCancel","$window"]}(),function(){"use strict";function e(e,t,n,i,o){var r=this;function a(){return r.loading=!0,t.get({action:"get-license-info"}).$promise.then(function(e){e.hasOwnProperty("License type")?r.licenseInfo=e:r.licenseInfo=null}).finally(function(){r.loading=!1})}r.$onInit=function(){r.features=i.features,a()},r.isDate=function(e){return!(!isNaN(parseFloat(e))&&isFinite(e)||isNaN(Date.parse(e)))},r.toDate=function(e){return new Date(e)},r.setNewLicense=function(){e.show({templateUrl:"staff/apps/settings/general/license/flsetlicense.html",controller:"FlSetLicenseController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{canCancel:!0}}).catch(function(){})},r.refreshLicense=function(){if(r.submitPending)return;return r.submitPending=!0,n.add(o.getString("License refresh in progress")),t.save({action:"refresh-license"}).$promise.then(function(e){a(),n.add(o.getString("License refreshed"))}).catch(function(e){r.backendErrors=e.data}).finally(function(e){return r.submitPending=!1,e})}}angular.module("fleioStaff").component("flLicenseInfo",{templateUrl:"staff/apps/settings/general/license/flgetlicenseinfo.html",controller:e}),e.$inject=["$mdDialog","FlLicenseApi","FlNotificationService","FlFeatureService","gettextCatalog"]}(),function(){"use strict";function e(e,t,i,n,o,r){var a=this;function s(){e.get({action:"notifications"}).$promise.then(function(e){a.broker=function(e){var t={};if(angular.isArray(e.notifications_url)){var n="";e.notifications_url.forEach(function(e){n&&(n+="\n"),n+=e}),t.notifications_url=n}if(angular.isArray(e.notifications_exchange)){var i="";e.notifications_exchange.forEach(function(e){i&&(i+=", "),i+=e}),t.notifications_exchange=i}if(angular.isArray(e.notifications_topic)){var o="";e.notifications_topic.forEach(function(e){o&&(o+=", "),o+=e}),t.notifications_topic=o}return t.notifications_pool=e.notifications_pool,t}(e)}).catch(function(e){a.broker={},t.add("Error retrieving NOTIFICATIONS settings.")})}function l(){e.get({action:"defaults"}).$promise.then(function(e){a.defaults=e}).catch(function(e){a.defaults={},t.add("Error retrieving Volume Size Increments.")})}function c(e){e.available_role_options&&(a.defaults.available_role_options=e.available_role_options,delete e.available_role_options),e.available_region_options&&(a.defaults.available_region_options=e.available_region_options,delete e.available_region_options),a.credentials=e}function u(){a.submitPending||a.credentialsForm.$invalid||(a.submitPending=!0,a.backendErrors=null,e.save(a.credentials).$promise.then(function(e){e.detail&&t.add(e.detail),e.settings&&c(e.settings),l(),a.submitPending=!1}).catch(function(e){a.backendErrors=e.data,a.submitPending=!1}))}function d(){a.submitPending||(a.submitPending=!0,a.backendErrors=null,a.credentialsForm.$setSubmitted(),e.save({action:"test_connection"},a.credentials).$promise.then(function(e){if(a.submitPending=!1,e.detail)return i.yesNoDlgCustom("",e.detail,o.getString("Save settings & sync"),o.getString("Changes ready to be saved."),"normal","success").then(function(){a.credentialsFormSubmit()}).catch(function(){})}).catch(function(e){if(a.submitPending=!1,e.data){var t="";for(var n in e.data)e.data.hasOwnProperty(n)&&(t=t+n+":"+e.data[n]+"<br>");return i.yesNoDlgCustom("",o.getString("Could not connect")+" : "+e.statusText,o.getString("Edit settings"),t,"warning","error").then(function(){}).catch(function(){})}}))}function p(){a.submitPending||(a.submitPending=!0,a.defaultsBackendErrors=null,e.save({action:"defaults"},a.defaults).$promise.then(function(e){e.defaults&&l(e.defaults),e.detail&&t.add(e.detail),a.submitPending=!1},function(e){a.defaultsBackendErrors=e.data,a.submitPending=!1}))}function f(){a.submitPending||(a.submitPending=!0,a.brokerBackendErrors=null,a.broker_formatted=angular.copy(a.broker),angular.isString(a.broker.notifications_url)&&(a.broker_formatted.notifications_url=a.broker.notifications_url.split("\n").filter(function(e){return 0!==(e=e.replace(/^\s+|\s+$/g,"")).length})),angular.isString(a.broker.notifications_topic)&&(a.broker_formatted.notifications_topic=a.broker.notifications_topic.split(",").filter(function(e){return 0!==(e=e.replace(/^\s+|\s+$/g,"")).length})),angular.isString(a.broker.notifications_exchange)&&(a.broker_formatted.notifications_exchange=a.broker.notifications_exchange.split(",").filter(function(e){return 0!==(e=e.replace(/^\s+|\s+$/g,"")).length})),e.save({action:"notifications"},a.broker_formatted).$promise.then(function(e){e.broker&&s(e.broker),e.detail&&t.add(e.detail),a.submitPending=!1},function(e){a.brokerBackendErrors=e.data,a.submitPending=!1}))}function g(e){a.broker_formatted=angular.copy(a.broker),angular.isString(a.broker.notifications_url)&&(a.broker_formatted.notifications_url=a.broker.notifications_url.split("\n").filter(function(e){return 0!==(e=e.replace(/^\s+|\s+$/g,"")).length})),angular.isString(a.broker.notifications_topic)&&(a.broker_formatted.notifications_topic=a.broker.notifications_topic.split(",").filter(function(e){return 0!==(e=e.replace(/^\s+|\s+$/g,"")).length})),angular.isString(a.broker.notifications_exchange)&&(a.broker_formatted.notifications_exchange=a.broker.notifications_exchange.split(",").filter(function(e){return 0!==(e=e.replace(/^\s+|\s+$/g,"")).length})),n.show({templateUrl:"staff/apps/settings/openstack/testnotificationsurls/testnotificationsurlsdialog.html",controller:"TestNotificationsUrlsDialogController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{broker:a.broker_formatted},bindToController:!0,targetEvent:e}).catch(function(){})}function m(){a.submitPending||(a.submitPending=!0,a.defaultsBackendErrors=null,e.save({action:"volume_size_increments"},{volume_size_increments:a.volumeSizeIncrements}).$promise.then(function(e){a.submitPending=!1,e.volume_size_increments&&(a.volumeSizeIncrements=e.volume_size_increments),e.detail&&t.add(e.detail)},function(e){var t=e.data;e.data&&e.data.volume_size_increments&&(t={non_field_errors:e.data.volume_size_increments}),a.vsiBackendErrors=t,a.submitPending=!1}))}function h(){a.loadServices=!0,e.get({action:"services"}).$promise.then(function(e){e.available_service_versions&&(a.available_service_versions=e.available_service_versions),a.loadServices=!1},function(e){a.loadServices=!1,a.servicesBackendErrors=e.data})}function v(e){return e.min_version<=e.version&&e.version<=e.max_version}a.$onInit=function(){a.credentialsFormSubmit=u,a.testConnection=d,a.defaultsFormSubmit=p,a.brokerFormSubmit=f,a.testNotificationsConnections=g,a.vsiFormSubmit=m,a.goBackOrToState=i.goBackOrToState,a.getServices=h,a.isServiceVersionSupported=v,c(a.settings),l(),s(),e.get({action:"volume_size_increments"}).$promise.then(function(e){a.volumeSizeIncrements=e.volume_size_increments;try{a.volumeSizeIncrements_length=Object.keys(a.volumeSizeIncrements).length}catch(e){a.volumeSizeIncrements_length=-1}}).catch(function(e){t.add("Error retrieving Volume Size Increments.")})},a.getOpenRCFile=function(t){r.get().$promise.then(function(e){return n.show({templateUrl:"oscommons/apiusers/getopenrcfile.dialog.html",controller:"FlApiUserGetOpenrcController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{user:{name:a.credentials.username,default_project_id:a.credentials.user_project_id},regions:e.objects},targetEvent:t}).then(function(){}).catch(function(){})})}}angular.module("fleioStaff").component("flOpenstackSettings",{templateUrl:"staff/apps/settings/openstack/openstacksettings.html",controller:e,bindings:{settings:"<"}}),e.$inject=["OpenstackSettingsApi","FlNotificationService","FlUiUtilsService","$mdDialog","gettextCatalog","FlRegionApi"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/settings/openstack/:action")}angular.module("fleioStaff").factory("OpenstackSettingsApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n,i,o){var r=this;r.$onInit=function(){r.section=n,r.configuration_id=o,r.backendDetail=i},r.close=function(){return e.cancel()},r.goToSectionSettings=function(){r.configuration_id?t.go("openstackSettings",{section:r.section,configuration_id:r.configuration_id}):t.go("openstackSettings",{section:r.section})}}angular.module("fleioStaff").controller("FlSettingsErrorController",e),e.$inject=["$mdDialog","$state","section","detail","configuration_id"]}(),function(){"use strict";function e(e,t,n){e.state("configurationsList",{url:t.joinBaseUrl("settings/configurations?page_size?ordering?search"),component:"flConfigurationsList",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"name",squash:!0}},data:{stateInfo:{display:n("Configurations"),parent:"dashboard"},feature:"settings.configurations",orderOptions:{name:n("Name")}},resolve:{configurations:["FlConfigurationsApi","FlObjectList","$stateParams",function(e,t,n){return t(e,n)}]}}).state("configurationDetails",{url:t.joinBaseUrl("settings/configurations/:id"),component:"flConfigurationDetails",authenticate:!0,data:{stateInfo:{display:n("Configuration details"),parent:"configurationsList"},feature:"settings.configurations"},resolve:{configuration:["FlConfigurationsApi","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.get({id:t.id}).$promise.catch(n.handleError)}],billingSettings:["FlConfigurationsApi","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.get({id:t.id,section:"billing"}).$promise.catch(n.handleError)}]}}).state("openstackSettings",{url:t.joinBaseUrl("settings/openstack"),component:"flOpenstackSettings",resolve:{settings:["OpenstackSettingsApi",function(e){return e.get().$promise}]},data:{stateInfo:{display:"OpenStack settings",parent:"dashboard"},feature:"openstack.settings"}}).state("generalSettings",{url:t.joinBaseUrl("settings/general"),component:"flGeneralSettings",params:{activeTab:""},authenticate:!0,data:{stateInfo:{display:n("General settings"),parent:"dashboard"},feature:"settings.general"}}).state("authorizationSettings",{url:t.joinBaseUrl("settings/authorization"),component:"flAuthorizationSettings",authenticate:!0,data:{stateInfo:{display:n("Authorization settings"),parent:"dashboard"},feature:"settings.authorization"}}).state("notificationTemplates",{url:t.joinBaseUrl("settings/notification-templates?page_size?ordering?search?filtering"),component:"flNotificationTemplatesComponent",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"name",squash:!0},filtering:{value:"",squash:!0}},data:{stateInfo:{display:n("Notification templates"),parent:"dashboard"},feature:"settings.notifications.templates",orderOptions:{name:n("Name"),category:n("Category")},filtering:{category:{display:n("category"),field_name:"category",type:"customModelInstance",service:"FlNotificationTemplatesCategoriesApi"}}},resolve:{notifications:["FlNotificationTemplatesApi","FlObjectList","$stateParams",function(e,t,n){return t(e,n)}]}}).state("notificationTemplateEdit",{url:t.joinBaseUrl("settings/notification-templates/edit/:id"),component:"flNotificationTemplateEditComponent",authenticate:!0,data:{stateInfo:{display:n("Edit notification templates"),parent:"notificationTemplates"},feature:"settings.notifications.templates"},resolve:{defaultTemplateId:["$stateParams",function(e){return e.id}],templates:["FlNotificationTemplatesApi","$stateParams",function(e,t){return e.get({action:"get_editable_notification_templates",template_id:t.id}).$promise}],createOptions:["FlNotificationTemplatesApi",function(e){return e.get({action:"create_options"}).$promise}]}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n){var i=this;i.$onInit=function(){i.submitPending=!0,n.save({action:"test-notifications-connections"},t).$promise.then(function(e){i.results=e.results,i.submitPending=!1},function(e){i.brokerBackendErrors=e.data,i.submitPending=!1})},i.close=function(){return e.cancel()}}angular.module("fleioStaff").controller("TestNotificationsUrlsDialogController",e),e.$inject=["$mdDialog","broker","OpenstackSettingsApi"]}(),function(){"use strict";function e(n,e,i,o,r,a,s){var l=this;function t(){return{searchEntity:function(e){return i.get({search:e}).$promise.then(function(e){return e.objects})},selectedEntityChange:function(e){l.backendErrors=null,void 0!==e&&i.get({id:e.id,action:"list_permissions"}).$promise.then(function(e){l.user_group_permissions=e})}}}function c(){return{searchEntity:function(e){return o.get({search:e}).$promise.then(function(e){return e.objects})},selectedEntityChange:function(t){l.backendErrors=null,void 0!==t&&o.get({id:t.id,option:"list_permissions"}).$promise.then(function(e){l.user_permissions=e,f(t)})}}}function u(t,e){null!=t&&("user"===e?o.get({id:t.id,option:"list_permissions"}).$promise.then(function(e){l.user_permissions=e,f(t)}):"usergroup"===e&&i.get({id:t.id,action:"list_permissions"}).$promise.then(function(e){l.user_group_permissions=e}))}function d(e){var t=s("filter")(l.user_permissions.objects,{name:e.name},!0)[0];t.granted=!t.granted}function p(e){var t=s("filter")(l.user_group_permissions.objects,{name:e.name},!0)[0];t.granted=!t.granted}function f(e){o.get({id:e.id,option:"fetch_effective_permissions"}).$promise.then(function(e){l.effective_permissions=e.permissions})}function g(t){if(document.activeElement.blur(),!l.submitPending&&!l.editUserPermissions.$invalid){if(t.permissions){var e=t.permissions;return l.submitPending=!0,n.post({id:e,action:"update_objects"},l.user_permissions).$promise.then(function(e){return l.submitPending=!1,r.add(a.getString("User permissions updated")),f(t),e}).catch(function(e){l.submitPending=!1,l.backendErrors=e.data})}return l.submitPending=!0,o.post({id:t.id,option:"generate_permission_set"},l.user_permissions).$promise.then(function(e){l.submitPending=!1,l.selectedUser.permissions=e.permissions_set,r.add(a.getString("User permissions generated")),f(t)}).catch(function(e){l.submitPending=!1,l.backendErrors=e.data})}}function m(e){if(document.activeElement.blur(),!l.submitPending&&!l.editGroupPermissions.$invalid){if(e.permissions){var t=e.permissions;return l.submitPending=!0,n.post({id:t,action:"update_objects"},l.user_group_permissions).$promise.then(function(e){return l.submitPending=!1,r.add(a.getString("User group permissions updated")),e}).catch(function(e){l.submitPending=!1,l.backendErrors=e.data})}return l.submitPending=!0,i.post({id:e.id,action:"generate_permission_set"},l.user_group_permissions).$promise.then(function(e){l.submitPending=!1,l.selectedGroup.permissions=e.permissions_set,r.add(a.getString("User group permissions generated"))}).catch(function(e){l.submitPending=!1,l.backendErrors=e.data})}}l.$onInit=function(){l.user_permissions={objects:[],implicitly_granted:!0},l.user_group_permissions={objects:[],implicitly_granted:!0},l.groupsSearch=t,l.usersSearch=c,l.userGroupsSearchService=l.groupsSearch(),l.usersSearchService=l.usersSearch(),l.updateUserPermissions=g,l.updateUserGroupPermissions=m,l.toogleUserCheckbox=d,l.toogleUserGroupCheckbox=p,l.refreshAllPermissions=u},l.checkAll=function(e){for(var t=0;t<e.length;t++)e[t].granted=!0},l.uncheckAll=function(e){for(var t=0;t<e.length;t++)e[t].granted=!1}}angular.module("fleioStaff").component("flAuthorizationSettings",{templateUrl:"staff/apps/settings/authorization/authorization.html",controller:e}),e.$inject=["FlPermissionsSetApi","FlAuthorizationApi","FlUserGroupsApi","FlUserApi","FlNotificationService","gettextCatalog","$filter"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/permissions/:action",{action:"@action"})}angular.module("fleioStaff").factory("FlAuthorizationApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/permissionsset/:id/:action",{id:"@id",action:"@action"})}angular.module("fleioStaff").factory("FlPermissionsSetApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n){e.state("openstackPlans",{url:t.joinBaseUrl("settings/openstack/plans?page_size?ordering?search"),component:"flBillingPlans",showSearch:!0,reloadOnSearch:!1,data:{feature:"openstack.plans",stateInfo:{display:n("OpenStack plans"),parent:"dashboard"},orderOptions:{name:n("Name"),currency:n("Currency")}},resolve:{plans:["FlOsBillingApi","FlObjectList","$stateParams",function(e,t,n){return t(e.BillingPlans,n)}]},params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"name",squash:!0}}}).state("flPricingRule",{url:t.joinBaseUrl("settings/openstack/plans/:id/add"),component:"flPriceRule",data:{feature:"openstack.plans",stateInfo:{display:n("Add pricing rule"),parent:"planDetails"}},params:{priceRuleId:{squash:!1}},resolve:{options:["$q","FlNotificationService","FlOsBillingApi","FlBreadCrumbService","$stateParams",function(i,o,e,r,a){return e.PriceRules.get({action:"create_options"}).$promise.then(function(e){var t=i.defer();if(0==e.resources.length)return t.reject("No resources"),o.add(gettextCatalog.getString("No available resources")),t.promise;for(var n=0;n<e.plans.length;n++)if(e.plans[n].id==a.id){r.setParams({name:e.plans[n].name});break}return e})}],priceRule:["FlOsBillingApi","$stateParams",function(e,t){return t.priceRuleId?e.PriceRules.get({id:t.priceRuleId}).$promise:null}],plan:["FlOsBillingApi","$stateParams",function(e,t){return e.BillingPlans.get({id:t.id}).$promise}]}}).state("flPricingRuleEdit",{url:t.joinBaseUrl("settings/openstack/plans/:id/:priceRuleId/edit"),component:"flPriceRule",data:{feature:"openstack.plans",stateInfo:{default:n("Edit pricing rule"),display:n("Edit pricing rule {:name}"),parent:"planDetails"}},params:{priceRuleId:{squash:!1}},resolve:{options:["FlOsBillingApi","FlBreadCrumbService","$stateParams",function(e,n,i){return e.PriceRules.get({action:"create_options"}).$promise.then(function(e){for(var t=0;t<e.plans.length;t++)if(e.plans[t].id===i.id){n.setParams({name:e.plans[t].name});break}return e})}],priceRule:["FlOsBillingApi","$stateParams",function(e,t){return t.priceRuleId?e.PriceRules.get({id:t.priceRuleId}).$promise:null}],plan:["FlOsBillingApi","$stateParams",function(e,t){return e.BillingPlans.get({id:t.id}).$promise}]}}).state("flMetricPricingRule",{url:t.joinBaseUrl("settings/openstack/plans/:id/addmetric"),component:"flMetricPriceRule",data:{feature:"openstack.plans",stateInfo:{display:n("Add metric pricing rule"),parent:"planDetails"}},params:{priceRuleId:{squash:!1}},resolve:{options:["FlOsBillingApi","FlBreadCrumbService","$stateParams",function(e,n,i){return e.MetricPriceRules.get({action:"create_options"}).$promise.then(function(e){for(var t=0;t<e.plans.length;t++)if(e.plans[t].id==i.id){n.setParams({name:e.plans[t].name});break}return e})}],priceRule:["FlOsBillingApi","$stateParams",function(e,t){return t.priceRuleId?e.MetricPriceRules.get({id:t.priceRuleId}).$promise:null}],plan:["FlOsBillingApi","$stateParams",function(e,t){return e.BillingPlans.get({id:t.id}).$promise}]}}).state("flMetricPricingRuleEdit",{url:t.joinBaseUrl("settings/openstack/plans/:id/:priceRuleId/editmetric"),component:"flMetricPriceRule",data:{feature:"openstack.plans",stateInfo:{display:n("Edit metric pricing rule"),parent:"planDetails"}},params:{priceRuleId:{squash:!1}},resolve:{options:["FlOsBillingApi","FlBreadCrumbService","$stateParams",function(e,n,i){return e.MetricPriceRules.get({action:"create_options"}).$promise.then(function(e){for(var t=0;t<e.plans.length;t++)if(e.plans[t].id==i.id){n.setParams({name:e.plans[t].name});break}return e})}],priceRule:["FlOsBillingApi","$stateParams",function(e,t){return t.priceRuleId?e.MetricPriceRules.get({id:t.priceRuleId}).$promise:null}],plan:["FlOsBillingApi","$stateParams",function(e,t){return e.BillingPlans.get({id:t.id}).$promise}]}}).state("planDetails",{url:t.joinBaseUrl("settings/openstack/plans/:id"),component:"flBillingPlanDetails",data:{feature:"openstack.plans",stateInfo:{display:n("Plan {:name}"),parent:"openstackPlans",default:n("Plan details")}},resolve:{plan:["$stateParams","FlOsBillingApi","FlBreadCrumbService",function(e,t,n){return t.BillingPlans.get({id:e.id}).$promise.then(function(e){return n.setParams({name:e.name}),e})}]}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,i){var o=this;o.plan?(o.edit=!0,o.wasDefault=angular.copy(o.plan.is_default)):(o.plan={name:"",currency:""},o.edit=!1),o.close=function(){return e.cancel()},o.newPlanSubmit=function(){document.activeElement.blur(),o.submitPending||o.newPlan.$invalid||(o.edit?n.BillingPlans.update(o.plan).$promise.then(function(){t.add(i.getString("Plan update scheduled")),e.hide()},function(e){o.backendErrors=e.data}):n.BillingPlans.save(o.plan).$promise.then(function(){t.add(i.getString("Plan create scheduled")),e.hide()}))}}angular.module("fleioStaff").controller("FlPlanCreateController",e),e.$inject=["$mdDialog","FlNotificationService","FlOsBillingApi","gettextCatalog"]}(),function(){"use strict";function e(r,e,t,o,a,n){var s=this;s.$onInit=function(){t.info.enabled=!0,t.info.label=n("Search plans"),t.info.service=s.plans},s.editPlan=function(i,o){e.Currencies.get().$promise.then(function(n){e.BillingPlans.get({page_size:"100000",is_default:"False"}).$promise.then(function(e){var t=e.objects;return r.show({templateUrl:"staff/apps/osbilling/plans/create/flplancreate.html",controller:"FlPlanCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,targetEvent:i,locals:{currencies:n,plan:angular.copy(o),plans:t},bindToController:!0}).then(function(){s.plans.fetchData()}).catch(function(){})})})},s.deletePlan=function(n,i){e.BillingPlans.get({page_size:"100000"}).$promise.then(function(e){var t=e.objects;if(1!==t.length)return r.show({templateUrl:"staff/apps/osbilling/plans/flbillingplandelete.html",controller:"FlPlanDeleteController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,targetEvent:n,locals:{plans:t,plan:angular.copy(i)},bindToController:!0}).then(function(){s.plans.fetchData()}).catch(function(){});o.add(a.getString("You can't delete the last plan"))})}}function t(t,e,n){var i=this;i.close=function(){return t.cancel()},i.delete=function(){document.activeElement.blur(),i.submitPending||i.deletePlanForm.$invalid||(i.submitPending=!0,e.BillingPlans.delete({id:i.plan.id,plan_to_migrate:i.plan_to_migrate}).$promise.then(function(e){n.add(e.detail),t.hide()},function(e){i.submitPending=!1,i.backendErrors=e.data}))}}angular.module("fleioStaff").component("flBillingPlans",{templateUrl:"staff/apps/osbilling/plans/flbillingplans.html",controller:e,bindings:{plans:"<"}}).controller("FlPlanDeleteController",t),e.$inject=["$mdDialog","FlOsBillingApi","FlSearchService","FlNotificationService","gettextCatalog","gettext"],t.$inject=["$mdDialog","FlOsBillingApi","FlNotificationService"]}(),function(){"use strict";function e(r,a,s,e,o,l,c,u,t){var d=this;d.$mdMedia=e,d.editPlan=function(i,o){a.Currencies.get().$promise.then(function(n){a.BillingPlans.get({page_size:"100000",is_default:"False"}).$promise.then(function(e){var t=e.objects;return s.show({templateUrl:"staff/apps/osbilling/plans/create/flplancreate.html",controller:"FlPlanCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,targetEvent:i,locals:{currencies:n,plan:angular.copy(o),plans:t},bindToController:!0}).then(function(){a.BillingPlans.get(r).$promise.then(function(e){d.plan=e,c.updateParams({name:e.name})})}).catch(function(){})})})},d.refreshPlan=function(){a.BillingPlans.get(r).$promise.then(function(e){d.plan=e})},d.removeRule=function(e){return t.yesNoDlg(u.getString("Deleting the princing rule will apply to all calculated costs"),u.getString("Delete pricing rule {{ruleName}}?",{ruleName:e.display_name}),u.getString("Delete")).then(function(){a.PriceRules.delete({id:e.id}).$promise.then(d.refreshPlan)}).catch(function(){})},d.deletePlan=function(n,i){a.BillingPlans.get({page_size:"100000"}).$promise.then(function(e){var t=e.objects;if(1!==t.length)return s.show({templateUrl:"staff/apps/osbilling/plans/flbillingplandelete.html",controller:"FlPlanDeleteController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,targetEvent:n,locals:{plans:t,plan:angular.copy(i)},bindToController:!0}).then(function(){l.go("openstackPlans")}).catch(function(){});o.add(u.getString("You can't delete the last plan"))})}}angular.module("fleioStaff").component("flBillingPlanDetails",{templateUrl:"staff/apps/osbilling/plans/flbillingplandetails.html",controller:e,bindings:{plan:"<"}}),e.$inject=["$stateParams","FlOsBillingApi","$mdDialog","$mdMedia","FlNotificationService","$state","FlBreadCrumbService","gettextCatalog","FlUiUtilsService"]}(),function(){"use strict";function e(e){}angular.module("fleioStaff").component("flPricing",{templateUrl:"staff/apps/osbilling/pricing/flpricing.html",controller:e}),e.$inject=["$mdDialog"]}(),function(){"use strict";function e(e,o,r,t,n){var a=this;function i(e){a.backendErrors=e.data,a.backendErrors.pricing&&(a.backendErrors.pricing=function t(e,n){if("string"==typeof e)return n.push(e);"object"==typeof e&&(e=Object.values(e)),e.forEach(function(e){return t(e,n)});var i=[];return n.forEach(function(e){i.indexOf(e)<0&&i.push(e)}),i}(a.backendErrors.pricing,[])),a.submitPending=!1}function s(e,t){return e-t}function l(e,t){var n=angular.copy(t);if(n.sort(s),e>=n[n.length-1])return"∞";for(var i=0;i<n.length;i++)if(n[i]>e)return n[i]}a.$onInit=function(){if(a.steps=[],a.priceRule){for(var e=0;e<a.options.resources.length;e++)a.options.resources[e].id===a.priceRule.resource&&(a.resource=a.options.resources[e],a.rate_type="f",a.resource.metric_display&&a.priceRule.pricing.prices.length&&(0!==a.priceRule.pricing.prices[0].f||1<a.priceRule.pricing.prices.length)&&(a.rate_type="t"),a.resIndex=e,a.edit=!0);for(var t=0;t<a.priceRule.pricing.prices.length;t++)a.steps.push(a.priceRule.pricing.prices[t].f);a.fixTiers()}else a.priceRule={conditions:[],modifiers:[],pricing:{prices:[{f:0}]}},a.rate_type="f",a.edit=!1,a.resIndex=0,a.loadResource();a.checkPricingAttribute(),a.selectNewMetric(),a.translatedStringsMap={add_modifier:n.getString("Add modifier"),add_filter:n.getString("Add filter"),add_filter_modifier_warning:n.getString("Fill in name, time unit and price first")}},a.backToPlanDetails=function(){return t.goBackOrToState("planDetails",{id:a.plan.id})},a.checkPricingAttribute=function(){if(a.hasPricingAttribute=!1,"service"===a.resource.type)for(var e=0;e<a.resource.attributes.length;e++)if("integer"===a.resource.attributes[e].type){a.hasPricingAttribute=!0;break}},a.checkUnit=function(){for(var e=0;e<a.resource.attributes.length;e++)if(a.resource.attributes[e].name===a.priceRule.pricing.attribute&&-1<["k","m","g","t","b","p","e"].indexOf(a.resource.attributes[e].value_size))return!1;return!0},a.editField=function(e,n,t,i){return o.show({templateUrl:"staff/apps/osbilling/resources/fladdresourcefield.html",controller:"FlAddResourceFieldController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,targetEvent:e,locals:{priceRule:a.priceRule,conditions:a.priceRule.conditions,modifiers:a.priceRule.modifiers,attributes:a.resource.attributes,isCondition:n,currency:a.plan.currency,numberOperators:a.options.number_operators,stringOperators:a.options.string_operators,timeUnits:a.options.time_units,attributeUnits:a.options.attribute_units,ngModel:angular.copy(t),index:i,validateCallback:function(e){var t=angular.copy(a.priceRule);return void 0!==i?n?t.conditions[i]=e:t.modifiers[i]=e:n?t.conditions.push(e):t.modifiers.push(e),function(e){return e.id?r.PriceRules.save({action:"validate_existing_rule",id:e.id},e).$promise:r.PriceRules.save({action:"validate_new_rule"},e).$promise}(t)}},bindToController:!0}).then(function(e){void 0!==i?n?a.priceRule.conditions[i]=e:a.priceRule.modifiers[i]=e:n?a.priceRule.conditions.push(e):a.priceRule.modifiers.push(e)}).catch(function(){})},a.loadResource=function(){a.resource=a.options.resources[a.resIndex],a.rate_type="f",a.priceRule.pricing={prices:[{f:0}]},"service"===a.resource.type&&(a.priceRule.conditions=[],a.priceRule.modifiers=[],a.priceRule.pricing.attribute=null,a.priceRule.pricing.attribute_unit=null),a.priceRule.resource=a.resource.id,a.priceRule.plan=e.id,a.checkPricingAttribute()},a.getField=function(e){for(var t=0;t<a.resource.attributes.length;t++)if(a.resource.attributes[t].name===e)return a.resource.attributes[t];return null},a.removeRule=function(e,t){t?a.priceRule.conditions.splice(e,1):a.priceRule.modifiers.splice(e,1)},a.saveRule=function(){a.submitPending||a.ruleForm.$invalid||(a.submitPending=!0,a.edit?r.PriceRules.update(a.priceRule).$promise.then(function(){a.backToPlanDetails()}).catch(i):r.PriceRules.save(a.priceRule).$promise.then(function(){a.backToPlanDetails()}).catch(i))},a.switchRateType=function(e){"f"===e&&a.priceRule.pricing.prices.length?(a.priceRuleCache=angular.copy(a.priceRule.pricing.prices),a.stepsCache=angular.copy(a.steps),(0!==a.priceRule.pricing.prices[0].f||1<a.priceRule.pricing.prices.length)&&(a.priceRule.pricing.prices.splice(1,a.priceRule.pricing.prices.length),a.priceRule.pricing.prices[0].f=0,a.priceRule.pricing.prices[0].t="∞",a.steps=[0])):a.priceRuleCache&&(a.priceRule.pricing.prices=angular.copy(a.priceRuleCache),a.steps=angular.copy(a.stepsCache))},a.addTier=function(){if(0===a.priceRule.pricing.prices.length)a.priceRule.pricing.prices.push({f:0,t:"",p:""});else{var e=a.priceRule.pricing.prices.length-1;a.priceRule.pricing.prices.push({f:a.steps[a.steps.length],t:"",p:""}),a.priceRule.pricing.prices[e].p||(a.priceRule.pricing.prices[e].p=0)}a.fixTiers()},a.selectNewMetric=function(){if(a.priceRule&&a.priceRule.pricing&&a.resource&&a.resource.metrics){var t=a.priceRule.pricing.attribute;a.resource.metrics.map(function(e){e.name===t&&(a.priceRuleMetricHelpText=e.help_text)})}else a.priceRuleMetricHelpText=""},a.fixTiers=function(){for(var e=0;e<a.priceRule.pricing.prices.length;e++)a.priceRule.pricing.prices[e].f=a.steps[e],a.priceRule.pricing.prices[e].t=l(a.priceRule.pricing.prices[e].f,a.steps)},a.clearPricingBackendErrors=function(){a.backendErrors&&a.backendErrors.pricing&&delete a.backendErrors.pricing},a.removeTier=function(e){0!==e?(a.priceRule.pricing.prices.splice(e,1),a.steps.splice(e,1)):(a.priceRule.pricing.prices[0].f=0,a.steps[0]=0),a.fixTiers(),a.clearPricingBackendErrors()}}angular.module("fleioStaff").component("flPriceRule",{templateUrl:"staff/apps/osbilling/pricing/flpricerule.html",controller:e,bindings:{options:"<",priceRule:"<",plan:"<"}}),e.$inject=["$stateParams","$mdDialog","FlOsBillingApi","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(t,n){var o=this;function i(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})}o.close=function(){return t.cancel()},o.checkUnit=function(){for(var e=0;e<o.attributes.length;e++)if(o.attributes[e].name===o.attribute.name&&-1<["k","m","g","t","b","p","e"].indexOf(o.attributes[e].value_size))return!1;return!0},o.attributeChange=function(e){for(var t=0;t<o.attributes.length;t++)if(o.attributes[t].name===e){o.attribute=o.attributes[t],o.field=o.attribute.name;break}if(o.attribute.choices)return o.operators={eq:n.getString("Equal")},void(o.ngModel.operator="eq");"string"===o.attribute.type&&(o.operators=o.stringOperators),"integer"!==o.attribute.type&&"datetime"!==o.attribute.type||(o.operators=o.numberOperators)},o.$onInit=function(){o.ngModel?(o.editAttribute=o.ngModel.attribute,o.attributeChange(o.editAttribute)):o.editAttribute=null},o.showField=function(e){for(var t,n=!1,i=0;i<o.conditions.length;i++)if(o.conditions[i].attribute===e&&o.conditions[i].name===o.editAttribute){t=!0;break}for(i=0;i<o.modifiers.length;i++)if(o.modifiers[i].attribute===e){n=!0;break}return o.isCondition?!t&&!n:!t},o.addField=function(){if(document.activeElement.blur(),o.addFieldForm.$invalid||o.submitPending)return null;o.ngModel&&o.ngModel.price_is_percent&&o.priceRule&&o.priceRule.pricing&&o.priceRule.pricing.time_unit&&(o.ngModel.time_unit=o.priceRule.pricing.time_unit),o.validateCallback(o.ngModel).then(function(e){return t.hide(o.ngModel),e}).catch(function(e){if(e.data&&e.data.modifiers&&e.data.modifiers.length){var t={detail:"Error saving modifiers"};e.data.modifiers.map(function(e){i(e)||(t=e)}),o.backendErrors=t}else if(e.data&&e.data.conditions&&e.data.conditions.length){var n={detail:"Error saving filters"};e.data.modifiers.map(function(e){i(e)||(n=e)}),o.backendErrors=n}else e.data&&e.data.non_field_errors?o.backendErrors=e.data:o.backendErrors={detail:"Unable to save the rule. See the backend logs for details."};return e})}}angular.module("fleioStaff").controller("FlAddResourceFieldController",e),e.$inject=["$mdDialog","gettextCatalog"]}(),function(){"use strict";function e(e,t){return{PriceRules:e(t.api_url+"/openstack/billing/pricerule/:id/:action",{action:"@action",id:"@id"}),BillingPlans:e(t.api_url+"/openstack/billing/plan/:id",{id:"@id"}),Currencies:e(t.api_url+"/currency/:id",{id:"@id"})}}angular.module("fleioStaff").factory("FlOsBillingApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s,l,c){var u=this;function d(){return u.floatingIps.fetchData()}u.$onInit=function(){u.current_state=a.current.name,n.info.enabled=!0,n.info.label=i("Search floating IPs"),n.info.service=u.floatingIps,u.refreshTimer=e(d,1e4),u.refreshTimer.start(),t.init(u.refreshTimer.start.bind(u.refreshTimer),u.refreshTimer.stop.bind(u.refreshTimer)),u.TRANSLATED_STRINGS_MAP={delete:r.getString("Delete"),create:r.getString("Add floating IP"),no_permission:r.getString("You are not\nallowed to do this")}},u.addFloatingIp=function(t){l.FloatingIps.get({options:"create_options"}).$promise.then(function(e){return u.current_state!==a.current.name?e:(a.go(a.current,{dlg:"add"}),s.show({templateUrl:"staff/apps/floatingips/flfloatingipadd.html",controller:"FlFloatingIpAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{opts:e}}).then(d).finally(function(){a.go(a.current,{dlg:"false"})}).catch(function(){}))})},u.deleteFloatingIp=function(e){return o.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete floating IP {{ip_address}}",{name:e.floating_ip_address}),r.getString("Delete floating IP")).then(function(){return e.$delete().then(function(){c.add(r.getString("Floating IP delete scheduled")),d()}).catch(function(){c.add(r.getString("Could not delete floating IP"))})}).catch(function(){})},u.$onDestroy=function(){u.refreshTimer.teardown(),t.uninit()}}angular.module("fleioStaff").component("flFloatingIps",{templateUrl:"staff/apps/floatingips/flfloatingips.html",controller:e,bindings:{floatingIps:"="}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlSearchService","gettext","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlOsApi","FlNotificationService"]}(),function(){"use strict";function e(e,t,n,i,o,r,a){var s,l=this;function c(){n.FloatingIps.get({id:l.floatingIp.id}).$promise.then(function(e){l.floatingIp=e})}l.$onInit=function(){(s=t(c,2e4)).start(),e.init(s.start.bind(s),s.stop.bind(s)),l.TRANSLATED_STRINGS_MAP={delete:o.getString("Delete"),no_permission:o.getString("You are not\nallowed to do this")}},l.deleteFloatingIp=function(e){return i.yesNoDlg(o.getString("Are you sure?"),o.getString("Delete floating IP {{ip_address}}",{ip_address:e.floating_ip_address}),o.getString("Delete floating IP")).then(function(){return e.$delete().then(function(){return a.add(o.getString("Floating IP delete scheduled")),r.go("floatingIps")}).catch(function(){c()})}).catch(function(){})},l.$onDestroy=function(){s.teardown(),e.uninit()}}angular.module("fleioStaff").component("flFloatingIpDetails",{templateUrl:"staff/apps/floatingips/flfloatingipdetails.html",controller:e,bindings:{floatingIp:"<",permissions:"<"}}),e.$inject=["FlDetectIdleService","FlOsTimer","FlOsApi","FlUiUtilsService","gettextCatalog","$state","FlNotificationService"]}(),function(){"use strict";function e(t,e,n,i){var o=this;o.$onInit=function(){o.ip={network:o.opts.networks.length?o.opts.networks[0]:""}},o.searchClient=function(e){return i.get({search:e,filtering:"services__openstack_project__isnull:false"}).$promise.then(function(e){return e.objects})},o.selectedClientChange=function(e){void 0!==e?(o.ip.client=e.id,o.getNetworks()):o.opts.networks={}},o.getNetworks=function(){n.FloatingIps.get({options:"create_options",client_id:o.ip.client}).$promise.then(function(e){o.opts.networks=e.networks},function(e){o.opts.networks={}})},o.saveFloatingIp=function(){if(document.activeElement.blur(),!o.floatingIp.$invalid&&!o.submitPending)return o.submitPending=!0,n.FloatingIps.save(o.ip).$promise.then(function(e){return t.hide(e),e},function(e){return o.submitPending=!1,o.backendErrors=e.data})},o.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlFloatingIpAddController",e),e.$inject=["$mdDialog","gettext","FlOsApi","FlClientApi"]}(),function(){"use strict";function e(e,t,n){e.state("floatingIps",{url:t.joinBaseUrl("openstack/floatingips?page_size?orderin?filtering?search"),component:"flFloatingIps",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-status",squash:!0},filtering:{value:"",squash:!0}},data:{stateInfo:{display:n("Floating IPs"),parent:"dashboard"},feature:"openstack.floatingips",orderOptions:{floating_ip_address:n("IP address"),status:n("Status"),floating_network:n("Network")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},project__service__client:{display:n("Client"),field_name:"project__service__client",type:"client"},status:{display:n("Status"),field_name:"status",type:"choices",choices:[{display:"Active",value:"ACTIVE"},{display:"Down",value:"DOWN"}]}}},resolve:{floatingIps:["$stateParams","FlObjectList","FlOsApi",function(e,t,n){return t(n.FloatingIps,e)}]}}).state("floatingIpDetails",{url:t.joinBaseUrl("openstack/floatingips/:id"),component:"flFloatingIpDetails",authenticate:!0,resolve:{floatingIp:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.FloatingIps.get(e).$promise.then(function(e){return n.setParams({floating_ip_address:e.floating_ip_address}),e}).catch(i.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.FloatingIps.get({options:"permissions"}).$promise}]},data:{feature:"openstack.floatingips",stateInfo:{display:n("Floating IP {:floating_ip_address}"),parent:"floatingIps",default:n("Floating IP details")}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s,l,c){var u=this;function d(){return u.networks.fetchData()}u.$onInit=function(){u.current_state=a.current.name,n.info.enabled=!0,n.info.label=i("Search networks"),n.info.service=u.networks,u.refreshTimer=e(d,1e4,!0,[1e3,2e3]),u.refreshTimer.start(),t.init(u.refreshTimer.start.bind(u.refreshTimer),u.refreshTimer.stop.bind(u.refreshTimer)),u.TRANSLATED_STRINGS_MAP={delete:r.getString("Delete"),edit:r.getString("Edit network"),create:r.getString("Create network"),auto_create_network:r.getString("Get me a network"),save_auto_create_network_options:r.getString("Configure get me a network"),no_permission:r.getString("You are not\nallowed to do this")}},u.addSubnet=function(t,n){u.networks.loading=!0,l.Subnets.get({options:"create_options",network_id:n.id}).$promise.then(function(e){return u.networks.loading=!1,u.current_state!==a.current.name?e:(a.go(a.current,{dlg:"add"}),s.show({templateUrl:"staff/apps/networks/flnetworksubnetedit.html",controller:"FlNetworkSubnetEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{network:angular.copy(n),subnet_pools:angular.copy(e.pools),ipv6_modes:angular.copy(e.ipv6_modes)}}))}).catch(function(e){u.networks.loading=!1,e&&(u.backendErrors=e.data)})},u.editNetwork=function(t,n){l.Networks.get({options:"create_options"}).$promise.then(function(e){return u.current_state!==a.current.name?e:(a.go(a.current,{dlg:"add"}),s.show({templateUrl:"staff/apps/networks/flnetworkedit.html",controller:"FlNetworkEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{network:angular.copy(n),regions:e.regions,provider_types:e.provider_types,segmentation_id_range:e.segmentation_id_range,selected_region:e.selected_region}}).then(u.refreshTimer.boost.bind(u.refreshTimer)).finally(function(){a.go(a.current,{dlg:"false"})}).catch(function(){}))})},u.createNetwork=function(t,n){l.Networks.get({options:"create_options"}).$promise.then(function(e){return u.current_state!==a.current.name?e:(a.go(a.current,{dlg:"add"}),s.show({templateUrl:"staff/apps/networks/flnetworkadd.html",controller:"FlNetworkAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{network:angular.copy(n),regions:e.regions,provider_types:e.provider_types,segmentation_id_range:e.segmentation_id_range,selected_region:e.selected_region}}).then(u.refreshTimer.boost.bind(u.refreshTimer)).finally(function(){a.go(a.current,{dlg:"false"})}).catch(function(){}))})},u.getMeANetwork=function(t){l.Networks.get({options:"create_options"}).$promise.then(function(e){return a.go(a.current,{dlg:"add"}),s.show({templateUrl:"staff/apps/networks/flnetworkautocreate.html",controller:"FlNetworkAutoCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{regions:e.regions}}).then(d).finally(function(){a.go(a.current,{dlg:"false"})}).catch(function(){})})},u.deleteNetwork=function(e){return o.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete network {{name}}",{name:e.name}),r.getString("Delete network")).then(function(){return e.$delete().then(function(){c.add(r.getString("Network delete scheduled")),u.refreshTimer.boost()})}).catch(function(){})},u.$onDestroy=function(){u.refreshTimer.teardown(),t.uninit()}}angular.module("fleioStaff").component("flNetworks",{templateUrl:"staff/apps/networks/flnetworks.html",controller:e,bindings:{networks:"="}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlSearchService","gettext","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlOsApi","FlNotificationService"]}(),function(){"use strict";function e(o,t,n,r,a,i,e,s){var l=this;function c(){o.Networks.get({id:l.network.id}).$promise.then(function(e){l.network=e})}l.$onInit=function(){l.current_state=r.current.name,l.refreshTimer=s(c,1e4),l.refreshTimer.start(),e.init(l.refreshTimer.start.bind(l.refreshTimer),l.refreshTimer.stop.bind(l.refreshTimer)),l.TRANSLATED_STRINGS_MAP={delete:n.getString("Delete"),edit:n.getString("Edit network"),no_permission:n.getString("You are not\nallowed to do this")}},l.editNetwork=function(t,n){o.Networks.get({options:"create_options"}).$promise.then(function(e){return l.current_state!==r.current.name?e:(r.go(r.current,{dlg:"add"}),a.show({templateUrl:"staff/apps/networks/flnetworkedit.html",controller:"FlNetworkEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{network:angular.copy(n),regions:e.regions}}).then(c).finally(function(){r.go(r.current,{dlg:"false"})}).catch(function(){}))})},l.deleteNetwork=function(e){return t.yesNoDlg(n.getString("Are you sure?"),n.getString("Delete network {{name}}",{name:e.name}),n.getString("Delete network")).then(function(){return e.$delete().then(function(){return r.go("openstackNetworks")})}).catch(function(){})},l.addSubnet=function(t,n){l.loading=!0,o.Subnets.get({options:"create_options",network_id:n.id}).$promise.then(function(e){return l.loading=!1,l.current_state!==r.current.name?e:(r.go(r.current,{dlg:"add"}),a.show({templateUrl:"staff/apps/networks/flnetworksubnetedit.html",controller:"FlNetworkSubnetEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{network:angular.copy(n),subnet_pools:angular.copy(e.pools),ipv6_modes:angular.copy(e.ipv6_modes)}}).then(c))}).catch(function(e){l.loading=!1,e&&(l.backendErrors=e.data)})},l.editSubnet=function(t,n,i){l.loading=!0,o.Subnets.get({options:"create_options",network_id:n.id}).$promise.then(function(e){return l.loading=!1,l.current_state!==r.current.name?e:(r.go(r.current,{dlg:"add"}),a.show({templateUrl:"staff/apps/networks/flnetworksubnetedit.html",controller:"FlNetworkSubnetEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{subnet:angular.copy(i),network:angular.copy(n),subnet_pools:angular.copy(e.pools),ipv6_modes:angular.copy(e.ipv6_modes)}}).then(c))}).catch(function(e){l.loading=!1,e&&(l.backendErrors=e.data)})},l.deleteSubnet=function(e){return t.yesNoDlg(n.getString("Are you sure?"),n.getString("Delete subnet {{subnet}}",{subnet:e.name}),n.getString("Delete subnet")).then(function(){return o.Subnets.delete({id:e.id}).$promise.then(function(){i.add(n.getString("Subnet delete scheduled")),c()}).catch(function(){i.add(n.getString("Could not delete subnet"))})})},l.$onDestroy=function(){l.refreshTimer.teardown(),e.uninit()}}angular.module("fleioStaff").component("flNetworkDetails",{templateUrl:"staff/apps/networks/flnetworkdetails.html",controller:e,bindings:{network:"<",permissions:"<"}}),e.$inject=["FlOsApi","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlNotificationService","FlDetectIdleService","FlOsTimer"]}(),function(){"use strict";function e(t,e,n,i,o){var r=this;r.searchClient=function(e){return o.get({search:e}).$promise.then(function(e){return e.objects})},r.selectedClientChange=function(e){void 0!==e&&(r.network.client=e.id)},r.saveNetwork=function(){if(document.activeElement.blur(),!r.submitPending&&!r.network_form.$invalid){if(r.submitPending=!0,!r.network.id)return r.showProviderPhysical||(r.network.provider_physical_network=""),r.showProviderSegmentationID||(r.network.provider_segmentation_id=""),e.Networks.save(r.network).$promise.then(function(e){return t.hide(e),n.add(i.getString("Network create scheduled")),e},function(e){return r.submitPending=!1,r.backendErrors=e.data},function(e){r.submitPending=!1,r.backendErrors=e.data});e.Networks.update({id:r.network.id},r.network).$promise.then(function(e){return t.hide(e),n.add(i.getString("Network update scheduled")),e},function(e){r.submitPending=!1,r.backendErrors=e.data})}},r.updateProviderFields=function(){r.showProviderPhysical=r.provider_types[r.network.provider_network_type].require_physical_network,r.showProviderSegmentationID=r.provider_types[r.network.provider_network_type].require_segmentation_id,r.segmentation_id_range[r.network.provider_network_type]&&(r.minSegmentationID=r.segmentation_id_range[r.network.provider_network_type][0],r.maxSegmentationID=r.segmentation_id_range[r.network.provider_network_type][1])},r.close=function(){return t.cancel()},r.network||(r.network={region:r.selected_region,admin_state_up:!0,provider_network_type:r.provider_types?Object.keys(r.provider_types)[0]:""},r.updateProviderFields(),r.for_auto_create&&(r.network.router_external=!0))}angular.module("fleioStaff").controller("FlNetworkEditController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog","FlClientApi"]}(),function(){"use strict";function e(t,e,n,i,o){var r=this;r.searchClient=function(e){return o.get({search:e}).$promise.then(function(e){return e.objects})},r.selectedClientChange=function(e){void 0!==e&&(r.network.client=e.id)},r.saveNetwork=function(){if(document.activeElement.blur(),r.submitPending||r.network_form.$invalid)return;r.submitPending=!0,r.showProviderPhysical||(r.network.provider_physical_network="");r.showProviderSegmentationID||(r.network.provider_segmentation_id="");r.create_subnet&&(!1===r.setGatewayIp?delete r.subnet.gateway_ip:null===r.setGatewayIp&&(r.subnet.gateway_ip=null),r.network.subnet=r.subnet,"manually"==r.network_address_source?(delete r.subnet.subnetpool_id,delete r.subnet.prefixlen):(r.subnet.subnetpool_id=r.subnet_pool.id,r.subnet.cidr=""));return e.Networks.save(r.network).$promise.then(function(e){return t.hide(e),n.add(i.getString("Network create scheduled")),e},function(e){return r.submitPending=!1,r.backendErrors=e.data},function(e){r.submitPending=!1,r.backendErrors=e.data})},r.updateProviderFields=function(){r.showProviderPhysical=r.provider_types[r.network.provider_network_type].require_physical_network,r.showProviderSegmentationID=r.provider_types[r.network.provider_network_type].require_segmentation_id,r.segmentation_id_range[r.network.provider_network_type]&&(r.minSegmentationID=r.segmentation_id_range[r.network.provider_network_type][0],r.maxSegmentationID=r.segmentation_id_range[r.network.provider_network_type][1])},r.updateSubnetPools=function(){e.Networks.get({options:"get_subnet_pools",region:r.network.region}).$promise.then(function(e){r.subnet_pools=e,r.subnet_pools.pools.length&&(r.subnet_pool=r.subnet_pools.pools[0],r.changeSubnetpoolOptions(r.subnet_pool))},function(e){r.subnet_pools=[]})},r.close=function(){return t.cancel()},r.init=function(){r.setGatewayIp=null,r.network={region:r.selected_region,admin_state_up:!0,provider_network_type:r.provider_types?Object.keys(r.provider_types)[0]:""},r.updateProviderFields(),r.for_auto_create&&(r.network.router_external=!0);r.subnet={allocation_pools:[{start:"",end:""}],dns_nameservers:[{ip:""}],host_routes:[{destination:"",nexthop:""}],enable_dhcp:!0,ipv6_ra_mode:null,ipv6_address_mode:null},r.ipv6_modes=["slaac","dhcpv6-stateful","dhcpv6-stateless"],r.updateSubnetPools()},r.addAllocationPool=function(){r.subnet.allocation_pools.push({start:"",end:""})},r.removeAllocationPool=function(e){1<r.subnet.allocation_pools.length&&r.subnet.allocation_pools.splice(e,1)},r.addDnsNameServer=function(){r.subnet.dns_nameservers.push({ip:""})},r.removeDnsNameServer=function(e){1<r.subnet.dns_nameservers.length&&r.subnet.dns_nameservers.splice(e,1)},r.addHostRoute=function(){r.subnet.host_routes.push({destination:"",nexthop:""})},r.removeHostRoute=function(e){1<r.subnet.host_routes.length&&r.subnet.host_routes.splice(e,1)},r.changeIPVersion=function(){4==r.subnet.ip_version&&(r.subnet.ipv6_ra_mode=null,r.subnet.ipv6_address_mode=null)},r.changeSubnetpoolOptions=function(e){e&&(r.subnet.prefixlen=~~e.default_prefixlen,r.subnet.ip_version=~~e.ip_version)},r.nextPage=function(){"network"==r.activeTab?r.network.client&&r.network.name?(r.network_form.$setPristine(),r.network_form.$setUntouched(),r.activeTab="subnet"):r.network_form.$setSubmitted(!0):"subnet"==r.activeTab&&(r.subnet.name&&r.subnet.cidr?(r.network_form.$setPristine(),r.network_form.$setUntouched(),r.activeTab="subnetDetails"):r.network_form.$setSubmitted(!0))},r.init()}angular.module("fleioStaff").controller("FlNetworkAddController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog","FlClientApi"]}(),function(){"use strict";function e(e,t,n){e.state("openstackNetworks",{url:t.joinBaseUrl("openstack/networks?page_size?ordering?search?filtering"),component:"flNetworks",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-name",squash:!0},filtering:{value:"",squash:!0,dynamic:!0}},data:{stateInfo:{display:n("Networks"),parent:"dashboard"},feature:"openstack.networks",orderOptions:{name:n("Name"),created_at:n("Created at"),region:n("Region")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},region:{display:n("Region"),field_name:"region",type:"choices",choices:[]},is_default:{display:n("Is default"),field_name:"is_default",type:"bool"},shared:{display:n("Shared"),field_name:"shared",type:"bool"}}},resolve:{networks:["$state","$stateParams","FlObjectList","FlOsApi",function(r,e,t,n){return n.Networks.get({options:"create_options"}).$promise.then(function(e){for(var t=e.regions,n=[],i=0,o=t.length;i<o;++i)n.push({display:t[i].id,value:t[i].id});r.get("openstackNetworks").data.filtering.region.choices=n}),t(n.Networks,e)}]}}).state("networkAutoCreateConfigure",{url:t.joinBaseUrl("openstack/networks/autoCreateConfigure"),component:"flNetworkAutoCreateConfigure",authenticate:!0,data:{stateInfo:{display:n("Configure get me a network"),parent:"openstackNetworks"},feature:"openstack.networks"},resolve:{regions:["FlRegionApi","FlObjectList",function(e,t){return t(e,{})}]}}).state("networkDetails",{url:t.joinBaseUrl("openstack/networks/:id"),component:"flNetworkDetails",authenticate:!0,resolve:{network:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.Networks.get(e).$promise.then(function(e){return n.setParams({network:e.name}),e}).catch(i.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.Networks.get({options:"permissions"}).$promise}]},data:{feature:"openstack.networks",stateInfo:{display:n("Network {:network}"),parent:"openstackNetworks",default:n("Network details")}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,i,o){var r=this;r.$onInit=function(){r.network||(r.network={region:r.regions.length?r.regions[0].id:"",admin_state_up:!0})},r.searchClient=function(e){return o.get({search:e}).$promise.then(function(e){return e.objects})},r.selectedClientChange=function(e){void 0!==e&&(r.network.client=e.id)},r.saveNetwork=function(){if(document.activeElement.blur(),!r.network_form.$invalid)return t.Networks.save({options:"auto_create_network"},r.network).$promise.then(function(e){n.add(i.getString("Auto creating network finished"))}),n.add(i.getString("Auto creating network...")),e.hide()},r.close=function(){return e.cancel()}}angular.module("fleioStaff").controller("FlNetworkAutoCreateController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog","FlClientApi"]}(),function(){"use strict";function e(i,o,r){var a=this;a.$onInit=function(){a.current_state=i.current.name,a.region=a.regions.objects.length?a.regions.objects[0].id:"",a.config={},a.getConfigOptions(a.region)},a.getConfigOptions=function(e){a.submitPending=!0,r.Networks.get({options:"config_auto_create_network_options",region:e}).$promise.then(function(e){a.networks=e.options.networks,a.ipv4_subnetpools=e.options.ipv4_subnetpools,a.ipv6_subnetpools=e.options.ipv6_subnetpools,a.parseCurrentConfigMessage(e.options.config),a.submitPending=!1},function(e){a.backendErrors=e.data,a.submitPending=!1})},a.parseCurrentConfigMessage=function(e){a.currentConfig="Current config:",a.currentConfig+="<ul>",e.network?(a.currentConfig+='<li class="fl-margin-left"><strong>Network: </strong>'+e.network.name,a.config.network=e.network.id):a.currentConfig+='<li class="fl-message fl-margin-left">A default external network is needed',e.ipv4_subnetpool||e.ipv6_subnetpool||(a.currentConfig+='<li class="fl-message fl-margin-left">At least one default shared subnet pool is needed'),e.ipv4_subnetpool&&(a.currentConfig+='<li class="fl-margin-left"><strong>IPv4 subnet pool: </strong>'+e.ipv4_subnetpool.name,a.config.ipv4_subnetpool=e.ipv4_subnetpool.id),e.ipv6_subnetpool&&(a.currentConfig+='<li class="fl-margin-left"><strong>IPv6 subnet pool: </strong>'+e.ipv6_subnetpool.name,a.config.ipv6_subnetpool=e.ipv6_subnetpool.id),a.currentConfig+="</ul>"},a.configSubmit=function(){a.submitPending=!0,r.Networks.save({options:"save_auto_create_network_options"},{region:a.region,network_id:a.config.network,ipv4_subnetpool:a.config.ipv4_subnetpool,ipv6_subnetpool:a.config.ipv6_subnetpool}).$promise.then(function(e){a.networks=e.options.networks,a.ipv4_subnetpools=e.options.ipv4_subnetpools,a.ipv6_subnetpools=e.options.ipv6_subnetpools,a.parseCurrentConfigMessage(e.options.config),a.submitPending=!1},function(e){a.backendErrors=e.data,a.submitPending=!1})},a.addSubnetPool=function(t,e){r.SubnetPools.get({options:"create_options"}).$promise.then(function(e){return a.current_state!==i.current.name?e:(i.go(i.current,{dlg:"add"}),o.show({templateUrl:"staff/apps/subnetpools/edit/flsubnetpooledit.html",controller:"FlSubnetPoolEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{createOptions:e,for_auto_create:!0}}).then(function(e){if(e)return 4==e.ip_version?(a.ipv4_subnetpools.push({id:e.id,name:e.name}),a.config.ipv4_subnetpool=e.id):(a.ipv6_subnetpools.push({id:e.id,name:e.name}),a.config.ipv6_subnetpool=e.id)}).finally(function(){i.go(i.current,{dlg:"false"})}).catch(function(){}))})},a.addNetwork=function(t,n){r.Networks.get({options:"create_options"}).$promise.then(function(e){return a.current_state!==i.current.name?e:(i.go(i.current,{dlg:"add"}),o.show({templateUrl:"staff/apps/networks/flnetworkedit.html",controller:"FlNetworkEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{network:angular.copy(n),regions:e.regions,for_auto_create:!0,provider_types:e.provider_types,segmentation_id_range:e.segmentation_id_range,selected_region:a.region}}).then(function(e){return a.networks.push({id:e.id,name:e.name}),a.config.network=e.id}).finally(function(){i.go(i.current,{dlg:"false"})}).catch(function(){}))})}}angular.module("fleioStaff").component("flNetworkAutoCreateConfigure",{templateUrl:"staff/apps/networks/flnetworkautocreateconfigure.html",controller:e,bindings:{regions:"="}}),e.$inject=["$state","$mdDialog","FlOsApi"]}(),function(){"use strict";function e(t,e,n,i){var o=this;o.$onInit=function(){if(o.subnet){var e,t=JSON.parse(o.subnet.extra.replace(/'/g,'"').replace(/None/g,"null"));if(o.subnet.allocation_pools?o.subnet.allocation_pools=JSON.parse(o.subnet.allocation_pools.replace(/'/g,'"')):o.subnet.allocation_pools=[],t.dns_nameservers){var n=[];for(e=0;e<t.dns_nameservers.length;e++)n.push({ip:t.dns_nameservers[e]});o.subnet.dns_nameservers=n}else o.subnet.dns_nameservers=[];if(t.host_routes){var i=[];for(e=0;e<t.host_routes.length;e++)i.push({destination:t.host_routes[e].destination,nexthop:t.host_routes[e].nexthop});o.subnet.host_routes=i}else o.subnet.host_routes=[];o.isNew=!1}else o.subnet={allocation_pools:[{start:"",end:""}],dns_nameservers:[{ip:""}],host_routes:[{destination:"",nexthop:""}],enable_dhcp:!0,ipv6_ra_mode:null,ipv6_address_mode:null},o.isNew=!0,o.setGatewayIp=null},o.addAllocationPool=function(){o.subnet.allocation_pools.push({start:"",end:""})},o.removeAllocationPool=function(e){o.subnet.allocation_pools.splice(e,1)},o.addDnsNameServer=function(){o.subnet.dns_nameservers.push({ip:""})},o.removeDnsNameServer=function(e){o.subnet.dns_nameservers.splice(e,1)},o.addHostRoute=function(){o.subnet.host_routes.push({destination:"",nexthop:""})},o.removeHostRoute=function(e){o.subnet.host_routes.splice(e,1)},o.changeIPVersion=function(){4===o.subnet.ip_version&&(o.subnet.ipv6_ra_mode=null,o.subnet.ipv6_address_mode=null)},o.changeSubnetpoolOptions=function(e){o.subnet.prefixlen=~~e.default_prefixlen,o.subnet.ip_version=~~e.ip_version},o.saveSubnet=function(){if(document.activeElement.blur(),!o.submitPending&&!o.subnet_form.$invalid)return o.submitPending=!0,o.subnet.network_id=o.network.id,void 0!==o.subnet_pool&&(o.subnet.subnetpool_id=o.subnet_pool.id,o.subnet.cidr=""),o.isNew?(!1===o.setGatewayIp?delete o.subnet.gateway_ip:null===o.setGatewayIp&&(o.subnet.gateway_ip=null),e.Subnets.save(o.subnet).$promise.then(function(e){return o.submitPending=!1,t.hide(e),n.add(i.getString("Add subnet scheduled")),e},function(e){return o.submitPending=!1,o.backendErrors=e.data})):e.Subnets.update(o.subnet.id,o.subnet).$promise.then(function(e){return o.submitPending=!1,t.hide(e),n.add(i.getString("Update subnet scheduled")),e},function(e){return o.submitPending=!1,o.backendErrors=e.data})},o.nextPage=function(){o.submitPending||o.subnet_form.$invalid||(o.activeTab="subnetDetails")},o.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlNetworkSubnetEditController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,i,o,r,a){var s,l=this;function c(){return l.subnetpools.fetchData().then(l.convertPrefixesToString)}l.$onInit=function(){n.info.enabled=!0,n.info.label=i("Search subnetpools"),n.info.service=l.subnetpools,(s=e(c,1e4)).start(),l.convertPrefixesToString(),t.init(s.start.bind(s),s.stop.bind(s)),l.TRANSLATED_STRINGS_MAP={delete:r.getString("Delete"),edit:r.getString("Edit subnet pool"),create:r.getString("Add subnet pool"),no_permission:r.getString("You are not\nallowed to do this")}},l.convertPrefixesToString=function(){for(var e=0;e<l.subnetpools.objects.length;e++){var t=l.subnetpools.objects[e].prefixes;l.subnetpools.objects[e].prefixes="";for(var n=0;n<t.length;n++)n===t.length-1?l.subnetpools.objects[e].prefixes+=t[n]:l.subnetpools.objects[e].prefixes+=t[n]+", "}},l.deleteSubnetPool=function(e){return o.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete subnetpool {{name}}",{name:e.name}),r.getString("Delete subnetpool")).then(function(){return e.$delete().then(function(){return a.add(r.getString("Subnet pool delete scheduled")),c()},function(e){return a.add(r.getString("Could not delete subnetpool")),e})}).catch(function(){})},l.$onDestroy=function(){s.teardown(),t.uninit()}}angular.module("fleioStaff").component("flSubnetPools",{templateUrl:"staff/apps/subnetpools/flsubnetpools.html",controller:e,bindings:{subnetpools:"="}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlSearchService","gettext","FlUiUtilsService","gettextCatalog","FlNotificationService"]}(),function(){"use strict";function e(e,t,n,i,o,r,a){var s,l=this,c=i.current.name;function u(){e.SubnetPools.get({id:l.subnetpool.id}).$promise.then(function(e){l.subnetpool=e})}l.$onInit=function(){(s=a(u,1e4)).start(),r.init(s.start.bind(s),s.stop.bind(s)),l.TRANSLATED_STRINGS_MAP={delete:n.getString("Delete"),edit:n.getString("Edit subnet pool"),no_permission:n.getString("You are not\nallowed to do this")}},l.editSubnetPool=function(t,n){e.SubnetPools.get({options:"create_options"}).$promise.then(function(e){return c!==i.current.name?e:(i.go(i.current,{dlg:"add"}),o.show({templateUrl:"staff/apps/subnetpools/flsubnetpooledit.html",controller:"FlSubnetPoolEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{subnetpool:angular.copy(n),regions:e.regions}}).then(u).finally(function(){i.go(i.current,{dlg:"false"})}).catch(function(){}))})},l.deleteSubnetPool=function(e){return t.yesNoDlg(n.getString("Are you sure?"),n.getString("Delete subnetpool {{name}}",{name:e.name}),n.getString("Delete subnetpool")).then(function(){return e.$delete().then(function(){return i.go("openstackSubnetpools")})}).catch(function(){})},l.$onDestroy=function(){s.teardown(),r.uninit()}}angular.module("fleioStaff").component("flSubnetPoolDetails",{templateUrl:"staff/apps/subnetpools/flsubnetpooldetails.html",controller:e,bindings:{subnetpool:"<",permissions:"<"}}),e.$inject=["FlOsApi","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlDetectIdleService","FlOsTimer"]}(),function(){"use strict";function e(e,t,n){e.state("openstackSubnetpools",{url:t.joinBaseUrl("openstack/subnetpools?page_size?ordering?filtering?search"),component:"flSubnetPools",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"name",squash:!0},filtering:{value:"",squash:!0}},data:{stateInfo:{display:n("Subnet pools"),parent:"dashboard"},feature:"openstack.subnetpools",orderOptions:{name:n("Name"),created_at:n("Created at"),region:n("Region"),prefixes:n("Prefixes")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},is_default:{display:n("Is default"),field_name:"is_default",type:"bool"},shared:{display:n("Shared"),field_name:"shared",type:"bool"},min_prefixlen:{display:n("Min prefix length"),field_name:"min_prefixlen",type:"decimal"},max_prefixlen:{display:n("Max prefix length"),field_name:"max_prefixlen",type:"decimal"}}},resolve:{subnetpools:["$stateParams","FlObjectList","FlOsApi",function(e,t,n){return t(n.SubnetPools,e)}]}}).state("subnetpoolCreate",{url:t.joinBaseUrl("openstack/subnetpools/create"),component:"flSubnetPoolEdit",authenticate:!0,resolve:{createOptions:["FlOsApi",function(e){return e.SubnetPools.get({options:"create_options"}).$promise}]},data:{feature:"openstack.subnetpools",stateInfo:{display:n("Create subnet pool"),parent:"openstackSubnetpools"}}}).state("subnetpoolUpdate",{url:t.joinBaseUrl("openstack/subnetpools/:id/edit"),component:"flSubnetPoolEdit",authenticate:!0,resolve:{createOptions:["FlOsApi",function(e){return e.SubnetPools.get({action:"create_options"}).$promise}],subnetpool:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.SubnetPools.get(e).$promise.then(function(e){return n.setParams({name:e.name}),e}).catch(i.handleError)}]},data:{feature:"openstack.subnetpools",stateInfo:{display:n("Edit subnet pool {:name}"),default:n("Edit subnet pool"),parent:"openstackSubnetpools"}}}).state("subnetpoolDetails",{url:t.joinBaseUrl("openstack/subnetpools/:id"),component:"flSubnetPoolDetails",authenticate:!0,resolve:{subnetpool:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.SubnetPools.get(e).$promise.then(function(e){return n.setParams({subnetpool:e.name}),e}).catch(i.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.SubnetPools.get({options:"permissions"}).$promise}]},data:{feature:"openstack.subnetpools",stateInfo:{display:n("Subnet pool {:subnetpool}"),parent:"openstackSubnetpools",default:n("Subnet pool details")}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(t,n,i,o,r,a){var s=this;s.$onInit=function(){s.subnetpool?s.convert_prefixes_to_dict():(s.subnetpool={region:s.createOptions.selected_region,prefixes:[{text:""}]},s.for_auto_create&&(s.subnetpool.shared=!0))},s.goBackOrToState=function(e,t){s.for_auto_create?a.hide(t):r.goBackOrToState(e)},s.convert_prefixes_to_dict=function(){var e=s.subnetpool.prefixes.slice();s.subnetpool.prefixes=[];for(var t=0;t<e.length;t++)s.subnetpool.prefixes.push({text:e[t]})},s.searchProject=function(e){return o.get({search:e}).$promise.then(function(e){return e.objects})},s.selectedProjectChange=function(e){void 0!==e&&(s.subnetpool.project_id=e.project_id)},s.addPrefix=function(){s.subnetpool.prefixes.push({text:""})},s.removePrefix=function(e){1<s.subnetpool.prefixes.length&&s.subnetpool.prefixes.splice(e,1)},s.saveSubnetPool=function(){if(document.activeElement.blur(),!s.submitPending&&!s.subnetpool_form.$invalid){s.submitPending=!0;for(var e=0;e<s.subnetpool.prefixes.length;e++)s.subnetpool.prefixes[e]=s.subnetpool.prefixes[e].text;return s.subnetpool.id?t.SubnetPools.update({id:s.subnetpool.id},s.subnetpool).$promise.then(function(e){return n.add(i.getString("SubnetPool update scheduled")),s.goBackOrToState("openstackSubnetpools"),e},function(e){return s.submitPending=!1,s.convert_prefixes_to_dict(),s.backendErrors=e.data}):t.SubnetPools.save(s.subnetpool).$promise.then(function(e){return n.add(i.getString("SubnetPool create scheduled")),s.goBackOrToState("openstackSubnetpools",e),e},function(e){return s.submitPending=!1,s.convert_prefixes_to_dict(),s.backendErrors=e.data})}}}angular.module("fleioStaff").component("flSubnetPoolEdit",{templateUrl:"staff/apps/subnetpools/edit/flsubnetpooledit.html",controller:e,bindings:{createOptions:"<",subnetpool:"="}}),angular.module("fleioStaff").controller("FlSubnetPoolEditController",e),e.$inject=["FlOsApi","FlNotificationService","gettextCatalog","FlProjectsApi","FlUiUtilsService","$mdDialog"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s,l,c){var u,d=this,p=a.current.name;function f(){return d.routers.fetchData()}d.editRouter=function(t,n){l.Routers.get({options:"create_options"}).$promise.then(function(e){return p!==a.current.name?e:(a.go(a.current,{dlg:"add"}),s.show({templateUrl:"staff/apps/osrouters/flrouteredit.html",controller:"FlRouterEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{router:angular.copy(n),regions:e.regions,external_networks:e.external_networks,selected_region:e.selected_region}}).then(function(){u.boost()}).finally(function(){a.go(a.current,{dlg:"false"})}).catch(function(){}))})},d.deleteRouter=function(e){return o.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete router {{name}}",{name:e.name}),r.getString("Delete router")).then(function(){return e.$delete().then(function(){c.add(r.getString("Router delete scheduled")),u.boost()}).catch(function(){c.add(r.getString("Could not delete router"))})}).catch(function(){})},d.addInterface=function(t,n){d.loading=!0,l.Routers.get({id:n.id,options:"create_add_interface_options"}).$promise.then(function(e){return d.loading=!1,p!==a.current.name?e:(a.go(a.current,{dlg:"add"}),s.show({templateUrl:"staff/apps/osrouters/flinterfaceadd.html",controller:"FlInterfaceAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{router:angular.copy(n),subnets:angular.copy(e.subnets)}}).then(function(){u.boost()}))}).catch(function(e){d.loading=!1,e&&(d.backendErrors=e.data)})},d.$onInit=function(){n.info.enabled=!0,n.info.label=i("Search routers"),n.info.service=d.routers,(u=e(f,1e4,!0,[1e3,2e3])).start(),t.init(u.start.bind(u),u.stop.bind(u)),d.TRANSLATED_STRINGS_MAP={delete:r.getString("Delete"),edit:r.getString("Edit router"),create:r.getString("Add router"),add_interface:r.getString("Add interface"),no_permission:r.getString("You are not\nallowed to do this")}},d.$onDestroy=function(){u.teardown(),t.uninit()}}angular.module("fleioStaff").component("flRouters",{templateUrl:"staff/apps/osrouters/flrouters.html",controller:e,bindings:{routers:"="}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlSearchService","gettext","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlOsApi","FlNotificationService"]}(),function(){"use strict";function e(i,n,o,r,a,e,t,s,l){var c,u=this,d=r.current.name;function p(){i.Routers.get({id:u.router.id}).$promise.then(function(e){u.router=e})}u.$onInit=function(){(c=t(p,1e4)).start(),e.init(c.start.bind(c),c.stop.bind(c)),u.TRANSLATED_STRINGS_MAP={delete:o.getString("Delete"),edit:o.getString("Edit router"),remove_interface:o.getString("Remove interface"),add_interface:o.getString("Add interface"),no_permission:o.getString("You are not\nallowed to do this")}},u.editRouter=function(t,n){i.Routers.get({options:"create_options"}).$promise.then(function(e){return d!==r.current.name?e:(r.go(r.current,{dlg:"add"}),a.show({templateUrl:"staff/apps/osrouters/flrouteredit.html",controller:"FlRouterEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{router:angular.copy(n),regions:e.regions,external_networks:e.external_networks,selected_region:e.selected_region}}).then(function(e){p()}).finally(function(){r.go(r.current,{dlg:"false"})}).catch(function(){}))})},u.deleteRouter=function(e){return n.yesNoDlg(o.getString("Are you sure?"),o.getString("Delete router {{name}}",{name:e.name}),o.getString("Delete router")).then(function(){return e.$delete().then(function(){return r.go("openstackRouters")})}).catch(function(){})},u.deleteInterface=function(e,t){return n.yesNoDlg(o.getString("Are you sure?"),o.getString("Delete interface")).then(function(){return i.Routers.save({id:e,interface_id:t,options:"remove_interface"}).$promise.then(function(){l.add(o.getString("Interface delete scheduled")),c.boost()},function(){l.add(o.getString("Could not delete interface"))})}).catch(function(){})},u.addInterface=function(t,n){u.loading=!0,i.Routers.get({id:n.id,options:"create_add_interface_options"}).$promise.then(function(e){return u.loading=!1,d!==r.current.name?e:(r.go(r.current,{dlg:"add"}),a.show({templateUrl:"staff/apps/osrouters/flinterfaceadd.html",controller:"FlInterfaceAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{router:angular.copy(n),subnets:angular.copy(e.subnets)}}).then(function(){c.boost()}).catch(function(){}))},function(e){return u.loading=!1,u.backendErrors=e.data})},u.$onDestroy=function(){c.teardown(),e.uninit()}}angular.module("fleioStaff").component("flRouterDetails",{templateUrl:"staff/apps/osrouters/flrouterdetails.html",controller:e,bindings:{router:"<",permissions:"<"}}),e.$inject=["FlOsApi","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlDetectIdleService","FlOsTimer","$scope","FlNotificationService"]}(),function(){"use strict";function e(t,e,n,i,o){var r=this;r.saveRouter=function(){if(document.activeElement.blur(),r.submitPending||r.router_form.$invalid)return;{if(r.submitPending=!0,!r.router.id)return e.Routers.save(r.router).$promise.then(function(e){return t.hide(e),n.add(i.getString("Router create scheduled")),e},function(e){return r.submitPending=!1,r.backendErrors=e.data},function(e){r.submitPending=!1,r.backendErrors=e.data});e.Routers.update({id:r.router.id},r.router).$promise.then(function(e){return t.hide(e),n.add(i.getString("Router update scheduled")),e},function(e){r.submitPending=!1,r.backendErrors=e.data})}},r.changeNetworks=function(e){r.filtered_external_networks=[];for(var t=0;t<r.external_networks.length;t++)r.external_networks[t].region==r.router.region&&r.filtered_external_networks.push(r.external_networks[t])},r.close=function(){return t.cancel()},r.searchClient=function(e){return o.get({search:e}).$promise.then(function(e){return e.objects})},r.selectedClientChange=function(e){void 0!==e&&(r.router.client=e.id)},r.router||(r.router={region:r.selected_region,admin_state_up:!0},r.changeNetworks(r.router.region))}angular.module("fleioStaff").controller("FlRouterEditController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog","FlClientApi"]}(),function(){"use strict";function e(t,e,n,i,o,r){var a=this;a.$onInit=function(){a.router=o,a.subnets=r,a.router_interface={subnet:r[0].id}},a.$onInit(),a.saveInterface=function(){if(document.activeElement.blur(),!a.submitPending&&!a.interface_form.$invalid)return a.submitPending=!0,e.Routers.save({id:a.router.id,options:"add_interface"},a.router_interface).$promise.then(function(e){return a.submitPending=!1,t.hide(e),n.add(i.getString("Add interface scheduled")),e},function(e){return a.submitPending=!1,a.backendErrors=e.data})},a.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlInterfaceAddController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog","router","subnets"]}(),function(){"use strict";function e(e,t,n){e.state("openstackRouters",{url:t.joinBaseUrl("openstack/routers?page_size?ordering?filtering?search"),component:"flRouters",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-name",squash:!0},filtering:{value:"",squash:!0}},data:{stateInfo:{display:n("Routers"),parent:"dashboard"},feature:"openstack.routers",orderOptions:{name:n("Name"),admin_state_up:n("Admin state"),region__id:n("Region")},filtering:{status:{display:n("Status"),field_name:"status",type:"choices",choices:[{display:"Active",value:"ACTIVE"},{display:"Down",value:"DOWN"},{display:"Build",value:"BUILD"},{display:"Error",value:"ERROR"}]},admin_state_up:{display:n("Admin state up"),field_name:"admin_state_up",type:"bool"},region:{display:n("Region"),field_name:"region",type:"choices",choices:[]},distributed:{display:n("Distributed"),field_name:"distributed",type:"bool"},enable_snat:{display:n("Enable snat"),field_name:"enable_snat",type:"bool"}}},resolve:{routers:["$state","$stateParams","FlObjectList","FlOsApi",function(r,e,t,n){return n.Routers.get({options:"create_options"}).$promise.then(function(e){for(var t=e.regions,n=[],i=0,o=t.length;i<o;++i)n.push({display:t[i].id,value:t[i].id});r.get("openstackRouters").data.filtering.region.choices=n}),t(n.Routers,e)}]}}).state("routerDetails",{url:t.joinBaseUrl("openstack/routers/:id"),component:"flRouterDetails",authenticate:!0,resolve:{router:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.Routers.get(e).$promise.then(function(e){return n.setParams({router:e.name}),e}).catch(i.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.Routers.get({options:"permissions"}).$promise}]},data:{feature:"openstack.routers",stateInfo:{display:n("Router {:router}"),parent:"openstackRouters",default:n("Router details")}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n){e.state("zones",{url:t.joinBaseUrl("openstack/zones?page_size?ordering?search?filtering"),component:"flZones",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{zones:["$state","$transition$","FlObjectList","FlOsApi",function(e,t,n,i){return n(i.Dns,t.params())}],permissions:["$state","$transition$","FlObjectList","FlOsApi",function(e,t,n,i){return i.Dns.get({actions:"permissions"}).$promise}]},data:{stateInfo:{display:n("Zones"),parent:"dashboard"},feature:"openstack.dns.zones",orderOptions:{name:n("Name"),serial:n("Serial Number"),status:n("Status"),created_at:n("Created at"),updated_at:n("Updated at")},filtering:{client:{display:n("Client"),field_name:"client",type:"client",allow_many:!1,allow_null:!1}}}}).state("zoneDetails",{url:t.joinBaseUrl("openstack/zones/:id"),component:"flZoneDetails",authenticate:!0,resolve:{zone:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.Dns.get(e).$promise.then(function(e){return n.setParams({zone:e.name}),e}).catch(i.handleError)}],permissions:["$state","$transition$","FlObjectList","FlOsApi",function(e,t,n,i){return i.Dns.get({actions:"permissions"}).$promise}]},data:{feature:"openstack.dns.zones",stateInfo:{display:n("Zone {:zone}"),parent:"zones",default:n("Zone details")}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s,l){var c,u=this,d=o.current.name;function p(){return u.zones.fetchData()}u.$onInit=function(){l.info.enabled=!0,l.info.label=i.getString("Search zones"),l.info.service=u.zones,(c=e(p,3e4,!0,[5e3,1e4])).start(),t.init(function(){return c.start()},function(){return c.stop()}),u.TRANSLATED_STRINGS_MAP={delete:i.getString("Delete"),edit:i.getString("Edit zone"),create:i.getString("Create zone"),no_permission:i.getString("You are not\nallowed to do this")}},u.editZone=function(t,n){a.Dns.get({actions:"create_options"}).$promise.then(function(e){return d!==o.current.name?e:(o.go(o.current,{dlg:"add"}),r.show({templateUrl:"staff/apps/oszones/flzoneedit.html",controller:"FlZoneEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{zone:angular.copy(n),regions:e.regions,selected_region:e.selected_region,types:e.types}}).then(function(){c.boost()}).finally(function(){o.go(o.current,{dlg:"false"})}).catch(function(){}))})},u.deleteZone=function(e){return n.yesNoDlg(i.getString("Are you sure?"),i.getString("Delete zone {{name}}",{name:e.name}),i.getString("Delete zone")).then(function(){return e.$delete().then(function(){s.add(i.getString("Zone delete scheduled")),c.boost()}).catch(function(){s.add(i.getString("Could not delete zone"))})}).catch(function(){})},u.$onDestroy=function(){c.teardown(),t.uninit()}}angular.module("fleioStaff").component("flZones",{templateUrl:"staff/apps/oszones/flzones.html",controller:e,bindings:{zones:"<",permissions:"<"}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlOsApi","FlNotificationService","FlSearchService"]}(),function(){"use strict";function e(t,n,i,o,r){var a=this;function e(){var e=a.zone.masters.slice();a.zone.masters=[];for(var t=0;t<e.length;t++)a.zone.masters.push({text:e[t]})}function s(e){return r.get({search:e}).$promise.then(function(e){return e.objects})}function l(e){void 0!==e&&(a.zone.client=e.id)}function c(){a.zone.masters.push({text:""})}function u(e){1<a.zone.masters.length&&a.zone.masters.splice(e,1)}function d(){if(document.activeElement.blur(),!a.submitPending&&!a.zone_form.$invalid){a.submitPending=!0;for(var e=0;e<a.zone.masters.length;e++)a.zone.masters[e]=a.zone.masters[e].text;if(!a.zone.id)return n.Dns.save(a.zone).$promise.then(function(e){return t.hide(e),i.add(o.getString("Zone create scheduled")),e},function(e){return a.submitPending=!1,a.backendErrors=e.data},function(e){a.submitPending=!1,a.convert_masters_to_dict(),a.backendErrors=e.data});n.Dns.update({id:a.zone.id},a.zone).$promise.then(function(e){return t.hide(e),i.add(o.getString("Zone update scheduled")),e},function(e){a.submitPending=!1,a.convert_masters_to_dict(),a.backendErrors=e.data})}}function p(){return t.cancel()}a.$onInit=function(){a.saveZone=d,a.close=p,a.searchClient=s,a.selectedClientChange=l,a.addMaster=c,a.removeMaster=u,a.convert_masters_to_dict=e,a.zone?a.convert_masters_to_dict():(a.forClient=!0,a.zone={region:a.selected_region,type_:a.types.length?a.types[0][0]:"",masters:[]})},a.changeDestinationProject=function(){a.forClient||(a.zone.client=null)}}angular.module("fleioStaff").controller("FlZoneEditController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog","FlClientApi"]}(),function(){"use strict";function e(t,n,i,o,r,e,a,s,l){var c,u=this;function d(e){u.loadingDetails=!0,t.Dns.get({id:e,actions:"list_records"}).$promise.then(function(e){return u.recordsets=e,function(){for(var e=0;e<u.recordsets.recordsets.length;e++)for(var t=u.recordsets.recordsets[e],n=0;n<t.records.length;n++){var i,o=t.records[n].split(" ");i="MX"==t.type?{priority:o[0],server:o[1]}:"SSHFP"==t.type?{algorithm:o[0],type:o[1],fingerprint:o[2]}:"SRV"==t.type?{priority:o[0],weight:o[1],port:o[2],hostname:o[3]}:{text:t.records[n]},t.records[n]=i}}(),e}).catch(function(e){e&&e.data&&e.data.detail?l.add(e.data.detail):l.add("Error loading zone records")}).finally(function(){u.loadingDetails=!1})}function p(){t.Dns.get({id:u.zone.id}).$promise.then(function(e){u.zone=e})}function f(e){return"MX"==e.type?{priority:"",server:""}:"SSHFP"==e.type?{algorithm:"",type:"",fingerprint:""}:"SRV"==e.type?{priority:"",weight:"",port:"",hostname:""}:{text:""}}u.editZone=function(e,t){return r.show({templateUrl:"staff/apps/oszones/flzoneedit.html",controller:"FlZoneEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:e,bindToController:!0,locals:{zone:angular.copy(t)}}).then(function(e){p()}).finally(function(){o.go(o.current,{dlg:"false"})}).catch(function(){})},u.deleteZone=function(e){return n.yesNoDlg(i.getString("Are you sure?"),i.getString("Delete zone {{name}}",{name:e.name}),i.getString("Delete zone")).then(function(){return e.$delete().then(function(){return o.go("zones")})}).catch(function(){})},u.syncronizeRecords=function(){if(!u.hasRecordSets())return;u.recordsForm.$invalid||u.submitPending||(u.submitPending=!0,u.getRecordsToUpdate(),function(){var e=u.recordsetsList.length;for(;e--;){var t=u.recordsetsList[e];1==t.deleted&&1==t.created&&u.recordsetsList.splice(e,1)}}(),function(){for(var e=0;e<u.recordsetsList.length;e++)for(var t=u.recordsetsList[e],n=0;n<t.records.length;n++){for(var i=angular.copy(t.records[n]),o=Object.keys(i),r="",a=0;a<o.length;a++)r+=i[o[a]]+" ";r=r.slice(0,-1),t.records[n]=r}}(),l.add(i.getString("Recordsets update scheduled")),t.Dns.save({id:u.zone.id,actions:"synchronize_records"},u.recordsetsList).$promise.then(function(e){u.submitPending=!1,u.recordsets=e,u.backendErrors=null,u.recordsetsList=[],d(o.params.id)},function(e){u.submitPending=!1,u.backendErrors=e.data,u.recordsetsList=[],d(o.params.id)}))},u.deleteRecordSet=function(e,t){u.createRecordsListObj(t),n.yesNoDlg(i.getString("Are you sure?"),i.getString("Delete recordset {{recordset}}",{recordset:e.id}),i.getString("Delete recordset")).then(function(){e.deleted=!0})},u.addRecordSet=function(){var e="temp"+u.temporaryRecordCreateId;u.createRecordsListObj(e),u.recordsets.recordsets.push({temporary_id:e,status:"Unavailable",zone_id:u.zone.id,ttl:null,zone_name:u.zone.zone_name,type:u.recordsets.record_types[0],name:"",records:[{text:""}],deleted:!1,created:!0}),u.temporaryRecordCreateId+=1},u.addRecord=function(e,t){u.createRecordsListObj(t),e.records.push(f(e))},u.recordsetErrors=function(e){return void 0!==u.backendErrors&&null!==u.backendErrors&&void 0!==u.backendErrors[e.id]&&u.backendErrors[e.id]},u.changeRecordType=function(e){e.records=[f(e)]},u.removeRecord=function(e,t,n){u.createRecordsListObj(n),1<e.records.length&&e.records.splice(t,1)},u.$onInit=function(){u.toBeUpdatedRecords={},u.recordsetsList=[],u.temporaryRecordCreateId=0,u.zone&&o.params.id&&(u.loadingDetails=!0,d(o.params.id)),e.init(function(){return c.start()},function(){return c.stop()}),(c=a(p,3e4,[5e3,1e4])).start(),u.TRANSLATED_STRINGS_MAP={delete:i.getString("Delete"),edit:i.getString("Edit zone"),no_permission:i.getString("You are not\nallowed to do this")}},u.$onDestroy=function(){return c.teardown(),e.uninit()},u.hasRecordSets=function(){return u.recordsets&&u.recordsets.recordsets&&u.recordsets.recordsets.length},u.createRecordsListObj=function(e){void 0!==e&&(u.toBeUpdatedRecords[e]=!0)},u.getRecordsToUpdate=function(){for(var e=0;e<u.recordsets.recordsets.length;e++){var t=u.recordsets.recordsets[e];(u.toBeUpdatedRecords[t.id]||u.toBeUpdatedRecords[t.temporary_id]&&!0!==t.deleted)&&u.recordsetsList.push(t)}}}angular.module("fleioStaff").component("flZoneDetails",{templateUrl:"staff/apps/oszones/flzonedetails.html",controller:e,bindings:{zone:"<",permissions:"<"}}),e.$inject=["FlOsApi","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlDetectIdleService","FlOsTimer","$scope","FlNotificationService"]}(),function(){"use strict";function e(e,t){var n,i,o,r,a;return r=e(t.api_url+"/billing/gateways/:id/:action",{id:"@id",action:"@action"}),n=e(t.api_url+"/billing/orders/:id/:action",{id:"@id",action:"@action"}),o=e(t.api_url+"/billing/services/:id/:action",{id:"@id",action:"@action"}),i=e(t.api_url+"/billing/products/:id/:action",{id:"@id",action:"@action"}),a=e(t.api_url+"/billing/productcycles/:id/:options",{id:"@id",options:"@options"}),{Orders:n,Products:i,Services:o,Invoices:e(t.api_url+"/billing/invoices/:id:options/:action",{id:"@id",options:"@options",action:"@action"}),Transactions:e(t.api_url+"/billing/transactions/:id/:options",{id:"@id",options:"@options"}),Gateways:r,ProductCycles:a,Journal:e(t.api_url+"/billing/journal/:id:options/:action",{id:"@id",options:"@options",action:"@action"}),GatewayAction:e(t.api_url+"/billing/gateway/:gateway/:action",{gateway:"@gateway",action:"@action"}),TaxRules:e(t.api_url+"/billing/taxrules/:id/:actions",{id:"@id",actions:"@actions"}),ProductGroups:e(t.api_url+"/billing/productgroups/:id/:action",{id:"@id",action:"@action"}),ConfigurableOptions:e(t.api_url+"/billing/configoptions/:id/:action",{id:"@id",action:"@action"}),ConfigurableOptionsCycles:e(t.api_url+"/billing/configoptions/cycles/:id/:action",{id:"@id",action:"@action"}),ConfigurableOptionsChoices:e(t.api_url+"/billing/configoptions/choices/:id/:action",{id:"@id",action:"@action"}),ConfigurableOptionsQuantity:e(t.api_url+"/billing/configoptions/quantity/:id/:action",{id:"@id",action:"@action"})}}angular.module("fleioStaff").factory("FlBilling",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n){e.state("billingInvoices",{url:t.joinBaseUrl("billing/invoicing?page_size?ordering?filtering?search"),component:"flInvoicing",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-issue_date",squash:!0},filtering:{value:"",squash:!0}},data:{stateInfo:{display:n("Invoices"),parent:"dashboard"},feature:"billing.invoices",orderOptions:{status:n("Status"),issue_date:n("Issue date"),due_date:n("Due date"),client:n("Client")},filtering:{issue_date:{display:n("Issue date"),field_name:"issue_date",type:"date"},due_date:{display:n("Due date"),field_name:"due_date",type:"date"},status:{display:n("Status"),field_name:"status",type:"choices",choices:[{display:n("Unpaid"),value:"unpaid"},{display:n("Paid"),value:"paid"},{display:n("Cancelled"),value:"cancelled"},{display:n("Refunded"),value:"refunded"}]},total:{display:n("Total"),field_name:"total",type:"decimal"}}},resolve:{invoices:["$stateParams","FlObjectList","FlBilling",function(e,t,n){return t(n.Invoices,e)}]}}).state("billingInvoicesDetails",{url:t.joinBaseUrl("billing/invoices/:id?dlg"),component:"flInvoicingDetails",authenticate:!0,resolve:{invoice:["$stateParams","FlBilling","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.Invoices.get(e).$promise.then(function(e){return n.setParams({id:e.id,name:e.name}),e}).catch(i.handleError)}]},params:{dlg:{value:"false",squash:!0}},data:{stateInfo:{display:"{:name}",parent:"billingInvoices",default:n("Invoice details")},feature:"billing.invoices"}}).state("billingInvoicesCreate",{url:t.joinBaseUrl("billing/invoices/create?client"),component:"flInvoiceCreate",authenticate:!0,resolve:{createOptions:["$stateParams","FlBilling",function(e,t){return t.Invoices.get({action:"invoice_create_options"}).$promise}]},params:{client:{value:null,squash:!0}},data:{stateInfo:{display:n("Invoice creation"),parent:"billingInvoices",default:n("Invoice creation")},feature:"billing.invoices"}}).state("billingServices",{url:t.joinBaseUrl("billing/services?page_size?ordering?filtering?search"),component:"flBillingServices",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},data:{stateInfo:{display:n("Services"),parent:"dashboard"},feature:"billing.services",orderOptions:{display_name:n("Display Name"),client:n("Client"),created_at:n("Created at"),next_due_date:n("Next due date"),status:n("Status")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},activated_at:{display:n("Activated at"),field_name:"activated_at",type:"date"},suspended_at:{display:n("Suspended at"),field_name:"suspended_at",type:"date"},terminated_at:{display:n("Terminated at"),field_name:"terminated_at",type:"date"},status:{display:n("Status"),field_name:"status",type:"choices",choices:[{display:n("Pending"),value:"pending"},{display:n("Active"),value:"active"},{display:n("Suspended"),value:"suspended"},{display:n("Terminated"),value:"terminated"},{display:n("Canceled"),value:"canceled"},{display:n("Fraud"),value:"fraud"},{display:n("Archived"),value:"archived"}]},next_due_date:{display:n("Next due date"),field_name:"next_due_date",type:"date"},client:{display:n("Client"),field_name:"client",type:"client"}}},resolve:{services:["$stateParams","FlObjectList","FlBilling","FlResolveErrorHandler",function(e,t,n,i){return t(n.Services,e).catch(i.handleError)}]}}).state("billingServiceUpgrade",{url:t.joinBaseUrl("billing/services/:id/change-options"),component:"flServiceUpgrade",authenticate:!0,data:{feature:"billing.services",stateInfo:{display:n("Change options"),parent:"billingServices"}},resolve:{serviceUpgradeOptions:["FlBilling","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.Services.get({id:t.id,action:"upgrade_options"}).$promise.catch(n.handleError)}]}}).state("billingServiceChangeProduct",{url:t.joinBaseUrl("billing/services/:id/change-product"),component:"flServiceChangeProduct",authenticate:!0,data:{feature:"billing.services",stateInfo:{display:n("Change product"),parent:"billingServices"}},resolve:{serviceUpgradeOptions:["FlBilling","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.Services.get({id:t.id,action:"upgrade_options"}).$promise.catch(n.handleError)}]}}).state("billingServicesDetails",{url:t.joinBaseUrl("billing/services/:id"),component:"flBillingServicesDetails",data:{feature:"billing.services",stateInfo:{display:n("Service details"),parent:"billingServices"}},resolve:{serviceDetails:["FlBilling","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.Services.get(t).$promise.then(function(e){return e}).catch(n.handleError)}]}}).state("billingOrders",{url:t.joinBaseUrl("billing/orders?page_size?ordering?filtering?search"),component:"flBillingOrders",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-order_date",squash:!0},filtering:{value:"",squash:!0}},data:{stateInfo:{display:n("Orders"),parent:"dashboard"},feature:"billing.orders",orderOptions:{id:n("Id"),client:n("Client"),user:n("User"),order_date:n("Order date"),status:n("Status")},filtering:{client:{display:n("Client"),field_name:"client",type:"client"},user:{display:n("User"),field_name:"user",type:"user"},order_date:{display:n("Order date"),field_name:"order_date",type:"date"},status:{display:n("Status"),field_name:"status",type:"choices",choices:[{display:n("Pending"),value:"pending"},{display:n("Verified"),value:"verified"},{display:n("Completed"),value:"completed"},{display:n("Cancelled"),value:"cancelled"}]}}},resolve:{orders:["$stateParams","FlObjectList","FlBilling","FlResolveErrorHandler",function(e,t,n,i){return t(n.Orders,e).catch(i.handleError)}]}}).state("billingOrderDetails",{url:t.joinBaseUrl("billing/orders/:id"),component:"flBillingOrderDetails",data:{stateInfo:{display:n("Order details"),parent:"billingOrders"},feature:"billing.orders"},resolve:{orderDetails:["FlBilling","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.Orders.get(t).$promise.then(function(e){return e}).catch(n.handleError)}]}}).state("billingProducts",{url:t.joinBaseUrl("billing/products?page_size?ordering?search"),component:"flBillingProducts",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-id",squash:!0}},data:{stateInfo:{display:n("Products"),parent:"dashboard"},feature:"billing.products"},resolve:{productGroups:["$stateParams","FlObjectList","FlBilling","FlResolveErrorHandler",function(e,t,n,i){return t(n.ProductGroups,e).catch(i.handleError)}]}}).state("billingProductCreate",{url:t.joinBaseUrl("billing/products/create"),component:"flBillingProductEdit",authenticate:!0,resolve:{createOptions:["FlBilling",function(e){return e.Products.get({action:"create_options"}).$promise}]},data:{stateInfo:{display:n("Create product"),parent:"billingProducts"},feature:"billing.products"}}).state("billingProductEdit",{url:t.joinBaseUrl("billing/products/:id/edit"),component:"flBillingProductEdit",authenticate:!0,resolve:{createOptions:["FlBilling","FlResolveErrorHandler",function(e,t){return e.Products.get({action:"create_options"}).$promise.then(function(e){return e}).catch(t.handleError)}],pack:["$stateParams","FlBilling","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.Products.get(e).$promise.then(function(e){return n.setParams({name:e.name}),e}).catch(i.handleError)}]},data:{stateInfo:{display:n("Edit product {:name}"),default:n("Edit product"),parent:"billingProducts"},feature:"billing.products"}}).state("billingProductDetails",{url:t.joinBaseUrl("billing/products/:id"),component:"flBillingProductDetails",data:{feature:"billing.products",stateInfo:{display:n("Product details"),parent:"billingProducts"}},resolve:{productDetails:["FlBilling","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.Products.get(t).$promise.then(function(e){return e}).catch(n.handleError)}]}}).state("billingGateways",{url:t.joinBaseUrl("billing/gateways?page_size?ordering?search"),component:"flBillingGateways",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-id",squash:!0}},data:{stateInfo:{display:n("Gateways"),parent:"dashboard"},feature:"billing.gateways",orderOptions:{id:n("Id"),display_name:n("Display Name"),enabled:n("Enabled"),visible_to_user:n("Visible to User"),fixed_fee:n("Fixed Fee"),percent_fee:n("Percent Fee")}},resolve:{gateways:["$stateParams","FlObjectList","FlBilling","FlResolveErrorHandler",function(e,t,n,i){return t(n.Gateways,e).catch(i.handleError)}]}}).state("billingGatewayDetails",{url:t.joinBaseUrl("billing/gateways/:id"),component:"flBillingGatewayDetails",data:{stateInfo:{display:n("Gateway details"),parent:"billingGateways"},feature:"billing.gateways"},resolve:{gatewayDetails:["FlBilling","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.Gateways.get(t).$promise.then(function(e){return e}).catch(n.handleError)}]}}).state("billingJournal",{url:t.joinBaseUrl("billing/journal?page_size?ordering?search?filtering"),component:"flBillingJournal",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-id",squash:!0},filtering:{value:"",squash:!0,dynamic:!0}},data:{stateInfo:{display:n("Billing journal"),parent:"dashboard"},feature:"billing.journal",filtering:{user_id:{display:n("User"),field_name:"user_id",type:"user"},source:{display:n("Source"),field_name:"source",type:"choices",choices:[{display:n("Transaction"),value:"tr"},{display:n("Invoice"),value:"iv"},{display:n("Credit"),value:"cr"},{display:n("Staff"),value:"st"},{display:n("Settlement"),value:"se"},{display:n("External"),value:"ex"}]},destination:{display:n("Destination"),field_name:"destination",type:"choices",choices:[{display:n("Transaction"),value:"tr"},{display:n("Invoice"),value:"iv"},{display:n("Credit"),value:"cr"},{display:n("Staff"),value:"st"},{display:n("Settlement"),value:"se"},{display:n("External"),value:"ex"}]},client_credit__client:{display:n("Credit related client"),field_name:"client_credit__client",type:"client"},invoice__client:{display:n("Invoice related client"),field_name:"invoice__client",type:"client"},date_added:{display:n("Date added"),field_name:"date_added",type:"date"},destination_amount:{display:n("Destination amount"),field_name:"destination_amount",type:"decimal"},source_amount:{display:n("Source amount"),field_name:"source_amount",type:"decimal"}},orderOptions:{id:n("Id"),invoice:n("Invoice"),transaction:n("Transaction"),transaction__status:n("Transaction Status"),source:n("Source"),destination:n("Destination"),source_amount:n("Source amount"),destination_amount:n("Destination amount")}},resolve:{journal:["$stateParams","FlObjectList","FlBilling","FlResolveErrorHandler",function(e,t,n,i){return t(n.Journal,e).catch(i.handleError)}]}}).state("billingJournalDetail",{url:t.joinBaseUrl("billing/journal/:id"),component:"flBillingJournalDetail",data:{stateInfo:{display:n("Detail"),parent:"billingJournal"},feature:"billing.journal"},resolve:{journal:["FlBilling","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.Journal.get(t).$promise.catch(n.handleError)}]}}).state("billingTaxRules",{url:t.joinBaseUrl("billing/taxrules?page_size?ordering?filtering?search"),component:"flBillingTaxRules",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"country",squash:!0},filtering:{value:"",squash:!0}},data:{stateInfo:{display:n("Tax rules"),parent:"dashboard"},feature:"billing.taxrules",orderOptions:{country:n("Country"),state:n("State"),level:n("Level"),rate:n("Rate"),name:n("Name")},filtering:{start_date:{display:n("Start date"),field_name:"start_date",type:"date"},end_date:{display:n("End date"),field_name:"end_date",type:"date"},rate:{display:n("Rate"),field_name:"rate",type:"decimal"},level:{display:n("Level"),field_name:"level",type:"choices",choices:[{display:n("Level 1"),value:1},{display:n("Level 2"),value:2}]}}},resolve:{taxRules:["$stateParams","FlObjectList","FlBilling","FlResolveErrorHandler",function(e,t,n,i){return t(n.TaxRules,e).catch(i.handleError)}]}}).state("billingConfigurableOptionList",{url:t.joinBaseUrl("billing/configurable-options"),component:"flConfigurableOptionList",data:{stateInfo:{display:n("Configurable Options"),parent:"dashboard"},feature:"billing",orderOptions:{created_at:n("Created")}},params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0}},resolve:{options:["FlBilling","$stateParams","FlResolveErrorHandler","FlObjectList",function(e,t,n,i){return i(e.ConfigurableOptions,t).catch(n.handleError)}]}}).state("billingConfigurableOption",{url:t.joinBaseUrl("billing/configurable-options/:id"),component:"flConfigurableOption",data:{stateInfo:{display:n("Configurable Option"),parent:"billingConfigurableOptionList"},feature:"billing"},resolve:{option:["FlBilling","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.ConfigurableOptions.get(t).$promise.catch(n.handleError)}]}}).state("billingConfigurableOptionCreate",{url:t.joinBaseUrl("billing/configurable-options/create"),component:"flConfigurableOptionCreate",data:{stateInfo:{display:n("Create Configurable Option"),parent:"billingConfigurableOptionList"},feature:"billing"},resolve:{createOptions:["FlBilling","FlResolveErrorHandler",function(e,t){return e.ConfigurableOptions.get({action:"create_options"}).$promise.catch(t.handleError)}]}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(n,e,t,i,o,r){var a=this;function s(t,e){n.Invoices.get({id:e.id}).$promise.then(function(e){return i.show({templateUrl:"staff/apps/billing/invoicing/delete/flinvoicedelete.html",controller:"FlInvoiceDeleteController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{invoice:e},targetEvent:t}).then(function(){r.add(o.getString("Invoice deleted")),a.invoices.fetchData()}).catch(function(){})}).catch(function(){a.invoice.status="unknown"})}a.$onInit=function(){a.deleteInvoice=s,e.info.enabled=!0,e.info.label=t("Search invoices"),e.info.service=a.invoices,a.current_date=new Date},a.getInvoiceStatusClass=function(e){if("paid"===e.status)return"fl-light-green";if("unpaid"===e.status){var t=new Date(e.due_date);if(a.current_date<=t)return"fl-yellow";if(a.current_date>t)return"fl-red"}else if("refunded"===e.status||"cancelled"===e.status)return"fl-gray"}}angular.module("fleioStaff").component("flInvoicing",{templateUrl:"staff/apps/billing/invoicing/flinvoicing.html",controller:e,bindings:{invoices:"<"}}),e.$inject=["FlBilling","FlSearchService","gettext","$mdDialog","gettextCatalog","FlNotificationService"]}(),function(){"use strict";function e(t,e,n,i,o,r,a,s,l){var c=this;function u(){t.Invoices.get({id:c.invoice.id}).$promise.then(function(e){c.invoice=e,c.invoiceStatusClass=d()}).catch(function(){c.invoice.status="unknown"})}function d(){if("paid"===c.invoice.status)return"fl-light-green";if("unpaid"===c.invoice.status){var e=new Date(c.invoice.due_date);if(c.current_date<=e)return"fl-yellow";if(c.current_date>e)return"fl-red"}else if("refunded"===c.invoice.status||"canceled"===c.invoice.status)return"fl-gray"}c.current_date=new Date,c.selectedTabIndex=0,c.$onInit=function(){c.invoiceStatusClass=d(),c.showDownloadPdf=!1,n.features["billing.pdf"]&&(c.showDownloadPdf=!0,c.pdfUrl=i.api_url+"/billing/invoices/"+c.invoice.id+"/download?content_type=pdf")},c.downloadPdf=function(){l.get(i.api_url+"/billing/invoices/"+c.invoice.id+"/download?content_type=pdf").then(function(e){var t=new Blob([e.data],{type:"application/pdf"}),n=document.createElement("a");n.href=window.URL.createObjectURL(t),c.invoice.display_number?n.download="invoice_"+c.invoice.display_number.replace(/\s/g,"")+".pdf":n.download="invoice_"+c.invoice.id+".pdf",document.body.appendChild(n),n.click(),document.body.removeChild(n)})},c.deleteTransaction=function(e){return r.yesNoDlg(a.getString("Are you sure?"),a.getString("Delete transaction {{transaction}}",{transaction:e.external_id}),a.getString("Delete transaction")).then(function(){return t.Transactions.delete({id:e.id}).$promise.then(function(){s.add(a.getString("Transaction deleted")),u()},function(){})}).catch(function(){})},c.deleteInvoice=function(e){return o.show({templateUrl:"staff/apps/billing/invoicing/delete/flinvoicedelete.html",controller:"FlInvoiceDeleteController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{invoice:c.invoice},targetEvent:e}).then(function(){return s.add(a.getString("Invoice deleted")),c.invoiceDeleted()}).catch(function(){})},c.invoiceDeleted=function(){e.go("billingInvoices")},c.paymentAdded=function(){u(),c.selectedTabIndex=0},c.refundPerformed=function(){u(),c.selectedTabIndex=0}}angular.module("fleioStaff").component("flInvoicingDetails",{templateUrl:"staff/apps/billing/invoicing/flinvoicingdetails.html",controller:e,bindings:{invoice:"<"}}),e.$inject=["FlBilling","$state","FlFeatureService","CONFIG","$mdDialog","FlUiUtilsService","gettextCatalog","FlNotificationService","$http"]}(),function(){"use strict";function e(t,n,i,o,r,a,s,l){var c=this;c.$onInit=function(){c.goBackOrToState=i.goBackOrToState,c.clientServicesLoaded=!1;var e=new Date;c.invoice={status:"unpaid",issue_date:e,due_date:e,items:[]},l.client&&a.get({id:l.client}).$promise.then(function(e){c.selectedClient=e,c.selectedClientChange(e)}).catch(function(e){n.add(o.getString("Could not preselect the client."))})},c.searchClient=function(e){return a.get({search:e}).$promise.then(function(e){return e.objects})},c.selectedClientChange=function(e){c.clientServicesLoaded=!1,c.invoice.items=[],void 0!==e&&t.Services.get({client:e.id}).$promise.then(function(e){c.services=e.objects,c.clientServicesLoaded=!0}).catch(s.handleError)},c.addInvoiceItem=function(){c.invoice.items.push({amount:0,description:" ",total:""})},c.emptyDate=function(e){delete c.invoice[e]},c.save=function(){document.activeElement.blur(),c.submitPending||c.createInvoiceForm.$invalid||(c.submitPending=!0,c.selectedClient&&(c.invoice.client=c.selectedClient.id),t.Invoices.save(c.invoice).$promise.then(function(e){n.add(o.getString("Invoice created")),r.go("billingInvoicesDetails",{id:e.id})}).catch(function(e){c.submitPending=!1,c.backendErrors=e.data}))}}angular.module("fleioStaff").component("flInvoiceCreate",{templateUrl:"staff/apps/billing/invoicing/create/flinvoicecreate.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["FlBilling","FlNotificationService","FlUiUtilsService","gettextCatalog","$state","FlClientApi","FlResolveErrorHandler","$stateParams"]}(),function(){"use strict";function e(e,t,n,i,o){var r=this;r.goBackOrToState=n.goBackOrToState,r.$onInit=function(){r.client=r.invoice.client,r.invoice.client=r.invoice.client.id},r.addInvoiceItem=function(){r.invoice.items.push({amount:0,description:" ",total:""})},r.save=function(){document.activeElement.blur(),r.submitPending||r.editInvoiceForm.$invalid||(r.submitPending=!0,e.Invoices.update(r.invoice).$promise.then(function(e){t.add(i("translate")("Invoice updated")),o.go("billingInvoicesDetails",{id:r.invoice.id})},function(e){r.submitPending=!1,r.backendErrors=e.data}))}}angular.module("fleioStaff").component("flInvoiceEdit",{templateUrl:"staff/apps/billing/invoicing/edit/flinvoiceedit.html",controller:e,bindings:{invoice:"<",createOptions:"<"}}),e.$inject=["FlBilling","FlNotificationService","FlUiUtilsService","$filter","$state"]}(),function(){"use strict";function e(e,t,n){e.state("invoiceEdit",{url:t.joinBaseUrl("billing/invoicing/:id/edit"),component:"flInvoiceEdit",authenticate:!0,resolve:{invoice:["$stateParams","FlBilling","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.Invoices.get(e).$promise.then(function(e){return n.setParams({id:e.id}),e}).catch(i.handleError)}],createOptions:["FlBilling","$stateParams",function(e,t){return e.Invoices.get({id:t.id,action:"create_options"}).$promise}]},data:{stateInfo:{display:n("Edit"),parent:"billingInvoicesDetails",default:n("Edit")},feature:"billing.invoices"}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t){var n=this;n.$onInit=function(){for(var e=n.refunded_credit=0;e<n.invoice.journal.length;e++){var t=n.invoice.journal[e];t.transaction||"cr"!==t.source||(n.refunded_credit+=parseFloat(t.source_amount))}},n.deleteInvoice=function(){document.activeElement.blur(),n.submitPending||n.deleteInvoiceForm.$invalid||(n.submitPending=!0,t.Invoices.save({id:n.invoice.id,action:"perform_delete"}).$promise.then(function(){return e.hide()},function(e){return n.backendErrors=e.data,n.submitPending=!1}))},n.close=function(){return e.cancel()}}angular.module("fleioStaff").controller("FlInvoiceDeleteController",e),e.$inject=["$mdDialog","FlBilling"]}(),function(){"use strict";function e(t,n,e,i){var o=this;o.$onInit=function(){o.payment={id:o.invoice.id,invoice:o.invoice.id,action:"add_payment_to_invoice",date_initiated:new Date},function(e){t.Invoices.get({id:e,action:"payment_options"}).$promise.then(function(e){return o.gateways=e.gateways,o.currencies=e.currencies,o.payment.currency=o.invoice.currency,o.payment.gateway=e.defaultGateway,e})}(o.invoice.id),"unpaid"==o.invoice.status&&(o.payment.amount=parseFloat(o.invoice.balance))},o.invoicePaymentSubmit=function(){document.activeElement.blur(),o.submitPending||o.invoicePayment.$invalid||(o.submitPending=!0,t.Invoices.save(o.payment).$promise.then(function(e){return n.add(e.detail),e}).catch(function(e){o.backendErrors=e.data}).finally(function(){o.submitPending=!1,o.onPaymentAdded()}))}}angular.module("fleioStaff").component("flInvoicePaymentCreate",{templateUrl:"staff/apps/billing/invoicing/payments/paymentcreate.html",controller:e,bindings:{invoice:"<",onPaymentAdded:"&"}}),e.$inject=["FlBilling","FlNotificationService","$state","$window"]}(),function(){"use strict";function e(r,e,a,s,l,c){var u=this;u.$onInit=function(){u.refundDetails={},u.refundMethods={},u.refundMethods.refundThroughGateway="1",u.refundMethods.refundManually="2",u.refundMethods.refundToCredit="3"},u.$onChanges=function(e){e&&e.invoice&&e.invoice.currentValue&&(u.transactions=function(e){var t=[];e&&e.transactions&&e.transactions.length&&(t=e.transactions.filter(function(e){var t=function(e,t){var n,i=null;e&&e.actions&&e.actions.length&&(n=e.actions.filter(function(e){return e.name===t}))&&0<n.length&&(i=n[0],1<n.length&&console.warn('More than one transaction action matched "'+t+'"'));return i}(e,"refund");return!!t&&e.is_refundable}));return t}(e.invoice.currentValue))},u.updateRefundDetails=function(){for(var e=u.transactions[u.transactionIndex],t={transactionInfo:e.external_id+" - "+e.gateway.display_name,transactionAmount:e.amount+" "+e.currency,journalEntries:[],canRefundToCredit:!1},n=0;n<u.invoice.journal.length;n++){var i=u.invoice.journal[n];i.transaction?i.transaction.id===e.id&&(u.selectedRefundMethod!==u.refundMethods.refundToCredit?(t.journalEntries.push(i),"cr"!==i.destination&&(t.canRefundToCredit=!0)):(t.canRefundToCredit=!0,"cr"!==i.destination&&t.journalEntries.push(i))):u.invoice.is_add_credit&&"cr"===i.destination&&"iv"===i.source&&t.journalEntries.push(i)}u.invoice.is_add_credit&&(t.canRefundToCredit=!1);for(var o=0;o<e.actions.length;o++){var r=e.actions[o];"refund"===r.name&&(t.action=r)}u.refundDetails=t,u.transaction=e},u.refundPayment=function(){return e.yesNoDlg(a.getString("Are you sure?"),a.getString("Refund transaction {{transaction}}",{transaction:u.transaction.external_id}),a.getString("Refund transaction")).then(function(){if(u.selectedRefundMethod===u.refundMethods.refundThroughGateway&&function(e,t,n){var i="invoice="+t+"&transaction="+n,o=c.api_url+"/billing/gateway/"+e.gateway+"/"+e.name+"?"+i;e.redirect?l.location.href=o:r.GatewayAction.save({gateway:e.gateway,action:e.name,invoice:journal.invoice,transaction:journal.transaction.id}).$promise.then(function(e){return s.add(a.getString("Transaction refund initiated.")),e}).catch(function(e){u.backendErrors=e.data}).finally(function(){u.onRefundPerformed()})}(u.refundDetails.action,u.invoice.id,u.transaction.id),u.selectedRefundMethod===u.refundMethods.refundManually||u.selectedRefundMethod===u.refundMethods.refundToCredit){for(var e=0,t=0;t<u.refundDetails.journalEntries.length;t++){var n=u.refundDetails.journalEntries[t];n.transaction&&(e+=Number(n.destination_amount))}var i={id:u.invoice.id,invoice:u.invoice.id,transaction:u.transaction.id,action:"perform_refund",refund_to_credit:u.selectedRefundMethod===u.refundMethods.refundToCredit,refund_manually:u.selectedRefundMethod===u.refundMethods.refundManually,amount:e,external_id:u.externalTransactionId};r.Invoices.save(i).$promise.then(function(e){return s.add(a.getString("Transaction refund initiated.")),e}).catch(function(e){u.backendErrors=e.data}).finally(function(){u.onRefundPerformed(),u.refundDetails={},u.transactionIndex=null})}})}}angular.module("fleioStaff").component("flInvoicePaymentRefund",{templateUrl:"staff/apps/billing/invoicing/payments/paymentrefund.html",controller:e,bindings:{invoice:"<",onRefundPerformed:"&"}}),e.$inject=["FlBilling","FlUiUtilsService","gettextCatalog","FlNotificationService","$window","CONFIG"]}(),function(){"use strict";function e(e,t,n){var i=this;i.$onInit=function(){t.info.enabled=!0,t.info.label=n("Search gateways"),t.info.service=i.gateways}}angular.module("fleioStaff").component("flBillingGateways",{templateUrl:"staff/apps/billing/gateways/gateways.html",controller:e,bindings:{gateways:"<"}}),e.$inject=["FlBilling","FlSearchService","gettext"]}(),function(){"use strict";function e(e,t,n,i,o){var r=this;r.$onInit=function(){r.goBackOrToState=i.goBackOrToState,r.gatewaySettings={},r.gatewayDetails.module_settings||(r.gatewayDetails.module_settings={}),r.gatewayDetails.module_settings.capabilities||(r.gatewayDetails.module_settings.capabilities={can_process_payments:!0,returns_fee_information:!1}),r.gatewayDetails.percent_fee=Number(r.gatewayDetails.percent_fee),r.gatewayDetails.fixed_fee=Number(r.gatewayDetails.fixed_fee)},r.saveGateway=function(){if(document.activeElement.blur(),!r.gatewayForm.$invalid&&!r.actionPending)return r.actionPending=!0,e.Gateways.update(r.gatewayDetails).$promise.then(function(e){return r.actionPending=!1,t.go("billingGateways"),n.add("Gateway saved"),e},function(e){r.actionPending=!1,r.backendErrors=e.data})}}angular.module("fleioStaff").component("flBillingGatewayDetails",{templateUrl:"staff/apps/billing/gateways/gatewaydetails.html",controller:e,bindings:{gatewayDetails:"<"}}),e.$inject=["FlBilling","$state","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(o,e,t,r,n,a,s,l){var i=this;i.$onInit=function(){e.info.enabled=!0,e.info.label=t("Search journal entries"),e.info.service=i.journal},i.doAction=function(n,i){var e=l.getString("Do you want to {{action}} transaction?",{action:i.display.toLowerCase()});s.yesNoDlg(e,l.getString("{{action}} transaction",{action:i.display})).then(function(){var e="invoice="+n.invoice+"&transaction="+n.transaction.id,t=a.api_url+"/billing/gateway/"+i.gateway+"/"+i.name+"?"+e;i.redirect?o.location.href=t:r.GatewayAction.save({gateway:i.gateway,action:i.name,invoice:n.invoice,transaction:n.transaction.id})}).catch(function(){})}}angular.module("fleioStaff").component("flBillingJournal",{templateUrl:"staff/apps/billing/journal/journal.html",controller:e,bindings:{journal:"<"}}),e.$inject=["$window","FlSearchService","gettext","FlBilling","$httpParamSerializer","CONFIG","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(o,r,a){this.$onInit=function(){},this.$onDestroy=function(){},this.availableAction=[],this.doAction=function(e,t){var n="?invoice="+encodeURIComponent(e.invoice)+"&transaction="+encodeURIComponent(e.transaction.id),i=a.api_url+"/billing/gateway/"+t.gateway+"/"+t.name+n;t.redirect?o.location.href=i:r.GatewayAction.save({gateway:t.gateway,action:t.name,invoice:e.invoice,transaction:e.transaction.id})}}angular.module("fleioStaff").component("flBillingJournalDetail",{templateUrl:"staff/apps/billing/journal/journaldetail.html",controller:e,bindings:{journal:"<"}}),e.$inject=["$window","FlBilling","CONFIG"]}(),function(){"use strict";function e(n,i,o,r,a){var s=this;s.doAction=function(e,t){{if("delete"===t)return o.yesNoDlg(a.getString("Are you sure?"),a.getString("Delete order")).then(function(){n.Orders.save({id:e,action:t}).$promise.then(function(){r.add(a.getString("Order deleted")),"billingOrders"===i.current.name?s.orders.fetchData():i.go("billingOrders")})});n.Orders.save({id:e,action:t}).$promise.then(function(){s.orders?s.orders.fetchData():i.reload(),r.add(a.getString("Order updated"))}).catch(function(e){e.data.messages&&o.messagesDlg(e.data.messages,e.data.detail)})}}}angular.module("fleioStaff").component("flOrderActions",{restrict:"E",bindings:{orders:"<",customOrder:"<"},templateUrl:"staff/apps/billing/orders/florderactions.html",controller:e}),e.$inject=["FlBilling","$state","FlUiUtilsService","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){var i=this;i.$onInit=function(){t.info.enabled=!0,t.info.label=n("Search orders"),t.info.service=i.orders},i.getCardStatusClass=function(e){switch(e.status){case"completed":return"fl-light-green";case"pending":return"fl-yellow";case"cancelled":return"fl-red";case"verified":return"fl-gray";default:return"fl-yellow"}}}angular.module("fleioStaff").component("flBillingOrders",{templateUrl:"staff/apps/billing/orders/orders.html",controller:e,bindings:{orders:"<"}}),e.$inject=["FlBilling","FlSearchService","gettext"]}(),function(){"use strict";function e(){this.$onInit=function(){}}angular.module("fleioStaff").component("flBillingOrderDetails",{templateUrl:"staff/apps/billing/orders/orderdetails.html",controller:e,bindings:{orderDetails:"<"}}),e.$inject=[]}(),function(){"use strict";function e(e,t,n,i){var o,r=this;function a(){r.services.fetchData().then(function(e){r.services=e})}r.$onInit=function(){e.info.enabled=!0,e.info.label=t("Search services"),e.info.service=r.services,(o=i(a,35e3)).start(),n.init(o.start.bind(o),o.stop.bind(o))},r.getServiceStatusClass=function(e){return"active"===e.status?"fl-light-green":"pending"===e.status?"fl-yellow":"terminated"===e.status?"fl-red":"fl-gray"},r.$onDestroy=function(){o.teardown(),n.uninit()}}angular.module("fleioStaff").component("flBillingServices",{templateUrl:"staff/apps/billing/services/services.html",controller:e,bindings:{services:"<"}}),e.$inject=["FlSearchService","gettext","FlDetectIdleService","FlOsTimer"]}(),function(){"use strict";function e(e,t,n,i,o,r,a){var s=this;s.$onInit=function(){s.service.statuses=["active","pending","suspended","terminated","canceled","fraud","archived"],s.selectedProduct=s.service.product,s.currentDate=new Date,s.goBackOrToState=r.goBackOrToState,s.refreshProductGroup(s.service.product.id),null!=s.service.cycle&&(s.service.cycle=s.service.cycle.id)},s.refreshProductGroup=function(e){return t.Products.get({search:s.service.product.name,id:e}).$promise.then(function(e){s.productGroup=e}).catch(function(e){i.add("Error retrieving product")})},s.emptyDate=function(e){s.service[e]=null},s.searchProduct=function(e){return t.Products.get({search:e}).$promise.then(function(e){return e.objects})},s.selectedProductChange=function(e){void 0!==e&&(s.service.product=e.id,s.refreshProductGroup(s.service.product).then(function(e){s.productGroup.cycles.length?s.service.cycle=s.productGroup.cycles[0].id:s.service.cycle=null}))},s.save=function(){!0===s.editServiceForm.product.$pristine&&s.selectedProductChange(s.service.product);!0===s.editServiceForm.$dirty&&(s.service.updated_at=s.currentDate);if(document.activeElement.blur(),s.submitPending||s.editServiceForm.$invalid)return;s.submitPending=!0,"null"===s.service.override_price&&(s.service.override_price=null);t.Services.update(s.service).$promise.then(function(e){i.add(o.getString("Service updated")),a.go("billingServicesDetails",{id:s.service.id})}).catch(function(e){s.submitPending=!1,s.backendErrors=e.data})}}angular.module("fleioStaff").component("flServiceEdit",{templateUrl:"staff/apps/billing/services/edit/flserviceedit.html",controller:e,bindings:{service:"<"}}),e.$inject=["FlObjectList","FlBilling","FlClientApi","FlNotificationService","gettextCatalog","FlUiUtilsService","$state"]}(),function(){"use strict";function e(e,t,n){e.state("serviceEdit",{url:t.joinBaseUrl("billing/services/:id/edit"),component:"flServiceEdit",authenticate:!0,resolve:{service:["$stateParams","FlBilling","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,i){return t.Services.get(e).$promise.then(function(e){return n.setParams({id:e.id}),e}).catch(i.handleError)}]},data:{stateInfo:{display:n("Edit"),parent:"billingServicesDetails",default:n("Edit")},feature:"billing"}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(n,i,o,r,a){var s=this;s.doAction=function(t,e){return"delete"===e?r.yesNoDlgCustom(o.getString("Are you sure?"),o.getString("Delete service {{id}}",{id:t}),o.getString("Delete service"),o.getString("This will permanently delete data (including the cost information for the ongoing billing cycle!)"),"warning","attention").then(function(){return n.Services.delete({id:t,delete_associated_resources:"true"}).$promise.then(function(e){e.detail?a.add(e.detail):a.add(e),s.services?s.services.fetchData():i.go("billingServices")})}).catch(function(){}):"terminate"===e?r.yesNoDlgCustom(o.getString("Are you sure?"),o.getString("Terminate service {{id}}",{id:t}),o.getString("Terminate service"),o.getString("This will permanently delete data."),"warning","attention").then(function(){return n.Services.save({id:t,action:"terminate"}).$promise.then(function(e){e.detail?a.add(e.detail):a.add(e),s.services?s.services.fetchData():i.go("billingServices")})}).catch(function(){}):void n.Services.save({id:t,action:e}).$promise.then(function(e){s.services?s.services.fetchData():function(e){n.Services.get({id:e}).$promise.then(function(e){s.customService=e})}(t),e.detail?a.add(e.detail):a.add(e)}).catch(function(e){a.add(e.data.detail)})}}angular.module("fleioStaff").component("flServiceActions",{restrict:"E",bindings:{services:"<",customService:"="},templateUrl:"staff/apps/billing/services/flserviceactions.html",controller:e,controllerAs:"$ctrl"}),e.$inject=["FlBilling","$state","gettextCatalog","FlUiUtilsService","FlNotificationService"]}(),function(){"use strict";function e(e,t,n){var i=this;i.$onInit=function(){i.hostingAccountChanged=!1},i.changeHostingAccount=function(){i.hostingAccountChanged=!0},i.saveHostingAccount=function(){i.hostingAccountChanged&&e.Services.update({id:i.serviceDetails.id,action:"update_hosting_account"},i.serviceDetails.hosting_account).$promise.then(function(e){t.add(n.getString("Service updated"))}).catch(function(e){t.add(n.getString("Unable to update service")),console.error(e)})}}angular.module("fleioStaff").component("flBillingServicesDetails",{templateUrl:"staff/apps/billing/services/details/servicedetails.html",controller:e,bindings:{serviceDetails:"<"}}),e.$inject=["FlBilling","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,i){var o=this;o.$onInit=function(){o.options=o.serviceUpgradeOptions,o.options.cycle&&o.options.cycle.id&&(o.newServiceCycle=o.options.cycle.id),o.newProduct=o.options.product.id,o.upgrade={},o.optionsSelected=!1,o.upgradeSummary={},o.configOptions={},o.upgradeInProgress=o.serviceUpgradeOptions.existing_upgrade_invoice,o.serviceUpgradeOptions&&o.serviceUpgradeOptions.configurable_options&&o.serviceUpgradeOptions.configurable_options.length&&o.serviceUpgradeOptions.configurable_options.forEach(function(e){o.configOptions[e.option]=e.option_value})},o.cancel=function(){e.go("billingServicesDetails",{id:o.serviceUpgradeOptions.id})},o.selectProduct=function(e){var t=o.upgrade[e];if(t)return i.Services.save({action:"upgrade",id:o.serviceUpgradeOptions.id},{product:e,cycle:t}).$promise.then(function(e){o.upgradeSummary=e,o.optionsSelected=!0}).catch(console.error);console.error("Select a cycle")},o.changeServiceCycle=function(){return i.Services.save({action:"upgrade",id:o.serviceUpgradeOptions.id},{product:o.serviceUpgradeOptions.product.id,cycle:o.newServiceCycle}).$promise.then(function(e){o.upgradeSummary=e,o.optionsSelected=!0}).catch(console.error)},o.serviceUpgradeFormSubmit=function(){},o.currentServiceOptionsSubmit=function(){},o.updateConfigurableOptions=function(){var e=[];for(var t in o.configOptions)o.configOptions.hasOwnProperty(t)&&e.push({option:t,option_value:o.configOptions[t]});var n={product:o.serviceUpgradeOptions.product.id,cycle:o.newServiceCycle,configurable_options:e};return i.Services.save({action:"upgrade",id:o.serviceUpgradeOptions.id},n).$promise.then(function(e){o.upgradeSummary=e,o.optionsSelected=!0}).catch(function(e){o.backendErrors=e.data})}}angular.module("fleioStaff").component("flServiceUpgrade",{templateUrl:"staff/apps/billing/services/upgrade/flserviceupgrade.component.html",controller:e,bindings:{serviceUpgradeOptions:"<"}}),e.$inject=["$state","FlBilling"]}(),function(){"use strict";function e(o,r){var a=this;a.$onInit=function(){},a.requestUpgrade=function(){var e=a.upgradeSummary.product_id,t=a.upgradeSummary.cycle_id,n=a.upgradeSummary.service_id,i=!1;return e&&t&&n&&(i=!0),o.Services.save({action:"upgrade",id:n},{product:e,cycle:t,confirm:i,configurable_options:a.upgradeSummary.configurable_options}).$promise.then(function(e){r.go("billingInvoicesDetails",{id:e.invoice})}).catch(console.error)}}angular.module("fleioStaff").component("flServiceUpgradeSummary",{templateUrl:"staff/apps/billing/services/upgrade/flserviceupgradesummary.component.html",controller:e,bindings:{upgradeSummary:"<"}}),e.$inject=["FlBilling","$state"]}(),function(){"use strict";function e(i,e,t){var o=this;o.$onInit=function(){o.selectedProductOptions={},o.selectedProductAvailableOptions=[],o.configOptions=function(e){var t={};return e.forEach(function(e){t[e.option]=e.option_value}),t}(o.serviceUpgradeOptions.configurable_options),o.options=o.serviceUpgradeOptions,o.upgradeInProgress=o.serviceUpgradeOptions.existing_upgrade_invoice,o.newProductList=function(e){var n=[];return e&&e.upgrades&&e.upgrades.length&&e.upgrades.forEach(function(t){t.cycles&&t.cycles.length&&t.cycles.forEach(function(e){n.push({name:t.name+" "+e.display_name,display_name:t.name+"  "+e.display_name+" ("+e.fixed_price+" "+e.currency+")",description:t.description,cycle:e.id,product:t.id,configurable_options:t.configurable_options,id:e.id+t.id})})}),n}(o.serviceUpgradeOptions)},o.getCycleDisplayName=function(e){return e?e.display_name+" ("+e.fixed_price+" "+e.currency+")":"n/a"},o.getCycleProductDisplayName=function(e,t){return t?e.name+" "+t.display_name+" ("+t.fixed_price+" "+t.currency+")":"n/a"},o.getSelectedProductDisplay=function(){return o.newProductSelected?o.newProductSelected.display_name:t.getString("Select a product")},o.selectNewProductAndCycle=function(){o.newProductSelected&&(o.selectedProductOptions[o.newProductSelected.product]=o.newProductSelected.configurable_options,o.newProductSelected.configurable_options&&o.newProductSelected.configurable_options.length&&(o.selectedProductAvailableOptions=[],o.newProductSelected.configurable_options.forEach(function(e){o.selectedProductAvailableOptions.push(e.id+"")})))},o.cancel=function(){e.go("billingServicesDetails",{id:o.options.id})},o.updateProduct=function(){var e=o.serviceUpgradeOptions.id,t=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&-1<o.selectedProductAvailableOptions.indexOf(n)&&e[n]&&t.push({option:parseInt(n,10),option_value:e[n]});return t}(o.configOptions),n={product:o.newProductSelected.product,cycle:o.newProductSelected.cycle,configurable_options:t,confirm:!1};return i.Services.save({action:"upgrade",id:e},n).$promise.then(function(e){o.upgradeSummary=e,o.optionsSelected=!0}).catch(function(e){o.backendErrors=e.data})}}angular.module("fleioStaff").component("flServiceChangeProduct",{templateUrl:"staff/apps/billing/services/upgrade/flservicechangeproduct.component.html",controller:e,bindings:{serviceUpgradeOptions:"<"}}),e.$inject=["FlBilling","$state","gettextCatalog"]}(),function(){"use strict";function e(t,n,i,o,e,r,a){var s=this;function l(){s.productGroups.fetchData()}function c(e,t){return a.show({templateUrl:"staff/apps/billing/products/flbillingproductgroupedit.html",controller:"FlProductGroupEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:e,bindToController:!0,locals:{productGroup:angular.copy(t)}}).then(function(){t?o.add(i.getString("Group updated")):o.add(i.getString("Group created")),l()}).catch(function(){})}function u(e){return n.yesNoDlg(i.getString("Are you sure?"),i.getString("Delete product {{name}}",{name:e.name}),i.getString("Delete product")).then(function(){return t.Products.delete({id:e.id}).$promise.then(function(){o.add(i.getString("Product deleted")),l()})}).catch(function(){})}function d(e){return n.yesNoDlg(i.getString("Are you sure?"),i.getString("Delete group {{name}}",{name:e.name}),i.getString("Delete group")).then(function(){return t.ProductGroups.delete({id:e.id}).$promise.then(function(){o.add(i.getString("Group deleted")),l()})}).catch(function(){})}s.$onInit=function(){e.info.enabled=!0,e.info.label=r("Search products"),e.info.service=s.productGroups,s.deleteProduct=u,s.editGroup=c,s.deleteGroup=d}}angular.module("fleioStaff").component("flBillingProducts",{templateUrl:"staff/apps/billing/products/products.html",controller:e,bindings:{productGroups:"<"}}),e.$inject=["FlBilling","FlUiUtilsService","gettextCatalog","FlNotificationService","FlSearchService","gettext","$mdDialog"]}(),function(){"use strict";function e(o,e,t,n,r,a,i){var s=this,l=r.current.name;function c(e){s.productIsFree="free"===e.price_model,s.productNeedsCycles=!s.productIsFree&&e.cycles&&!e.cycles.length}function u(){o.Products.get(e).$promise.then(function(e){c(s.productDetails=e)})}s.productNeedsCycles=!1,s.productIsFree=!1,s.deleteCycle=function(e){return t.yesNoDlg(n.getString("Are you sure?"),n.getString("Delete cycle")).then(function(){return o.ProductCycles.delete({id:e.id}).$promise.then(function(){u(),i.add(n.getString("Cycle deleted"))})}).catch(function(){})},s.$onInit=function(){c(s.productDetails),s.refreshConfigurableOptions()},s.refreshDetails=u,s.editCycle=function(t,n,i){s.loading=!0,o.ProductCycles.get({options:"create_options"}).$promise.then(function(e){return s.loading=!1,l!==r.current.name?e:(r.go(r.current,{dlg:"add"}),a.show({templateUrl:"staff/apps/billing/products/editcycle/flproductcycleedit.html",controller:"FlProductCycleEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{product_cycle:angular.copy(i),pack:angular.copy(n),create_options:angular.copy(e.create_options)}}).then(u))}).catch(function(e){s.loading=!1,e&&(s.backendErrors=e.data)})},s.editProduct=function(t,n){s.loading=!0,o.Products.get({action:"create_options"}).$promise.then(function(e){return s.loading=!1,l!==r.current.name?e:(r.go(r.current,{dlg:"add"}),a.show({templateUrl:"staff/apps/billing/products/flbillingproductedit.html",controller:"FlProductEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{pack:angular.copy(n),create_options:angular.copy(e.create_options)}}).then(u))}).catch(function(e){s.loading=!1,e&&(s.backendErrors=e.data)})},s.deleteProduct=function(e){return t.yesNoDlg(n.getString("Are you sure?"),n.getString("Delete product {{name}}",{name:e.name}),n.getString("Delete product")).then(function(){return o.Products.delete({id:e.id}).$promise.then(function(){return i.add(n.getString("Product deleted")),r.go("billingProducts")})}).catch(function(){})},s.refreshConfigurableOptions=function(){s.loadingConfigurableOptions=!0,o.Products.get({id:s.productDetails.id,action:"configurable_options"}).$promise.then(function(e){s.configurableOptions=e.configurable_options,s.availableConfigurableOptions=e.available_options}).catch(function(e){console.error(e.message)}).finally(function(){s.loadingConfigurableOptions=!1})},s.dissociateConfigurableOption=function(e){o.Products.save({id:s.productDetails.id,action:"dissociate_configurable_option"},{option:e}).$promise.then(function(e){i.add(e.detail)}).catch(function(e){console.error(e)}).finally(function(){return s.refreshConfigurableOptions()})},s.showAssociateOption=function(e){return a.show({templateUrl:"staff/apps/billing/products/associateproductoption.html",controller:"FlAssociateProductOption",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{availableOptions:s.availableConfigurableOptions,productId:s.productDetails.id},targetEvent:e}).then(function(){return s.refreshConfigurableOptions()}).catch(function(){})}}angular.module("fleioStaff").component("flBillingProductDetails",{templateUrl:"staff/apps/billing/products/productdetails.html",controller:e,bindings:{productDetails:"<"}}),e.$inject=["FlBilling","$stateParams","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlNotificationService"]}(),function(){"use strict";function e(t,e,n,i,o,r,a){var s=this;function l(){if(document.activeElement.blur(),!s.submitPending&&!s.productcycle_form.$invalid)return s.submitPending=!0,s.product_cycle.id?e.ProductCycles.update({id:s.product_cycle.id},s.product_cycle).$promise.then(function(e){return s.submitPending=!1,t.hide(e),n.add(i.getString("Product cycle modified")),e},function(e){return s.submitPending=!1,s.backendErrors=e.data}):e.ProductCycles.save(s.product_cycle).$promise.then(function(e){return s.submitPending=!1,t.hide(e),n.add(i.getString("Product cycle added")),e},function(e){return s.submitPending=!1,s.backendErrors=e.data})}function c(){return t.cancel()}s.$onInit=function(){s.defaultCurrency=null,s.saveProductCycle=l,s.close=c,s.product_cycle=void 0===o?{product:r.id||a.products[0].id,cycle:a.cycles[0][0],currency:a.currencies[0].code,status:a.statuses[0][0],cycle_multiplier:1,fixed_price:0,setup_fee:0,setup_fee_entire_quantity:!1,is_relative_price:!1}:o,s.pack=r,(s.create_options=a).currencies.forEach(function(e){e.is_default&&(s.defaultCurrency=e)})},s.changeCurrency=function(){s.defaultCurrency.code===s.product_cycle.currency&&(s.product_cycle.is_relative_price=!1)}}angular.module("fleioStaff").controller("FlProductCycleEditController",e),e.$inject=["$mdDialog","FlBilling","FlNotificationService","gettextCatalog","product_cycle","pack","create_options"]}(),function(){"use strict";function e(e,t,n,i,o,r){var a=this;function s(){a.plugin=a.createOptions.modules[a.pack.module].plugin}function l(){return a.productForm.$setSubmitted(),document.activeElement.blur(),a.submitPending||a.productForm.$invalid?a.plugin?a.productForm[a.pack.moduleConfigurationForm].$invalid?void(a.selectedTab=1):void(a.selectedTab=0):void 0:(a.submitPending=!0,a.pack.id?e.Products.update({id:a.pack.id},a.pack).$promise.then(function(e){return a.submitPending=!1,t.add(n.getString("Product modified")),a.goBackOrToState("billingProducts"),e},function(e){return a.submitPending=!1,a.backendErrors=e.data}):e.Products.save(a.pack).$promise.then(function(e){return a.submitPending=!1,t.add(n.getString("Product added")),i.go("billingProductDetails",{id:e.id}),e},function(e){return a.submitPending=!1,a.backendErrors=e.data,e.data}))}a.$onInit=function(){a.goBackOrToState=o.goBackOrToState,a.saveProduct=l,a.close=r.cancel,a.moduleChanged=s,a.pack?(a.pack.group=a.pack.group.id,a.pack.module=a.pack.module.id):a.pack={group:a.createOptions.groups[0].id,module:Object.keys(a.createOptions.modules)[0],product_type:a.createOptions.product_types[0][0],status:a.createOptions.statuses[0][0],price_model:a.createOptions.price_models[0][0],auto_setup:a.createOptions.auto_setups[0][0],has_quantity:!1,taxable:!0};a.moduleChanged()}}angular.module("fleioStaff").component("flBillingProductEdit",{templateUrl:"staff/apps/billing/products/flbillingproductedit.html",controller:e,bindings:{createOptions:"<",pack:"="}}),e.$inject=["FlBilling","FlNotificationService","gettextCatalog","$state","FlUiUtilsService","$mdDialog"]}(),function(){"use strict";function e(t,e){var n=this;n.saveProductGroup=function(){if(document.activeElement.blur(),n.submitPending||n.productGroup_form.$invalid)return;{if(n.submitPending=!0,!n.productGroup.id)return e.ProductGroups.save(n.productGroup).$promise.then(function(e){return t.hide(e),e},function(e){n.submitPending=!1,n.backendErrors=e.data},function(e){n.submitPending=!1,n.backendErrors=e.data});e.ProductGroups.update({id:n.productGroup.id},n.productGroup).$promise.then(function(e){return t.hide(e),e},function(e){n.submitPending=!1,n.backendErrors=e.data})}},n.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlProductGroupEditController",e),e.$inject=["$mdDialog","FlBilling"]}(),function(){"use strict";function e(e,t,n){var i=this;i.$onInit=function(){i.selectedOption=null},i.close=function(){t.cancel()},i.clearBackendErrors=function(){i.backendErrors=null},i.associateConfigurableOption=function(){i.optionId&&i.productId&&e.Products.save({id:i.productId,action:"associate_configurable_option"},{configurable_option:i.optionId}).$promise.then(function(e){n.add(e.detail),t.hide()}).catch(function(e){i.backendErrors=e.data})}}angular.module("fleioStaff").controller("FlAssociateProductOption",e),e.$inject=["FlBilling","$mdDialog","FlNotificationService"]}(),function(){"use strict";function e(n,i,o,e){var r=this;r.$onInit=function(){r.upgradeProducts={},n.Products.get({id:r.productId,action:"upgrade_options"}).$promise.then(function(e){r.upgrades=e.available_products,e.selected_products.map(function(e){r.upgradeProducts[e.id]=!0})})},r.saveUpgradeOptions=function(){var e=[];for(var t in r.upgradeProducts)r.upgradeProducts.hasOwnProperty(t)&&!0===r.upgradeProducts[t]&&e.push(t);n.Products.save({id:r.productId,action:"upgrade_options"},{upgrades:e}).$promise.then(function(e){i.add(o.getString("Upgrade options saved"))}).catch(function(e){i.add(e.data)})}}angular.module("fleioStaff").component("flBillingProductUpgrades",{templateUrl:"staff/apps/billing/products/upgrades/product-upgrades.component.html",controller:e,bindings:{productId:"<",upgrades:"<"}}),e.$inject=["FlBilling","FlNotificationService","gettextCatalog","$state"]}(),function(){"use strict";function e(t,n,i,o,e,r,a){var s=this;function l(){return s.taxRules.fetchData()}s.deleteTaxRule=function(e){return n.yesNoDlg(i.getString("Are you sure?"),i.getString("Delete tax rule {{tax_rule}}",{name:e.name}),i.getString("Delete tax rule")).then(function(){return t.TaxRules.delete({id:e.id}).$promise.then(function(){o.add(i.getString("Tax rule deleted")),l()})}).catch(function(){})},s.$onInit=function(){e.info.enabled=!0,e.info.label=r("Search tax rules"),e.info.service=s.taxRules},s.editTaxRule=function(e,t){return a.show({templateUrl:"staff/apps/billing/taxrules/flbillingtaxruleedit.html",controller:"FlBillingTaxRuleEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,bindToController:!0,locals:{rule:t},targetEvent:e}).then(function(){return l()}).catch(function(){})}}angular.module("fleioStaff").component("flBillingTaxRules",{templateUrl:"staff/apps/billing/taxrules/taxrules.html",controller:e,bindings:{taxRules:"<"}}),e.$inject=["FlBilling","FlUiUtilsService","gettextCatalog","FlNotificationService","FlSearchService","gettext","$mdDialog"]}(),function(){"use strict";function e(e,t,n,i){var o=this;o.$onInit=function(){o.initializing=!0,e.TaxRules.get({actions:"create_options"}).$promise.then(function(e){o.initializing=!1,o.rule||(o.rule={start_date:new Date,level:e.levels.length?e.levels[0][0]:"",country:e.countries.length?e.countries[0]:""}),o.create_options=e,o.countries=o.create_options.countries?o.create_options.countries:[];var t=o.countries.filter(function(e){return e===o.rule.country});o.selectedCountry=t[0]},function(e){o.initializing=!1,o.backendErrors=e.data})},o.saveTaxRule=function(){if(document.activeElement.blur(),o.submitPending||o.rule_form.$invalid)return;o.submitPending=!0,o.rule.start_date=moment(o.rule.start_date).format("YYYY-MM-DD"),o.rule.end_date&&(o.rule.end_date=moment(o.rule.end_date).format("YYYY-MM-DD"));return o.rule.id?e.TaxRules.update({id:o.rule.id},o.rule).$promise.then(function(e){return i.hide(e),t.add(n.getString("Tax rule modified")),e},function(e){o.submitPending=!1,o.backendErrors=e.data}):e.TaxRules.save(o.rule).$promise.then(function(e){return i.hide(e),t.add(n.getString("Tax rule added")),e},function(e){o.submitPending=!1,o.backendErrors=e.data})},o.close=function(){return i.cancel()},o.$onInit(),o.selectedCountryChange=function(e){e&&(o.rule.country=e)},o.querySearch=function(e){return e?o.countries.filter(function(e){var t=e.toLowerCase();return function(e){return 0===e.toLowerCase().indexOf(t)}}(e)):o.countries}}angular.module("fleioStaff").controller("FlBillingTaxRuleEditController",e),e.$inject=["FlBilling","FlNotificationService","gettextCatalog","$mdDialog"]}(),function(){"use strict";function e(n,i,o,r){var a=this;a.saveAndContinue=!1,a.saveInProgress=!1,a.$onInit=function(){a.widget=a.option.widget,n.ConfigurableOptions.get({action:"create_options"}).$promise.then(function(e){a.createOptions=e}).catch(console.error)},a.changeOptionType=function(){a.saveAndContinue=!0,a.widget=a.option.widget},a.refreshOption=function(){n.ConfigurableOptions.get({id:a.option.id}).$promise.then(function(e){a.option=e}).catch(function(e){console.error(e)})},a.addEditChoice=function(e,t){return i.show({templateUrl:"staff/apps/billing/configurable_options/choices/choice.dialog.html",controller:"FlOptionChoiceEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:e,bindToController:!0,locals:{choice:t,optionId:a.option.id}}).then(function(e){a.refreshOption(),r.add(o.getString("Choice "+e.label+" modified"))}).catch(console.error)},a.deleteChoice=function(e,t){n.ConfigurableOptionsChoices.delete({id:t.id}).$promise.then(function(e){r.add(o.getString("Choice "+t.label+" deleted")),a.refreshOption()})},a.saveOption=function(){a.configOptForm.$invalid||a.saveInProgress||(a.saveInProgress=!0,n.ConfigurableOptions.update(a.option).$promise.then(function(e){a.option=e,r.add(o.getString("Configurable option saved")),a.configOptForm.$setPristine()}).catch(function(e){a.backendErrors=e.data}).finally(function(){a.saveInProgress=!1,a.saveAndContinue=!1}))}}angular.module("fleioStaff").component("flConfigurableOption",{templateUrl:"staff/apps/billing/configurable_options/option.component.html",controller:e,bindings:{option:"<"}}),e.$inject=["FlBilling","$mdDialog","gettextCatalog","FlNotificationService"]}(),function(){"use strict";function e(e,t,n,i){var o=this;o.option={settings:{}},o.$onInit=function(){},o.saveOption=function(){e.ConfigurableOptions.save(o.option).$promise.then(function(e){n.add(i.getString("Configurable option saved")),t.go("billingConfigurableOption",{id:e.id})}).catch(function(e){console.error(e),o.backendErrors=e.data})}}angular.module("fleioStaff").component("flConfigurableOptionCreate",{templateUrl:"staff/apps/billing/configurable_options/createoption.component.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["FlBilling","$state","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(n,i,o,r){var a=this;a.deleteOption=function(e,t){return i.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete option {{name}}",{name:t.internal_name}),r.getString("Delete option")).then(function(){n.ConfigurableOptions.delete({id:t.id}).$promise.then(function(e){o.add("Option deleted"),a.options.fetchData()}).catch(function(e){o.add(e.message)})}).catch(function(){})}}angular.module("fleioStaff").component("flConfigurableOptionList",{templateUrl:"staff/apps/billing/configurable_options/optionlist.component.html",controller:e,bindings:{options:"<"}}),e.$inject=["FlBilling","FlUiUtilsService","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(t,n){var i=this,e={setup_fee:0,is_relative_price:!0,setup_fee_entire_quantity:!0,cycle_multiplier:1,cycle:"month",value:i.value_id||null,option:i.option_id||null};i.$onInit=function(){n.ConfigurableOptionsCycles.get({action:"create_options"}).$promise.then(function(e){i.createOptions=e}),void 0!==i.cycle_id?i.option_cycle=n.ConfigurableOptionsCycles.get({id:i.cycle_id}):i.option_cycle=e},i.showPricingInputs=function(){return!i.createOptions||!i.option_cycle||(!1===i.option_cycle.is_relative_price&&i.createOptions.default_currency.code!==i.option_cycle.currency||i.createOptions.default_currency.code===i.option_cycle.currency)},i.saveOptionCycle=function(){if(!i.optionCycleForm.$invalid){i.option_cycle.is_relative_price&&i.createOptions.default_currency.code!==i.option_cycle.currency&&(i.option_cycle.price||(i.option_cycle.price=0));var e=n.ConfigurableOptionsCycles.save;i.option_cycle.id&&(e=n.ConfigurableOptionsCycles.update),e(i.option_cycle).$promise.then(function(e){t.hide(e)}).catch(function(e){i.backendErrors=e.data})}},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlOptionCycleEditController",e),e.$inject=["$mdDialog","FlBilling"]}(),function(){"use strict";function e(n,i,o){var r=this;r.refreshCycles=function(){var e={};if(r.valueId)e={value:r.valueId};else{if(!r.optionId)return void console.error("No option or choice provided");e={option:r.optionId}}n.ConfigurableOptionsCycles.get(e).$promise.then(function(e){r.cycles=e.objects}).catch(console.error)},this.editCycle=function(e,t){return i.show({templateUrl:"staff/apps/billing/configurable_options/cycles/optioncycleedit.html",controller:"FlOptionCycleEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:e,bindToController:!0,locals:{value_id:r.valueId,cycle_id:t.id,option_id:r.optionId,widget:r.widget}}).then(function(e){r.refreshCallback&&r.refreshCallback()}).catch(function(){})},this.deleteCycle=function(e,t){n.ConfigurableOptionsCycles.delete({id:t.id}).$promise.then(function(e){o.add(t.display_name+" cycle deleted"),r.refreshCallback&&r.refreshCallback()}).catch(function(e){console.error(e),o.add("Error deleting "+t.display_name)})},this.addCycle=function(e){return i.show({templateUrl:"staff/apps/billing/configurable_options/cycles/optioncycleedit.html",controller:"FlOptionCycleEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:e,bindToController:!0,locals:{value_id:r.valueId,option_id:r.optionId,widget:r.widget}}).then(function(){r.refreshCallback&&r.refreshCallback()}).catch(function(){})}}angular.module("fleioStaff").component("flConfigurableOptionCycles",{templateUrl:"staff/apps/billing/configurable_options/cycles/optioncyclelist.component.html",controller:e,bindings:{cycles:"<",valueId:"<",optionId:"<",widget:"<",showHeader:"@",refreshCallback:"&"}}),e.$inject=["FlBilling","$mdDialog","FlNotificationService"]}(),function(){"use strict";function e(t,e){var n=this;n.editingChoice=!0,n.$onInit=function(){n.choice||(n.editingChoice=!1,n.choice={option:n.optionId})},n.saveOptionChoice=function(){n.optionChoiceForm.$invalid||(n.choice.id?e.ConfigurableOptionsChoices.update(n.choice).$promise.then(function(e){return t.hide(e)}).catch(function(e){n.backendErrors=e.data}):e.ConfigurableOptionsChoices.save(n.choice).$promise.then(function(e){return t.hide(e)}).catch(function(e){n.backendErrors=e.data}))},n.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlOptionChoiceEditController",e),e.$inject=["$mdDialog","FlBilling"]}(),function(){"use strict";function e(e,t,n,i){var o=this;o.$onInit=function(){},o.saveServer=function(){o.serverEditForm.$setSubmitted(),o.serverEditForm.settings&&(o.serverEditForm.settings.$setSubmitted(),o.serverEditForm.settings.$invalid)||e.Servers.update(o.server).$promise.then(function(e){n.add(i.getString("Server {{name}} updated",{name:o.server.name})),o.goToServerList()}).catch(function(e){o.backendErrors=e.data})},o.goToServerList=function(){t.go("serverList")}}angular.module("fleioStaff").component("flServerDetails",{templateUrl:"staff/apps/servers/flserver-detail/flserver-detail.component.html",controller:e,bindings:{server:"<"}}),e.$inject=["FlServersApi","$state","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(t,n,i,o){var r=this;r.$onInit=function(){},r.deleteServer=function(e){return o.yesNoDlg(i.getString("Are you sure ?"),i.getString("Delete server {{name}}",{name:e.name})).then(function(){t.Servers.delete({id:e.id}).$promise.then(function(){n.add(i.getString("Server {{name}} deleted",{name:e.name})),r.servers.fetchData()}).catch(function(e){n.add(e.data)})})}}angular.module("fleioStaff").component("flServerList",{templateUrl:"staff/apps/servers/flserver-list/flserver-list.component.html",controller:e,bindings:{servers:"<"}}),e.$inject=["FlServersApi","FlNotificationService","gettextCatalog","FlUiUtilsService"]}(),function(){"use strict";function e(e,t,n,i){var o=this;o.selectedPlugin=null,o.$onInit=function(){o.server={},o.serverSettings={},o.createOptions.statusList[0]&&(o.server.status=o.createOptions.statusList[0][0]),o.createOptions.plugins[0]&&(o.selectedPlugin=o.createOptions.plugins[0],o.server.plugin=o.selectedPlugin.id),o.createOptions.groups[0]&&(o.server.group=o.createOptions.groups[0].id)},o.changePlugin=function(){o.createOptions.plugins.map(function(e){e.id===o.server.plugin&&(o.selectedPlugin=e)})},o.createServer=function(){o.serverCreateForm.$setSubmitted(),o.serverCreateForm.$invalid||o.serverCreateForm.settings&&(o.serverCreateForm.settings.$setSubmitted(),o.serverCreateForm.settings.$invalid)||e.Servers.save(o.server).$promise.then(function(){n.go("serverList").then(function(){t.add(i.getString("Server {{name}} created",{name:o.server.name}))})}).catch(function(e){o.backendErrors=e.data})}}angular.module("fleioStaff").component("flServerCreate",{templateUrl:"staff/apps/servers/flserver-create/flserver-create.component.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["FlServersApi","FlNotificationService","$state","gettextCatalog"]}(),function(){"use strict";function e(t,n,i,o){var r=this;r.$onInit=function(){},r.getPlacement=function(e){return 1===e.placement?i.getString("In order"):2===e.placement?i.getString("Least full"):void 0},r.deleteServerGroup=function(e){return o.yesNoDlg(i.getString("Are you sure ?"),i.getString("Delete server group {{name}}",{name:e.name})).then(function(){t.ServerGroups.delete({id:e.id}).$promise.then(function(){n.add(i.getString("Server group {{name}} deleted",{name:e.name})),r.serverGroups.fetchData()}).catch(function(e){n.add(e.data)})})}}angular.module("fleioStaff").component("flServerGroupList",{templateUrl:"staff/apps/servers/flservergroup-list/flservergroup-list.component.html",controller:e,bindings:{serverGroups:"<"}}),e.$inject=["FlServersApi","FlNotificationService","gettextCatalog","FlUiUtilsService"]}(),function(){"use strict";function e(e,t,n,i){var o=this;o.$onInit=function(){o.group={placement:1}},o.cancel=function(){return n.go("serverGroupList")},o.createServerGroup=function(){e.ServerGroups.save(o.group).$promise.then(function(){n.go("serverGroupList").then(function(){t.add(i.getString("Server group {{name}} created",{name:o.group.name}))})}).catch(function(e){o.backendErrors=e.data})}}angular.module("fleioStaff").component("flServerGroupCreate",{templateUrl:"staff/apps/servers/flservergroup-create/flservergroup-create.component.html",controller:e}),e.$inject=["FlServersApi","FlNotificationService","$state","gettextCatalog"]}(),function(){"use strict";function e(t,n,i,o,e){var r=this;r.$onInit=function(){},r.saveServerGroup=function(){t.ServerGroups.update(r.serverGroup).$promise.then(function(e){r.serverGroup=e,n.add(i.getString("Server group {{name}} updated",{name:r.serverGroup.name})),r.goToServerGroups()}).catch(function(e){r.backendErrors=e.data})},r.goToServerGroups=function(){e.go("serverGroupList")},r.deleteServerGroup=function(e){return o.yesNoDlg(i.getString("Are you sure ?"),i.getString("Delete server group {{name}}",{name:e.name})).then(function(){t.ServerGroups.delete({id:e.id}).$promise.then(function(){n.add(i.getString("Server group {{name}} deleted",{name:e.name})),r.serverGroups.fetchData()}).catch(function(e){n.add(e.data)})})}}angular.module("fleioStaff").component("flServerGroupDetails",{templateUrl:"staff/apps/servers/flservergroup-detail/flservergroup-detail.component.html",controller:e,bindings:{serverGroup:"<"}}),e.$inject=["FlServersApi","FlNotificationService","gettextCatalog","FlUiUtilsService","$state"]}(),function(){"use strict";function e(e,t){return{Servers:e(t.api_url+"/server/:id/:action",{id:"@id",action:"@action"}),ServerGroups:e(t.api_url+"/servergroup/:id/:action",{id:"@id",action:"@action"})}}angular.module("fleioStaff").factory("FlServersApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n){e.state("serverList",{url:t.joinBaseUrl("servers"),component:"flServerList",data:{stateInfo:{display:n("Servers"),parent:"dashboard"},feature:"servers",orderOptions:{name:n("Name"),created_at:n("Created at"),group:n("Group")}},params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{servers:["FlObjectList","FlServersApi","FlResolveErrorHandler","$stateParams",function(e,t,n,i){return e(t.Servers,i).catch(n.handleError)}]}}).state("serverCreate",{url:t.joinBaseUrl("servers/create"),component:"flServerCreate",data:{stateInfo:{display:n("New server"),parent:"serverList"},feature:"servers"},resolve:{createOptions:["FlServersApi","FlResolveErrorHandler",function(e,t){return e.Servers.get({action:"create_options"}).$promise.catch(t.handleError)}]}}).state("serverDetails",{url:t.joinBaseUrl("servers/:id"),component:"flServerDetails",data:{stateInfo:{display:n("Server details"),parent:"serverList"},feature:"servers"},resolve:{server:["FlServersApi","FlResolveErrorHandler","$stateParams",function(e,t,n){return e.Servers.get(n).$promise.catch(t.handleError)}]}}).state("serverGroupDetails",{url:t.joinBaseUrl("server-groups/:id"),component:"flServerGroupDetails",data:{stateInfo:{display:n("Server group details"),parent:"serverGroupList"},feature:"servers"},resolve:{serverGroup:["FlServersApi","FlResolveErrorHandler","$stateParams",function(e,t,n){return e.ServerGroups.get(n).$promise.catch(t.handleError)}]}}).state("serverGroupCreate",{url:t.joinBaseUrl("server-groups/create"),component:"flServerGroupCreate",data:{stateInfo:{display:n("New server group"),parent:"serverGroupList"},feature:"servers"}}).state("serverGroupList",{url:t.joinBaseUrl("server-groups"),component:"flServerGroupList",data:{stateInfo:{display:n("Server groups"),parent:"dashboard"},feature:"servers",orderOptions:{name:n("Name")}},params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"name",squash:!0},filtering:{value:"",squash:!0}},resolve:{serverGroups:["FlObjectList","FlServersApi","FlResolveErrorHandler","$stateParams",function(e,t,n,i){return e(t.ServerGroups,i).catch(n.handleError)}]}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(i){return{restrict:"E",scope:{widgetName:"=",widgetData:"="},template:"<div></div>",controller:["$scope","$element",function(e,t){var n=i("<fl-"+e.widgetName+'-widget data="widgetData"></fl-'+e.widgetName+"-widget>")(e);t.append(n)}]}}angular.module("fleioStaff").directive("flWidget",e),e.$inject=["$compile"]}(),function(){"use strict";function e(e){return e.$on("chart-create",function(e,t){angular.element(document.getElementById(t.config.options.legendId)).html(t.config.options.legendCallback(t))}),{options:function(e,t){return{legendId:t,title:{display:!0,text:e},legend:{display:!1,maxHeight:788},legendCallback:function(e){var t=[];t.push('<div class="chart-legend">');for(var n=0;n<e.data.datasets[0].data.length;n++)t.push('<div class="chart-legend-item"><span style="background-color:'+e.data.datasets[0].backgroundColor[n]+'">'),e.data.labels[n]&&t.push(e.data.labels[n]),t.push("</span></div>");return t.push("</div>"),t.join("")},tooltips:{callbacks:{label:function(e,t){var n=t.datasets[0].data.reduce(function(e,t){return e+t},0),i=Math.round(t.datasets[0].data[e.index]/n*100);return t.labels[e.index]+": "+t.datasets[0].data[e.index]+" ("+i+"%)"}}}}}}}angular.module("fleioStaff").factory("FlWidgetChartService",e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(e){var t=this;t.reloadData=function(){t.data.data=null,e.get({options:"summary"}).$promise.then(function(e){t.data.data=e})},t.$onInit=function(){t.data.callback=t.reloadData,1===Object.keys(t.data).length&&t.data.constructor===Object&&t.reloadData()}}angular.module("fleioStaff").component("flClientsWidget",{templateUrl:"staff/apps/dashboard/widgets/clients/flclients.widget.html",controller:e,bindings:{data:"<"}}),e.$inject=["FlClientApi"]}(),function(){"use strict";function e(e,t,n,i){var o=this;o.reloadData=function(){o.systems=null,o.updated_info_details=null,e.get(t.api_url+"/services-statuses").then(function(e){o.systems=e.data}),e.get(t.api_url+"/app-status").then(function(e){o.updated_info_details=e.data.updated_info_details,o.updated_info_last_updated=e.data.updated_info_last_updated})},o.$onInit=function(){o.features=i.features,o.statusMap={false:n.getString("not running"),true:n.getString("running")},o.reloadData(),o.data.callback=o.reloadData}}angular.module("fleioStaff").component("flSystemServicesWidget",{templateUrl:"staff/apps/dashboard/widgets/system_services/flsystemservices.widget.html",controller:e,bindings:{data:"<"}}),e.$inject=["$http","CONFIG","gettextCatalog","FlFeatureService"]}(),function(){"use strict";function e(e){var t=this;t.reloadData=function(){t.data.data=null,e.Invoices.get({options:"summary"}).$promise.then(function(e){t.data.data=e})},t.$onInit=function(){t.data.callback=t.reloadData,1===Object.keys(t.data).length&&t.data.constructor===Object&&t.reloadData()}}angular.module("fleioStaff").component("flBillingWidget",{templateUrl:"staff/apps/dashboard/widgets/billing/flbilling.widget.html",controller:e,bindings:{data:"<"}}),e.$inject=["FlBilling"]}(),function(){"use strict";function e(e,t,n){var i=this;i.reloadData=function(){i.data.data={},e.Instances.get({options:"summary"}).$promise.then(function(e){i.data.data=e;for(var t=0;t<i.data.data.instance_status_labels.length;t++)i.data.data.instance_status_labels[t]=n.getString(i.data.data.instance_status_labels[t])})},i.$onInit=function(){i.state_options=t.options(n.getString("Instance state distribution"),"instances-state-dougnut-legend"),i.region_options=t.options(n.getString("Instance region distribution"),"instances-region-dougnut-legend"),i.data.callback=i.reloadData,1===Object.keys(i.data).length&&i.data.constructor===Object&&i.reloadData()}}angular.module("fleioStaff").component("flInstancesWidget",{templateUrl:"staff/apps/dashboard/widgets/instances/flinstances.widget.html",controller:e,bindings:{data:"<"}}),e.$inject=["FlOsApi","FlWidgetChartService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){var i=this;i.reloadData=function(){i.data.data=null,e.Flavors.get({options:"summary"}).$promise.then(function(e){i.data.data=e})},i.$onInit=function(){i.data.callback=i.reloadData,i.options=t.options(n.getString("Flavor distribution"),"flavor-doughnut-legend"),1===Object.keys(i.data).length&&i.data.constructor===Object&&i.reloadData()}}angular.module("fleioStaff").component("flFlavorsWidget",{templateUrl:"staff/apps/dashboard/widgets/flavors/flflavors.widget.html",controller:e,bindings:{data:"<"}}),e.$inject=["FlOsApi","FlWidgetChartService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){var i=this;i.reloadData=function(){i.data.data=null,e.Summary.get({action:"operating_systems"}).$promise.then(function(e){i.data.data=e})},i.$onInit=function(){i.options=t.options(n.getString("Operating system distribution"),"os-doughnut-legend"),i.data.callback=i.reloadData,1===Object.keys(i.data).length&&i.data.constructor===Object&&i.reloadData()}}angular.module("fleioStaff").component("flOsWidget",{templateUrl:"staff/apps/dashboard/widgets/os/flos.widget.html",controller:e,bindings:{data:"<"}}),e.$inject=["FlOsApi","FlWidgetChartService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){var i=this;i.reloadData=function(){i.data.data=null,i.selectedHypervisor={},e.Summary.get({action:"hypervisors"}).$promise.then(function(e){(i.data.data=e).hypervisors.length&&(i.selectedHypervisor=e.hypervisors[0])})},i.$onInit=function(){i.memory_options=t.options(n.getString("Hypervisor memory"),"hv-memory-doughnut-legend"),i.vcpus_options=t.options("vCPUs","hv-vcpu-doughnut-legend"),i.disk_options=t.options(n.getString("Disk"),"hv-disk-doughnut-legend"),i.data.callback=i.reloadData,1===Object.keys(i.data).length&&i.data.constructor===Object?i.reloadData():i.data.data.hypervisors.length&&(i.selectedHypervisor=i.data.data.hypervisors[0])}}angular.module("fleioStaff").component("flHypervisorsWidget",{templateUrl:"staff/apps/dashboard/widgets/hypervisors/flhypervisors.widget.html",controller:e,bindings:{data:"<"}}),e.$inject=["FlOsApi","FlWidgetChartService","gettextCatalog"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/configurations/:id/:section",{id:"@id",section:"@section"})}angular.module("fleioStaff").factory("FlConfigurationsApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(t,e,n,i,o,r,a){var s=this;s.$onInit=function(){e.info.enabled=!0,e.info.label=n("Search configurations"),e.info.service=s.configurations},s.createConfiguration=function(e,t){return i.show({templateUrl:"staff/apps/settings/configurations/configurationedit.html",controller:"FlConfigurationEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{configuration:angular.copy(t)},bindToController:!0,targetEvent:e}).finally(function(){return s.configurations.fetchData()}).catch(function(){})},s.editConfiguration=function(e,t){return i.show({templateUrl:"staff/apps/settings/configurations/configurationedit.html",controller:"FlConfigurationEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{configuration:angular.copy(t)},bindToController:!0,targetEvent:e}).finally(function(){return s.configurations.fetchData()}).catch(function(){})},s.deleteConfiguration=function(e){return o.yesNoDlg(r.getString("Are you sure you want to delete {{name}}?",{name:e.name}),r.getString("Delete configuration")).then(function(){t.delete({id:e.id}).$promise.then(function(){a.add(r.getString("Configuration deleted")),s.configurations.fetchData()})}).catch(function(){})}}angular.module("fleioStaff").component("flConfigurationsList",{templateUrl:"staff/apps/settings/configurations/configurations.html",controller:e,bindings:{configurations:"<"}}),e.$inject=["FlConfigurationsApi","FlSearchService","gettext","$mdDialog","FlUiUtilsService","gettextCatalog","FlNotificationService"]}(),function(){"use strict";function e(t,n,i,e,o,r,a,s){var l=this;function c(e){return n.yesNoDlg(a.getString("Are you sure you want to delete {{name}}?",{name:e.name}),a.getString("Delete configuration")).then(function(){t.delete({id:e.id}).$promise.then(function(){i.add(a.getString("Configuration deleted")),o.go("configurationsList")})}).catch(function(){})}l.$onInit=function(){l.deleteConfiguration=c,l.loadingOpenstackSettings=!1,l.features=e.features,l.goBackOrToState=n.goBackOrToState,l.autoCreateServiceChanged(),s.get({action:"plugins_with_component",component_name:"PluginConfiguration"}).$promise.then(function(e){l.plugins=e.plugins})},l.saveSettings=function(e){l.submitPending||l.billingSettingsForm.$invalid||(l.submitPending=!0,l.backendErrors=null,t.update({id:e,section:"billing"},l.billingSettings).$promise.then(function(e){i.add(e.detail),e.settings&&(l.billingSettings=e.settings,l.autoCreateServiceChanged())}).catch(function(e){l.backendErrors=e.data}).finally(function(){l.submitPending=!1}))},l.autoCreateServiceChanged=function(){if(l.autoCreateProduct=null,l.billingSettings.auto_order_service&&l.billingSettings.products.length)for(var e=0;e<l.billingSettings.products.length;e++)l.billingSettings.auto_order_service===l.billingSettings.products[e].id&&(l.autoCreateProduct=l.billingSettings.products[e])}}angular.module("fleioStaff").component("flConfigurationDetails",{templateUrl:"staff/apps/settings/configurations/configurationdetails.html",controller:e,bindings:{configuration:"<",billingSettings:"<"}}),e.$inject=["FlConfigurationsApi","FlUiUtilsService","FlNotificationService","FlFeatureService","$state","$stateParams","gettextCatalog","PluginsApi"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/notification_templates/:id/:action",{id:"@id",action:"@action"})}angular.module("fleioStaff").factory("FlNotificationTemplatesApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/notifications_categories/:id/:action",{id:"@id",action:"@action"})}angular.module("fleioStaff").factory("FlNotificationTemplatesCategoriesApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n,i,o,r){var a=this;a.$onInit=function(){e.info.enabled=!0,e.info.label=n("Search notifications"),e.info.service=a.notifications},a.deleteNotification=function(e){return i.yesNoDlg(o.getString("Are you sure?"),o.getString("Delete notification {{name}}",{name:e.name}),o.getString("Delete notification")).then(function(){return t.delete({id:e.id}).$promise.then(function(){a.notifications.fetchData(),r.add(o.getString("Notification deleted"))})}).catch(function(){})}}angular.module("fleioStaff").component("flNotificationTemplatesComponent",{templateUrl:"staff/apps/settings/notifications/flnotification-templates.template.html",controller:e,bindings:{notifications:"<",notificationsCategories:"<"}}),e.$inject=["FlSearchService","FlNotificationTemplatesApi","gettext","FlUiUtilsService","gettextCatalog","FlNotificationService"]}(),function(){"use strict";function e(t,e,n,i,o){var r=this;r.$onInit=function(){r.name=o,e.get({action:"get_available_languages_for_template",template_name:r.name}).$promise.then(function(e){r.available_languages=e.objects}).catch(function(e){n.add(e)})},r.close=function(){return t.cancel()},r.addTemplate=function(){document.activeElement.blur(),r.submitPending||r.newTemplateForm.$invalid||(r.submitPending=!0,e.post({name:r.name,language:r.language}).$promise.then(function(e){return r.submitPending=!1,t.hide(e),e}).catch(function(e){r.submitPending=!1,n.add(i.getString(e.data.detail))}))}}angular.module("fleioStaff").controller("FlSelectTemplateLanguageController",e),e.$inject=["$mdDialog","FlNotificationTemplatesApi","FlNotificationService","gettextCatalog","name"]}(),function(){"use strict";function e(t,e,n,i,o,r,a){var s=this;function l(){return t.get({action:"get_editable_notification_templates",template_id:s.defaultTemplateId}).$promise.then(function(e){s.templates=e}).catch(function(e){r.add(e)})}s.$onInit=function(){s.tinymceOptions=e.tiny_mce_options,s.goBackOrToState=n.goBackOrToState,s.templateName=s.templates.objects[0].name,s.disableNotification=s.templates.objects[0].disable_notification},s.deleteTemplate=function(e){return n.yesNoDlg(o.getString("Are you sure?"),o.getString("Delete {{language}} template",{language:e.language}),o.getString("Delete template")).then(function(){return t.delete({id:e.id}).$promise.then(function(){l(),r.add(o.getString("Template deleted"))})}).catch(function(){})},s.addNewTemplate=function(e){return a.show({templateUrl:"staff/apps/settings/notifications/create/select-template-language.template.html",controller:"FlSelectTemplateLanguageController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{name:s.templates.objects[0].name},bindToController:!0,targetEvent:e}).then(function(){l()}).catch(function(){})},s.saveTemplates=function(){if(document.activeElement.blur(),!s.submitPending&&!s.editNotificationTemplate.$invalid){s.submitPending=!0;for(var e=0;e<s.templates.objects.length;e++)s.templates.objects[e].disable_notification=s.disableNotification;t.post({action:"update_templates_set"},s.templates.objects).$promise.then(function(e){s.submitPending=!1,l(),r.add(o.getString("Templates successfully updated"))}).catch(function(e){s.submitPending=!1,s.backendErrors=e.data})}},s.clickVariable=function(e){var t=document.createElement("textarea");t.value=e.item,document.body.appendChild(t),t.select(),document.execCommand("Copy"),t.remove(),r.add(o.getString("Successfully copied"))}}angular.module("fleioStaff").component("flNotificationTemplateEditComponent",{templateUrl:"staff/apps/settings/notifications/edit/flnotification-template-edit.template.html",controller:e,bindings:{defaultTemplateId:"<",createOptions:"<",templates:"<"}}),e.$inject=["FlNotificationTemplatesApi","CONFIG","FlUiUtilsService","$state","gettextCatalog","FlNotificationService","$mdDialog"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/currency/:code:action",{action:"@action"})}angular.module("fleioStaff").factory("FlCurrencyApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(i,t,n,o,e,r,a){var s=this;s.$onInit=function(){return e(r,a).then(function(e){s.currencies=e})},s.editCurrency=function(t,n){s.loading=!0,r.get({code:"create_options"}).$promise.then(function(e){return s.loading=!1,i.show({templateUrl:"staff/apps/settings/general/currency/flcurrencyedit.html",controller:"FlCurrencyEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{currency:angular.copy(n),codes:e.codes},bindToController:!0,targetEvent:t}).then(function(){return s.currencies.fetchData()}).catch(function(){})},function(e){return s.loading=!1,s.backendErrors=e.data})},s.deleteCurrency=function(e){return n.yesNoDlg(o.getString("Related objects will not be deleted."),o.getString("Delete currency {{code}}?",{code:e.code}),o.getString("Delete")).then(function(){r.delete({code:e.code}).$promise.then(function(){t.add(o.getString("Currency deleted")),s.currencies.fetchData()}).catch(function(e){return"ProtectedError"===e.data.error_type?(console.error(e.data.detail),t.add(e.data.user_friendly_message)):t.add(e.data.detail)})}).catch(function(){})},s.updateRelativePrices=function(){return n.yesNoDlg(o.getString("Update relative prices for all products?"),o.getString("Update relative prices")).then(function(){r.save({action:"update_relative_prices"}).$promise.then(function(){t.add(o.getString("Relative prices updated"))})}).catch(function(){})},s.updateExchangeRates=function(){return n.yesNoDlg(o.getString("Update exchange rates?"),o.getString("Update exchange rates")).then(function(){r.save({action:"update_exchange_rates"}).$promise.then(function(){t.add(o.getString("Exchange rates updated")),s.currencies.fetchData()})}).catch(function(){})}}angular.module("fleioStaff").component("flCurrencies",{templateUrl:"staff/apps/settings/general/currency/flcurrencies.html",controller:e}),e.$inject=["$mdDialog","FlNotificationService","FlUiUtilsService","gettextCatalog","FlObjectList","FlCurrencyApi","$stateParams"]}(),function(){"use strict";function e(t,n,e,i){var o=this;function r(e){return e?o.codes.filter(function(e){var t=e.toLowerCase();return function(e){return 0===e.toLowerCase().indexOf(t)}}(e)):o.codes}function a(){return t.cancel()}function s(){if(document.activeElement.blur(),!o.submitPending&&!o.currencyForm.$invalid){if(o.submitPending=!0,o.currency.is_default&&(o.currency.rate=1),o.currency.new_currency)return e.save(o.currency).$promise.then(function(e){return t.hide(e),n.add(i.getString("Currency added")),e},function(e){return o.submitPending=!1,o.backendErrors=e.data},function(e){o.submitPending=!1,o.backendErrors=e.data});e.update({code:o.currency.code},o.currency).$promise.then(function(e){return t.hide(e),n.add(i.getString("Currency modified")),e},function(e){o.submitPending=!1,o.backendErrors=e.data})}}o.$onInit=function(){o.querySearch=r,o.saveCurrency=s,o.close=a,o.currency||(o.currency={is_default:!1,new_currency:!0}),o.codes=o.codes?o.codes:[]}}angular.module("fleioStaff").controller("FlCurrencyEditController",e),e.$inject=["$mdDialog","FlNotificationService","FlCurrencyApi","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,i,o,r,a){var s=this;s.$onInit=function(){s.submitPending=!1,s.getCustomCode()},s.getCustomCode=function(){r.get({action:"get_custom_code"}).$promise.then(function(e){s.customCode=e}).catch(a.handleError)},s.saveCustomCode=function(){s.submitPending=!0,r.save({action:"save_custom_code",custom_code:s.customCode.custom_code}).$promise.then(function(){s.getCustomCode(),t.add(i.getString("Frontend customization saved"))}).catch(a.handleError).finally(function(){s.submitPending=!1})},s.updateFrontend=function(){r.save({action:"update_frontend"}).$promise.then(function(){t.add(i.getString("Frontend updated"))}).catch(a.handleError)}}angular.module("fleioStaff").component("frontendCustomization",{templateUrl:"staff/apps/settings/general/frontendcustomization/frontendcustomization.html",controller:e}),e.$inject=["$mdDialog","FlNotificationService","FlUiUtilsService","gettextCatalog","FlObjectList","FrontendCustomizationApi","FlResolveErrorHandler"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/frontend-customization/:id/:action",{id:"@id",action:"@action"})}angular.module("fleioStaff").factory("FrontendCustomizationApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n){var i=this;i.$onInit=function(){i.loadSettings=!0,e.get({}).$promise.then(function(e){i.settings=e.signup_settings,i.templates=e.notification_templates}).catch(function(e){i.backendErrors=e.data}).finally(function(){i.loadSettings=!1})},i.saveSettings=function(){e.post(i.settings).$promise.then(function(e){t.add(n.getString("Settings saved"))}).catch(function(e){i.backendErrors=e.data})}}angular.module("fleioStaff").component("signUpSettings",{templateUrl:"staff/apps/settings/general/signup_settings/signupsettings.component.html",controller:e}),e.$inject=["SignUpSettingsServiceApi","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/settings/sign-up-settings/:action")}angular.module("fleioStaff").factory("SignUpSettingsServiceApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n,i,o,r){var a=this;a.$onInit=function(){a.tinymceOptions=o.tiny_mce_options,a.selectedTOSId=null,a.loadTermsOfService=!0,a.refreshTOS(null)},a.saveSettings=function(){t.post({require_end_users_to_agree_with_latest_tos:a.tosResponse.settings.require_end_users_to_agree_with_latest_tos,forbid_access_after:a.tosResponse.settings.forbid_access_after,ask_again_after:a.tosResponse.settings.ask_again_after}).$promise.then(function(e){n.add(i.getString("Settings saved"))}).catch(function(e){n.add(e.data.detail),a.backendErrors=e.data,a.refreshTOS(null)})},a.refreshTOS=function(t){e.get({}).$promise.then(function(e){a.tosResponse=e,t&&(a.selectedTOSId=t,a.loadTOS())}).catch(function(e){a.backendErrors=e.data}).finally(function(){a.loadTermsOfService=!1})},a.editTOS=function(){e.update(a.selectedTOS).$promise.then(function(e){n.add(i.getString("TOS updated"))}).catch(function(e){n.add(e.data.detail)})},a.deleteSelectedTOS=function(){return r.yesNoDlg(i.getString("Are you sure?"),i.getString("Delete TOS {{title}}",{title:a.selectedTOS.title}),i.getString("Delete TOS")).then(function(){return e.delete({id:a.selectedTOS.id}).$promise.then(function(e){n.add(i.getString("TOS deleted")),a.refreshTOS(),a.selectedTOSId=null}).catch(function(e){n.add(e.data.detail)})}).catch(function(){})},a.loadTOS=function(){null!==a.selectedTOSId&&(a.loadingTOS=!0,e.get({id:a.selectedTOSId}).$promise.then(function(e){a.selectedTOS=e}).catch(function(e){a.backendErrors=e.data}).finally(function(){a.loadingTOS=!1}))},a.addNewTOS=function(){a.addNewTOSForm.$setSubmitted(),a.submitPending||a.addNewTOSForm.$invalid||e.post(a.newTOS).$promise.then(function(e){n.add(i.getString("TOS added")),a.refreshTOS(e.id)}).catch(function(e){a.backendErrors=e.data})}}angular.module("fleioStaff").component("tosSettings",{templateUrl:"staff/apps/settings/general/tos_settings/tos-settings.component.html",controller:e}),e.$inject=["TOSServiceApi","TOSSettingsServiceApi","FlNotificationService","gettextCatalog","CONFIG","FlUiUtilsService"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/settings/tos-settings")}angular.module("fleioStaff").factory("TOSSettingsServiceApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/settings/tos/:id/:action",{id:"@id",action:"@action"})}angular.module("fleioStaff").factory("TOSServiceApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,n,i,t,o){var r=this;r.$onInit=function(){r.translatedStringsMap={disable_sfa:i.getString("Once disabled, users that use this\nmethod will not be required anymore\nto complete second factor auth step.\nThey will also need to reconfigure second\nfactor authentication if you'll re-enable this.")},r.reloadSettings=function(){r.loadSettings=!0,e.get({}).$promise.then(function(e){r.settings=e.sfa_settings}).catch(function(e){r.backendErrors=e.data}).finally(function(){r.loadSettings=!1})},r.reloadSettings(),o.get({action:"get_for_settings"}).$promise.then(function(e){r.sfaTypes=e.objects}).catch(t.handleError),r.switchEnabledStaff=function(t){o.update({id:t.id},{enabled_to_staff:t.enabled_to_staff}).$promise.then(function(e){n.add(i.getString("Operation completed successfully."))}).catch(function(e){t.enabled_to_staff=!t.enabled_to_staff,n.add(e.data.detail)})},r.switchEnabledEndUser=function(t){o.update({id:t.id},{enabled_to_enduser:t.enabled_to_enduser}).$promise.then(function(e){n.add(i.getString("Operation completed successfully."))}).catch(function(e){t.enabled_to_enduser=!t.enabled_to_enduser,n.add(e.data.detail)})},r.saveSettings=function(){e.post(r.settings).$promise.then(function(e){n.add(i.getString("Settings saved"))}).catch(function(e){n.add(e.data.detail),r.backendErrors=e.data,r.reloadSettings()})}}}angular.module("fleioStaff").component("sfaSettings",{templateUrl:"staff/apps/settings/general/sfa_settings/sfasettings.component.html",controller:e}),e.$inject=["SfaSettingsServiceApi","FlNotificationService","gettextCatalog","FlResolveErrorHandler","FlSFAApi"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/settings/sfa-settings/:action")}angular.module("fleioStaff").factory("SfaSettingsServiceApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(t,e,n){var i=this;i.$onInit=function(){},i.saveConfiguration=function(){if(document.activeElement.blur(),i.submitPending||i.configurationForm.$invalid)return;var e;i.submitPending=!0,e=i.configuration.id?n.update(i.configuration).$promise:n.save(i.configuration).$promise;return e.then(function(e){return t.hide(e),e},function(e){i.backendErrors=e.data}).finally(function(){i.submitPending=!1})},i.close=function(){return t.cancel()}}angular.module("fleioStaff").controller("FlConfigurationEditController",e),e.$inject=["$mdDialog","FlNotificationService","FlConfigurationsApi"]}(),function(){"use strict";function e(e,t){var n=this;n.activeTab=e.activeTab,n.$onInit=function(){n.features=t.features}}angular.module("fleioStaff").component("flGeneralSettings",{templateUrl:"staff/apps/settings/general/generalsettings.html",controller:e}),e.$inject=["$stateParams","FlFeatureService"]}(),function(){"use strict";function e(e,t,n){e.state("utilsTaskLog",{url:t.joinBaseUrl("utils/tasklog?page_size?ordering?search?filtering"),component:"flTaskLog",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{tasks:["$stateParams","FlObjectList","FlTaskLogApi",function(e,t,n){return t(n,e)}]},data:{stateInfo:{display:n("Task log"),parent:"dashboard"},feature:"utils.tasklog",orderOptions:{created_at:n("Date created"),state:n("State")},filtering:{created_at:{display:n("Date created"),field_name:"created_at",type:"date"},user_id:{display:n("User"),field_name:"user_id",type:"user"}}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/tasklog/:id/:action",{action:"@action",id:"@id"})}angular.module("fleioStaff").factory("FlTaskLogApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s){var l=this;function c(e){r.yesNoDlg(o.getString("This will create a new task with the same parameters and will run the task again. Are you sure?"),o.getString("Recreate task")).then(function(){l.tasks.loading=!0,a.save({id:e,action:"recreate"}).$promise.then(function(e){s.add(e.detail),l.tasks.loading=!1}).catch(function(e){e&&e.status&&e.status<500&&s.add(e.detail)}).finally(function(){l.tasks.loading=!1})}).catch(function(){})}l.$onInit=function(){n.info.enabled=!0,n.info.label=i("Search tasks"),n.info.service=l.tasks,l.reCreateTask=c}}angular.module("fleioStaff").component("flTaskLog",{templateUrl:"staff/apps/tasklog/tasks.html",controller:e,bindings:{tasks:"<"}}),e.$inject=["$state","$stateParams","FlSearchService","gettext","gettextCatalog","FlUiUtilsService","FlTaskLogApi","FlNotificationService"]}(),function(){"use strict";function e(e,t,n){e.state("utilsActivityLog",{url:t.joinBaseUrl("utils/activitylog?page_size?ordering?search?filtering"),component:"flActivityLog",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{log:["$stateParams","FlObjectList","FlActivityLogApi","$state",function(e,t,n,s){return n.get({action:"filter_options"}).$promise.then(function(e){var t,n,i=e.actions,o=e.categories,r=[],a=[];for(t=0,n=i.length;t<n;++t)r.push({display:i[t].name,value:i[t].name});for(t=0,n=o.length;t<n;++t)a.push({display:o[t].name,value:o[t].name});s.get("utilsActivityLog").data.filtering.log_class__name.choices=r,s.get("utilsActivityLog").data.filtering.log_class__category__name.choices=a}),t(n,e)}]},data:{stateInfo:{display:n("Activity log"),parent:"dashboard"},feature:"utils.activitylog",orderOptions:{created_at:n("Created at"),user:n("User"),ip:n("IP")},filtering:{created_at:{display:n("Date created"),field_name:"created_at",type:"date"},user_id:{display:n("User"),field_name:"user_id",type:"user"},log_class__name:{display:n("Action"),field_name:"log_class__name",choices:[],type:"choices"},log_class__category__name:{display:n("Category"),field_name:"log_class__category__name",choices:[],type:"choices"}}}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/activitylog/:id/:action",{action:"@action",id:"@id"})}angular.module("fleioStaff").factory("FlActivityLogApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n,i,o,r,a){var s=this;function l(e,t){i.yesNoDlg(n.getString("This will create a new task with the same parameters and will run the task again. Are you sure?"),n.getString("Recreate task")).then(function(){s.log.loading=!0,a.save({id:e,action:"recreate"}).$promise.then(function(){s.loadEntryTasks(t)}).catch(function(e){r.add(e.detail)}).finally(function(){s.log.loading=!1})}).catch(function(){})}s.$onInit=function(){s.reCreateTask=l,e.info.enabled=!0,e.info.label=t("Search log"),e.info.service=s.log},s.loadEntryTasks=function(t){a.get({action:"get_tasks_for_activity",activity_id:t.id}).$promise.then(function(e){t.tasks=e.objects})},s.toggleEntry=function(e){e.expanded=!e.expanded,e.tasks||s.loadEntryTasks(e)},s.toggleTask=function(t){t.expanded=!t.expanded,t.log||a.get({action:"get_task_log",id:t.id}).$promise.then(function(e){t.log=e.task_log})}}angular.module("fleioStaff").component("flActivityLog",{templateUrl:"staff/apps/activitylog/log.html",controller:e,bindings:{log:"<"}}),e.$inject=["FlSearchService","gettext","gettextCatalog","FlUiUtilsService","FlActivityLogApi","FlNotificationService","FlTaskLogApi"]}(),function(){"use strict";function e(e,n){var i=this;i.$onInit=function(){i.clientId&&n.get({id:i.clientId}).$promise.then(function(e){i.client=e})},i.selectedClientChanged=function(e){i.clientId=void 0!==e?e.id:null,i.onClientChanged({client:e})},i.searchClient=function(e){var t={search:e};return i.hasResellerService&&(t.has_reseller_service=!0),n.get(t).$promise.then(function(e){return e.objects})}}angular.module("fleioStaff").component("flAutocompleteClient",{templateUrl:"staff/apps/fleiodata/autocompleteclient/flautocompleteclient.html",controller:e,bindings:{clientId:"=",onClientChanged:"&",placeholder:"@",hasResellerService:"<"}}),e.$inject=["$element","FlClientApi"]}(),function(){"use strict";function e(e,n){var i=this;i.$onInit=function(){i.userId&&n.get({id:i.userId}).$promise.then(function(e){i.user=e})},i.selectedUserChanged=function(e){i.userId=void 0!==e?e.id:null,i.onUserChanged({user:e})},i.searchUser=function(e){var t={search:e};return i.staffOnly&&(t.is_staff=!0),i.resellerOnly&&(t.is_reseller=!0),n.get(t).$promise.then(function(e){return e.objects})}}angular.module("fleioStaff").component("flAutocompleteUser",{templateUrl:"staff/apps/fleiodata/autocompleteuser/flautocompleteuser.html",controller:e,bindings:{staffOnly:"<",resellerOnly:"<",userId:"=",onUserChanged:"&",placeholder:"@",notFound:"@"}}),e.$inject=["$element","FlUserApi"]}(),function(){"use strict";function e(e,t){return{Revenue:e(t.api_url+"/revenue_reports/:id/:action",{id:"@id",action:"@action"})}}angular.module("fleioStaff").factory("FlReportsApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t){this.$onInit=function(){}}angular.module("fleioStaff").component("flReportsSummary",{templateUrl:"staff/apps/reports/fleioreports.template.html",controller:e}),e.$inject=["gettextCatalog","FlUiUtilsService"]}(),function(){"use strict";function e(e,t,n){var i=this;i.$onInit=function(){n.info.enabled=!0,n.info.label=e("Search reports"),n.info.service=i.reports}}angular.module("fleioStaff").component("flRevenueReports",{templateUrl:"staff/apps/reports/revenue_reports/revenue_reports.template.html",controller:e,bindings:{reports:"<"}}),e.$inject=["gettext","FlUiUtilsService","FlSearchService"]}(),function(){"use strict";function e(e,t){this.$onInit=function(){}}angular.module("fleioStaff").component("flRevenueReportDetails",{templateUrl:"staff/apps/reports/revenue_reports/revenue_report_details.template.html",controller:e,bindings:{revenueReport:"<"}}),e.$inject=["gettextCatalog","FlUiUtilsService"]}(),function(){"use strict";function e(n,e,i,o,r){var a=this;a.$onInit=function(){a.goBackOrToState=e.goBackOrToState,a.buildLocale=function(n){return{formatDate:function(e){return e?moment(e).format(n):null},parseDate:function(e){if(e){var t=moment(e,n,!0);return t.isValid()?t.toDate():new Date(NaN)}return null}}},a.monthFormat=a.buildLocale("MMM-YYYY"),a.generate=function(){if(void 0!==a.generationDate){var e=a.generationDate.getMonth()+1,t=a.generationDate.getFullYear();i.Revenue.post({action:"trigger_revenue_report_generation",month:e,year:t}).$promise.then(function(e){a.backendErrors=null,a.reports_under_generation=e.reports_under_generation,r.go("fleioRevenueReports"),o.add(n.getString("Revenue report generation was started."))}).catch(function(e){a.reports_under_generation=null,a.backendErrors=e.data})}else o.add(n.getString("Please specify a date."))}}}angular.module("fleioStaff").component("flGenerateRevenueReport",{templateUrl:"staff/apps/reports/revenue_reports/generate_revenue_report.template.html",controller:e,bindings:{}}),e.$inject=["gettextCatalog","FlUiUtilsService","FlReportsApi","FlNotificationService","$state"]}(),function(){"use strict";function e(e,t,n){e.state("fleioReports",{url:t.joinBaseUrl("reports"),component:"flReportsSummary",data:{stateInfo:{display:n("Reports"),parent:"dashboard"},feature:"utils.reports"}}).state("fleioRevenueReports",{url:t.joinBaseUrl("reports/revenue"),component:"flRevenueReports",data:{stateInfo:{display:n("Revenue Reports"),parent:"fleioReports"},feature:"utils.reports"},params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-end_date",squash:!0}},resolve:{reports:["$stateParams","FlObjectList","FlReportsApi","FlResolveErrorHandler",function(e,t,n,i){return t(n.Revenue,e).catch(i.handleError)}]}}).state("fleioRevenueReportDetails",{url:t.joinBaseUrl("reports/revenue/:id"),component:"flRevenueReportDetails",data:{stateInfo:{display:n("Revenue report details"),parent:"fleioRevenueReports"},feature:"billing.reporting"},resolve:{revenueReport:["FlReportsApi","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.Revenue.get(t).$promise.then(function(e){return e}).catch(n.handleError)}]}}).state("fleioGenerateRevenueReport",{url:t.joinBaseUrl("reports/revenue/generate"),component:"flGenerateRevenueReport",data:{stateInfo:{display:n("Generate revenue report"),parent:"fleioRevenueReports"},feature:"billing.reporting"},resolve:{}})}angular.module("fleioStaff").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}();