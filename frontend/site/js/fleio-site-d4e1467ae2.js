!function(){"use strict";function e(n,e){var t={api_url:"http://localhost:8000/api",app_name:"fleio",home_url:"/",base_url:"/",paginate_by:"20",distro_img_path:"/images/os_distro",base_title:"@ - Fleio",min_search_length:3,toast_hide_delay:3e3,confirm_dialog_message:e("Are you sure?"),confirm_dialog_title:e("Confirm your action"),menu:[{label:e("Home"),state:"dashboard",icon:"dashboard",feature:"dashboard"},{category:e("Cloud"),main_feature:"openstack",items:[{label:e("Instances"),state:"openstackInstances",icon:"instances",feature:"openstack.instances"},{label:e("Clusters"),state:"openstackClusters",icon:"folder",feature:"openstack.coe.clusters"},{label:e("Cluster Templates"),state:"openstackClusterTemplates",icon:"folder",feature:"openstack.coe.cluster_templates"},{label:e("Networks"),state:"openstackNetworks",icon:"networks",feature:"openstack.networks"},{label:e("Routers"),state:"openstackRouters",icon:"routers",feature:"openstack.routers"},{label:e("Zones"),state:"zones",icon:"dns_zones",feature:"openstack.dns.zones"},{label:e("Security groups"),state:"securityGroups",icon:"security_groups",feature:"openstack.securitygroups"},{label:e("Floating IPs"),state:"floatingIps",icon:"floating_ip",feature:"openstack.floatingips"},{label:e("SSH keys"),state:"openstackSshKeys",icon:"keys",feature:"openstack.sshkeys"},{label:e("Volumes"),state:"openstackVolumes",icon:"volumes",feature:"openstack.volumes"},{label:e("Volume backups"),state:"openstackVolumeBackups",icon:"volumes",feature:"openstack.volumes.backups"},{label:e("Volume snapshots"),state:"openstackVolumeSnapshots",icon:"volumes",feature:"openstack.volumes.snapshots"},{label:e("My images"),state:"images",icon:"images",feature:"openstack.images"},{label:e("API users"),state:"apiUsers",icon:"group",feature:"openstack.apiusers"}]},{plugins_menu_placeholder:!0,feature:"plugins"},{category:e("Billing"),main_feature:"billing",items:[{label:e("Services"),state:"billingServices",icon:"services",feature:"billing.services"},{label:e("Invoices"),state:"billingInvoices",icon:"invoice_item",feature:"billing.invoices"},{label:e("Order services"),state:"products",icon:"product",feature:"billing.order"},{label:e("Cart"),state:"cart",icon:"shopping_cart",feature:"billing.order"},{label:e("Billing history"),state:"billingHistory",icon:"chart",feature:"billing.history"}]}],default_theme:"Spring",logo_light:"/images/logo.svg",logo_dark:"/images/logo-dark.svg",djangoCsrf:{cookieName:"csrftoken",headerName:"X-CSRFToken"},tiny_mce_options:{relative_urls:!0,convert_urls:!1,inline:!1,plugins:"link code image lists autolink",toolbar:["undo redo | styleselect | bold italic underline | alignleft aligncenter alignright alignjustify | link code image | bullist numlist | removeformat"],skin:"lightgray",theme:"modern",menubar:""},flavors_as_cards:!1,local_compute_storage_enabled:!0,preselect_public_networks:!0,hide_networks_if_only_one_available:!0,show_root_password_field_on_new_instance_form:!0,root_password_mandatory_on_new_instance_form:!1,show_userdata_on_new_instance_form:!0,interceptorConfig:function(e,t){return e},customThemesCallback:function(e){},registeredThemes:["Spring","Navy","Dusk"],new_object_arrow_img_source:"images/arrow.png",verify_resize_message:null};angular.forEach(t,function(e,t){n.hasOwnProperty(t)||(n[t]=e)}),n.__baseUrlSlashed=n.base_url.replace(/\/?$/,"/"),n.joinBaseUrl=function(e){return n.__baseUrlSlashed+e.replace(/^\/+/g,"")}}angular.module("fleio.baseconfig",["fleio.config"]).config(e),e.$inject=["CONFIG","gettext"]}(),function(){"use strict";angular.module("fleio.config",[])}(),function(){"use strict";function e(e,t,n){!1===t.enable_debug&&e.debugInfoEnabled(!1),n.setOptions({colors:["#803690","#00ADF9","#DCDCDC","#46BFBD","#FDB45C","#949FB1","#4D5360"]})}function t(e,n,t,o,i){o.setCurrentLanguage(t.language),e.$on("fl:noClients",function(){"addClient"!==e.nextState&&n.go("addClient")}),e.$on("fl:noEmailNotConfirmed",function(){"confirmEmail"!==e.nextState&&"confirmEmailNoToken"!==e.nextState&&n.go("confirmEmailNoToken")}),e.$on("fl:tosNotAgreedWith",function(){"TOSAgreements"!==e.nextState&&n.go("TOSAgreements")}),e.$on("fl:noSfaAdded",function(){"SFAOptions"!==e.nextState&&n.go("SFAConfirmPassword")}),e.$on("fl:licenseNotSet",function(e,t){n.go("login"),i.add(t)})}angular.module("fleio",["ngCookies","ngSanitize","ngMessages","ui.router","http-auth-interceptor","ngMaterial","gettext","chart.js","fleio.config","fleio.baseconfig","fleio.commons","fleio.oscommons"]).config(e).run(t),e.$inject=["$compileProvider","CONFIG","ChartJsProvider"],t.$inject=["$rootScope","$state","CONFIG","gettextCatalog","FlNotificationService"]}(),function(){"use strict";function e(e,t,n){var o=this;o.$onInit=function(){o.features=e.features,o.features.plugins&&n.get({action:"plugins_with_component",component_name:"DashboardServicesRows"}).$promise.then(function(e){o.plugins=e.plugins})}}angular.module("fleio").component("flDashboard",{templateUrl:"apps/dashboard/fldashboard.html",controller:e,bindings:{summary:"<",userInfo:"<",openstackSummary:"<",externalBillingUrl:"<"}}),e.$inject=["FlFeatureService","CONFIG","PluginsApi"]}(),function(){"use strict";function e(e,t,a){e.state("dashboard",{url:t.home_url,component:"flDashboard",authenticate:!0,data:{stateInfo:{display:a("Home"),parent:null},feature:"dashboard"},resolve:{userInfo:["FlAuthService",function(e){return e.getUserInfo().then(function(e){return e})}],summary:["FlAuthService","FlBilling",function(e,t){if(e.userInfo&&e.userInfo.user&&angular.isArray(e.userInfo.user.clients)&&0<e.userInfo.user.clients.length)return t.Summary.get().$promise}],externalBillingUrl:["CONFIG","$http",function(e,t){return t.get(e.api_url+"/get-external-billing-url").then(function(e){return e.data.external_billing_url}).catch(function(e){return""})}],openstackSummary:["$state","FlOsApi","FlAuthService","FlFeatureService","FlResolveErrorHandler",function(e,t,n,o,i){if(n.userInfo&&n.userInfo.user&&angular.isArray(n.userInfo.user.clients)&&0<n.userInfo.user.clients.length)return!0===o.features.openstack?t.Summary.get().$promise:{};var r={status:428,data:{detail:a("Before you continue, please fill in your information"),clientRequired:!0}};i.handleError(r)}]}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/openstack/regions")}function t(e,t,n){var o,i,r,a,s,l,c,u,d,p,m,g,f,h,v,_,b,S,y;return o=e(t.api_url+"/openstack/account"),l=e(t.api_url+"/openstack/billing/:action",{action:"@action"}),u=e(t.api_url+"/openstack/billing/history/:id",{id:"@id"}),c=e(t.api_url+"/osbackup/:id",{id:"@id"}),g=e(t.api_url+"/openstack/summary",{}),f=e(t.api_url+"/openstack/floatingips/:id/:options",{id:"@id",options:"@options"}),(s=e(t.api_url+"/openstack/instances/:uuid:options/:action",{uuid:"@uuid",action:"@action",options:"@options"})).prototype.allowedAction=function(e){return-1<this.allowed_actions.indexOf(e)},s.prototype.execute=function(e){return s.save(angular.extend({uuid:this.uuid},e))},s.prototype.fldelete=function(){return this.$delete()},a=e(t.api_url+"/openstack/images/:id:options/:action",{id:"@id",options:"@options",action:"@action"}),(d=e(t.api_url+"/openstack/volumes/:id:options/:action",{id:"@id",options:"@options",action:"@action"})).prototype.isUnderTask=function(){return-1===[n("available"),n("in-use"),n("deleted"),n("unknown"),n("error"),n("error_deleting"),n("error_restoring"),n("error_extending")].indexOf(this.status)},d.prototype.isDisabled=function(){return-1===[n("available"),n("in-use"),n("unknown"),n("error"),n("error_restoring"),n("error_extending")].indexOf(this.status)},(p=e(t.api_url+"/openstack/volumebackups/:id/:action",{id:"@id",action:"@action"})).prototype.isUnderTask=function(){return-1===["available","error","error_deleting"].indexOf(this.status)},p.prototype.fldelete=function(){return this.$delete()},(m=e(t.api_url+"/openstack/volumesnapshots/:id/:action",{id:"@id",action:"@action"})).prototype.isUnderTask=function(){return-1===["available","error","error_deleting","unmanaging"].indexOf(this.status)},m.prototype.fldelete=function(){return this.$delete()},(i=e(t.api_url+"/openstack/clusters/:id/:action",{id:"@id",action:"@action"})).prototype.fldelete=function(){return this.$delete()},(r=e(t.api_url+"/openstack/cluster-templates/:id/:action",{id:"@id",action:"@action"})).prototype.fldelete=function(){return this.$delete()},a.prototype.isUnderTask=function(){return"saving"===this.status},d.prototype.fldelete=function(){return this.$delete()},h=e(t.api_url+"/openstack/networks/:id/:options",{id:"@id",options:"@options"}),v=e(t.api_url+"/openstack/subnets/:id/:options",{id:"@id",options:"@options"}),_=e(t.api_url+"/openstack/ports/:id:options/:action",{id:"@id",options:"@options",action:"@action"}),b=e(t.api_url+"/openstack/routers/:id/:options",{id:"@id",options:"@options"}),S=e(t.api_url+"/openstack/securitygroups/:id/:options",{id:"@id",options:"@options"}),y=e(t.api_url+"/openstack/dns/:id/:actions",{id:"@id",actions:"@actions"}),{Clusters:i,ClusterTemplates:r,Instances:s,Images:a,Account:o,Accounting:l,AccountingHistory:u,Volumes:d,VolumeBackups:p,VolumeSnapshots:m,Summary:g,FloatingIps:f,Networks:h,Subnets:v,Ports:_,Routers:b,SecurityGroups:S,Dns:y,BackupSchedules:c}}angular.module("fleio").factory("FlOsApi",t).factory("FlRegionApi",e),e.$inject=["FlResourceService","CONFIG"],t.$inject=["FlResourceService","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n){e.state("apiUsers",{url:t.joinBaseUrl("openstack/apiusers"),component:"flApiUsers",authenticate:!0,reloadOnSearch:!1,resolve:{users:["$stateParams","FlApiUsersApi",function(e,t){return t.query().$promise}],createOptions:["$stateParams","FlApiUsersApi",function(e,t){return t.get({action:"create_options"}).$promise}],permissions:["$stateParams","FlApiUsersApi",function(e,t){return t.get({action:"permissions"}).$promise}]},data:{stateInfo:{display:n("API users"),parent:"dashboard"},feature:"openstack.apiusers"}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/openstack/users/:id/:action",{id:"@id",action:"@action"})}angular.module("fleio").factory("FlApiUsersApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(t,e,o,n,i,r,a,s,l){var c=this;function u(){i.query().$promise.then(function(e){c.users=e})}c.$onInit=function(){c.TRANSLATED_STRINGS_MAP={delete:r.getString("Delete"),create:r.getString("Add API user"),edit:r.getString("Edit"),no_permission:r.getString("You are not\nallowed to do this")}},c.addAPIUser=function(e){return o.show({templateUrl:"apps/osapiusers/flapiuseredit.html",controller:"FlApiUserAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{createOptions:c.createOptions},targetEvent:e}).then(function(){u()}).finally(function(){t.go(t.current,{dlg:"false"})}).catch(function(){})},c.editAPIUser=function(e,t){return o.show({templateUrl:"apps/osapiusers/flapiuseredit.html",controller:"FlApiUserEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{user:t,createOptions:c.createOptions},targetEvent:e}).then(function(){u(),s.add(r.getString("API user edited"))}).catch(function(){})},c.getOpenrcFile=function(t,n){l.get().$promise.then(function(e){return o.show({templateUrl:"oscommons/apiusers/getopenrcfile.dialog.html",controller:"FlApiUserGetOpenrcController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{user:n,regions:e.objects},targetEvent:t}).then(function(){}).catch(function(){})})},c.deleteAPIUser=function(e){return n.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete user {{name}}",{name:e.name}),r.getString("Delete user")).then(function(){i.delete({id:e.id}).$promise.then(function(){u(),s.add(r.getString("API user deleted"))},function(){s.add(r.getString("Could not delete API User"))})}).catch(function(){})},"add"===e.dlg&&c.addKey(null)}angular.module("fleio").component("flApiUsers",{templateUrl:"apps/osapiusers/flapiusers.html",controller:e,bindings:{users:"<",createOptions:"<",permissions:"<"}}),e.$inject=["$state","$stateParams","$mdDialog","FlUiUtilsService","FlApiUsersApi","gettextCatalog","gettext","FlNotificationService","FlRegionApi"]}(),function(){"use strict";function e(t,e,n,o){var i=this;i.$onInit=function(){i.user=angular.copy(n),i.createOptions=angular.copy(o),i.createOptions.prefix_api_users_with_username&&(i.user.name=i.user.name.replace(i.createOptions.prefix,"")),i.isEdit=!0},i.saveAPIUser=function(){if(document.activeElement.blur(),!i.editAPIUser.$invalid&&!i.submitPending)return i.submitPending=!0,e.update({id:i.user.id},i.user).$promise.then(function(e){return t.hide(e),e}).catch(function(e){i.submitPending=!1,i.backendErrors=e.data})},i.close=function(){return t.cancel()}}angular.module("fleio").controller("FlApiUserEditController",e),e.$inject=["$mdDialog","FlApiUsersApi","user","createOptions"]}(),function(){"use strict";function e(t,e,n){var o=this;o.$onInit=function(){o.user={},o.createOptions=angular.copy(n),o.isEdit=!1},o.saveAPIUser=function(){if(document.activeElement.blur(),!o.editAPIUser.$invalid&&!o.submitPending)return o.submitPending=!0,e.save(o.user).$promise.then(function(e){return t.hide(e),e}).catch(function(e){o.submitPending=!1,o.backendErrors=e.data})},o.close=function(){return t.cancel()}}angular.module("fleio").controller("FlApiUserAddController",e),e.$inject=["$mdDialog","FlApiUsersApi","createOptions"]}(),function(){"use strict";function e(e,t,l){e.state("openstackInstances",{url:t.joinBaseUrl("openstack/instances?page_size?ordering?search?filtering"),component:"flInstances",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created",squash:!0},filtering:{value:"",squash:!0}},resolve:{instances:["$state","$stateParams","FlObjectList","FlOsApi","FlFeatureService",function(a,e,t,n,s){return n.Instances.get({options:"filter_options"}).$promise.then(function(e){for(var t=e.region,n=[],o=0,i=t.length;o<i;++o)n.push({display:t[o].id,value:t[o].id});if(a.get("openstackInstances").data.filtering.region.choices=n,a.get("openstackInstances").data.filtering.status.choices=e.statuses,s.features["openstack.instances.traffic"]){var r=a.get("openstackInstances").data.orderOptions;r.current_cycle_traffic=l("Current cycle traffic"),r.current_month_traffic=l("Current month traffic")}}),t(n.Instances,e)}]},data:{stateInfo:{display:l("Instances"),parent:"dashboard"},feature:"openstack.instances",orderOptions:{name:l("Name"),status:l("Status"),region:l("Region"),created:l("Date created")},filtering:{created:{display:l("Date of creation"),field_name:"created",type:"date"},status:{display:l("Status"),field_name:"status",type:"choices",choices:[]},region:{display:l("Region"),field_name:"region",type:"choices",choices:[]}}}}).state("openstackInstanceCreate",{url:t.joinBaseUrl("openstack/instances/create"),component:"flInstanceCreate",authenticate:!0,params:{image:null,region:null,fromLaunchImage:!1,fromNewImage:!1},resolve:{createOptions:["$stateParams","FlOsApi",function(e,t){return t.Instances.get({action:"create_options",region:e.region}).$promise}]},data:{feature:"openstack.instances",stateInfo:{display:l("Create instance"),parent:"openstackInstances"}}}).state("openstackInstanceDetails",{url:t.joinBaseUrl("openstack/instances/:id"),component:"flInstanceDetails",authenticate:!0,resolve:{instance:["$stateParams","FlOsApi","FlInstanceStateAllowed","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o,i){return t.Instances.get({uuid:e.id}).$promise.then(function(e){return o.setParams({name:e.name}),n(e,e,"details")}).catch(i.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.Instances.get({action:"permissions"}).$promise}]},data:{feature:"openstack.instances",stateInfo:{display:l("Instance {:name}"),parent:"openstackInstances",default:l("Instance details")}}}).state("openstackInstanceRebuild",{url:t.joinBaseUrl("openstack/instances/:id/rebuild"),component:"flInstanceRebuild",authenticate:!0,resolve:{rebuildOptions:["$stateParams","FlOsApi","FlInstanceStateAllowed","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o,i){return t.Instances.get({uuid:e.id,action:"rebuild"}).$promise.then(function(e){return o.setParams({name:e.instance.name}),n(e,e.instance,"rebuild")}).catch(i.handleError)}]},data:{feature:"openstack.instances",stateInfo:{display:l("Rebuild"),parent:"openstackInstanceDetails"}}}).state("openstackInstanceResize",{url:t.joinBaseUrl("openstack/instances/:id/resize"),component:"flInstanceResize",authenticate:!0,resolve:{resizeOptions:["$stateParams","FlOsApi","FlInstanceStateAllowed","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o,i){return t.Instances.get({uuid:e.id,action:"resize"}).$promise.then(function(e){return o.setParams({name:e.instance.name}),n(e,e.instance,"resize")}).catch(i.handleError)}]},data:{feature:"openstack.instances",stateInfo:{display:l("Resize"),parent:"openstackInstanceDetails"}}}).state("openstackInstanceRescue",{url:t.joinBaseUrl("openstack/instances/:id/rescue"),component:"flInstanceRescue",authenticate:!0,resolve:{rescueOptions:["$stateParams","FlOsApi","FlInstanceStateAllowed","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o,i){return t.Instances.get({uuid:e.id,action:"rescue"}).$promise.then(function(e){return o.setParams({name:e.instance.name}),n(e,e.instance,"rescue")}).catch(i.handleError)}]},data:{feature:"openstack.instances",stateInfo:{display:l("Rescue"),parent:"openstackInstanceDetails"}}}).state("openstackInstanceBootFromIso",{url:t.joinBaseUrl("openstack/instances/:id/boot-from-iso"),component:"flInstanceBootFromIso",authenticate:!0,resolve:{bootFromIsoOptions:["$transition$","FlOsApi","FlInstanceStateAllowed","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o,i){return t.Instances.get({uuid:e.params().id,action:"boot_from_iso"}).$promise.then(function(e){return o.setParams({name:e.instance.name}),n(e,e.instance,"boot_from_iso")}).catch(i.handleError)}]},data:{feature:"openstack.instances",stateInfo:{display:l("Boot from ISO"),parent:"openstackInstanceDetails"}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,o,i,r){var a,s=this;function l(){return s.instances.fetchData().then(s.checkForTaskChange)}s.$onInit=function(){s.translateLib=o,n.info.enabled=!0,n.info.label=i("Search instances"),n.info.service=s.instances,(a=e(l,1e4)).start(),t.init(a.start.bind(a),a.stop.bind(a)),s.checkForTaskChange(s.instances),s.TRANSLATED_STRINGS_MAP={create:o.getString("Create instance"),no_permission:o.getString("You are not\nallowed to do this"),instance_resized_info:o.getString("Check if files have been successfully\nmigrated to the new instance disk. \nChoose Verify resize from the instance menu\nto confirm migration was successful, otherwise\nchoose Revert resize to revert back to the initial disk.")},r.verify_resize_message&&(s.TRANSLATED_STRINGS_MAP.instance_resized_info+="\n"+r.verify_resize_message)},s.onInstanceAction=function(){return a.boost()},s.checkForTaskChange=function(e){return angular.forEach(e.objects,function(e){if(null!==e.display_task)return a.boost()})},s.$onDestroy=function(){a.teardown(),t.uninit()}}angular.module("fleio").component("flInstances",{templateUrl:"apps/osinstances/flinstances.html",controller:e,bindings:{instances:"<"}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlSearchService","gettextCatalog","gettext","CONFIG"]}(),function(){"use strict";function e(t,n,o,e,i,r,a){var s=this;s.init=function(){s.networks=r,s.port={fixed_ips:[],project:a,network:r[0].id,device_id:e.uuid,device_owner:"compute:nova",region:e.region,attach_to:"instance"},s.changeSubnets()},s.changeSubnets=function(){for(var e=0;e<s.networks.length;e++)if(s.networks[e].id==s.port.network){s.subnets=s.networks[e].subnets,s.port.subnet=s.subnets[0].id;break}},s.addPort=function(){if(document.activeElement.blur(),!s.addPortForm.$invalid&&!s.submitPending){s.submitPending=!0;var e=angular.copy(s.port);0===s.port.fixed_ips.length&&s.port.subnet&&(e.fixed_ips=[{subnet_id:s.port.subnet}]),n.Ports.save(e).$promise.then(function(){o.add(i.getString("Add port scheduled")),s.submitPending=!1,t.hide()},function(e){s.backendErrors=e.data,s.submitPending=!1})}},s.addIp=function(){s.port.fixed_ips.push({ip_address:""})},s.removeIp=function(e){0<s.port.fixed_ips.length&&s.port.fixed_ips.splice(e,1)},s.close=function(){return t.cancel()},s.init()}angular.module("fleio").controller("FlInstanceAddPortController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog","networks","project_id"]}(),function(){"use strict";function e(n,o,i,r,a,e,t){var s=this;s.init=function(){s.networks=e,s.ports=t,s.$ips=1,s.port={region:r.region,port:t[0].id},s.changeSubnets()},s.changeSubnets=function(){for(var e=0;e<s.ports.length;e++)if(s.port.port==s.ports[e].id){for(var t=0;t<s.networks.length;t++)if(s.ports[e].network===s.networks[t].id){s.subnets=s.networks[t].subnets,s.port.subnet=s.subnets[0].id;break}break}},s.updatePort=function(){if(document.activeElement.blur(),!s.addPortForm.$invalid&&!s.submitPending){s.submitPending=!0;var e={fixed_ips:[]};e.region=r.region;for(var t=0;t<s.ips;t++)e.fixed_ips.push({subnet_id:s.port.subnet});o.Ports.save({id:s.port.port,action:"automatic_add_ips"},e).$promise.then(function(){i.add(a.getString("Add IP(s) scheduled")),s.submitPending=!1,n.hide()},function(e){s.backendErrors=e.data,s.submitPending=!1})}},s.close=function(){return n.cancel()},s.init()}angular.module("fleio").controller("FlInstanceAutomaticAddIpController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog","networks","ports"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s){var l=this;l.init=function(){l.networks=r,l.ports=a,l.select_port_locked=s,l.port={fixed_ips:[{ip_address:""}],device_id:o.uuid,device_owner:"compute:nova",region:o.region,append_ip:!0,port:a[0].id},l.changeSubnets()},l.changeSubnets=function(){for(var e=0;e<l.ports.length;e++)if(l.port.port==l.ports[e].id){for(var t=0;t<l.networks.length;t++)if(l.ports[e].network===l.networks[t].id){l.subnets=l.networks[t].subnets,l.port.subnet=l.subnets[0].id;break}break}},l.updatePort=function(){document.activeElement.blur(),l.addPortForm.$invalid||l.submitPending||(l.submitPending=!0,t.Ports.save({id:l.port.port,action:"add_ip"},l.port).$promise.then(function(){n.add(i.getString("Add IP(s) scheduled")),l.submitPending=!1,e.hide()},function(e){l.backendErrors=e.data,l.submitPending=!1}))},l.addIp=function(){l.port.fixed_ips.push({ip_address:""})},l.removeIp=function(e){1<l.port.fixed_ips.length&&l.port.fixed_ips.splice(e,1)},l.close=function(){return e.cancel()},l.init()}angular.module("fleio").controller("FlInstanceAddIpController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog","networks","ports","select_port_locked"]}(),function(){"use strict";function e(a,t,o,n,i,s,l,c){return{restrict:"E",replace:"true",scope:{instance:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"apps/osinstances/actions/flinstanceactions.html",controller:["$scope","$element",function(r,e){return r.consoleWindow=null,r.TRANSLATED_STRINGS_MAP={shut_down:s.getString("Shut down"),start:s.getString("Start"),reboot:s.getString("Reboot"),reset_state:s.getString("Reset state"),delete:s.getString("Delete"),no_permission:s.getString("You are not\nallowed to do this")},r.deleteInstance=function(){return a.yesNoDlg(s.getString("Are you sure you want to delete the instance? Files will be permanently lost."),s.getString("Delete instance {{name}}",{name:r.instance.name}),s.getString("Delete instance")).then(function(){return l.add(s.getString("Instance delete scheduled")),r.isDetail&&t.go("openstackInstances"),r.instance.fldelete()}).catch(function(e){l.add(e.data.detail)})},r.execute=function(e){if(r.instance.execute(e),"function"==typeof r.callback)return r.instance.display_task="pending",r.callback.call(null)},r.openConsole=function(){r.consoleWindow&&r.consoleWindow.close(),r.consoleWindow=window.open("",r.instance.uuid,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no"),r.consoleWindow.focus(),i.Instances.get({uuid:r.instance.uuid,action:"get_console_url"}).$promise.then(function(e){e.lxc?r.consoleWindow.location=e.url:e.remote_console?r.consoleWindow.location=e.remote_console.url:r.consoleWindow.location=e.console.url}).catch(function(e){l.add(e.data.detail),r.consoleWindow.close()})},r.changePassword=function(e,t){return o.show({templateUrl:"apps/osinstances/password/flinstancechangepassword.html",controller:"FlInstanceChangePasswordController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:e},targetEvent:t})},r.renameInstance=function(e,t){return o.show({templateUrl:"apps/osinstances/rename/flinstancerename.html",controller:"FlInstanceRenameController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:e},targetEvent:t}).then(function(e){return n.updateParams({name:e}),r.instance.name=e}).catch(function(){})},r.associateIp=function(t,n){i.Instances.get({uuid:t.uuid,action:"associate_ip_create_options"}).$promise.then(function(e){return o.show({templateUrl:"apps/osinstances/associateip/flinstanceassociateip.html",controller:"FlInstanceAssociateIpController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:t,ports:e.ports,freeIps:e.free_ips},targetEvent:n})},function(e){return o.cancel()})},r.dissociateIp=function(t,n){i.Instances.get({uuid:t.uuid,action:"dissociate_ip_create_options"}).$promise.then(function(e){return o.show({templateUrl:"apps/osinstances/dissociateip/flinstancedissociateip.html",controller:"FlInstanceDissociateIpController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:t,ips:e.ips},targetEvent:n})},function(e){return o.cancel()})},r.action=function(e){var t,n,o,i;switch(i=t=n=null,o=!1,e.action){case"reboot":n=s.getString("Reboot instance {{name}}",{name:r.instance.name}),t=s.getString("Are you sure you want to reboot the instance?"),i=s.getString("Reboot instance");break;case"start":break;case"stop":n=s.getString("Shut down instance {{name}}",{name:r.instance.name}),t=s.getString("Are you sure you want to shut down the instance?"),i=s.getString("Shut down instance"),c.shutdown_instance_note&&(o=!0,c.shutdown_instance_note)}return o?a.yesNoDlgCustom(t+"<br>",n,i,c.shutdown_instance_note,"warning").then(function(){return r.execute(e)}).catch(function(){}):t?a.yesNoDlg(t,n,i).then(function(){return r.execute(e)}).catch(function(){}):r.execute(e)}}]}}angular.module("fleio").directive("flInstanceActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlBreadCrumbService","FlOsApi","gettextCatalog","FlNotificationService","CONFIG"]}(),function(){"use strict";function e(r,t,o,n,a,s,l){return{restrict:"E",replace:"true",scope:{instance:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"apps/osinstances/actions/flxsinstanceactions.html",controller:["$scope","$element",function(i,e){return i.consoleWindow=null,i.deleteInstance=function(){return r.yesNoDlg(s.getString("Are you sure you want to delete the instance? Files will be permanently lost."),s.getString("Delete instance {{name}}",{name:i.instance.name}),s.getString("Delete instance")).then(function(){return l.add(s.getString("Instance delete scheduled")),i.isDetail&&t.go("openstackInstances"),i.instance.fldelete()}).catch(function(e){l.add(e.data.detail)})},i.execute=function(e){if(i.instance.execute(e),"function"==typeof i.callback)return i.instance.display_task="pending",i.callback.call(null)},i.openConsole=function(){i.consoleWindow&&i.consoleWindow.close(),i.consoleWindow=window.open("",i.instance.uuid,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no"),i.consoleWindow.focus(),a.Instances.get({uuid:i.instance.uuid,action:"get_console_url"}).$promise.then(function(e){e.lxc?i.consoleWindow.location=e.url:e.remote_console?i.consoleWindow.location=e.remote_console.url:i.consoleWindow.location=e.console.url}).catch(function(e){l.add(e.data.detail),i.consoleWindow.close()})},i.changePassword=function(e,t){return o.show({templateUrl:"apps/osinstances/password/flinstancechangepassword.html",controller:"FlInstanceChangePasswordController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:e},targetEvent:t})},i.renameInstance=function(e,t){return o.show({templateUrl:"apps/osinstances/rename/flinstancerename.html",controller:"FlInstanceRenameController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:e},targetEvent:t}).then(function(e){return n.updateParams({name:e}),i.instance.name=e}).catch(function(){})},i.associateIp=function(t,n){a.Instances.get({uuid:t.uuid,action:"associate_ip_create_options"}).$promise.then(function(e){return o.show({templateUrl:"apps/osinstances/associateip/flinstanceassociateip.html",controller:"FlInstanceAssociateIpController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:t,ports:e.ports,freeIps:e.free_ips},targetEvent:n})},function(e){return l.add(e.data.detail),o.cancel()})},i.dissociateIp=function(t,n){a.Instances.get({uuid:t.uuid,action:"dissociate_ip_create_options"}).$promise.then(function(e){return o.show({templateUrl:"apps/osinstances/dissociateip/flinstancedissociateip.html",controller:"FlInstanceDissociateIpController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:t,ips:e.ips},targetEvent:n})},function(e){return l.add(e.data.detail),o.cancel()})},i.action=function(e){var t,n,o;switch(o=t=n=null,e.action){case"reboot":n=s.getString("Reboot instance {{name}}",{name:i.instance.name}),t=s.getString("Are you sure you want to reboot the instance?"),o=s.getString("Reboot instance");break;case"start":n=s.getString("Start instance {{name}}",{name:i.instance.name}),t=s.getString("Are you sure to start the instance?"),o=s.getString("Start instance");break;case"stop":n=s.getString("Shut down instance {{name}}",{name:i.instance.name}),t=s.getString("Are you sure you want to shut down the instance?"),o=s.getString("Shut down instance")}return t?r.yesNoDlg(t,n,o).then(function(){return i.execute(e)}).catch(function(){}):i.execute(e)}}]}}angular.module("fleio").directive("flXsInstanceActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlBreadCrumbService","FlOsApi","gettextCatalog","FlNotificationService"]}(),function(){"use strict";function e(t,e,n){var o=this;o.name=n.name,o.instance=n,o.renameInstance=function(){if(document.activeElement.blur(),!o.renameInstanceForm.$invalid&&!o.submitPending)return o.submitPending=!0,e.Instances.save({uuid:o.instance.uuid,action:"rename",name:o.name}).$promise.then(function(e){return t.hide(o.name)},function(e){return o.backendErrors=e.data,o.submitPending=!1})},o.close=function(){return t.cancel()}}angular.module("fleio").controller("FlInstanceRenameController",e),e.$inject=["$mdDialog","FlOsApi","instance"]}(),function(){"use strict";function e(e,t,n,o,i){var r=this;r.password="",r.changePasswordForm={},r.instance=o,r.changePassword=function(){document.activeElement.blur(),r.changePasswordForm.$invalid||r.submitPending||(r.submitPending=!0,t.Instances.save({uuid:o.uuid,action:"change_password",password:r.password}).$promise.then(function(){n.add(i.getString("Admin password changed successfully")),e.hide()},function(e){r.backendErrors=e.data,r.submitPending=!1}))},r.close=function(){return e.cancel()}}angular.module("fleio").controller("FlInstanceChangePasswordController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog"]}(),function(){"use strict";function e(i,e,t,o,n,r,a,s,l,c,u,d,p,m,g,f){var h,v=this;function _(){"snapshots"===v.activeTab&&v.fetch_snapshots(),"volumes"===v.activeTab&&v.fetch_attachments(),"securityGroups"===v.activeTab&&v.fetch_security_groups(),i.Instances.get({uuid:e.id}).$promise.then(function(e){v.instance=e,v.checkForTaskChange(e)}).catch(function(e){404===e.status&&c.go("openstackInstances")})}v.$onInit=function(){v.translateMethod=m,(h=n(_,1e4)).start(),r.init(h.start.bind(h),h.stop.bind(h)),v.checkForTaskChange(v.instance),v.TRANSLATED_STRINGS_MAP={delete_port:m.getString("Delete port"),remove_ip:m.getString("Remove IP"),dissociate_ip:m.getString("Dissociate floating IP"),detach_volume:m.getString("Detach volume"),dissociate_security_group:m.getString("Dissociate security group"),no_permission:m.getString("You are not\nallowed to do this"),instance_resized_info:m.getString("Check if files have been successfully\nmigrated to the new instance disk. \nChoose Verify resize from the instance menu\nto confirm migration was successful, otherwise\nchoose Revert resize to revert back to the initial disk.")},p.verify_resize_message&&(v.TRANSLATED_STRINGS_MAP.instance_resized_info+="\n"+p.verify_resize_message)},v.features=l.features,v.FlOsChartService=s,v.console_output=null,v.history_log_selected=!1,v.metrics={value:"1",index:"cpu"},v.activeTab="info",v.snapshots={},v.attachments={},v.syslogParams={},v.loaders={},v.graphPeriods=[{label:m.getString("Last hour"),value:"1"},{label:m.getString("24 hours"),value:"24"},{label:m.getString("7 days"),value:"168"},{label:m.getString("30 days"),value:"720"}],v.history_log_resolve=function(){v.loaders.histlog=!0,u(d(p.api_url+"/openstack/instances/"+v.instance.uuid+"/actions"),{page_size:p.paginate_by}).then(function(e){v.history_log_selected=!0,v.history_logs=e}).finally(function(){v.loaders.histlog=!1})},v.loadGraphs=function(e,t){return"cpu"===v.metrics.index?v.loadCpuData(e,t):v.loadPortData(e,t)},v.fetch_snapshots=function(){return i.Images.get({action:"get_snapshots_for_instance",instance_uuid:v.instance.id}).$promise.then(function(e){v.snapshots=e})},v.fetch_attachments=function(){return i.Volumes.get({options:"get_attachments",instance_uuid:v.instance.uuid}).$promise.then(function(e){v.attachments=e})},v.onInstanceAction=function(){return h.boost()},v.checkForTaskChange=function(e){if(null!=e.display_task)return h.boost()},v.$onDestroy=function(){h.teardown(),r.uninit()},v.get_console_output=function(e){return v.loaders.syslog=!0,i.Instances.get({uuid:e.uuid,action:"get_console_output",length:v.syslogParams.selected_length}).$promise.then(function(e){return v.syslogParams.length=e.length,v.syslogParams.selected_length=e.length,e.console_text?v.console_output=e.console_text:v.console_output=" "}).finally(function(){v.loaders.syslog=!1})},v.readableBytes=function(e){if(null===e)return m.getString("Size info not available.");if(0===e)return"0 bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","KB","MB","GB"][t]},v.createSnapshot=function(e,t){return a.show({templateUrl:"apps/osimages/snapshot/flinstancesnapshot.html",controller:"FlInstanceSnapshotController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:v.instance},targetEvent:t}).then(function(e){o.add(m.getString("Snapshot {{name}} create scheduled",{name:e}))}).catch(function(){})},v.attachVolume=function(e,t){return a.show({templateUrl:"apps/osvolumes/attach/flvolumeattach.html",controller:"FlVolumeAttachController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:v.instance},targetEvent:t}).then(function(){h.boost(),o.add(m.getString("Attaching volume to instance"))}).catch(function(){})},v.detachVolume=function(e){return g.yesNoDlg(m.getString("Are you sure?"),m.getString("Detach volume {{volume_name}}",{volume_name:e.volume_id})).then(function(){return o.add(m.getString("Detaching volume from instance")),i.Instances.save({action:"detach_volume",volume_id:e.volume_id,uuid:v.instance.uuid}).$promise.then(function(e){return e},function(e){return o.add(m.getString("Error while detaching"))})})},v.loadCpuData=function(e,t){v.loaders.metrics=!0;var n={uuid:e.uuid,hours:t,metric:"cpu_util",action:"measures"};return v.cpuGraphLabels=[],v.cpuGraphData=[],i.Instances.get(n).$promise.then(function(e){return angular.forEach(e.measures,function(e){v.cpuGraphLabels.push(moment(e.date)),v.cpuGraphData.push(e.value)}),e}).finally(function(){v.loaders.metrics=!1})},v.loadPortData=function(e,t){v.loaders.metrics=!0;var n={uuid:e.uuid,hours:t,metric:"interface_traffic",action:"measures"};return v.packetsData=[[],[]],v.bytesData=[[],[]],v.portLabels=[],i.Instances.get(n).$promise.then(function(e){return angular.forEach(e.measures,function(e){v.portLabels.push(moment(e.date)),v.packetsData[0].push(e.packets_in),v.packetsData[1].push(e.packets_out),v.bytesData[0].push(e.bytes_in),v.bytesData[1].push(e.bytes_out)}),e}).finally(function(){v.loaders.metrics=!1})},v.fetch_security_groups=function(){return v.security_groups||(v.loaders.secgroup=!0),i.Instances.get({uuid:v.instance.uuid,action:"list_security_groups"}).$promise.then(function(e){v.security_groups=e.security_groups}).catch(function(e){o.add(e.detail)}).finally(function(){v.loaders.secgroup=!1})},v.associateSecurityGroup=function(t,n){i.Instances.get({uuid:t.uuid,action:"associate_security_group_create_options"}).$promise.then(function(e){return a.show({templateUrl:"apps/osinstances/associatesecuritygroup/flassociatesecuritygroup.html",controller:"FlAssociateSecurityController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:t,securityGroups:angular.copy(e.groups)},targetEvent:n}).then(h.boost.bind(h)).catch(function(){})})},v.dissociateSecurityGroup=function(e,t){return g.yesNoDlg(m.getString("Are you sure?"),m.getString("Dissociate security group {{sec_group}} from instance {{instance}}",{sec_group:t.name,instance:e.name}),m.getString("Dissociate security group")).then(function(){i.Instances.save({uuid:e.uuid,action:"dissociate_security_group",group:t.id}).$promise.then(function(){return o.add(m.getString("Dissociate security group scheduled")),a.hide(),h.boost()})}).catch(function(){})},v.dissociateIp=function(e,t){return g.yesNoDlg(m.getString("Are you sure?"),m.getString("Disassociate floating IP {{ip_address}}",{ip_address:t}),m.getString("Disassociate floating IP")).then(function(){i.Instances.save({uuid:e.uuid,action:"remove_floating_ip",ip:t}).$promise.then(function(){o.add(m.getString("Disassociate IP scheduled")),a.hide()},function(e){o.add(e)})}).catch(function(){})},v.getPTR=function(e,t){return a.show({templateUrl:"apps/osinstances/editptr/fleditptr.html",controller:"FlEditPtrController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{region:e.region,ip:t}}).then(h.boost.bind(h)).catch(function(){})},v.fetchInstanceBackups=function(e){return v.loaders.backups=e,i.Instances.get({uuid:v.instance.uuid,action:"get_instance_backups_and_backup_schedules"}).$promise.then(function(e){v.backupSchedules=e.schedules,v.backups=e.backups,v.loaders.backups=!1}).catch(function(e){f.handleError(e),v.loaders.backups=!1})},v.deleteBackupSchedule=function(e,t){return g.yesNoDlg(m.getString("Are you sure?"),m.getString("Delete backup schedule {{name}}",{name:t}),m.getString("Delete")).then(function(){return i.BackupSchedules.delete({id:e}).$promise.then(function(e){v.fetchInstanceBackups(!0),o.add(m.getString("Backup schedule deleted"))}).catch(f.handleError)}).catch(function(){})},v.addBackupSchedule=function(e){return a.show({templateUrl:"commons/osbackup/fl-backupschedules-create-dialog.html",controller:"FlBackupSchedulesController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:v.instance},targetEvent:e}).then(function(){}).catch(function(){v.fetchInstanceBackups(!1)})},v.createNewBackup=function(e){return a.show({templateUrl:"commons/osbackup/fl-osbackups-create-dialog.html",controller:"FlOsBackupsController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:v.instance},targetEvent:e}).then(function(){}).catch(function(){v.fetchInstanceBackups(!1)})},v.associateIp=function(t,n){i.Instances.get({uuid:t.uuid,action:"associate_ip_create_options"}).$promise.then(function(e){return a.show({templateUrl:"apps/osinstances/associateip/flinstanceassociateip.html",controller:"FlInstanceAssociateIpController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{instance:t,ports:e.ports,freeIps:e.free_ips},targetEvent:n}).then(function(){return h.boost()}).catch(function(){})})},v.fetchPortsPermissions=function(){return i.Ports.get({action:"permissions"}).$promise.then(function(e){v.portsPermissions=e})},v.removeIp=function(e,t,n){return g.yesNoDlg(m.getString("Are you sure?"),m.getString("Delete IP {{ip}}",{ip:t.ip_address}),m.getString("Delete IP")).then(function(){i.Ports.save({id:e.id,action:"remove_ip"},{fixed_ips:[{ip_address:t.ip_address,subnet_id:t.subnet_id}],region:n}).$promise.then(function(){o.add(m.getString("Remove IP scheduled")),v.submitPending=!1,a.hide()})}).catch(function(){})},v.addIp=function(t,n,o){i.Instances.get({uuid:t.uuid,action:"add_ip_options"}).$promise.then(function(e){!function(e,t,n,o){var i=!1;if(void 0!==n){for(var r=0;r<e.ports.length;r++)e.ports[r].id===n.id&&(e.ports=[e.ports[r]]);i=!0}a.show({templateUrl:"apps/osinstances/addip/flinstanceaddip.html",controller:"FlInstanceAddIpController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{instance:o,networks:e.networks,ports:e.ports,select_port_locked:i},targetEvent:t}).then(function(){return h.boost()}).catch(function(){})}(e,n,o,t)})},v.addPort=function(t,n){i.Instances.get({uuid:t.uuid,action:"add_port_options"}).$promise.then(function(e){return a.show({templateUrl:"apps/osinstances/addport/flinstanceaddport.html",controller:"FlInstanceAddPortController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{instance:t,networks:e.networks,project_id:e.project_id},targetEvent:n}).then(function(){return h.boost()}).catch(function(){})})},v.automaticAddIp=function(t,n){i.Instances.get({uuid:t.uuid,action:"add_ip_options"}).$promise.then(function(e){return a.show({templateUrl:"apps/osinstances/automaticaddips/flinstanceautomaticaddips.html",controller:"FlInstanceAutomaticAddIpController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{instance:t,networks:e.networks,ports:e.ports},targetEvent:n}).then(function(){return v.prev_net_details=angular.copy(v.instance.net_details),h.boost()}).catch(function(){})})},v.removePort=function(e){return g.yesNoDlg(m.getString("Are you sure?"),m.getString("Delete port {{port_name}}",{port_name:e.name}),m.getString("Delete port")).then(function(){i.Ports.delete({id:e.id}).$promise.then(function(){return o.add(m.getString("Remove port scheduled")),a.hide(),h.boost()})}).catch(function(){})}}angular.module("fleio").component("flInstanceDetails",{templateUrl:"apps/osinstances/flinstancedetail.html",controller:e,bindings:{instance:"<",permissions:"<"}}),e.$inject=["FlOsApi","$stateParams","$sceDelegate","FlNotificationService","FlOsTimer","FlDetectIdleService","$mdDialog","FlOsChartService","FlFeatureService","$state","FlObjectList","FlResourceService","CONFIG","gettextCatalog","FlUiUtilsService","FlResolveErrorHandler"]}(),function(){"use strict";function e(e,i,r,t,n,o,a,s,l,c,u,d){var p=this;function m(e,t){e&&t&&(t.boot_source={source_type:e.type,source_id:e.object.id},e.options&&(t.boot_source.delete_on_termination=e.options.delete_on_termination,t.boot_source.create_new_volume=e.options.create_new_volume,t.boot_source.volume_size=e.options.volume_size,t.boot_source.volume_type=e.options.volume_type))}function g(e,t){return!0===t||!!(p.instance.boot_source&&-1<["image","owned_image","shared_image","community_image"].indexOf(p.bootSource.type)&&p.instance.boot_source.source_id===e.id)&&e.assigned_to_flavor}function f(e){var t=Number.MAX_VALUE,n=Number.MAX_VALUE;e&&(t=e.memory_gb,n=e.root_gb);var o,i,r=!1;for(o=0;o<p.createOptions.bootSources.image.length;o++)(i=p.createOptions.bootSources.image[o]).disabled=i.min_disk>n||i.min_ram/1024>t,r=g(i,r);for(o=0;o<p.createOptions.bootSources.owned_image.length;o++)(i=p.createOptions.bootSources.owned_image[o]).disabled=i.min_disk>n||i.min_ram/1024>t,r=g(i,r);for(o=0;o<p.createOptions.bootSources.shared_image.length;o++)(i=p.createOptions.bootSources.shared_image[o]).disabled=i.min_disk>n||i.min_ram/1024>t,r=g(i,r);for(o=0;o<p.createOptions.bootSources.community_image.length;o++)(i=p.createOptions.bootSources.community_image[o]).disabled=i.min_disk>n||i.min_ram/1024>t,r=g(i,r);!p.isFlavorDisabled(e)&&r||(p.instance.boot_source=null,p.bootSource=null)}p.$onInit=function(){if(p.flavorsAsCards=d.flavors_as_cards,p.hideNetworksIfOnlyOneAvailable=d.hide_networks_if_only_one_available,p.showRootPasswordFieldOnNewInstanceForm=d.show_root_password_field_on_new_instance_form,p.rootPasswordMandatory=d.root_password_mandatory_on_new_instance_form,p.showUserData=d.show_userdata_on_new_instance_form,p.current_state=i.current.name,p.features=a.features,p.computeStorageEnabled=d.local_compute_storage_enabled,p.selectedClient=p.createOptions.client,p.fromLaunchImage=r.fromLaunchImage,p.flavors=p.createOptions.flavor,r.fromNewImage)p.instance=u.popObject("instance"),p.instance.region=p.createOptions.selected_region,p.bootSource={type:"owned_image",object:r.image,options:{}};else if(p.instance={region:p.createOptions.selected_region,client:p.selectedClient.id},r.image&&p.createOptions.bootSources){var e,t,n,o=!1;if(p.createOptions.bootSources.owned_image&&p.createOptions.bootSources.owned_image.length)for(e=p.createOptions.bootSources.owned_image,n=0;n<e.length;n++)if((t=e[n]).id===r.image.id){p.bootSource={type:"owned_image",object:t,options:{}},p.instance.region=t.region,o=!0;break}if(!o&&p.createOptions.bootSources.community_image&&p.createOptions.bootSources.community_image.length)for(e=p.createOptions.bootSources.community_image,n=0;n<e.length;n++)if((t=e[n]).id===r.image.id){p.bootSource={type:"community_image",object:t,options:{}},p.instance.region=t.region;break}}p.bootSource&&m(p.bootSource,p.instance),p.preselectPublicNics(p.createOptions.nics),p.flavorIncompatibleWarningText=s.getString("The selected image source requires\na flavor with more resources.\nSelect a flavor with more resources\nor use a different image source."),p.translatedStringsMap={flavor_incompatibility_brief:s.getString("Not compatible with\nselected boot source"),flavor_incompatibility:s.getString("The selected image source requires\na flavor with more resources.\nSelect a flavor with more resources\nor use a different image source.")}},p.bootSourceIsIso=function(){return p.bootSource&&p.bootSource.object&&p.bootSource.object.is_iso},p.onSelectBootSource=function(e){l.toggle("bootSource"),p.bootSource=e,m(p.bootSource,p.instance),p.flavorsAsCards||function(){p.bootSource&&"image"===p.bootSource.type?p.refreshFlavors():p.flavors=p.createOptions.flavor;if(!p.bootSource){if(p.flavorsAsCards)return p.selectedFlavorIsIncompatible=!0;p.instance.flavor=null,p.flavor=null}if(!(p.bootSource&&p.bootSource.options&&p.bootSource.options.create_new_volume)&&p.flavor&&p.bootSource&&-1<["image","owned_image"].indexOf(p.bootSource.type)&&(p.bootSource.object.min_disk>p.flavor.root_gb||p.bootSource.object.min_ram>p.flavor.memory_mb)){if(p.flavorsAsCards)return p.selectedFlavorIsIncompatible=!0;p.instance.flavor=null,p.flavor=null}p.selectedFlavorIsIncompatible=!1}()},p.toggleSidenav=function(e){u.pushObject("instance",p.instance),l.toggle(e)},p.closeNetworkSelect=function(){c.hide()},p.onRegionChange=function(){e.Instances.get({action:"create_options",region:p.instance.region}).$promise.then(function(e){p.instance.nics=[],p.createOptions=e,p.newInstance.$setPristine(),p.flavors=e.flavor,function(e){if(e&&p.flavor&&p.flavor.name&&p.flavor.memory_mb)for(var t=0;t<e.length;t++)if(e[t].name===p.flavor.name&&e[t].memory_mb===p.flavor.memory_mb)return p.flavor=e[t],p.instance.flavor=p.flavor.id,p.flavorChanged(p.flavor);p.flavor=null,p.instance.flavor=null}(e.flavor),p.bootSource={},p.instance.boot_source=null,p.preselectPublicNics(p.createOptions.nics)})},p.goBackOrToState=o.goBackOrToState,p.refreshFlavors=function(){p.loading=!0,e.Instances.get({image_id:p.bootSource.object.id,action:"get_flavors_assigned_to_image"}).$promise.then(function(e){p.flavors=e.flavors;for(var t=!1,n=0;n<p.flavors.length;n++)p.flavor&&p.flavors[n].id===p.flavor.id&&(t=!0);t?p.selectedFlavorIsIncompatible=!!p.isFlavorDisabled(p.flavor):(p.instance.flavor=null,p.flavor=null,p.selectedFlavorIsIncompatible=!1)})},p.refreshImages=function(t){t?(p.loading=!0,e.Instances.get({selected_flavor_id:t.id,region:p.instance.region,action:"get_images_assigned_to_flavors_or_flavor_group"}).$promise.then(function(e){p.loading=!1,p.createOptions.bootSources.image=e.bootSources.image,p.createOptions.bootSources.owned_image=e.bootSources.owned_image,p.createOptions.bootSources.shared_image=e.bootSources.shared_image,p.createOptions.bootSources.community_image=e.bootSources.community_image,f(t)}).catch(function(e){p.loading=!1})):e.Instances.get({region:p.instance.region,action:"get_images_assigned_to_flavors_or_flavor_group"}).$promise.then(function(e){p.loading=!1,p.createOptions.bootSources.image=e.bootSources.image,p.createOptions.bootSources.owned_image=e.bootSources.owned_image,p.createOptions.bootSources.shared_image=e.bootSources.shared_image,p.createOptions.bootSources.community_image=e.bootSources.community_image,f(t)}).catch(function(e){p.loading=!1})},p.bootSourceIsWindows=function(){return p.bootSource&&p.bootSource.object&&"windows"===p.bootSource.object.os_distro},p.flavorChanged=function(e){p.flavorsAsCards&&p.refreshImages(e)},p.isFlavorDisabled=function(e){return!!(p.bootSource&&-1<["image","owned_image","community_image"].indexOf(p.bootSource.type))&&(p.bootSource.object.min_disk>e.root_gb||p.bootSource.object.min_ram>e.memory_mb)},p.getFlavorSelectDisplay=function(){return p.flavor?"<span class='fl-ellipsis-text'>"+p.flavor.name+"</span>":"Select a configuration"},p.getFlavorIconName=function(){if(!p.flavor)return"flavor_1";var e="flavor_",t=p.flavor.memory_mb;switch(!0){case t<=512:return e+"1";case 512<t&&t<=4096:return e+"2";case 2048<t&&t<=8192:return e+"3";case 8192<t:return e+"4"}},p.preselectPublicNics=function(e){if(1===e.length&&p.hideNetworksIfOnlyOneAvailable)p.instance.nics=[e[0].id];else if(e&&e.length&&d.preselect_public_networks)for(var t=0;t<e.length;t++)for(var n=0;n<e[t].tags.length;n++)if("public"===e[t].tags[n].tag_name)return void(p.instance.nics=[e[t].id])},p.setInstanceFlavor=function(){p.flavor&&p.flavor.id?p.instance.flavor=p.flavor.id:p.instance.flavor=null},p.addSSHKey=function(e){return t.show({templateUrl:"apps/pkm/flpkmkeyedit.html",controller:"FlPkmKeyAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:e}).then(function(e){p.createOptions.ssh_key.push({id:e.id,name:e.name}),p.instance.ssh_key=e.id}).catch(function(){})},p.switchUserData=function(){!0!==p.userdata&&delete p.instance.user_data},p.newInstanceSubmit=function(){if(document.activeElement.blur(),!p.submitPending&&!p.newInstance.$invalid)return p.submitPending=!0,p.instance.ssh_keys&&(p.instance.ssh_keys=JSON.stringify(p.instance.ssh_keys)),e.Instances.save(p.instance).$promise.then(function(e){return n.add(s.getString("Instance create scheduled")),i.current.name===p.current_state&&i.go("openstackInstances"),e}).catch(function(e){p.backendErrors=e.data}).finally(function(){p.submitPending=!1})}}angular.module("fleio").component("flInstanceCreate",{templateUrl:"apps/osinstances/create/flinstancecreate.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["FlOsApi","$state","$stateParams","$mdDialog","FlNotificationService","FlUiUtilsService","FlFeatureService","gettextCatalog","FlRightNavService","$mdSelect","GlobalData","CONFIG"]}(),function(){"use strict";function e(e,i,r){var a=this;a.$onInit=function(){if(a.selected={image:null,owned_image:null,shared_image:null,volume:null,volume_snapshot:null},a.features=i.features,a.computeStorageEnabled=!!a.computeStorageEnabled,a.storageType=a.computeStorageEnabled?"local":"",a.volumesEnabled=!!a.volumesEnabled,a.translated_strings_map={not_assigned:r.getString("Image is not assigned\nto the selected flavor\nor flavor group")},a.getImageDisabledReason=function(e){return e.assigned_to_flavor?r.getString("Image requires a flavor\nwith more resources."):r.getString("Image is not assigned\nto the selected flavor\nor flavor group.")},a.selSource={type:"image",options:{create_new_volume:!a.computeStorageEnabled,delete_on_termination:!1,volume_type:""}},a.initial&&a.initial.type&&a.initial.object&&a.bootSources&&a.bootSources[a.initial.type])for(var e=a.initial.type,t=a.bootSources[e],n=0;n<t.length;n++)if(t[n].id===a.initial.object.id){if(a.selected[e]=t[n],a.selSource.type=e,a.selSource.object=a.initial.object,a.initial.options){for(var o in a.initial.options)a.initial.options.hasOwnProperty(o)&&(a.selSource.options[o]=a.initial.options[o]);a.initial.options.volume_type&&a.initial.options.create_new_volume&&(a.storageType=a.initial.options.volume_type)}break}a.selectStorageType(),a.setBootVolumeSize()},a.selectStorageType=function(){if("local"!==a.storageType){a.selSource.options.create_new_volume=!0,a.selSource.options.volume_type=a.storageType,a.sizeIncrement||(a.sizeIncrement=1),a.setBootVolumeSize();var t=1;a.selSource.options.volume_type&&a.bootSources.volume_types.forEach(function(e){e.name===a.selSource.options.volume_type&&(t=e.sizeIncrement)}),a.sizeIncrement=t}else a.selSource.options.create_new_volume=!1},a.sourceNotSelected=function(){return null===a.selected[a.selSource.type]},a.invalidSelection=function(){return"local"===a.storageType?a.sourceNotSelected():a.sourceNotSelected()||!a.validVolumeSize()},a.validVolumeSize=function(){var e=-1<["image","owned_image","shared_image","community_image"].indexOf(a.selSource.type);return void 0!==a.selSource.options.volume_size&&!(e&&a.selected[a.selSource.type]&&a.selected[a.selSource.type].min_disk&&a.selSource.options.volume_size<a.selected[a.selSource.type].min_disk)},a.doubleClickedImage=function(){a.setBootVolumeSize(),a.selectBootSource()},a.setBootVolumeSize=function(){if(-1<["image","owned_image","shared_image","community_image"].indexOf(a.selSource.type)&&a.selSource.options){var e=a.selSource.options.volume_size?a.selSource.options.volume_size:a.sizeIncrement;a.selected&&a.selected[a.selSource.type]&&a.selected[a.selSource.type].min_disk>e?a.selSource.options.volume_size=a.selected[a.selSource.type].min_disk:a.selSource.options.volume_size=e}},a.changeBootSource=function(e){a.selSource.type=e},a.showVolumeOptions=function(){return a.volumesEnabled&&-1<["image","owned_image","shared_image","community_image"].indexOf(a.selSource.type)},a.selectBootSource=function(){var e=a.selSource.type;a.selSource.object=a.selected[e],a.onSelect({source:a.selSource})},a.cancelSelection=function(){a.onCancel()},a.uploadImage=function(){e.go("imageCreate")}}angular.module("fleio").component("flBootSourceSelect",{templateUrl:"apps/osinstances/create/flbootsourceselect.html",controller:e,bindings:{bootSources:"<",initial:"<",computeStorageEnabled:"<",volumesEnabled:"<",snapshotsEnabled:"<",onSelect:"&",onCancel:"&"}}),e.$inject=["$state","FlFeatureService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s){var l=this;l.$onInit=function(){l.instance={},l.rebuildOptions&&l.rebuildOptions.instance&&l.rebuildOptions.instance.name&&(l.instance.name=l.rebuildOptions.instance.name),l.goBackOrToState=i.goBackOrToState,l.showUserData=s.show_userdata_on_new_instance_form,l.showRootPasswordFieldOnNewInstanceForm=s.show_root_password_field_on_new_instance_form,l.rootPasswordMandatory=s.root_password_mandatory_on_new_instance_form},l.toggleSidenav=function(e){a.toggle(e)},l.onSelectBootSource=function(e){(l.bootSource=e).object&&e.object.id&&(l.instance.image=e.object.id),l.toggleSidenav("bootSource")},l.bootSourceIsWindows=function(){return l.bootSource&&l.bootSource.object&&"windows"===l.bootSource.object.os_distro},l.rebuildInstance=function(){if(!l.submitPending&&!l.newInstance.$invalid)return l.submitPending=!0,l.instance.uuid=n.id,l.instance.action="rebuild",l.instance.ssh_keys&&(l.instance.ssh_keys=JSON.stringify(l.instance.ssh_keys)),e.Instances.save(l.instance).$promise.then(function(e){o.add(r.getString("Instance rebuild scheduled")),t.go("openstackInstances")}).catch(function(e){l.backendErrors=e.data,l.submitPending=!1})}}angular.module("fleio").component("flInstanceRebuild",{templateUrl:"apps/osinstances/rebuild/flinstancerebuild.html",controller:e,bindings:{rebuildOptions:"<"}}),e.$inject=["FlOsApi","$state","$stateParams","FlNotificationService","FlUiUtilsService","gettextCatalog","FlRightNavService","CONFIG"]}(),function(){"use strict";function e(t,n,o,e,i,r,a){var s=this;s.$onInit=function(){s.goBackOrToState=r.goBackOrToState,s.instance={},s.current_flavor=e("filter")(s.resizeOptions.flavors,{id:s.resizeOptions.instance.flavor})[0],s.flavorChanged=function(e){e?s.instance.flavor=e.id:delete s.instance.flavor}},s.resizeInstance=function(e){return s.instance.flavor?r.yesNoDlgCustom(null,a.getString("Resize instance?"),a.getString("Resize instance"),a.getString("Instance resize will cause downtime. The instance will shutdown and the disk image will be copied to a new disk. This may take a while, depending on the disk size."),"warning","").then(function(){if(document.activeElement.blur(),!s.submitPending&&!s.newInstance.$invalid)return s.submitPending=!0,e.uuid=o.id,t.Instances.save({uuid:e.uuid,flavor:e.flavor,action:"resize"}).$promise.then(function(e){return i.add(a.getString("Instance resize scheduled")),n.go("openstackInstanceDetails",{id:o.id})}).catch(function(e){return s.backendErrors=e.data,s.submitPending=!1})}).catch(function(){}):i.add(a.getString("You must select a flavor first!"))}}angular.module("fleio").component("flInstanceResize",{templateUrl:"apps/osinstances/resize/flinstanceresize.html",controller:e,bindings:{resizeOptions:"<"}}),e.$inject=["FlOsApi","$state","$stateParams","$filter","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(t,n,o,i,e,r){var a=this;a.$onInit=function(){a.goBackOrToState=e.goBackOrToState,a.image_type="pub",a.instance={}},a.rescueInstance=function(e){if(document.activeElement.blur(),!a.submitPending&&!a.newInstance.$invalid)return a.submitPending=!0,t.Instances.save({image:e.image,root_password:e.root_password,uuid:o.id,action:"rescue"}).$promise.then(function(e){return i.add(r.getString("Instance rescue scheduled")),n.go("openstackInstanceDetails",{id:o.id}),e},function(e){return a.backendErrors=e.data,a.submitPending=!1})}}angular.module("fleio").component("flInstanceRescue",{templateUrl:"apps/osinstances/rescue/flinstancerescue.html",controller:e,bindings:{rescueOptions:"<"}}),e.$inject=["FlOsApi","$state","$stateParams","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(t,n,o,i,e,r){var a=this;a.goBackOrToState=e.goBackOrToState,a.image_type="pub",a.instance={},a.bootFromIsoInstance=function(e){if(document.activeElement.blur(),!a.submitPending&&!a.newInstance.$invalid)return a.submitPending=!0,t.Instances.save({image:e.image,uuid:o.id,action:"boot_from_iso"}).$promise.then(function(e){return i.add(r.getString("Instance boot from ISO scheduled")),n.go("openstackInstanceDetails",{id:o.id}),e},function(e){return a.backendErrors=e.data,a.submitPending=!1})}}angular.module("fleio").component("flInstanceBootFromIso",{templateUrl:"apps/osinstances/bootfromiso/flinstancebootfromiso.html",controller:e,bindings:{bootFromIsoOptions:"<"}}),e.$inject=["FlOsApi","$state","$stateParams","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,o,i,r,a){var s=this;s.instance={ports:r,free_ips:a,port:r[0],ip:a[0]},s.associateIp=function(){document.activeElement.blur(),s.associateIpForm.$invalid||s.submitPending||(s.submitPending=!0,t.Instances.save({uuid:o.uuid,action:"add_floating_ip",floating_ip:s.instance.ip,fixed_ip:s.instance.port}).$promise.then(function(){n.add(i.getString("IP associated")),e.hide()},function(e){s.backendErrors=e.data,s.submitPending=!1}))},s.close=function(){return e.cancel()}}angular.module("fleio").controller("FlInstanceAssociateIpController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog","ports","freeIps"]}(),function(){"use strict";function e(e,t,n,o,i,r){var a=this;a.instance={ips:r,ip:r[0].floating_ip_address},a.dissociateIp=function(){document.activeElement.blur(),a.dissociateIpForm.$invalid||a.submitPending||(a.submitPending=!0,t.Instances.save({uuid:o.uuid,action:"remove_floating_ip",ip:a.instance.ip}).$promise.then(function(){n.add(i.getString("IP dissociated")),e.hide()},function(e){a.backendErrors=e.data,a.submitPending=!1}))},a.close=function(){return e.cancel()}}angular.module("fleio").controller("FlInstanceDissociateIpController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog","ips"]}(),function(){"use strict";function e(e,t,n,o,i,r){var a=this;a.securityGroups=r,a.instance=o,a.group=a.securityGroups.length?a.securityGroups[0].id:"",a.associateSecurityGroup=function(){document.activeElement.blur(),a.associateForm.$invalid||a.submitPending||(a.submitPending=!0,t.Instances.save({uuid:o.uuid,action:"associate_security_group",group:a.group}).$promise.then(function(){n.add(i.getString("Associate group scheduled")),e.hide()},function(e){a.backendErrors=e.data,a.submitPending=!1}))},a.close=function(){return e.cancel()}}angular.module("fleio").controller("FlAssociateSecurityController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","instance","gettextCatalog","securityGroups"]}(),function(){"use strict";function e(r,a,s,l){return function(e,t,n){var o;if(o=a.defer(),t.objects)return o.reject(),o.promise;if(t=new s.Instances(t),"details"==n||t.allowedAction(n))return e;var i=l.getString("Action not allowed");return r.add(i),o.reject({detail:i}),o.promise}}angular.module("fleio").factory("FlInstanceStateAllowed",e),e.$inject=["FlNotificationService","$q","FlOsApi","gettextCatalog"]}(),function(){"use strict";function e(t,e,n,o){var i=this;i.init=function(){i.ptr_loading=!0,e.Dns.get({actions:"get_ptr_from_ip",ip:o,region_name:n}).$promise.then(function(e){i.ptr_loading=!1,i.ptr={record:e.record,region_name:n,ip:o},e.zone_id&&(i.ptr.zone_id=e.zone_id),""===e.record&&(i.is_creating=!0)},function(e){i.ptr_loading=!1,i.backendErrors=e.data})},i.create_or_update_ptr=function(){document.activeElement.blur(),i.ptrForm.$invalid||i.submitPending||(i.submitPending=!0,e.Dns.save({actions:"create_or_update_ptr"},i.ptr).$promise.then(function(e){return t.hide()},function(e){return i.backendErrors=e.data,i.submitPending=!1}))},i.close=function(){return t.cancel()},i.init()}angular.module("fleio").controller("FlEditPtrController",e),e.$inject=["$mdDialog","FlOsApi","region","ip"]}(),function(){"use strict";function e(e,t,n){e.state("images",{url:t.joinBaseUrl("openstack/images?page_size?ordering?search?filtering"),component:"flImages",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{images:["$state","$stateParams","FlObjectList","FlOsApi",function(o,e,t,n){return n.Images.get({options:"create_options"}).$promise.then(function(e){var t=[];if(e.regions)for(var n=0;n<e.regions.length;n++)t.push({display:e.regions[n].id,value:e.regions[n].id});o.get("images").data.filtering.status.choices=e.statuses,o.get("images").data.filtering.region.choices=t}),t(n.Images,e)}]},data:{stateInfo:{display:n("My images"),parent:"dashboard"},feature:"openstack.images",orderOptions:{name:n("Name"),status:n("Status"),type:n("Type"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},region:{display:n("Region"),field_name:"region",type:"choices",choices:[]},status:{display:n("Status"),field_name:"status",type:"choices",choices:[]},visibility:{display:n("Visibility"),field_name:"visibility",type:"choices",choices:[{display:n("Private"),value:"private"},{display:n("Public"),value:"public"}]},protected:{display:n("Protected"),field_name:"protected",type:"bool"},min_disk:{display:n("Min disk"),field_name:"min_disk",type:"decimal"},min_ram:{display:n("Min ram"),field_name:"min_ram",type:"decimal"},volume_snapshot_uuid:{display:n("Volume snapshot"),field_name:"volume_snapshot_uuid",type:"customModelInstance",service:"FlOsApi",service_details:{type:"openstack",items:"VolumeSnapshots"}}}}}).state("imagesDetails",{url:t.joinBaseUrl("openstack/images/:id"),component:"flImageDetails",authenticate:!0,resolve:{image:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o){return t.Images.get(e).$promise.then(function(e){return n.setParams({name:e.name}),e}).catch(o.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.Images.get({action:"permissions"}).$promise}]},data:{feature:"openstack.images",stateInfo:{display:n("Image {:name}"),parent:"images",default:n("Snapshot details")}}}).state("imageCreate",{url:t.joinBaseUrl("openstack/images/create"),component:"flUserImageCreate",authenticate:!0,data:{feature:"openstack.images",stateInfo:{display:n("Create image"),parent:"images"}},resolve:{createOptions:["FlOsApi",function(e){return e.Images.get({action:"create_options"}).$promise}]}}).state("imageUpdate",{url:t.joinBaseUrl("openstack/images/:id/edit"),component:"flUserImageUpdate",authenticate:!0,resolve:{createOptions:["FlOsApi","FlResolveErrorHandler",function(e,t){return e.Images.get({action:"create_options"}).$promise.catch(t.handleError)}],image:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o){return t.Images.get(e).$promise.then(function(e){return n.setParams({name:e.name}),e}).catch(o.handleError)}]},data:{feature:"openstack.images",stateInfo:{display:n("Edit image {:name}"),default:n("Edit image"),parent:"images"}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(t,e,n,o,i,r,a,s,l){var c=this;function u(){return c.images.fetchData().then(c.checkForTaskChange)}c.$onInit=function(){o.info.enabled=!0,o.info.label=i("Search images"),o.info.service=c.images,c.refreshTimer=n(u,1e4),c.refreshTimer.start(),e.init(c.refreshTimer.start.bind(c.refreshTimer),c.refreshTimer.stop.bind(c.refreshTimer)),c.features=s.features,c.checkForTaskChange(c.images),c.TRANSLATED_STRINGS_MAP={create:r.getString("Create image"),delete:r.getString("Delete"),download:r.getString("Download image"),update:r.getString("Update"),no_permission:r.getString("You are not\nallowed to do this")}},c.deleteImage=function(e){return t.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete image {{name}}",{name:e.name}),r.getString("Delete image")).then(function(){return e.status=i("pending"),a.add(r.getString("Image delete scheduled")),e.$delete().finally(u)}).catch(function(){})},c.downloadImage=function(e){var t=l.api_url+"/openstack/images/"+e.id+"/download";window.open(t)},c.checkForTaskChange=function(e){return angular.forEach(e.objects,function(e){if(e.isUnderTask())return c.refreshTimer.boost()})},c.$onDestroy=function(){c.refreshTimer.teardown(),e.uninit()}}angular.module("fleio").component("flImages",{templateUrl:"apps/osimages/flimages.html",controller:e,bindings:{images:"<"}}),e.$inject=["FlUiUtilsService","FlDetectIdleService","FlOsTimer","FlSearchService","gettext","gettextCatalog","FlNotificationService","FlFeatureService","CONFIG"]}(),function(){"use strict";function e(t,n,o,e,i,r,a,s,l,c,u){var d,p=this;function m(){r.Images.get({id:p.image.id}).$promise.then(function(e){p.image=e,p.checkForTaskChange(p.image)})}p.$onInit=function(){(d=i(m,1e4)).start(),e.init(d.start.bind(d),d.stop.bind(d)),p.checkForTaskChange(p.image),"object"==typeof p.image.properties&&(p.imageHasProperties=0!==Object.keys(p.image.properties).length),p.features=c.features,p.TRANSLATED_STRINGS_MAP={update:s.getString("Update"),delete:s.getString("Delete"),download:s.getString("Download"),no_permission:s.getString("You are not\nallowed to do this")}},p.deleteImage=function(e){return n.yesNoDlg(s.getString("Are you sure?"),s.getString("Delete image {{name}}",{name:e.name}),s.getString("Delete image")).then(function(){return e.status=a("pending"),e.$delete().then(function(){return l.add(s.getString("Image delete scheduled")),o.go("images")}).catch(m)})},p.downloadImage=function(e){var t=u.api_url+"/openstack/images/"+e.id+"/download";window.open(t)},p.checkForTaskChange=function(e){e.isUnderTask()&&d.boost()},p.$onDestroy=function(){d.teardown(),e.uninit()},p.checkMemberStatus=function(e){return t.show({templateUrl:"apps/osimages/memberstatus/memberstatusdialog.template.html",controller:"FlImageMemberStatusController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{image_id:p.image.id},targetEvent:e}).then(function(){l.add(s.getString("Your request was sent."))}).catch(function(){})}}angular.module("fleio").component("flImageDetails",{templateUrl:"apps/osimages/flimagedetails.html",controller:e,bindings:{image:"<",permissions:"<"}}),e.$inject=["$mdDialog","FlUiUtilsService","$state","FlDetectIdleService","FlOsTimer","FlOsApi","gettext","gettextCatalog","FlNotificationService","FlFeatureService","CONFIG"]}(),function(){"use strict";function e(e,t,n,o){var i=this;i.$onInit=function(){i.name="",i.features=o.features,i.instance=n,i.features["openstack.instances.snapshots.pricing"]&&(i.loadingData=!0,t.Instances.get({uuid:n.id,action:"get_snapshot_price"}).$promise.then(function(e){i.price_per_storage=e.price_per_storage,i.price_per_snapshot=e.price_per_snapshot}).finally(function(){i.loadingData=!1}))},i.createSnapshot=function(){if(!i.createSnapshotForm.$invalid&&!i.submitPending)return i.submitPending=!0,t.Instances.save({uuid:i.instance.uuid,action:"create_snapshot",name:i.name}).$promise.then(function(){return e.hide(i.name)},function(e){return i.backendErrors=e.data,i.submitPending=!1})},i.close=function(){return e.cancel()}}angular.module("fleio").controller("FlInstanceSnapshotController",e),e.$inject=["$mdDialog","FlOsApi","instance","FlFeatureService"]}(),function(){"use strict";function e(e,t,n,i,o,r,a,s){var l=this;l.$onInit=function(){if(l.image={},l.image.container_format="bare",l.image.disk_format="qcow2",l.image.visibility=l.createOptions.visibilities[0],l.image.region=l.createOptions.selected_region,l.image.architecture="x86_64",l.architectures=["x86_64","i386","i686"],l.image.hypervisor_type=null,l.image.source="url",l.goBackOrToState=n.goBackOrToState,l.uploadProgress=0,l.features=s.features,l.allowedFormats="",l.createOptions.allowed_formats.length)for(var e=0;e<l.createOptions.allowed_formats.length;e++)l.allowedFormats=l.allowedFormats+"."+l.createOptions.allowed_formats[e],e!==l.createOptions.allowed_formats.length-1&&(l.allowedFormats=l.allowedFormats+",")},l.upload=function(e){var t=new FormData;if("file"===l.image.source){var n=document.getElementById("file");null!==n&&n.files.length&&t.append("file",n.files[0])}for(var o in e)e.hasOwnProperty(o)&&"file"!==o&&t.append(o,e[o]);return r({method:"POST",url:i.api_url+"/openstack/images",data:t,headers:{"Content-Type":void 0},uploadEventHandlers:{progress:function(e){var t=100*e.loaded/e.total;l.uploadProgress=t.toFixed(1)}}})},l.showCleanupMessage=function(){if(l.createOptions.cleanup_enabled)for(var e=0;e<l.createOptions.cleanup_formats.length;e++)if(l.image.disk_format===l.createOptions.cleanup_formats[e])return!0;return!1},l.newImageSubmit=function(){document.activeElement.blur(),l.submitPending||l.newImage.$invalid||(l.submitPending=!0,l.upload(l.image).then(function(e){return t.add(o.getString("Image create scheduled")),a.Images.get({id:e.data.id}).$promise.then(function(e){var t={image:e,region:e.region,fromLaunchImage:!0,fromNewImage:!0};n.goBackOrToState("images",t,!0)}),e}).catch(function(e){413===e.status?l.backendErrors={detail:o.getString("File to large, contact support.")}:l.backendErrors=e.data}).finally(function(){l.submitPending=!1}))},l.osDistroQuerySearch=function(e){return e?l.createOptions.os_distros.filter(function(e){var t=e.toLowerCase();return function(e){return 0===e.toLowerCase().indexOf(t)}}(e)):l.createOptions.os_distros},l.selectedOSDistroChange=function(e){l.image.os_distro=e}}angular.module("fleio").component("flUserImageCreate",{templateUrl:"apps/osimages/create/flimagecreate.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["$state","FlNotificationService","FlUiUtilsService","CONFIG","gettextCatalog","$http","FlOsApi","FlFeatureService"]}(),function(){"use strict";function e(n,o,i,e,r){var a=this;a.$onInit=function(){a.architectures=["x86_64","i386","i686"],a.goBackOrToState=e.goBackOrToState,a.imagePropertiesLoaded=!1,a.selectedOSDistro=a.image.os_distro,"object"==typeof a.image.properties?a.imageHasProperties=0!==Object.keys(a.image.properties).length:a.imageHasProperties=!1},a.setImageProperties=function(){if(!1===a.imageHasProperties&&!1===a.imagePropertiesLoaded)a.image.properties={},a.keys=[],a.imagePropertiesLoaded=!0;else if(!0===a.imageHasProperties&&!1===a.imagePropertiesLoaded){a.keys=[];var e=0;for(var t in a.image.properties)a.image.properties.hasOwnProperty(t)&&(a.keys[e]={},a.keys[e].key=t,a.keys[e].value=a.image.properties[t],e++);a.imagePropertiesLoaded=!0}},a.deactivateImage=function(){a.changeImageActiveState=!0,n.Images.save({id:a.image.id,action:"deactivate"}).$promise.then(function(e){i.add(e.detail),a.image.status="deactivated"}).catch(function(e){404!==e.status&&i.add(e.data.detail)}).finally(function(){a.changeImageActiveState=!1})},a.reactivateImage=function(){a.changeImageActiveState=!0,n.Images.save({id:a.image.id,action:"reactivate"}).$promise.then(function(e){i.add(e.detail),a.image.status="active"}).catch(function(e){404!==e.status&&i.add(e.data.detail)}).finally(function(){a.changeImageActiveState=!1})},a.deleteKey=function(e,t){a.image.properties[e]="",a.keys.splice(t,1)},a.addImageProperty=function(){a.keys.push({key:"",value:""})},a.updateImagePropsSubmit=function(){if(document.activeElement.blur(),!a.submitPending&&!a.updateImageProps.$invalid){for(var e in a.submitPending=!0,a.image.properties)a.image.properties.hasOwnProperty(e)&&(a.image.properties[e]="");for(var t=0;t<a.keys.length;t++)a.image.properties[a.keys[t].key]=a.keys[t].value;return n.Images.update(a.image).$promise.then(function(e){return i.add(r.getString("Image update scheduled")),o.go("images"),e}).catch(function(e){e.data&&e.data.properties&&e.data.properties.length?a.backendPropsErrors={detail:e.data.properties[0]}:a.backendPropsErrors=e.data,a.submitPending=!1})}},a.updateButtonDisabled=function(){return a.submitPending||a.changeImageActiveState},a.updateImageSubmit=function(){if(document.activeElement.blur(),!a.submitPending&&!a.updateImage.$invalid)return a.submitPending=!0,a.selectedOSDistro&&(a.image.os_distro=a.selectedOSDistro),n.Images.update(a.image).$promise.then(function(e){return i.add(r.getString("Image update scheduled")),o.go("images"),e}).catch(function(e){a.backendErrors=e.data,a.submitPending=!1})},a.osDistroQuerySearch=function(e){return e?a.createOptions.os_distros.filter(function(e){var t=e.toLowerCase();return function(e){return 0===e.toLowerCase().indexOf(t)}}(e)):a.createOptions.os_distros},a.selectedOSDistroChange=function(e){a.image.os_distro=e}}angular.module("fleio").component("flUserImageUpdate",{templateUrl:"apps/osimages/update/flimageupdate.html",controller:e,bindings:{createOptions:"<",image:"<"}}),e.$inject=["FlOsApi","$state","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(n,e,o,i,r,a){var t=this;t.$onInit=function(){e.Images.get({id:o,action:"get_member_status"}).$promise.then(function(e){t.memberStatus=e.status}).catch(a.handleError)},t.updateStatus=function(t){document.activeElement.blur(),e.Images.post({id:o,action:"update_image_member_status",member_status:t}).$promise.then(function(e){i.add(e.detail),n.cancel(),"rejected"===t&&r.go("images")}).catch(a.handleError)},t.close=function(){return n.cancel()}}angular.module("fleio").controller("FlImageMemberStatusController",e),e.$inject=["$mdDialog","FlOsApi","image_id","FlNotificationService","$state","FlResolveErrorHandler"]}(),function(){"use strict";function e(e,t,n,o,i){var r,a=this;function s(){return a.clusters.fetchData().then(function(){})}a.$onInit=function(){n.info.enabled=!0,n.info.label=o("Search clusters"),n.info.service=a.clusters,(r=e(s,1e4)).start(),t.init(r.start.bind(r),r.stop.bind(r)),a.TRANSLATED_STRINGS_MAP={create:i.getString("Create cluster"),no_permission:i.getString("You are not\nallowed to do this")}},a.$onDestroy=function(){r.teardown(),t.uninit()},a.onClusterAction=function(){return r.boost()}}angular.module("fleio").component("flClustersList",{templateUrl:"apps/osclusters/flclusters.component.html",controller:e,bindings:{clusters:"<"}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlSearchService","gettext","gettextCatalog"]}(),function(){"use strict";function e(){var e=this;e.$onInit=function(){e.cluster.master_addresses&&(e.cluster.master_addresses=JSON.parse(e.cluster.master_addresses.replace(/'/g,'"'))),e.cluster.node_addresses&&(e.cluster.node_addresses=JSON.parse(e.cluster.node_addresses.replace(/'/g,'"'))),e.cluster.labels=JSON.parse(e.cluster.labels)}}angular.module("fleio").component("flClusterDetails",{templateUrl:"apps/osclusters/flclusterdetails.component.html",controller:e,bindings:{cluster:"<",permissions:"<"}}),e.$inject=[]}(),function(){"use strict";function e(t,e,n,o,i){var r=this;r.cluster=n,r.resizeCluster=function(){if(document.activeElement.blur(),!r.submitPending&&!r.resizeClusterForm.$invalid)return r.submitPending=!0,e.Clusters.post({id:r.cluster.id},{action:"resize_cluster",node_count:r.node_count,nodes_to_remove:r.nodes_to_remove}).$promise.then(function(e){return i.add(o.getString("Resize started.")),t.hide()},function(e){return r.backendErrors=e.data,r.submitPending=!1})},r.close=function(){return t.cancel()}}angular.module("fleio").controller("FlClusterResizeController",e),e.$inject=["$mdDialog","FlOsApi","cluster","gettextCatalog","FlNotificationService"]}(),function(){"use strict";function e(t,o,i,r,e,a,n,s,l){return{restrict:"E",replace:"true",scope:{cluster:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"apps/osclusters/actions/flclusteractions.html",controller:["$scope","$element",function(n,e){n.TRANSLATED_STRINGS_MAP={delete:a.getString("Delete"),edit:a.getString("Edit"),resize:a.getString("Resize"),get_certificate:a.getString("Get certificate"),no_permission:a.getString("You are not\nallowed to do this")},n.deleteCluster=function(){return t.yesNoDlg(a.getString("Are you sure you want to delete the cluster?"),a.getString("Delete cluster {{name}}",{name:n.cluster.name}),a.getString("Delete cluster")).then(function(){return n.cluster.fldelete().then(function(){if(r.add(a.getString("Cluster deleted scheduled")),n.isDetail)return o.go("openstackClusters");n.callback()}).catch(function(e){r.add(e.data.detail)})}).catch(function(){})},n.getClusterCertificate=function(){var e=l.api_url+"/openstack/clusters/"+n.cluster.id+"/get_certificate";window.open(e)},n.resizeCluster=function(e,t){return i.show({templateUrl:"apps/osclusters/resize/flclusterresize.html",controller:"FlClusterResizeController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{cluster:n.cluster},targetEvent:t}).then(function(e){}).catch(function(){})}}]}}angular.module("fleio").directive("flClusterActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlResolveErrorHandler","FlOsApi","CONFIG"]}(),function(){"use strict";function e(t,o,i,r,e,a){return{restrict:"E",replace:"true",scope:{cluster:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"apps/osclusters/actions/flxsclusteractions.html",controller:["$scope","$element",function(n,e){n.deleteCluster=function(){return t.yesNoDlg(a.getString("Are you sure you want to delete the cluster?"),a.getString("Delete cluster {{name}}",{name:n.cluster.name}),a.getString("Delete cluster")).then(function(){return n.cluster.fldelete().then(function(){if(r.add(a.getString("Cluster deleted scheduled")),n.isDetail)return o.go("openstackClusters");n.callback()}).catch(function(e){r.add(e.data.detail)})}).catch(function(){})},n.getClusterCertificate=function(){var e=CONFIG.api_url+"/openstack/clusters/"+n.cluster.id+"/get_certificate";window.open(e)},n.resizeCluster=function(e,t){return i.show({templateUrl:"apps/osclusters/resize/flclusterresize.html",controller:"FlClusterResizeController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{cluster:n.cluster},targetEvent:t}).then(function(){}).catch(function(){})}}]}}angular.module("fleio").directive("flXsClusterActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog"]}(),function(){"use strict";function e(t,n,e,o,i){var r=this;r.$onInit=function(){r.goBackOrToState=o.goBackOrToState,r.cluster={master_count:1,node_count:1,create_timeout:60},r.searchClusterTemplates=function(e){return t.ClusterTemplates.get({search:e}).$promise.then(function(e){return e.objects})},r.matchFlavor=function(e,t){for(var n=!1,o=null,i=0;i<r.createOptions.flavors.length;i++)r.createOptions.flavors[i].id===t[e]&&(n=!0,r.cluster[e]=t[e]),r.createOptions.flavors[i].name===t[e]&&(o=r.createOptions.flavors[i]);n||(r.cluster[e]=o.id)},r.formatLabelsToStr=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t=t+n+"="+e[n]+",");return t.substring(0,t.length-1)},r.clusterTemplateChanged=function(){r.selectedClusterTemplate&&t.Clusters.get({cluster_template_id:r.selectedClusterTemplate.id,action:"create_options"}).$promise.then(function(e){r.createOptions=e,t.ClusterTemplates.get({id:r.selectedClusterTemplate.id}).$promise.then(function(e){r.cluster.docker_volume_size=e.docker_volume_size,e.master_flavor_id&&r.matchFlavor("master_flavor_id",e),e.flavor_id&&r.matchFlavor("flavor_id",e),e.labels&&(r.cluster.labels=r.formatLabelsToStr(JSON.parse(e.labels.replace(/'/g,'"')))),e.keypair_id&&(r.cluster.keypair=e.keypair_id)})})},r.submitForm=function(){if(!r.newCluster.$invalid){if(r.submitPending=!0,!r.selectedClusterTemplate)return r.submitPending=!1,e.add(i.getString("Please select a valid cluster template"));r.cluster.cluster_template_id=r.selectedClusterTemplate.id,t.Clusters.save(r.cluster).$promise.then(function(e){r.submitPending=!1,n.go("openstackClusters")}).catch(function(e){r.backendErrors=e.data,r.submitPending=!1})}}}}angular.module("fleio").component("flClusterCreate",{templateUrl:"apps/osclusters/create/flclustercreate.component.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["FlOsApi","$state","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){e.state("openstackClusters",{url:t.joinBaseUrl("openstack/clusters?page_size?ordering?filtering?search"),component:"flClustersList",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{clusters:["$state","$stateParams","FlObjectList","FlOsApi",function(r,e,t,n){return n.Clusters.get({action:"filter_options"}).$promise.then(function(e){for(var t=e.regions,n=[],o=0,i=t.length;o<i;++o)n.push({display:t[o].id,value:t[o].id});r.get("openstackClusters").data.filtering.region.choices=n,r.get("openstackClusters").data.filtering.status.choices=e.statuses}),t(n.Clusters,e)}]},data:{stateInfo:{display:n("Clusters"),parent:"dashboard"},feature:"openstack.coe.clusters",orderOptions:{name:n("Name"),status:n("Status"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},region:{display:n("Region"),field_name:"region",type:"choices",choices:[]},status:{display:n("Status"),field_name:"status",type:"choices",choices:[]},cluster_template:{display:n("Cluster template"),field_name:"cluster_template",type:"customModelInstance",service:"FlOsApi",service_details:{type:"openstack",items:"ClusterTemplates"}}}}}).state("openstackClusterCreate",{url:t.joinBaseUrl("openstack/clusters/create"),component:"flClusterCreate",authenticate:!0,resolve:{createOptions:["FlOsApi",function(e){return e.Clusters.get({action:"create_options"}).$promise}]},data:{feature:"openstack.coe.clusters",stateInfo:{display:n("Create cluster"),parent:"openstackClusters"}}}).state("openstackClusterDetails",{url:t.joinBaseUrl("openstack/clusters/:id"),component:"flClusterDetails",authenticate:!0,resolve:{cluster:["FlOsApi","$stateParams","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o){return e.Clusters.get(t).$promise.then(function(e){var t;return t=e.name?e.name:e.id,n.setParams({clusterTitle:t}),e}).catch(o.handleError)}],permissions:["FlOsApi",function(e){return e.Clusters.get({action:"permissions"}).$promise}]},data:{feature:"openstack.coe.clusters",stateInfo:{display:n("Cluster {:clusterTitle}"),parent:"openstackClusters",default:n("Cluster details")}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l){var c,u=this;function d(){return u.clusterTemplates.fetchData().then(function(){})}u.$onInit=function(){r.info.enabled=!0,r.info.label=s("Search cluster templates"),r.info.service=u.clusterTemplates,(c=n(d,1e4)).start(),o.init(c.start.bind(c),c.stop.bind(c)),u.TRANSLATED_STRINGS_MAP={create:l.getString("Create cluster template"),no_permission:l.getString("You are not\nallowed to do this")}},u.$onDestroy=function(){c.teardown(),o.uninit()},u.onClusterTemplateAction=function(){return c.boost()}}angular.module("fleio").component("flClusterTemplatesList",{templateUrl:"apps/osclustertemplates/flclustertemplates.component.html",controller:e,bindings:{clusterTemplates:"<"}}),e.$inject=["$state","$stateParams","FlOsTimer","FlDetectIdleService","$mdDialog","FlSearchService","FlOsApi","gettext","gettextCatalog"]}(),function(){"use strict";function e(){var e=this;e.$onInit=function(){e.clusterTemplate.labels=JSON.parse(e.clusterTemplate.labels.replace(/'/g,'"').replace(/None/g,"null"))}}angular.module("fleio").component("flClusterTemplateDetails",{templateUrl:"apps/osclustertemplates/flclustertemplatedetails.component.html",controller:e,bindings:{clusterTemplate:"<",permissions:"<"}}),e.$inject=[]}(),function(){"use strict";function e(e,t,n,o,i){var r=this;r.$onInit=function(){r.goBackOrToState=o.goBackOrToState,r.clusterTemplate={coe:"kubernetes",network_driver:"flannel",docker_storage_driver:"devicemapper",volume_driver:"cinder",server_type:"vm",fixed_network:null},r.coeOptions=[{name:"kubernetes",display_name:"Kubernetes"},{name:"swarm",display_name:"Docker Swarm"},{name:"mesos",display_name:"Mesos"}],r.refreshCreateOptions=function(){e.ClusterTemplates.get({action:"create_options",region:r.selectedRegion}).$promise.then(function(e){r.createOptions=e}).catch(function(e){})},r.createOptions.regions.length&&(r.selectedRegion=r.createOptions.regions[0].id,r.refreshCreateOptions()),r.regionChanged=function(){r.clusterTemplate.external_network_id=null,r.clusterTemplate.flavor_id=null,r.clusterTemplate.master_flavor_id=null,r.clusterTemplate.fixed_network=null,r.clusterTemplate.image_id=null,delete r.clusterTemplate.fixed_subnet,r.selectedFixedSubnet=null,r.refreshCreateOptions()},r.createFilterFor=function(e){var t=angular.lowercase(e);return function(e){return 0===angular.lowercase(e.name).indexOf(t)}},r.selectedFixedSubnetChange=function(e){e?r.clusterTemplate.fixed_subnet=e.id:delete r.clusterTemplate.fixed_subnet},r.querySearchSubnets=function(e){return e?r.createOptions.fixed_subnets.filter(r.createFilterFor(e)):r.createOptions.fixed_subnets},r.submitForm=function(){r.submitPending=!0,r.newClusterTemplate.$invalid?r.submitPending=!1:(r.clusterTemplate.region=r.selectedRegion,e.ClusterTemplates.save(r.clusterTemplate).$promise.then(function(e){return r.submitPending=!1,n.add(i.getString("Successfully created cluster template.")),t.go("openstackClusterTemplates")}).catch(function(e){r.submitPending=!1,r.backendErrors=e.data}))}}}angular.module("fleio").component("flClusterTemplateCreate",{templateUrl:"apps/osclustertemplates/create/flclustertemplate-create.component.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["FlOsApi","$state","FlNotificationService","FlUiUtilsService","gettextCatalog"]}(),function(){"use strict";function e(n,o,e,i,t,r,a){return{restrict:"E",replace:"true",scope:{clusterTemplate:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"apps/osclustertemplates/actions/flclustertemplateactions.html",controller:["$scope","$element",function(e,t){e.TRANSLATED_STRINGS_MAP={delete:r.getString("Delete"),edit:r.getString("Edit"),no_permission:r.getString("You are not\nallowed to do this")},e.deleteClusterTemplate=function(){return n.yesNoDlg(r.getString("Are you sure you want to delete the cluster template?"),r.getString("Delete cluster template {{name}}",{name:e.clusterTemplate.name}),r.getString("Delete cluster template")).then(function(){return e.clusterTemplate.fldelete().then(function(){if(i.add(r.getString("Cluster template deleted")),e.isDetail)return o.go("openstackClusterTemplates");e.callback()}).catch(function(e){403!==e.status&&i.add(e.data.detail)})}).catch(function(){})}}]}}angular.module("fleio").directive("flClusterTemplateActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlResolveErrorHandler"]}(),function(){"use strict";function e(n,o,e,i,r){return{restrict:"E",replace:"true",scope:{clusterTemplate:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"apps/osclustertemplates/actions/flxsclustertemplateactions.html",controller:["$scope","$element",function(e,t){e.deleteClusterTemplate=function(){return n.yesNoDlg(r.getString("Are you sure you want to delete the cluster template?"),r.getString("Delete cluster template {{name}}",{name:e.clusterTemplate.name}),r.getString("Delete cluster template")).then(function(){return e.clusterTemplate.fldelete().then(function(){if(i.add(r.getString("Cluster template deleted")),e.isDetail)return o.go("openstackClusterTemplates");e.callback()}).catch(function(e){403!==e.status&&i.add(e.data.detail)})}).catch(function(){})}}]}}angular.module("fleio").directive("flXsClusterTemplateActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){e.state("openstackClusterTemplates",{url:t.joinBaseUrl("openstack/cluster-templates?page_size?ordering?filtering?search"),component:"flClusterTemplatesList",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{clusterTemplates:["$state","$stateParams","FlObjectList","FlOsApi",function(r,e,t,n){return n.ClusterTemplates.get({action:"filter_options"}).$promise.then(function(e){for(var t=e.regions,n=[],o=0,i=t.length;o<i;++o)n.push({display:t[o].id,value:t[o].id});r.get("openstackClusterTemplates").data.filtering.region.choices=n}),t(n.ClusterTemplates,e)}]},data:{stateInfo:{display:n("Cluster templates"),parent:"dashboard"},feature:"openstack.coe.cluster_templates",orderOptions:{name:n("Name"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},coe:{display:n("Container orchestration engine"),field_name:"coe",type:"choices",choices:[{display:n("Kubernetes"),value:"kubernetes"},{display:n("Mesos"),value:"mesos"},{display:n("Swarm"),value:"swarm"}]},public:{display:n("Is public"),field_name:"public",type:"bool"},floating_ip_enabled:{display:n("Floating IP enabled"),field_name:"floating_ip_enabled",type:"bool"},region:{display:n("Region"),field_name:"region",type:"choices",choices:[]}}}}).state("openstackClusterTemplateCreate",{url:t.joinBaseUrl("openstack/cluster-templates/create"),component:"flClusterTemplateCreate",authenticate:!0,resolve:{createOptions:["FlOsApi",function(e){return e.ClusterTemplates.get({action:"create_options"}).$promise}]},data:{feature:"openstack.coe.cluster_templates",stateInfo:{display:n("Create cluster template"),parent:"openstackClusterTemplates"}}}).state("openstackClusterTemplateDetails",{url:t.joinBaseUrl("openstack/cluster-templates/:id"),component:"flClusterTemplateDetails",authenticate:!0,resolve:{clusterTemplate:["FlOsApi","$stateParams","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o){return e.ClusterTemplates.get(t).$promise.then(function(e){var t;return t=e.name?e.name:e.id,n.setParams({clusterTemplateTitle:t}),e}).catch(o.handleError)}],permissions:["FlOsApi",function(e){return e.ClusterTemplates.get({action:"permissions"}).$promise}]},data:{feature:"openstack.coe.cluster_templates",stateInfo:{display:n("Cluster template {:clusterTemplateTitle}"),parent:"openstackClusterTemplates",default:n("Cluster template details")}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n){e.state("openstackVolumeBackups",{url:t.joinBaseUrl("openstack/volume-backups?page_size?ordering?filtering?search?dlg"),component:"flVolumeBackupsList",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{volumeBackups:["$state","$stateParams","FlObjectList","FlOsApi",function(t,e,n,o){return o.VolumeBackups.get({action:"filter_options"}).$promise.then(function(e){t.get("openstackVolumeBackups").data.filtering.status.choices=e.statuses}),n(o.VolumeBackups,e)}]},data:{stateInfo:{display:n("Volume backups"),parent:"dashboard"},feature:"openstack.volumes.backups",orderOptions:{name:n("Name"),status:n("Status"),size:n("Size"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},volume:{display:n("related volume"),field_name:"volume",type:"customModelInstance",service:"FlOsApi",service_details:{type:"openstack",items:"Volumes"}},is_incremental:{display:n("Is incremental"),field_name:"is_incremental",type:"bool"},status:{display:n("Status"),field_name:"status",type:"choices",choices:[]},size:{display:n("Size"),field_name:"size",type:"decimal"},object_count:{display:n("Object count"),field_name:"object_count",type:"decimal"},has_dependent_backups:{display:n("Has dependent backups"),field_name:"has_dependent_backups",type:"bool"}}}}).state("openstackVolumeBackupDetails",{url:t.joinBaseUrl("openstack/volume-backups/:id"),component:"flVolumeBackupDetails",authenticate:!0,resolve:{volumeBackup:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o){return t.VolumeBackups.get(e).$promise.then(function(e){var t;return t=e.name?e.name:e.id,n.setParams({volumeBackupTitle:t}),e}).catch(o.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.VolumeBackups.get({action:"permissions"}).$promise}]},data:{feature:"openstack.volumes.backups",stateInfo:{display:n("Volume backup {:volumeBackupTitle}"),parent:"openstackVolumeBackups",default:n("Volume backup details")}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l){var c,u=this;function d(){return u.volumeBackups.fetchData().then(u.checkForTaskChange)}u.$onInit=function(){r.info.enabled=!0,r.info.label=s("Search volume backups"),r.info.service=u.volumeBackups,(c=n(d,1e4)).start(),o.init(c.start.bind(c),c.stop.bind(c)),u.TRANSLATED_STRINGS_MAP={create:l.getString("Create volume backup"),no_permission:l.getString("You are not\nallowed to do this")}},u.checkForTaskChange=function(){angular.forEach(u.volumeBackups.objects,function(e){if(e.isUnderTask())return c.boost()})},u.$onDestroy=function(){c.teardown(),o.uninit()},u.onVolumeAction=function(){return c.boost()},u.createNewBackup=function(e){return i.show({templateUrl:"apps/osvolumebackups/create/fl-volumebackups-create.template.html",controller:"FlVolumeBackupsCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:null},targetEvent:e}).then(function(){}).catch(function(){d()})}}angular.module("fleio").component("flVolumeBackupsList",{templateUrl:"apps/osvolumebackups/flvolumebackups.html",controller:e,bindings:{volumeBackups:"<"}}),e.$inject=["$state","$stateParams","FlOsTimer","FlDetectIdleService","$mdDialog","FlSearchService","FlOsApi","gettext","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,o){var i,r=this;function a(){return t.VolumeBackups.get({id:e.id}).$promise.then(function(e){r.volumeBackup=e,r.checkForTaskChange(e)})}r.$onInit=function(){(i=n(a,1e4)).start(),o.init(i.start.bind(i),i.stop.bind(i)),r.checkForTaskChange(r.volumeBackup)},r.checkForTaskChange=function(e){if(e.isUnderTask())return i.boost()},r.onVolumeAction=function(){return i.boost()},r.$onDestroy=function(){i.teardown(),o.uninit()}}angular.module("fleio").component("flVolumeBackupDetails",{templateUrl:"apps/osvolumebackups/flvolumebackupdetails.html",controller:e,bindings:{volumeBackup:"<",permissions:"<"}}),e.$inject=["$stateParams","FlOsApi","FlOsTimer","FlDetectIdleService"]}(),function(){"use strict";function e(n,o,i,r,e,a,t){return{restrict:"E",replace:"true",scope:{backup:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"apps/osvolumebackups/actions/flvolumebackupactions.html",controller:["$scope","$element",function(t,e){t.TRANSLATED_STRINGS_MAP={delete:a.getString("Delete"),edit:a.getString("Edit"),restore:a.getString("Restore"),no_permission:a.getString("You are not\nallowed to do this")},t.deleteVolumeBackup=function(){return n.yesNoDlg(a.getString("Are you sure you want to delete the volume backup?"),a.getString("Delete volume backup {{name}}",{name:t.backup.name}),a.getString("Delete volume backup")).then(function(){return t.backup.fldelete().then(function(){if(r.add(a.getString("Volume backup delete scheduled")),t.isDetail)return o.go("openstackVolumeBackups")}).catch(function(e){r.add(e.data.detail)})}).catch(function(){})},t.restoreBackup=function(e){return i.show({templateUrl:"apps/osvolumebackups/restore/fl-volumebackups-restore.template.html",controller:"FlVolumeBackupsRestoreController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{backup:t.backup},targetEvent:e}).then(function(){}).catch(function(){})},t.editBackup=function(e){return i.show({templateUrl:"apps/osvolumebackups/edit/fl-volumebackups-edit.template.html",controller:"FlVolumeBackupsEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{backupId:t.backup.id,backupName:t.backup.name,backupDescription:t.backup.description},targetEvent:e}).then(function(){}).catch(function(){})}}]}}angular.module("fleio").directive("flVolumeBackupActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlResolveErrorHandler"]}(),function(){"use strict";function e(n,o,i,r,e,a,t){return{restrict:"E",replace:"true",scope:{backup:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"apps/osvolumebackups/actions/flxsvolumebackupactions.html",controller:["$scope","$element",function(t,e){t.TRANSLATED_STRINGS_MAP={delete:a.getString("Delete"),restore:a.getString("Restore"),no_permission:a.getString("You are not\nallowed to do this")},t.deleteVolumeBackup=function(){return n.yesNoDlg(a.getString("Are you sure you want to delete the volume backup?"),a.getString("Delete volume backup {{name}}",{name:t.backup.name}),a.getString("Delete volume backup")).then(function(){return t.backup.fldelete().then(function(){if(r.add(a.getString("Volume backup delete scheduled")),t.isDetail)return o.go("openstackVolumeBackups")}).catch(function(e){r.add(e.data.detail)})}).catch(function(){})},t.restoreBackup=function(e){return i.show({templateUrl:"apps/osvolumebackups/restore/fl-volumebackups-restore.template.html",controller:"FlVolumeBackupsRestoreController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{backup:t.backup},targetEvent:e}).then(function(){}).catch(function(){})},t.editBackup=function(e){return i.show({templateUrl:"apps/osvolumebackups/edit/fl-volumebackups-edit.template.html",controller:"FlVolumeBackupsEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{backupId:t.backup.id,backupName:t.backup.name,backupDescription:t.backup.description},targetEvent:e}).then(function(){}).catch(function(){})}}]}}angular.module("fleio").directive("flXsVolumeBackupActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlResolveErrorHandler"]}(),function(){"use strict";function e(t,e,n,o,i){var r=this;r.$onInit=function(){e?(r.volumeIsPreselected=!0,r.volume=angular.copy(e),r.backup={volume_id:r.volume.id}):(r.volumeIsPreselected=!1,r.backup={}),r.submitPending=!1},r.volumeSearch=function(e){return t.Volumes.get({search:e}).$promise.then(function(e){return e.objects})},r.selectedVolumeChange=function(e){r.backup.volume_id=e.id},r.close=function(){n.cancel()},r.createBackup=function(){if(document.activeElement.blur(),!r.submitPending&&!r.backupForm.$invalid)return r.submitPending=!0,t.VolumeBackups.save(r.backup).$promise.then(function(e){return o.add(i.getString("Backup was scheduled for creation")),r.submitPending=!1,n.cancel(e)}).catch(function(e){r.backendErrors=e.data,r.submitPending=!1})}}angular.module("fleio").controller("FlVolumeBackupsCreateController",e),e.$inject=["FlOsApi","volume","$mdDialog","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,o,i,r,a){var s=this;s.$onInit=function(){t&&(s.backup={id:angular.copy(t),name:angular.copy(n),description:angular.copy(o)})},s.close=function(){i.cancel()},s.updateBackup=function(){if(document.activeElement.blur(),!s.submitPending&&!s.backupForm.$invalid)return s.submitPending=!0,e.VolumeBackups.update(s.backup).$promise.then(function(e){return r.add(a.getString("Backup was scheduled for updating")),s.submitPending=!1,i.cancel(e)}).catch(function(e){s.backendErrors=e.data,s.submitPending=!1})}}angular.module("fleio").controller("FlVolumeBackupsEditController",e),e.$inject=["FlOsApi","backupId","backupName","backupDescription","$mdDialog","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(t,e,n,o,i){var r=this;r.$onInit=function(){e&&(r.backup=angular.copy(e)),r.requestData={}},r.close=function(){n.cancel()},r.restoreBackup=function(){if(document.activeElement.blur(),!r.submitPending&&!r.backupForm.$invalid){r.submitPending=!0;var e={id:r.backup.id,action:"restore"};return r.requestData.newVolume&&r.requestData.name&&(e.name=r.requestData.name),!r.requestData.newVolume&&r.selectedVolume&&(e.volume_id=r.selectedVolume.id),t.VolumeBackups.post(e).$promise.then(function(e){return o.add(i.getString("Backup was scheduled for restoration")),r.submitPending=!1,n.cancel(e)}).catch(function(e){r.backendErrors=e.data,r.submitPending=!1})}},r.volumesSearch=function(e){return t.VolumeBackups.post({backup_id:r.backup.id,action:"get_volumes_available_for_restoration",search:e}).$promise.then(function(e){return e.objects})}}angular.module("fleio").controller("FlVolumeBackupsRestoreController",e),e.$inject=["FlOsApi","backup","$mdDialog","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l){var c,u=this;function d(){return u.volumeSnapshots.fetchData().then(u.checkForTaskChange)}u.$onInit=function(){r.info.enabled=!0,r.info.label=s("Search volume snapshots"),r.info.service=u.volumeSnapshots,(c=n(d,1e4)).start(),o.init(c.start.bind(c),c.stop.bind(c)),u.TRANSLATED_STRINGS_MAP={create:l.getString("Create volume snapshot"),no_permission:l.getString("You are not\nallowed to do this")}},u.checkForTaskChange=function(){angular.forEach(u.volumeSnapshots.objects,function(e){if(e.isUnderTask())return c.boost()})},u.$onDestroy=function(){c.teardown(),o.uninit()},u.onVolumeAction=function(){return c.boost()},u.createNewSnapshot=function(e){return i.show({templateUrl:"apps/osvolumesnapshots/create/fl-volumesnapshots-create.template.html",controller:"FlVolumeSnapshotsCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:null},targetEvent:e}).then(function(){}).catch(function(){d()})}}angular.module("fleio").component("flVolumeSnapshotsList",{templateUrl:"apps/osvolumesnapshots/flvolumesnapshots.html",controller:e,bindings:{volumeSnapshots:"<"}}),e.$inject=["$state","$stateParams","FlOsTimer","FlDetectIdleService","$mdDialog","FlSearchService","FlOsApi","gettext","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,o){var i,r=this;function a(){return t.VolumeSnapshots.get({id:e.id}).$promise.then(function(e){r.volumeSnapshot=e,r.checkForTaskChange(e)})}r.$onInit=function(){(i=n(a,1e4)).start(),o.init(i.start.bind(i),i.stop.bind(i)),r.checkForTaskChange(r.volumeSnapshot)},r.checkForTaskChange=function(e){if(e.isUnderTask())return i.boost()},r.onVolumeAction=function(){return i.boost()},r.$onDestroy=function(){i.teardown(),o.uninit()}}angular.module("fleio").component("flVolumeSnapshotDetails",{templateUrl:"apps/osvolumesnapshots/flvolumesnapshotdetails.html",controller:e,bindings:{volumeSnapshot:"<",permissions:"<"}}),e.$inject=["$stateParams","FlOsApi","FlOsTimer","FlDetectIdleService"]}(),function(){"use strict";function e(t,e,n,o,i){var r=this;r.$onInit=function(){e?(r.volumeIsPreselected=!0,r.volume=angular.copy(e),r.snapshot={volume_id:r.volume.id}):(r.volumeIsPreselected=!1,r.snapshot={}),r.submitPending=!1},r.volumeSearch=function(e){return t.Volumes.get({search:e}).$promise.then(function(e){return e.objects})},r.selectedVolumeChange=function(e){r.snapshot.volume_id=e.id},r.close=function(){n.cancel()},r.createSnapshot=function(){if(document.activeElement.blur(),!r.submitPending&&!r.snapshotForm.$invalid)return r.submitPending=!0,t.VolumeSnapshots.save(r.snapshot).$promise.then(function(e){return o.add(i.getString("Volume snapshot was scheduled for creation")),r.submitPending=!1,n.cancel(e)}).catch(function(e){r.backendErrors=e.data,r.submitPending=!1})}}angular.module("fleio").controller("FlVolumeSnapshotsCreateController",e),e.$inject=["FlOsApi","volume","$mdDialog","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(n,o,i,r,e,a){return{restrict:"E",replace:"true",scope:{snapshot:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"apps/osvolumesnapshots/actions/flvolumesnapshotactions.html",controller:["$scope","$element",function(e,t){e.TRANSLATED_STRINGS_MAP={delete:a.getString("Delete"),edit:a.getString("Edit"),reset_state:a.getString("Reset state"),no_permission:a.getString("You are not\nallowed to do this")},e.deleteVolumeSnapshot=function(){return n.yesNoDlg(a.getString("Are you sure you want to delete the volume snapshot?"),a.getString("Delete volume snapshot {{name}}",{name:e.snapshot.name}),a.getString("Delete volume snapshot")).then(function(){return e.snapshot.fldelete().then(function(){if(r.add(a.getString("Volume snapshot delete scheduled")),e.isDetail)return o.go("openstackVolumeSnapshots")}).catch(function(e){r.add(e.data.detail)})}).catch(function(){})},e.resetVolumeSnapshotState=function(e,t){return i.show({templateUrl:"apps/osvolumesnapshots/reset_state/flvolumesnapshot-reset-state.html",controller:"FlVolumeSnapResetStateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{snapshot:e},targetEvent:t}).then(function(){return r.add(a.getString("Resetting state of volume..."))}).catch(function(){})},e.updateVolumeSnapshot=function(e,t){return i.show({templateUrl:"apps/osvolumesnapshots/update/fl-volumesnapshots-update.template.html",controller:"FlVolumeSnapshotsUpdateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{snapshot:e},targetEvent:t}).then(function(){return r.add(a.getString("Volume snapshot update started."))}).catch(function(){})}}]}}angular.module("fleio").directive("flVolumeSnapshotActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog"]}(),function(){"use strict";function e(n,o,i,r,e,a,t){return{restrict:"E",replace:"true",scope:{snapshot:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"apps/osvolumesnapshots/actions/flxsvolumesnapshotactions.html",controller:["$scope","$element",function(e,t){e.TRANSLATED_STRINGS_MAP={delete:a.getString("Delete"),no_permission:a.getString("You are not\nallowed to do this")},e.deleteVolumeSnapshot=function(){return n.yesNoDlg(a.getString("Are you sure you want to delete the volume snapshot?"),a.getString("Delete volume snapshot {{name}}",{name:e.snapshot.name}),a.getString("Delete volume snapshot")).then(function(){return e.snapshot.fldelete().then(function(){if(r.add(a.getString("Volume snapshot delete scheduled")),e.isDetail)return o.go("openstackVolumeSnapshots")}).catch(function(e){r.add(e.data.detail)})}).catch(function(){})},e.resetVolumeSnapshotState=function(e,t){return i.show({templateUrl:"apps/osvolumesnapshots/reset_state/flvolumesnapshot-reset-state.html",controller:"FlVolumeSnapResetStateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{snapshot:e},targetEvent:t}).then(function(){return r.add(a.getString("Resetting state of volume..."))}).catch(function(){})},e.updateVolumeSnapshot=function(e,t){return i.show({templateUrl:"apps/osvolumesnapshots/update/fl-volumesnapshots-update.template.html",controller:"FlVolumeSnapshotsUpdateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{snapshot:e},targetEvent:t}).then(function(){return r.add(a.getString("Volume snapshot update started."))}).catch(function(){})}}]}}angular.module("fleio").directive("flXsVolumeSnapshotActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlResolveErrorHandler"]}(),function(){"use strict";function e(e,t,n,o){var i=this;i.$onInit=function(){i.snapshot=angular.copy(t),i.states=[{value:"available",display:o.getString("Available")},{value:"error",display:o.getString("Error")}],i.state=i.states[0].value},i.resetState=function(){if(document.activeElement.blur(),!i.submitPending&&!i.resetStateForm.$invalid)return i.submitPending=!0,e.VolumeSnapshots.save({id:i.snapshot.id,action:"reset_state",state:i.state}).$promise.then(function(e){return n.hide(),e}).catch(function(e){i.backendErrors=e.data,i.submitPending=!1})},i.close=function(){return n.cancel()}}angular.module("fleio").controller("FlVolumeSnapResetStateController",e),e.$inject=["FlOsApi","snapshot","$mdDialog","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,o,i){var r=this;r.$onInit=function(){r.snapshot=angular.copy(t),r.submitPending=!1},r.close=function(){n.cancel()},r.updateSnapshot=function(){if(document.activeElement.blur(),!r.submitPending&&!r.snapshotForm.$invalid)return r.submitPending=!0,e.VolumeSnapshots.update(r.snapshot).$promise.then(function(e){return o.add(i.getString("Volume snapshot update started.")),r.submitPending=!1,n.cancel(e)}).catch(function(e){r.backendErrors=e.data,r.submitPending=!1})}}angular.module("fleio").controller("FlVolumeSnapshotsUpdateController",e),e.$inject=["FlOsApi","snapshot","$mdDialog","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){e.state("openstackVolumeSnapshots",{url:t.joinBaseUrl("openstack/volume-snapshots?page_size?ordering?filtering?search?dlg"),component:"flVolumeSnapshotsList",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{volumeSnapshots:["$state","$stateParams","FlObjectList","FlOsApi",function(t,e,n,o){return o.VolumeSnapshots.get({action:"filter_options"}).$promise.then(function(e){t.get("openstackVolumeSnapshots").data.filtering.status.choices=e.statuses}),n(o.VolumeSnapshots,e)}]},data:{stateInfo:{display:n("Volume snapshots"),parent:"dashboard"},feature:"openstack.volumes.snapshots",orderOptions:{name:n("Name"),status:n("Status"),size:n("Size"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},volume:{display:n("related volume"),field_name:"volume",type:"customModelInstance",service:"FlOsApi",service_details:{type:"openstack",items:"Volumes"}},status:{display:n("Status"),field_name:"status",type:"choices",choices:[]},size:{display:n("Size"),field_name:"size",type:"decimal"}}}}).state("openstackVolumeSnapshotDetails",{url:t.joinBaseUrl("openstack/volume-snapshots/:id"),component:"flVolumeSnapshotDetails",authenticate:!0,resolve:{volumeSnapshot:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o){return t.VolumeSnapshots.get(e).$promise.then(function(e){var t;return t=e.name?e.name:e.id,n.setParams({volumeSnapshotTitle:t}),e}).catch(o.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.VolumeSnapshots.get({action:"permissions"}).$promise}]},data:{feature:"openstack.volumes.snapshots",stateInfo:{display:n("Volume snapshot {:volumeSnapshotTitle}"),parent:"openstackVolumeSnapshots",default:n("Volume snapshot details")}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n){e.state("openstackVolumes",{url:t.joinBaseUrl("openstack/volumes?page_size?ordering?filtering?search?dlg"),component:"flVolumes",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{dlg:{value:"false",squash:!0},page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{volumes:["$state","$stateParams","FlObjectList","FlOsApi",function(r,e,t,n){return n.Volumes.get({options:"filter_options"}).$promise.then(function(e){for(var t=e.regions,n=[],o=0,i=t.length;o<i;++o)n.push({display:t[o].id,value:t[o].id});r.get("openstackVolumes").data.filtering.region.choices=n,r.get("openstackVolumes").data.filtering.status.choices=e.statuses}),t(n.Volumes,e)}]},data:{stateInfo:{display:n("Volumes"),parent:"dashboard"},feature:"openstack.volumes",orderOptions:{name:n("Name"),status:n("Status"),size:n("Size"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},status:{display:n("Status"),field_name:"status",type:"choices",choices:[]},size:{display:n("Size"),field_name:"size",type:"decimal"},region:{display:n("Region"),field_name:"region",type:"choices",choices:[]}}}}).state("openstackVolumeCreate",{url:t.joinBaseUrl("openstack/volumes/create"),component:"flVolumeCreateComponent",authenticate:!0,resolve:{createOptions:["$transition$","FlOsApi",function(e,t){return t.Volumes.get({action:"create_options",region:e.params().region}).$promise}]},data:{feature:"openstack.volumes",stateInfo:{display:n("New"),parent:"openstackVolumes",default:n("Create")}}}).state("openstackVolumeDetails",{url:t.joinBaseUrl("openstack/volumes/:id"),component:"flVolumeDetails",authenticate:!0,resolve:{volume:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o){return t.Volumes.get(e).$promise.then(function(e){var t;return t=e.name?e.name:e.id,n.setParams({volumeTitle:t}),e}).catch(o.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.Volumes.get({action:"permissions"}).$promise}]},data:{feature:"openstack.volumes",stateInfo:{display:n("Volume {:volumeTitle}"),parent:"openstackVolumes",default:n("Volume details")}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l){var c,u=this;e.current.name;function d(){return u.volumes.fetchData().then(function(e){u.checkForTaskChange(e)})}u.$onInit=function(){r.info.enabled=!0,r.info.label=s("Search volumes"),r.info.service=u.volumes,(c=n(d,1e4)).start(),o.init(c.start.bind(c),c.stop.bind(c)),u.TRANSLATED_STRINGS_MAP={create:l.getString("Create volume"),no_permission:l.getString("You are not\nallowed to do this")}},u.checkForTaskChange=function(e){return angular.forEach(e.objects,function(e){if(e.isUnderTask())return c.boost()})},u.$onDestroy=function(){c.teardown(),o.uninit()},u.onVolumeAction=function(){return c.boost()}}angular.module("fleio").component("flVolumes",{templateUrl:"apps/osvolumes/flvolumes.html",controller:e,bindings:{volumes:"<"}}),e.$inject=["$state","$stateParams","FlOsTimer","FlDetectIdleService","$mdDialog","FlSearchService","FlOsApi","gettext","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,o,i,r){var a,s=this;function l(){return t.Volumes.get({id:e.id}).$promise.then(function(e){s.volume=e,s.checkForTaskChange(e)})}s.$onInit=function(){s.features=i.features,(a=n(l,1e4)).start(),o.init(a.start.bind(a),a.stop.bind(a)),s.checkForTaskChange(s.volume),s.numberOfSnapshotsStr=r.getString("Snapshots ("+s.volume.number_of_snapshots+")")},s.checkForTaskChange=function(e){if(e.isUnderTask())return a.boost()},s.onVolumeAction=function(){return a.boost()},s.$onDestroy=function(){a.teardown(),o.uninit()}}angular.module("fleio").component("flVolumeDetails",{templateUrl:"apps/osvolumes/flvolumedetails.html",controller:e,bindings:{volume:"<",permissions:"<"}}),e.$inject=["$stateParams","FlOsApi","FlOsTimer","FlDetectIdleService","FlFeatureService","gettextCatalog"]}(),function(){"use strict";function e(t,e,n,o,i,r){var a,s=this;s.$onInit=function(){s.currentPage=1,s.nextPage=!1,s.previousPage=!1,s.loading=!0,s.refreshVolumeBackups=function(){return n.VolumeBackups.get({volume__id:e.id,page:s.currentPage}).$promise.then(function(e){s.loading=!1,s.nextPage=!!e.next,s.previousPage=!!e.previous,s.volumeBackups=e}).catch(r.handleError)},s.refreshVolumeBackups(),(a=o(s.refreshVolumeBackups,1e4)).start(),i.init(a.start.bind(a),a.stop.bind(a))},s.createNewBackup=function(e){return t.show({templateUrl:"apps/osvolumebackups/create/fl-volumebackups-create.template.html",controller:"FlVolumeBackupsCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:s.volume},targetEvent:e}).then(function(){}).catch(function(){s.refreshVolumeBackups()})},s.onVolumeAction=function(){return a.boost()},s.changePage=function(e){"next"===e&&(s.currentPage=s.currentPage+1,s.refreshVolumeBackups()),"previous"===e&&(s.currentPage=s.currentPage-1,s.refreshVolumeBackups())},s.$onDestroy=function(){a.teardown(),i.uninit()}}angular.module("fleio").component("flVolumeBackups",{templateUrl:"apps/osvolumes/backups/flvolumebackups.template.html",controller:e,bindings:{volume:"<"}}),e.$inject=["$mdDialog","$stateParams","FlOsApi","FlOsTimer","FlDetectIdleService","FlResolveErrorHandler"]}(),function(){"use strict";function e(t,e,n,o,i,r){var a,s=this;s.$onInit=function(){s.currentPage=1,s.nextPage=!1,s.previousPage=!1,s.loading=!0,s.refreshVolumeSnapshots=function(){return n.VolumeSnapshots.get({volume__id:e.id,page:s.currentPage}).$promise.then(function(e){s.loading=!1,s.nextPage=!!e.next,s.previousPage=!!e.previous,s.volumeSnapshots=e}).catch(r.handleError)},s.refreshVolumeSnapshots(),(a=o(s.refreshVolumeSnapshots,1e4)).start(),i.init(a.start.bind(a),a.stop.bind(a))},s.createNewSnapshot=function(e){return t.show({templateUrl:"apps/osvolumesnapshots/create/fl-volumesnapshots-create.template.html",controller:"FlVolumeSnapshotsCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:s.volume},targetEvent:e}).then(function(){}).catch(function(){s.refreshVolumeSnapshots()})},s.onVolumeAction=function(){return a.boost()},s.changePage=function(e){"next"===e&&(s.currentPage=s.currentPage+1,s.refreshVolumeSnapshots()),"previous"===e&&(s.currentPage=s.currentPage-1,s.refreshVolumeSnapshots())},s.$onDestroy=function(){a.teardown(),i.uninit()}}angular.module("fleio").component("flVolumeSnapshots",{templateUrl:"apps/osvolumes/snapshots/flvolumesnapshots.template.html",controller:e,bindings:{volume:"<"}}),e.$inject=["$mdDialog","$stateParams","FlOsApi","FlOsTimer","FlDetectIdleService","FlResolveErrorHandler"]}(),function(){"use strict";function e(t,o,i,r,a,s,e,l){return{restrict:"E",replace:"true",scope:{volume:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"apps/osvolumes/actions/flvolumeactions.html",controller:["$scope","$element",function(n,e){return n.TRANSLATED_STRINGS_MAP={extend:s.getString("Extend"),delete:s.getString("Delete"),rename:s.getString("Rename"),no_permission:s.getString("You are not\nallowed to do this")},n.features=l.features,n.deleteVolume=function(){return t.yesNoDlg(s.getString("Are you sure you want to delete the volume?"),s.getString("Delete volume {{name}}",{name:n.volume.name}),s.getString("Delete volume")).then(function(){return n.volume.fldelete().then(function(){if(r.add(s.getString("Volume delete scheduled")),n.isDetail)return o.go("openstackVolumes")}).catch(function(e){e.data.detail?r.add(e.data.detail):r.add(s.getString("Unable to delete volume."))})}).catch(function(){})},n.renameVolume=function(e,t){return i.show({templateUrl:"apps/osvolumes/rename/flvolumerename.html",controller:"FlVolumeRenameController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:e},targetEvent:t}).then(function(e){n.volume.name=e,a.updateParams({name:e})}).catch(function(){})},n.revertToSnapshot=function(e,t){return i.show({templateUrl:"oscommons/revert_volume_to_snapshot_dialog/fl-revert-volume-to-snapshot-dialog.template.html",controller:"FlVolumeRevertController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:e},targetEvent:t}).then(function(e){r.add(e.detail)}).catch(function(){})},n.changeBootableStatus=function(e,t){return i.show({templateUrl:"oscommons/change_bootable_status_dialog/fl-change-bootable-status-dialog.template.html",controller:"FlVolumeChangeBootableStatusController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:e},targetEvent:t}).then(function(e){r.add(e.detail)}).catch(function(){})},n.extendVolume=function(e){return i.show({templateUrl:"apps/osvolumes/extend/flvolumeextend.html",controller:"FlVolumeExtendController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:n.volume},targetEvent:e}).then(function(){return"function"==typeof n.callback&&(n.volume.status="pending",n.callback.call(null)),r.add(s.getString("Volume extend scheduled"))}).catch(function(){})}}]}}angular.module("fleio").directive("flVolumeActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlOsApi","FlFeatureService"]}(),function(){"use strict";function e(t,o,i,r,a,s,e,l){return{restrict:"E",replace:"true",scope:{volume:"=",isDetail:"=",callback:"=",permissions:"<"},templateUrl:"apps/osvolumes/actions/flxsvolumeactions.html",controller:["$scope","$element",function(n,e){return n.features=l.features,n.deleteVolume=function(){return t.yesNoDlg(s.getString("Are you sure you want to delete the volume?"),s.getString("Delete volume {{name}}",{name:n.volume.name}),s.getString("Delete volume")).then(function(){return n.volume.fldelete().then(function(){if(r.add(s.getString("Volume delete scheduled")),n.isDetail)return o.go("openstackVolumes")}).catch(function(e){e.data.detail?r.add(e.data.detail):r.add(s.getString("Unable to delete volume."))})}).catch(function(){})},n.renameVolume=function(e,t){return i.show({templateUrl:"apps/osvolumes/rename/flvolumerename.html",controller:"FlVolumeRenameController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:e},targetEvent:t}).then(function(e){n.volume.name=e,a.updateParams({name:e})}).catch(function(){})},n.revertToSnapshot=function(e,t){return i.show({templateUrl:"oscommons/revert_volume_to_snapshot_dialog/fl-revert-volume-to-snapshot-dialog.template.html",controller:"FlVolumeRevertController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:e},targetEvent:t}).then(function(e){r.add(e.detail)}).catch(function(){})},n.changeBootableStatus=function(e,t){return i.show({templateUrl:"oscommons/change_bootable_status_dialog/fl-change-bootable-status-dialog.template.html",controller:"FlVolumeChangeBootableStatusController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:e},targetEvent:t}).then(function(e){r.add(e.detail)}).catch(function(){})},n.extendVolume=function(e){return i.show({templateUrl:"apps/osvolumes/extend/flvolumeextend.html",controller:"FlVolumeExtendController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{volume:n.volume},targetEvent:e}).then(function(){return"function"==typeof n.callback&&(n.volume.status="pending",n.callback.call(null)),r.add(s.getString("Volume extend scheduled"))}).catch(function(){})}}]}}angular.module("fleio").directive("flXsVolumeActions",e),e.$inject=["FlUiUtilsService","$state","$mdDialog","FlNotificationService","FlBreadCrumbService","gettextCatalog","FlOsApi","FlFeatureService"]}(),function(){"use strict";function e(t,e,n){var o=this;o.sizeIncrement=n.size_increment,o.size=n.size,o.volume=n,o.extendVolume=function(){if(document.activeElement.blur(),!o.submitPending&&!o.extendVolumeForm.$invalid)return o.submitPending=!0,e.Volumes.save({id:o.volume.id,action:"extend",size:o.size}).$promise.then(function(e){return t.hide()},function(e){return o.backendErrors=e.data,o.submitPending=!1})},o.close=function(){return t.cancel()}}angular.module("fleio").controller("FlVolumeExtendController",e),e.$inject=["$mdDialog","FlOsApi","volume"]}(),function(){"use strict";function e(t,n,o,e,i){var r=this;r.sourceTypes=[{name:"new",description:"Create a new empty volume"}],r.features=e.features,r.$onInit=function(){r.volume={region:r.createOptions.selected_region,type:r.createOptions.types.length?r.createOptions.types[0]:"",source:{source_type:"new",source:null}},r.setVolumeType(),r.rebuildSourceTypes()},r.refreshCreateOptions=function(e){return t.Volumes.get({action:"create_options",region:e}).$promise.then(function(e){return r.createOptions=e,r.setVolumeType(),r.rebuildSourceTypes(),r.resetVolumeSources(),e}).catch(function(e){return n.add(e.data),e})},r.changeRegion=function(){r.refreshCreateOptions(r.volume.region)},r.rebuildSourceTypes=function(){r.sourceTypes=[{name:"new",description:i.getString("Create a new empty volume")}],r.createOptions.sources&&(r.createOptions.sources.image&&r.createOptions.sources.image.length&&r.sourceTypes.push({name:"image",description:i.getString("Use image as a source")}),r.createOptions.sources.volume&&r.createOptions.sources.volume.length&&r.sourceTypes.push({name:"volume",description:i.getString("Use an existing volume")})),r.volume.source&&"new"!==r.volume.source.source_type&&(r.createOptions.sources[r.volume.source.source_type].length||(r.volume.source.source_type="new",r.volume.source.source=null))},r.setVolumeType=function(){var t={};r.createOptions.types.forEach(function(e){e.name===r.volume.type&&(t=e)}),r.volumeType=t,r.volume.type=t.name},r.resetVolumeSources=function(){"new"!==r.volume.source.source_type?(delete r.volume.source.source,r.volumeSources=r.createOptions.sources[r.volume.source.source_type]):r.volumeSources=[]},r.close=function(){return o.go("openstackVolumes")},r.newVolumeSubmit=function(){if(document.activeElement.blur(),!r.submitPending&&!r.newVolume.$invalid)return"default"===r.volume.type&&(r.volume.type=null),r.submitPending=!0,t.Volumes.save(r.volume).$promise.then(function(e){return n.add(i.getString("Volume create scheduled")),o.go("openstackVolumes"),e}).catch(function(e){r.backendErrors=e.data}).finally(function(){r.submitPending=!1})}}angular.module("fleio").component("flVolumeCreateComponent",{templateUrl:"apps/osvolumes/create/flvolumecreate.html",controller:e,bindings:{createOptions:"<"}}),e.$inject=["FlOsApi","FlNotificationService","$state","FlFeatureService","gettextCatalog"]}(),function(){"use strict";function e(t,e,n){var o=this;o.name=n.name,o.volume=n,o.renameVolume=function(){if(document.activeElement.blur(),!o.submitPending&&!o.renameVolumeForm.$invalid)return o.submitPending=!0,e.Volumes.save({id:o.volume.id,action:"rename",name:o.name}).$promise.then(function(e){return t.hide(o.name)},function(e){return o.backendErrors=e.data,o.submitPending=!1})},o.close=function(){return t.cancel()}}angular.module("fleio").controller("FlVolumeRenameController",e),e.$inject=["$mdDialog","FlOsApi","volume"]}(),function(){"use strict";function e(e,t,n,o){var i=this;i.instance=t,i.create_options={},i.attachment={uuid:t.uuid,action:"attach_volume"},e.Volumes.get({status:"available",region:i.instance.region,page_size:"100000"}).$promise.then(function(e){i.create_options=e}),i.close=function(){return n.cancel()},i.createNewVolume=function(){return n.cancel(),o.go("openstackVolumeCreate")},i.attachVolume=function(){if(document.activeElement.blur(),!i.submitPending&&!i.attachVolumeForm.$invalid)return i.submitPending=!0,e.Instances.save(i.attachment).$promise.then(function(e){return n.hide(),e},function(e){i.backendErrors=e.data,i.submitPending=!1})}}angular.module("fleio").controller("FlVolumeAttachController",e),e.$inject=["FlOsApi","instance","$mdDialog","$state"]}(),function(){"use strict";function e(e,t,n){e.state("openstackSshKeys",{url:t.joinBaseUrl("openstack/sshkeys?page_size?ordering?filtering?search?dlg"),component:"flPkmKeys",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{dlg:{value:"false",squash:!0},page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0},filtering:{value:"",squash:!0}},resolve:{keys:["$stateParams","FlObjectList","FlPkmApi",function(e,t,n){return t(n,e)}]},data:{stateInfo:{display:n("SSH keys"),parent:"dashboard"},feature:"openstack.sshkeys",orderOptions:{name:n("Name"),created_at:n("Date created")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"}}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/pkm/:id:action")}angular.module("fleio").factory("FlPkmApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(t,e,n,o,i,r,a,s,l,c){var u=this;u.$onInit=function(){r.info.enabled=!0,r.info.label=s("Search keys"),r.info.service=u.keys,"add"===e.dlg&&u.addKey(null),u.TRANSLATED_STRINGS_MAP={delete:a.getString("Delete"),edit:a.getString("Edit"),create:a.getString("Add SSH key"),no_permission:a.getString("You are not\nallowed to do this")}},u.addKey=function(e){return t.go(t.current,{dlg:"add"}),n.show({templateUrl:"apps/pkm/flpkmkeyedit.html",controller:"FlPkmKeyAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,targetEvent:e}).then(function(){return l.add(a.getString("Successfully added SSH key")),u.keys.fetchData()}).finally(function(){t.go(t.current,{dlg:"false"})}).catch(function(){})},u.editKey=function(e,t){if(u.keys.permissions["publickeys.update"])return n.show({templateUrl:"apps/pkm/flpkmkeyedit.html",controller:"FlPkmKeyEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{key:t},targetEvent:e}).then(function(){return l.add(a.getString("SSH key updated successfully")),u.keys.fetchData()}).catch(function(){})},u.deleteKey=function(e){return o.yesNoDlg(a.getString("Are you sure?"),a.getString("Delete key {{name}}",{name:e.name}),a.getString("Delete key")).then(function(){return u.keys.delete({id:e.id}).$promise.then(function(e){l.add(a.getString("SSH key successfully deleted"))}).catch(function(e){c.handleError(e)})}).catch(function(){})}}angular.module("fleio").component("flPkmKeys",{templateUrl:"apps/pkm/flpkmkeys.html",controller:e,bindings:{keys:"<"}}),e.$inject=["$state","$stateParams","$mdDialog","FlUiUtilsService","FlPkmApi","FlSearchService","gettextCatalog","gettext","FlNotificationService","FlResolveErrorHandler"]}(),function(){"use strict";function e(t,e,n){var o=this;o.$onInit=function(){o.key=angular.copy(n)},o.saveKey=function(){if(document.activeElement.blur(),!o.editKey.$invalid&&!o.submitPending)return o.submitPending=!0,e.update({id:o.key.id},o.key).$promise.then(function(e){return t.hide(e),e},function(e){o.submitPending=!1,o.backendErrors=e.data})},o.close=function(){return t.cancel()}}angular.module("fleio").controller("FlPkmKeyEditController",e),e.$inject=["$mdDialog","FlPkmApi","key"]}(),function(){"use strict";function e(t,e,n){var o=this;o.$onInit=function(){o.enableGenerate=!0,o.keyGen={inProgress:!1,generated:!1},void 0===o.key&&(o.key={})},o.generateKey=function(){document.activeElement.blur(),o.keyGen={inProgress:!0,generated:!1},e.get({action:"get_generated_key_pair"}).$promise.then(function(e){o.key.private_key=e.private_key,o.key.public_key=e.public_key},function(e){t.hide(e)}).finally(function(){o.keyGen={inProgress:!1,generated:!0}})},o.saveKey=function(){if(document.activeElement.blur(),!o.editKey.$invalid&&!o.submitPending)return o.submitPending=!0,e.save(o.key).$promise.then(function(e){return t.hide(e),e},function(e){return o.submitPending=!1,o.backendErrors=e.data})},o.close=function(){return t.cancel()}}angular.module("fleio").controller("FlPkmKeyAddController",e),e.$inject=["$mdDialog","FlPkmApi","gettext"]}(),function(){"use strict";function e(e,t,n){e.state("billingHistory",{url:t.joinBaseUrl("billing/history"),component:"billingHistory",authenticate:!0,data:{stateInfo:{display:n("Billing history"),parent:"dashboard"},feature:"billing.history"},resolve:{billing:["FlOsApi","FlFeatureService",function(e,t){return t.features.openstack?e.Accounting.get().$promise:{objects:[]}}]}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(t,e){var n=this;function o(e){n.is_history=!1,(n.usage=e)&&e.usage&&n.usage.usage.currency&&(n.billing_currency=n.usage.usage.currency.code)}function i(e){n.loaders={billing:!0},null===e?t.Accounting.get().$promise.then(function(e){if(n.billing=e,n.selectedServiceId)for(var t=0;t<e.objects.length;t++)n.selectedServiceId===e.objects[t].id&&o(e.objects[t]);else o(e.objects[0]);n.loaders={billing:!1}}):t.AccountingHistory.get({id:e}).$promise.then(function(e){n.is_history=!0,n.usage=e,n.billing_currency=n.usage.usage.currency.code,n.loaders={billing:!1}})}n.$onInit=function(){n.getHistory=i,console.log(n.billing),o(n.billing.objects[0]),n.selectedServiceId=n.billing.objects[0].id,n.loaders={billing:!1},e.getString("Instance details"),e.getString("Image details"),e.getString("Volume details"),e.getString("Network details"),e.getString("Object storage details"),e.getString("Ceph object storage details"),e.getString("Instance traffic details")},n.changeSelectedService=function(){for(var e=0;e<n.billing.objects.length;e++)n.billing.objects[e].id===n.selectedServiceId&&o(n.billing.objects[e])}}angular.module("fleio").component("billingHistory",{templateUrl:"apps/billing/history/billinghistory.html",controller:e,bindings:{billing:"<"}}),e.$inject=["FlOsApi","gettextCatalog"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/signup")}angular.module("fleio").factory("FlSignUpApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(t,e,n,o){var i=this;i.$onInit=function(){i.userInfo=n.userInfo,i.ngModel={email:"",password:"",reseller_client_id:o.reseller_client_id},void 0!==o.language&&(i.ngModel.language=o.language),i.signUpForm={}},i.switchAgreementFlag=function(){i.ngModel.tos_agreement=!i.ngModel.tos_agreement},i.signUp=function(){if(!i.signUpForm.$invalid&&!i.submitPending)return i.submitPending=!0,e.save(i.ngModel).$promise.then(function(e){return n.getUserInfo(!0).then(function(){t.go("addClient")}),e}).catch(function(e){i.backendErrors=e.data}).finally(function(){i.submitPending=!1})}}angular.module("fleio").component("flSignUp",{templateUrl:"apps/signup/flsignup.html",controller:e,bindings:{currentUser:"<"}}),e.$inject=["$state","FlSignUpApi","FlAuthService","CONFIG"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s){var l=this;l.$onInit=function(){l.confirmEmailApi=a.api_url+"/confirm-email/",l.resendEmailApi=a.api_url+"/resend-confirmation-email/",n.token&&(l.confirmation_code=n.token,l.confirm())},l.confirm=function(){l.confirmation_code&&(l.loading=!0,e.post(l.confirmEmailApi,{token:l.confirmation_code}).then(function(e){l.loading=!1,o.go("dashboard"),t.add(s.getString("Email successfully confirmed"))}).catch(function(e){l.loading=!1,l.backendErrors=e.data}))},l.resendEmail=function(){e.post(l.resendEmailApi).then(function(e){l.responseMessage=e.data.detail}).catch(function(e){l.backendErrors=e.data})}}angular.module("fleio").component("flConfirmEmail",{templateUrl:"apps/signup/flconfirmemail.component.html",controller:e}),e.$inject=["$http","FlNotificationService","$stateParams","$state","FlSignUpApi","FlAuthService","CONFIG","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){e.state("signup",{url:t.joinBaseUrl("signup"),component:"flSignUp",data:{feature:"clients&users.signup",showMenu:!1,stateInfo:{display:n("Sign up")}},resolve:{currentUser:["FlAuthService","$state",function(e,t){return e.getUserInfo().then(function(e){return void 0!==e.user?t.go("dashboard"):e})}]}}).state("confirmEmail",{url:t.joinBaseUrl("confirm-email/:token"),component:"flConfirmEmail",data:{feature:"clients&users.signup",showMenu:!0,stateInfo:{display:n("Confirm email"),parent:null}}}).state("confirmEmailNoToken",{url:t.joinBaseUrl("confirm-email"),component:"flConfirmEmail",data:{feature:"clients&users.signup",showMenu:!0,stateInfo:{display:n("Confirm email"),parent:null}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/clients/:id:options/:action",{id:"@id",options:"@options",action:"@action"})}angular.module("fleio").factory("FlClientApi",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(t,e,n){var o=this;o.$onInit=function(){o.client={first_name:n.userInfo.user.first_name,last_name:n.userInfo.user.last_name,email:n.userInfo.user.email},o.addClientForm={},o.countries=o.options.countries,o.customFieldsDefinition=o.options.custom_fields},o.stateRequired=function(){for(var e=0;e<o.countries.length;e++)if(o.countries[e].value===o.client.country)return o.countries[e].state_required;return!0},o.selectedCountryChange=function(e){o.client.country=e.value},o.querySearch=function(e){return e?o.countries.filter(function(e){var t=e.toLowerCase();return function(e){return 0===e.label.toLowerCase().indexOf(t)}}(e)):o.countries},o.addClient=function(){if(document.activeElement.blur(),!o.addClientForm.$invalid&&!o.submitPending)return o.submitPending=!0,e.save(o.client).$promise.then(function(e){return n.getUserInfo(!0).then(function(e){e.requires_email_verification?t.go("confirmEmailNoToken"):t.go("dashboard")}),e},function(e){o.submitPending=!1,o.backendErrors=e.data})}}angular.module("fleio").component("flAddClient",{templateUrl:"apps/clients/fladdclient.html",controller:e,bindings:{options:"<"}}),e.$inject=["$state","FlClientApi","FlAuthService"]}(),function(){"use strict";function e(e,t,n,o,i){var r=this;r.$onInit=function(){r.countries=r.createOptions.countries?r.createOptions.countries:[],r.client=r.client?r.client:{},r.createOptions&&(r.customFieldsDefinition=r.createOptions.custom_fields);if(r.client&&r.client.country&&r.countries.length){var e=r.countries.filter(function(e){return e.value===r.client.country});r.selectedCountry=e[0]}},r.saveClient=function(){if(document.activeElement.blur(),r.editClientForm.$invalid||r.actionPending)return;return r.actionPending=!0,e.update({id:r.client.id},r.client).$promise.then(function(e){r.actionPending=!1,t.go("userprofile"),n.add(o.getString("Client {{fname}} {{lname}} modified",{fname:e.first_name,lname:e.last_name}))},function(e){r.actionPending=!1,r.backendErrors=e.data})},r.stateRequired=function(){for(var e=0;e<r.countries.length;e++)if(r.countries[e].value===r.client.country)return r.countries[e].state_required;return!0},r.selectedCountryChange=function(e){e&&(r.client.country=e.value)},r.querySearch=function(e){return e?r.countries.filter(function(e){var t=e.toLowerCase();return function(e){return 0===e.label.toLowerCase().indexOf(t)}}(e)):r.countries}}angular.module("fleio.commons").component("flUserClientEdit",{templateUrl:"apps/clients/flclientedit.html",controller:e,bindings:{createOptions:"<",client:"<"}}),e.$inject=["FlClientApi","$state","FlNotificationService","gettextCatalog","$mdDialog"]}(),function(){"use strict";function e(e,t,n,o,i){var r=this;r.$onInit=function(){r.countries=r.createOptions.countries?r.createOptions.countries:[],r.client=r.client?r.client:{},r.createOptions&&(r.customFieldsDefinition=r.createOptions.custom_fields);if(r.client&&r.client.country&&r.countries.length){var e=r.countries.filter(function(e){return e.value===r.client.country});r.selectedCountry=e[0]}},r.saveClient=function(){if(document.activeElement.blur(),r.editClientForm.$invalid||r.actionPending)return;return r.actionPending=!0,e.update({id:r.client.id},r.client).$promise.then(function(e){r.actionPending=!1,i.hide()},function(e){r.actionPending=!1,r.backendErrors=e.data})},r.selectedCountryChange=function(e){e&&(r.client.country=e.value)},r.querySearch=function(e){return e?r.countries.filter(function(e){var t=e.toLowerCase();return function(e){return 0===e.label.toLowerCase().indexOf(t)}}(e)):r.countries},r.close=function(){return i.cancel()}}angular.module("fleio.commons").controller("EditClientController",e),e.$inject=["FlClientApi","$state","FlNotificationService","gettextCatalog","$mdDialog"]}(),function(){"use strict";function e(e,t,n){e.state("addClient",{url:t.joinBaseUrl("clients/add"),component:"flAddClient",data:{feature:"clients&users.clients",stateInfo:{display:n("Add client billing information"),parent:"dashboard"}},resolve:{options:["FlClientApi","FlAuthService",function(e,t){if(t.userInfo&&t.userInfo.user&&angular.isArray(t.userInfo.user.clients)&&0<t.userInfo.user.clients.length)throw{redirect:"dashboard",message:"Client already created"};return e.get({options:"create_options"}).$promise}]}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t){var n,o,i,r,a=t.api_url+"/billing";return n=e(a+"/summary"),o=e(a+"/orders/:id/:action",{id:"@id",action:"@action"}),r=e(a+"/gateways/:id/:action",{id:"@id",action:"@action"}),i=e(a+"/services/:id/:action",{id:"@id",action:"@action"}),{Summary:n,Orders:o,Products:e(a+"/products/:id/:action",{id:"@id",action:"@action"}),Services:i,Invoices:e(a+"/invoices/:id:options/:action",{id:"@id",options:"@options",action:"@action"}),Gateways:r}}angular.module("fleio").factory("FlBilling",e),e.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(e,t,n){e.state("billingInvoices",{url:t.joinBaseUrl("billing/invoices?page_size?ordering?search?filtering"),component:"flInvoicing",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-status,due_date",squash:!0},filtering:{value:"",squash:!0}},data:{stateInfo:{display:n("Invoices"),parent:"dashboard"},feature:"billing.invoices",orderOptions:{"status,due_date":n("Status and due date"),status:n("Status"),issue_date:n("Issue date"),due_date:n("Due date")},filtering:{issue_date:{display:n("Issue date"),field_name:"issue_date",type:"date"},due_date:{display:n("Due date"),field_name:"due_date",type:"date"},status:{display:n("Status"),field_name:"status",type:"choices",choices:[{display:n("Unpaid"),value:"unpaid"},{display:n("Paid"),value:"paid"},{display:n("Cancelled"),value:"cancelled"},{display:n("Refunded"),value:"refunded"}]},total:{display:n("Total"),field_name:"total",type:"decimal"}}},resolve:{invoices:["$stateParams","FlObjectList","FlBilling","FlResolveErrorHandler",function(e,t,n,o){return t(n.Invoices,e).catch(o.handleError)}]}}).state("billingInvoicesDetails",{url:t.joinBaseUrl("billing/invoices/:id"),component:"flInvoicingDetails",authenticate:!0,resolve:{invoice:["$stateParams","FlBilling","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o){return t.Invoices.get(e).$promise.then(function(e){return n.setParams({id:e.id,name:e.name}),e}).catch(o.handleError)}]},data:{stateInfo:{display:"{:name}",parent:"billingInvoices",default:n("Invoice details")},feature:"billing.invoices"}}).state("addCredit",{url:t.joinBaseUrl("billing/add-credit/:client_id"),component:"flAddCredit",authenticate:!0,data:{stateInfo:{display:n("Add credit"),parent:"dashboard"},feature:"billing.addcredit"},resolve:{client:["FlClientApi","FlUiUtilsService","$stateParams","FlResolveErrorHandler",function(e,t,n,o){return e.get({id:n.client_id}).$promise.catch(o.handleError)}],applicableTaxRules:["$http","$stateParams","FlResolveErrorHandler","CONFIG",function(e,t,n,o){return e.get(o.api_url+"/billing/taxrules",{params:{client_id:t.client_id}}).catch(n.handleError)}]}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,o,i){var r=this;r.$onInit=function(){r.client_id=n.client_id,r.goBackOrToState=e.goBackOrToState,r.creditAmount=void 0,r.features=i.features},r.submitAddCredit=function(){if(!r.addCreditForm.$invalid)return r.submitPending=!0,t.Invoices.save({action:"add_credit_invoice"},{client:r.client_id,credit:r.creditAmount}).$promise.then(function(e){o.go("billingInvoicesDetails",{id:e.id})}).catch(function(e){r.backendErrors=e.data}).finally(function(){r.submitPending=!1})}}angular.module("fleio").component("flAddCredit",{templateUrl:"apps/billing/invoicing/fladdcredit.html",controller:e,bindings:{client:"<",applicableTaxRules:"<"}}),e.$inject=["FlUiUtilsService","FlBilling","$stateParams","$state","FlFeatureService"]}(),function(){"use strict";function e(e,t,n){var o=this;o.$onInit=function(){n.getString("paid"),n.getString("cancelled"),n.getString("unpaid"),n.getString("refunded"),e.info.enabled=!0,e.info.label=t("Search invoices"),e.info.service=o.invoices,o.current_date=new Date},o.getInvoiceStatusClass=function(e){if("paid"===e.status)return"fl-light-green";if("unpaid"===e.status){var t=new Date(e.due_date);if(o.current_date<=t)return"fl-yellow";if(o.current_date>t)return"fl-red"}else if("refunded"===e.status||"cancelled"===e.status)return"fl-gray"}}angular.module("fleio").component("flInvoicing",{templateUrl:"apps/billing/invoicing/flinvoicing.html",controller:e,bindings:{invoices:"<"}}),e.$inject=["FlSearchService","gettext","gettextCatalog"]}(),function(){"use strict";function e(t,n,o,i,e,r,a,s){var l=this;function c(t){var n=null,o=!1;return l.paymentOptions.gateways.forEach(function(e){e.id===t&&(n=e.name,o=e.recurring_payments_enabled)}),{name:n,recurring_payments_enabled:o}}l.$onInit=function(){l.invoiceStatusClass=function(){{if("paid"===l.invoice.status)return"fl-light-green";if("unpaid"===l.invoice.status){var e=new Date(l.invoice.due_date);if(l.current_date<=e)return"fl-yellow";if(l.current_date>e)return"fl-red"}else if("refunded"===l.invoice.status||"canceled"===l.invoice.status)return"fl-gray"}}(),l.creditGatewayId="credit",l.selectedGatewayHasRecurringPayments=!1,l.availableCredit=0,l.saveCard=!1,l.current_date=new Date,l.gatewaysExist=!1,l.paymentOptions=l.invoice.payment_options,l.paymentOptions&&l.paymentOptions.creditBalance&&l.paymentOptions.creditBalance.forEach(function(e){e.currency===l.invoice.currency&&0<e.amount&&(l.availableCredit=e.amount)}),l.paymentOptions&&l.paymentOptions.gateways&&l.paymentOptions.gateways.length&&(l.gatewaysExist=!0),0<l.availableCredit&&(l.gatewaysExist=!0),l.showDownloadPdf=!1,e.features["billing.pdf"]&&(l.showDownloadPdf=!0,l.pdfUrl=o.api_url+"/billing/invoices/"+l.invoice.id+"/download?content_type=pdf")},l.clickedConditions=function(){l.saveCard=!l.saveCard},l.downloadPdf=function(){a.get(o.api_url+"/billing/invoices/"+l.invoice.id+"/download?content_type=pdf").then(function(e){var t=new Blob([e.data],{type:"application/pdf"}),n=document.createElement("a");n.href=window.URL.createObjectURL(t),l.invoice.display_number?n.download="invoice_"+l.invoice.display_number.replace(/\s/g,"")+".pdf":n.download="invoice_"+l.invoice.id+".pdf",document.body.appendChild(n),n.click(),document.body.removeChild(n)})},l.getTranslatedContent=function(e){return s.getString(e)},l.selectedGatewayChanged=function(){l.selectedGatewayHasRecurringPayments=!1;var e=c(l.paymentGateway);l.selectedGatewayName=e.name,e.recurring_payments_enabled&&(l.selectedGatewayHasRecurringPayments=!0)},l.processPayment=function(e){l.inProgress=!0,e===l.creditGatewayId?t.Invoices.save({id:l.invoice.id,action:"pay_from_credit_balance"}).$promise.then(function(e){n.add(e.detail),r.reload()}).finally(function(){l.inProgress=!1}):function(e){var t=c(e);if(null!==t.name){var n="invoice="+encodeURIComponent(l.invoice.id);l.saveCard&&(n+="&recurring=True"),i.location.href=o.api_url+"/billing/gateway/"+t.name+"/pay_invoice?"+n}}(e),l.inProgress=!1}}angular.module("fleio").component("flInvoicingDetails",{templateUrl:"apps/billing/invoicing/flinvoicingdetails.html",controller:e,bindings:{invoice:"<"}}),e.$inject=["FlBilling","FlNotificationService","CONFIG","$window","FlFeatureService","$state","$http","gettextCatalog"]}(),function(){"use strict";function e(t,n,o,i){var r=this;function a(){t.Gateways.get({action:"get_configured_recurring_payment_options"}).$promise.then(function(e){r.options=e}).catch(function(e){n.add(o.getString("Could not refresh recurring payment options."))})}r.$onInit=function(){},r.deactivateRecurringPayment=function(e){return i.yesNoDlg(o.getString("Are you sure?"),o.getString("Deactivate recurring payments for {{name}}",{name:e.display_name}),o.getString("Deactivate")).then(function(){t.Gateways.post({action:"deactivate_recurring_payment_option",gateway_name:e.name}).$promise.then(function(e){a(),n.add(o.getString("Recurring payment option updated."))}).catch(function(e){n.add(o.getString("Could not update recurring payment option."))})}).catch(function(){})},r.reactivateRecurringPayment=function(e){return i.yesNoDlg(o.getString("Are you sure?"),o.getString("Reactivate recurring payments for {{name}}",{name:e.display_name}),o.getString("Reactivate")).then(function(){t.Gateways.post({action:"reactivate_recurring_payment_option",gateway_name:e.name}).$promise.then(function(e){a(),n.add(o.getString("Recurring payment option updated."))}).catch(function(e){n.add(o.getString("Could not update recurring payment option."))})}).catch(function(){})},r.moveUp=function(e){t.Gateways.post({action:"change_recurrent_payments_order",recurring_payment_gateway_name:e.name,new_ordering:e.order-1}).$promise.then(function(e){a(),n.add(o.getString("Recurring payment option updated."))}).catch(function(e){n.add(o.getString("Could not update recurring payment option."))})}}angular.module("fleio").component("flRecurringPaymentOpts",{templateUrl:"apps/billing/recurring_payment_opts/recurring_payment_opts.component.html",controller:e,bindings:{options:"<"}}),e.$inject=["FlBilling","FlNotificationService","gettextCatalog","FlUiUtilsService"]}(),function(){"use strict";function e(e,t,n){e.state("manageRecurringPaymentOpts",{url:t.joinBaseUrl("billing/manage-recurring-payment-options"),component:"flRecurringPaymentOpts",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{},data:{stateInfo:{display:n("Recurring payment options"),parent:"dashboard"},feature:"billing.recurring_payments",orderOptions:{},filtering:{}},resolve:{options:["$stateParams","FlObjectList","FlBilling","FlResolveErrorHandler",function(e,t,n,o){return n.Gateways.get({action:"get_configured_recurring_payment_options"}).$promise.then(function(e){return e}).catch(o.handleError)}]}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c){var u,d=this,p=a.current.name;function m(){return d.floatingIps.fetchData()}d.$onInit=function(){n.info.enabled=!0,n.info.label=o("Search floating IPs"),n.info.service=d.floatingIps,(u=e(m,1e4)).start(),t.init(u.start.bind(u),u.stop.bind(u)),d.TRANSLATED_STRINGS_MAP={create:r.getString("Add floating IP"),delete:r.getString("Delete"),no_permission:r.getString("You are not\nallowed to do this")}},d.addFloatingIp=function(t){l.FloatingIps.get({options:"create_options"}).$promise.then(function(e){return p!==a.current.name?e:(a.go(a.current,{dlg:"add"}),s.show({templateUrl:"apps/floatingips/flfloatingipadd.html",controller:"FlFloatingIpAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{networks:e.networks,can_create_resource:e.can_create_resource}}).then(m).finally(function(){a.go(a.current,{dlg:"false"})}).catch(function(){}))})},d.deleteFloatingIp=function(e){return i.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete floating IP {{ip_address}}",{ip_address:e.floating_ip_address}),r.getString("Delete floating IP")).then(function(){return e.$delete().then(function(){c.add(r.getString("Floating IP delete scheduled")),m()}).catch(function(e){c.add(r.getString("Could not delete floating IP"))})}).catch(function(){})},d.$onDestroy=function(){u.teardown(),t.uninit()}}angular.module("fleio").component("flFloatingIps",{templateUrl:"apps/floatingips/flfloatingips.html",controller:e,bindings:{floatingIps:"="}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlSearchService","gettext","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlOsApi","FlNotificationService"]}(),function(){"use strict";function e(e,t,n,o,i,r,a){var s,l=this;function c(){n.FloatingIps.get({id:l.floatingIp.id}).$promise.then(function(e){l.floatingIp=e})}l.$onInit=function(){(s=t(c,1e4)).start(),e.init(s.start.bind(s),s.stop.bind(s)),l.TRANSLATED_STRINGS_MAP={delete:i.getString("Delete"),no_permission:i.getString("You are not\nallowed to do this")}},l.deleteFloatingIp=function(e){return o.yesNoDlg(i.getString("Are you sure?"),i.getString("Delete floating IP {{ip_address}}",{name:e.floating_ip_address}),i.getString("Delete floating IP")).then(function(){return e.$delete().then(function(){return a.add(i.getString("Floating IP delete scheduled")),r.go("floatingIps")}).catch(c)}).catch(function(){})},l.$onDestroy=function(){s.teardown(),e.uninit()}}angular.module("fleio").component("flFloatingIpDetails",{templateUrl:"apps/floatingips/flfloatingipdetails.html",controller:e,bindings:{floatingIp:"<",permissions:"<"}}),e.$inject=["FlDetectIdleService","FlOsTimer","FlOsApi","FlUiUtilsService","gettextCatalog","$state","FlNotificationService"]}(),function(){"use strict";function e(t,e){var n=this;n.$onInit=function(){n.keyGen={inProgress:!1,generated:!1},n.ip={network:n.networks.length?n.networks[0]:""}},n.saveFloatingIp=function(){if(document.activeElement.blur(),!n.floatingIp.$invalid&&!n.submitPending)return n.submitPending=!0,e.FloatingIps.save({floating_network:n.ip.network,description:n.ip.description}).$promise.then(function(e){return t.hide(e),n.submitPending=!1,e},function(e){return n.submitPending=!1,n.backendErrors=e.data})},n.close=function(){return t.cancel()}}angular.module("fleio").controller("FlFloatingIpAddController",e),e.$inject=["$mdDialog","FlOsApi"]}(),function(){"use strict";function e(e,t,n){e.state("floatingIps",{url:t.joinBaseUrl("openstack/floatingips?page_size?ordering?filtering?search?dlg"),component:"flFloatingIps",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{dlg:{value:"false",squash:!0},page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-status",squash:!0},filtering:{value:"",squash:!0}},data:{stateInfo:{display:n("Floating IPs"),parent:"dashboard"},feature:"openstack.floatingips",orderOptions:{floating_ip_address:n("IP address"),status:n("Status"),floating_network:n("Network")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},status:{display:n("Status"),field_name:"status",type:"choices",choices:[{display:"Down",value:"DOWN"}]}}},resolve:{floatingIps:["$stateParams","FlObjectList","FlOsApi",function(e,t,n){return t(n.FloatingIps,e)}]}}).state("floatingIpDetails",{url:t.joinBaseUrl("openstack/floatingips/:id"),component:"flFloatingIpDetails",authenticate:!0,resolve:{floatingIp:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o){return t.FloatingIps.get(e).$promise.then(function(e){return n.setParams({floating_ip_address:e.floating_ip_address}),e}).catch(o.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.FloatingIps.get({options:"permissions"}).$promise}]},data:{feature:"openstack.floatingips",stateInfo:{display:n("Floating IP {:floating_ip_address}"),parent:"floatingIps",default:n("Floating IP details")}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c){var u,d=this,p=s.current.name;function m(){return d.networks.fetchData()}d.$onInit=function(){o.info.enabled=!0,o.info.label=i("Search networks"),o.info.service=d.networks,(u=t(m,1e4)).start(),n.init(u.start.bind(u),u.stop.bind(u)),d.TRANSLATED_STRINGS_MAP={delete:a.getString("Delete"),edit:a.getString("Edit network"),create:a.getString("Create network"),auto_create_network:a.getString("Get me a network"),no_permission:a.getString("You are not\nallowed to do this")}},d.addSubnet=function(t,n){d.networks.loading=!0,c.Subnets.get({options:"create_options",network_id:n.id}).$promise.then(function(e){return d.networks.loading=!1,p!==s.current.name?e:(s.go(s.current,{dlg:"add"}),l.show({templateUrl:"apps/networks/flnetworksubnetedit.html",controller:"FlNetworkSubnetEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{network:angular.copy(n),subnet_pools:angular.copy(e.pools),ipv6_modes:angular.copy(e.ipv6_modes)}}))}).catch(function(e){d.networks.loading=!1,e&&(d.backendErrors=e.data)})},d.editNetwork=function(t,n){c.Networks.get({options:"create_options"}).$promise.then(function(e){return p!==s.current.name?e:(s.go(s.current,{dlg:"add"}),l.show({templateUrl:"apps/networks/flnetworkedit.html",controller:"FlNetworkEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{network:angular.copy(n),regions:e.regions,selected_region:e.selected_region}}).then(function(){return d.networks.fetchData()}).finally(function(){s.go(s.current,{dlg:"false"})}).catch(function(){}))})},d.createNetwork=function(t,n){c.Networks.get({options:"create_options"}).$promise.then(function(e){return p!==s.current.name?e:(s.go(s.current,{dlg:"add"}),l.show({templateUrl:"apps/networks/flnetworkadd.html",controller:"FlNetworkAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{network:angular.copy(n),regions:e.regions,can_create_resource:e.can_create_resource,selected_region:e.selected_region}}).then(function(){return d.networks.fetchData()}).finally(function(){s.go(s.current,{dlg:"false"})}).catch(function(){}))})},d.getMeANetwork=function(t){c.Networks.get({options:"create_options"}).$promise.then(function(e){return s.go(s.current,{dlg:"add"}),l.show({templateUrl:"apps/networks/flnetworkautocreate.html",controller:"FlNetworkAutoCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{regions:e.regions,can_create_resource:e.can_create_resource}}).then(function(){return d.networks.fetchData()}).finally(function(){s.go(s.current,{dlg:"false"})}).catch(function(){})})},d.deleteNetwork=function(e){return r.yesNoDlg(a.getString("Are you sure?"),a.getString("Delete network {{name}}",{name:e.name}),a.getString("Delete network")).then(function(){return e.$delete().then(m).catch(function(){FlNotificationService.add(a.getString("Could not delete network"))})})},d.allowedAction=function(e,t){return-1<e.allowed_actions.indexOf(t)},d.$onDestroy=function(){u.teardown(),n.uninit()}}angular.module("fleio").component("flNetworks",{templateUrl:"apps/networks/flnetworks.html",controller:e,bindings:{networks:"="}}),e.$inject=["$scope","FlOsTimer","FlDetectIdleService","FlSearchService","gettext","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlOsApi"]}(),function(){"use strict";function e(i,t,n,o,r,a,e,s){var l,c=this,u=o.current.name;function d(){i.Networks.get({id:c.network.id}).$promise.then(function(e){c.network=e})}c.$onInit=function(){(l=s(d,1e4)).start(),e.init(l.start.bind(l),l.stop.bind(l)),c.TRANSLATED_STRINGS_MAP={delete:n.getString("Delete"),edit:n.getString("Edit network"),no_permission:n.getString("You are not\nallowed to do this")}},c.editNetwork=function(t,n){i.Networks.get({options:"create_options"}).$promise.then(function(e){return u!==o.current.name?e:(o.go(o.current,{dlg:"add"}),r.show({templateUrl:"apps/networks/flnetworkedit.html",controller:"FlNetworkEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{network:angular.copy(n),regions:e.regions}}).then(function(e){d()}).finally(function(){o.go(o.current,{dlg:"false"})}).catch(function(){}))})},c.deleteNetwork=function(e){return t.yesNoDlg(n.getString("Are you sure?"),n.getString("Delete network {{name}}",{name:e.name}),n.getString("Delete network")).then(function(){return e.$delete().then(function(){return o.go("openstackNetworks")})}).catch(function(){})},c.allowedAction=function(e,t){return-1<e.allowed_actions.indexOf(t)},c.addSubnet=function(t,n){c.loading=!0,i.Subnets.get({options:"create_options",network_id:n.id}).$promise.then(function(e){return c.loading=!1,u!==o.current.name?e:(o.go(o.current,{dlg:"add"}),r.show({templateUrl:"apps/networks/flnetworksubnetedit.html",controller:"FlNetworkSubnetEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{network:angular.copy(n),subnet_pools:angular.copy(e.pools),ipv6_modes:angular.copy(e.ipv6_modes)}}).then(function(){d()}).catch(function(){}))},function(e){return c.loading=!1,c.backendErrors=e.data})},c.editSubnet=function(t,n,o){c.loading=!0,i.Subnets.get({options:"create_options",network_id:n.id}).$promise.then(function(e){return c.loading=!1,r.show({templateUrl:"apps/networks/flnetworksubnetedit.html",controller:"FlNetworkSubnetEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{subnet:angular.copy(o),network:angular.copy(n),subnet_pools:angular.copy(e.pools),ipv6_modes:angular.copy(e.ipv6_modes)}}).then(d)}).catch(function(e){c.loading=!1,e&&(c.backendErrors=e.data)})},c.deleteSubnet=function(e){return t.yesNoDlg(n.getString("Are you sure?"),n.getString("Delete subnet {{subnet}}",{subnet:e.name}),n.getString("Delete subnet")).then(function(){return i.Subnets.delete({id:e.id}).$promise.then(function(){a.add(n.getString("Subnet delete scheduled")),d()}).catch(function(){a.add(n.getString("Could not delete subnet"))})}).catch(function(){})},c.$onDestroy=function(){l.teardown(),e.uninit()}}angular.module("fleio").component("flNetworkDetails",{templateUrl:"apps/networks/flnetworkdetails.html",controller:e,bindings:{network:"<",permissions:"<"}}),e.$inject=["FlOsApi","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlNotificationService","FlDetectIdleService","FlOsTimer"]}(),function(){"use strict";function e(t,e,n,o){var i=this;i.$onInit=function(){i.network||(i.network={region:i.selected_region,admin_state_up:!0})},i.saveNetwork=function(){if(document.activeElement.blur(),!i.submitPending&&!i.network_form.$invalid){if(i.submitPending=!0,!i.network.id)return e.Networks.save(i.network).$promise.then(function(e){return t.hide(e),n.add(o.getString("Network create scheduled")),e},function(e){return i.submitPending=!1,i.backendErrors=e.data},function(e){i.submitPending=!1,i.backendErrors=e.data});e.Networks.update({id:i.network.id},i.network).$promise.then(function(e){return t.hide(e),n.add(o.getString("Network update scheduled")),e},function(e){i.submitPending=!1,i.backendErrors=e.data})}},i.close=function(){return t.cancel()}}angular.module("fleio").controller("FlNetworkEditController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(t,e,n,o){var i=this;function r(){if(document.activeElement.blur(),!i.submitPending&&!i.network_form.$invalid)return i.submitPending=!0,i.showProviderPhysical||(i.network.provider_physical_network=""),i.showProviderSegmentationID||(i.network.provider_segmentation_id=""),i.create_subnet&&(!1===i.setGatewayIp?delete i.subnet.gateway_ip:null===i.setGatewayIp&&(i.subnet.gateway_ip=null),i.network.subnet=i.subnet,"manually"==i.network_address_source?(delete i.subnet.subnetpool_id,delete i.subnet.prefixlen):(i.subnet.subnetpool_id=i.subnet_pool.id,i.subnet.cidr="")),e.Networks.save(i.network).$promise.then(function(e){return t.hide(e),n.add(o.getString("Network create scheduled")),e},function(e){return i.submitPending=!1,i.backendErrors=e.data},function(e){i.submitPending=!1,i.backendErrors=e.data})}function a(){e.Networks.get({options:"get_subnet_pools",region:i.network.region}).$promise.then(function(e){i.subnet_pools=e,i.subnet_pool=i.subnet_pools.pools[0],i.changeSubnetpoolOptions(i.subnet_pool)},function(e){i.subnet_pools=[]})}function s(){i.subnet.allocation_pools.push({start:"",end:""})}function l(e){1<i.subnet.allocation_pools.length&&i.subnet.allocation_pools.splice(e,1)}function c(){i.subnet.dns_nameservers.push({ip:""})}function u(e){1<i.subnet.dns_nameservers.length&&i.subnet.dns_nameservers.splice(e,1)}function d(){i.subnet.host_routes.push({destination:"",nexthop:""})}function p(e){1<i.subnet.host_routes.length&&i.subnet.host_routes.splice(e,1)}function m(){4==i.subnet.ip_version&&(i.subnet.ipv6_ra_mode=null,i.subnet.ipv6_address_mode=null)}function g(e){e&&(i.subnet.prefixlen=~~e.default_prefixlen,i.subnet.ip_version=~~e.ip_version)}function f(){"network"==i.activeTab?i.activeTab="subnet":"subnet"==i.activeTab&&(i.activeTab="subnetDetails")}function h(){return t.cancel()}i.$onInit=function(){i.setGatewayIp=null,i.saveNetwork=r,i.updateSubnetPools=a,i.close=h,i.addAllocationPool=s,i.removeAllocationPool=l,i.addDnsNameServer=c,i.removeDnsNameServer=u,i.addHostRoute=d,i.removeHostRoute=p,i.changeIPVersion=m,i.changeSubnetpoolOptions=g,i.nextPage=f,i.network={region:i.selected_region,admin_state_up:!0},i.for_auto_create&&(i.network.router_external=!0),i.subnet={allocation_pools:[{start:"",end:""}],dns_nameservers:[{ip:""}],host_routes:[{destination:"",nexthop:""}],enable_dhcp:!0,ipv6_ra_mode:null,ipv6_address_mode:null},i.ipv6_modes=["slaac","dhcpv6-stateful","dhcpv6-stateless"]}}angular.module("fleio").controller("FlNetworkAddController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){e.state("openstackNetworks",{url:t.joinBaseUrl("openstack/networks?page_size?ordering?search?filtering"),component:"flNetworks",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-name",squash:!0},filtering:{value:"",squash:!0,dynamic:!0}},data:{stateInfo:{display:n("Networks"),parent:"dashboard"},feature:"openstack.networks",orderOptions:{name:n("Name"),created_at:n("Created at"),region:n("Region")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},region:{display:n("Region"),field_name:"region",type:"choices",choices:[]},is_default:{display:n("Is default"),field_name:"is_default",type:"bool"},shared:{display:n("Shared"),field_name:"shared",type:"bool"}}},resolve:{networks:["$state","$stateParams","FlObjectList","FlOsApi",function(r,e,t,n){return n.Networks.get({options:"create_options"}).$promise.then(function(e){for(var t=e.regions,n=[],o=0,i=t.length;o<i;++o)n.push({display:t[o].id,value:t[o].id});r.get("openstackNetworks").data.filtering.region.choices=n}),t(n.Networks,e)}]}}).state("networkDetails",{url:t.joinBaseUrl("openstack/networks/:id"),component:"flNetworkDetails",authenticate:!0,resolve:{network:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o){return t.Networks.get(e).$promise.then(function(e){return n.setParams({network:e.name}),e}).catch(o.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.Networks.get({options:"permissions"}).$promise}]},data:{feature:"openstack.networks",stateInfo:{display:n("Network {:network}"),parent:"openstackNetworks",default:n("Network details")}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,o){var i=this;i.$onInit=function(){i.network||(i.network={region:i.regions.length?i.regions[0].id:"",admin_state_up:!0}),i.saveNetwork=function(){if(document.activeElement.blur(),!i.network_form.$invalid)return t.Networks.save({options:"auto_create_network"},i.network).$promise.then(function(e){n.add(o.getString("Auto creating network finished"))}),n.add(o.getString("Auto creating network...")),e.hide()},i.close=function(){return e.cancel()}}}angular.module("fleio").controller("FlNetworkAutoCreateController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(t,e,n,o){var i=this;i.$onInit=function(){if(i.subnet){var e,t=JSON.parse(i.subnet.extra.replace(/'/g,'"').replace(/None/g,"null"));if(i.subnet.allocation_pools?i.subnet.allocation_pools=JSON.parse(i.subnet.allocation_pools.replace(/'/g,'"')):i.subnet.allocation_pools=[],t.dns_nameservers){var n=[];for(e=0;e<t.dns_nameservers.length;e++)n.push({ip:t.dns_nameservers[e]});i.subnet.dns_nameservers=n}else i.subnet.dns_nameservers=[];if(t.host_routes){var o=[];for(e=0;e<t.host_routes.length;e++)o.push({destination:t.host_routes[e].destination,nexthop:t.host_routes[e].nexthop});i.subnet.host_routes=o}else i.subnet.host_routes=[];i.isNew=!1}else i.subnet={allocation_pools:[{start:"",end:""}],dns_nameservers:[{ip:""}],host_routes:[{destination:"",nexthop:""}],enable_dhcp:!0,ipv6_ra_mode:null,ipv6_address_mode:null},i.isNew=!0,i.setGatewayIp=null},i.addAllocationPool=function(){i.subnet.allocation_pools.push({start:"",end:""})},i.removeAllocationPool=function(e){i.subnet.allocation_pools.splice(e,1)},i.addDnsNameServer=function(){i.subnet.dns_nameservers.push({ip:""})},i.removeDnsNameServer=function(e){i.subnet.dns_nameservers.splice(e,1)},i.addHostRoute=function(){i.subnet.host_routes.push({destination:"",nexthop:""})},i.removeHostRoute=function(e){i.subnet.host_routes.splice(e,1)},i.changeIPVersion=function(){4===i.subnet.ip_version&&(i.subnet.ipv6_ra_mode=null,i.subnet.ipv6_address_mode=null)},i.changeSubnetpoolOptions=function(e){i.subnet.prefixlen=~~e.default_prefixlen,i.subnet.ip_version=~~e.ip_version},i.saveSubnet=function(){if(document.activeElement.blur(),!i.submitPending&&!i.subnet_form.$invalid)return i.submitPending=!0,i.subnet.network_id=i.network.id,void 0!==i.subnet_pool&&(i.subnet.subnetpool_id=i.subnet_pool.id,i.subnet.cidr=""),i.isNew?(!1===i.setGatewayIp?delete i.subnet.gateway_ip:null===i.setGatewayIp&&(i.subnet.gateway_ip=null),e.Subnets.save(i.subnet).$promise.then(function(e){return i.submitPending=!1,t.hide(e),n.add(o.getString("Add subnet scheduled")),e},function(e){return i.submitPending=!1,i.backendErrors=e.data})):e.Subnets.update(i.subnet.id,i.subnet).$promise.then(function(e){return i.submitPending=!1,t.hide(e),n.add(o.getString("Edit subnet scheduled")),e},function(e){return i.submitPending=!1,i.backendErrors=e.data})},i.nextPage=function(){i.submitPending||i.subnet_form.$invalid||(i.activeTab="subnetDetails")},i.close=function(){return t.cancel()}}angular.module("fleio").controller("FlNetworkSubnetEditController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c){var u,d=this,p=a.current.name;function m(){return d.routers.fetchData()}d.$onInit=function(){n.info.enabled=!0,n.info.label=o("Search routers"),n.info.service=d.routers,(u=e(m,1e4,!0,[1e3,2e3])).start(),t.init(u.start.bind(u),u.stop.bind(u))},d.editRouter=function(t,n){l.Routers.get({options:"create_options"}).$promise.then(function(e){return p!==a.current.name?e:(a.go(a.current,{dlg:"add"}),s.show({templateUrl:"apps/osrouters/flrouteredit.html",controller:"FlRouterEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{router:angular.copy(n),regions:e.regions,external_networks:e.external_networks,selected_region:e.selected_region,can_create_resource:e.can_create_resource}}).then(function(){u.boost()}).finally(function(){a.go(a.current,{dlg:"false"})}).catch(function(){}))})},d.deleteRouter=function(e){return i.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete router {{name}}",{name:e.name}),r.getString("Delete router")).then(function(){return e.$delete().then(function(){c.add(r.getString("Router delete scheduled")),u.boost()}).catch(function(){c.add(r.getString("Could not delete router"))})})},d.addInterface=function(t,n){d.loading=!0,l.Routers.get({id:n.id,options:"create_add_interface_options"}).$promise.then(function(e){return d.loading=!1,p!==a.current.name?e:(a.go(a.current,{dlg:"add"}),s.show({templateUrl:"apps/osrouters/flinterfaceadd.html",controller:"FlInterfaceAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{router:angular.copy(n),subnets:angular.copy(e.subnets)}}).then(function(){u.boost()}))}).catch(function(e){d.loading=!1,e&&(d.backendErrors=e.data)})},d.$onDestroy=function(){u.teardown(),t.uninit()}}angular.module("fleio").component("flRouters",{templateUrl:"apps/osrouters/flrouters.html",controller:e,bindings:{routers:"="}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlSearchService","gettext","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlOsApi","FlNotificationService"]}(),function(){"use strict";function e(o,n,i,r,a,e,t,s){var l=this,c=r.current.name;function u(){o.Routers.get({id:l.router.id}).$promise.then(function(e){l.router=e})}function d(t,n){o.Routers.get({options:"create_options"}).$promise.then(function(e){return c!==r.current.name?e:(r.go(r.current,{dlg:"add"}),a.show({templateUrl:"apps/osrouters/flrouteredit.html",controller:"FlRouterEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{router:angular.copy(n),regions:e.regions,external_networks:e.external_networks,selected_region:e.selected_region}}).then(u).finally(function(){r.go(r.current,{dlg:"false"})}).catch(function(){}))})}function p(t,n){l.loading=!0,o.Routers.get({id:n.id,options:"create_add_interface_options"}).$promise.then(function(e){return l.loading=!1,c!==r.current.name?e:(r.go(r.current,{dlg:"add"}),a.show({templateUrl:"apps/osrouters/flinterfaceadd.html",controller:"FlInterfaceAddController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{router:angular.copy(n),subnets:angular.copy(e.subnets)}}).then(function(){l.refreshTimer.boost()}))}).catch(function(e){l.loading=!1,e&&(l.backendErrors=e.data)})}function m(e){return n.yesNoDlg(i.getString("Are you sure?"),i.getString("Delete router {{name}}",{name:e.name}),i.getString("Delete router")).then(function(){return e.$delete().then(function(){return r.go("openstackRouters")})}).catch(function(){})}function g(e,t){return n.yesNoDlg(i.getString("Are you sure?"),i.getString("Delete interface")).then(function(){return s.add(i.getString("Interface delete scheduled")),o.Routers.save({id:e,interface_id:t,options:"remove_interface"}).$promise.then(function(){l.refreshTimer.boost()},function(){s.add(i.getString("Could not delete interface"))})}).catch(function(){})}l.$onInit=function(){l.refreshTimer=t(u,1e4),l.refreshTimer.start(),e.init(l.refreshTimer.start.bind(l.refreshTimer),l.refreshTimer.stop.bind(l.refreshTimer)),l.editRouter=d,l.deleteRouter=m,l.deleteInterface=g,l.addInterface=p},l.$onDestroy=function(){l.refreshTimer.teardown(),e.uninit()}}angular.module("fleio").component("flRouterDetails",{templateUrl:"apps/osrouters/flrouterdetails.html",controller:e,bindings:{router:"<"}}),e.$inject=["FlOsApi","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlDetectIdleService","FlOsTimer","FlNotificationService"]}(),function(){"use strict";function e(t,e,n,o,i){var r=this;r.$onInit=function(){r.changeNetworks=function(e){r.filtered_external_networks=[];for(var t=0;t<r.external_networks.length;t++)r.external_networks[t].region===r.router.region&&r.filtered_external_networks.push(r.external_networks[t])},r.router||(r.router={region:r.selected_region,admin_state_up:!0},r.changeNetworks(r.router.region)),r.saveRouter=function(){if(document.activeElement.blur(),!r.submitPending&&!r.router_form.$invalid){if(r.submitPending=!0,!r.router.id)return e.Routers.save(r.router).$promise.then(function(e){return t.hide(e),n.add(o.getString("Router create scheduled")),e},function(e){return r.submitPending=!1,r.backendErrors=e.data},function(e){r.submitPending=!1,r.backendErrors=e.data});e.Routers.update({id:r.router.id},r.router).$promise.then(function(e){return t.hide(e),n.add(o.getString("Router update scheduled")),e},function(e){r.submitPending=!1,r.backendErrors=e.data})}},r.close=function(){return t.cancel()}}}angular.module("fleio").controller("FlRouterEditController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog","FlClientApi"]}(),function(){"use strict";function e(t,e,n,o,i,r){var a=this;a.$onInit=function(){a.router=i,a.subnets=r,a.router_interface={subnet:r[0].id}},a.$onInit(),a.saveInterface=function(){if(document.activeElement.blur(),!a.submitPending&&!a.interface_form.$invalid)return a.submitPending=!0,e.Routers.save({id:a.router.id,options:"add_interface"},a.router_interface).$promise.then(function(e){return a.submitPending=!1,t.hide(e),n.add(o.getString("Add interface scheduled")),e},function(e){return a.submitPending=!1,a.backendErrors=e.data})},a.close=function(){return t.cancel()}}angular.module("fleio").controller("FlInterfaceAddController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog","router","subnets"]}(),function(){"use strict";function e(e,t,n){e.state("openstackRouters",{url:t.joinBaseUrl("openstack/routers?page_size?ordering"),component:"flRouters",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-name",squash:!0}},data:{stateInfo:{display:n("Routers"),parent:"dashboard"},feature:"openstack.routers",orderOptions:{name:n("Name"),admin_state_up:n("Admin state")}},resolve:{routers:["$stateParams","FlObjectList","FlOsApi",function(e,t,n){return t(n.Routers,e)}]}}).state("routerDetails",{url:t.joinBaseUrl("openstack/routers/:id"),component:"flRouterDetails",authenticate:!0,resolve:{router:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o){return t.Routers.get(e).$promise.then(function(e){return n.setParams({router:e.name}),e}).catch(o.handleError)}]},data:{feature:"openstack.routers",stateInfo:{display:n("Router {:router}"),parent:"openstackRouters",default:n("Router details")}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n){e.state("zones",{url:t.joinBaseUrl("openstack/zones?page_size?ordering?search"),component:"flZones",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-created_at",squash:!0}},resolve:{zones:["$state","$transition$","FlObjectList","FlOsApi",function(e,t,n,o){return n(o.Dns,t.params())}]},data:{stateInfo:{display:n("Zones"),parent:"dashboard"},feature:"openstack.dns.zones",orderOptions:{name:n("Name"),serial:n("Serial Number"),status:n("Status"),created_at:n("Created at"),updated_at:n("Updated at")}}}).state("zoneDetails",{url:t.joinBaseUrl("openstack/zones/:id"),component:"flZoneDetails",authenticate:!0,resolve:{zone:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o){return t.Dns.get(e).$promise.then(function(e){return n.setParams({zone:e.name}),e}).catch(o.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.Dns.get({actions:"permissions"}).$promise}]},data:{feature:"openstack.dns.zones",stateInfo:{display:n("Zone {:zone}"),parent:"zones",default:n("Zone details")}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l){var c,u=this,d=i.current.name;function p(){return u.zones.fetchData()}u.$onInit=function(){l.info.enabled=!0,l.info.label=o.getString("Search zones"),l.info.service=u.zones,(c=e(p,3e4,!0,[5e3,1e4])).start(),t.init(function(){return c.start()},function(){return c.stop()}),u.TRANSLATED_STRINGS_MAP={create:o.getString("Create zone"),delete:o.getString("Delete"),edit:o.getString("Edit zone"),no_permission:o.getString("You are not\nallowed to do this")}},u.editZone=function(t,n){a.Dns.get({actions:"create_options"}).$promise.then(function(e){return d!==i.current.name?e:(i.go(i.current,{dlg:"add"}),r.show({templateUrl:"apps/oszones/flzoneedit.html",controller:"FlZoneEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{zone:angular.copy(n),regions:e.regions,selected_region:e.selected_region,can_create_resource:e.can_create_resource}}).then(function(){c.boost()}).finally(function(){i.go(i.current,{dlg:"false"})}).catch(function(){}))})},u.deleteZone=function(e){return n.yesNoDlg(o.getString("Are you sure?"),o.getString("Delete zone {{name}}",{name:e.name}),o.getString("Delete zone")).then(function(){return e.$delete().then(function(){s.add(o.getString("Zone delete scheduled")),c.boost()}).catch(function(){s.add(o.getString("Could not delete zone"))})}).catch(function(){})},u.$onDestroy=function(){c.teardown(),t.uninit()}}angular.module("fleio").component("flZones",{templateUrl:"apps/oszones/flzones.html",controller:e,bindings:{zones:"<"}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlOsApi","FlNotificationService","FlSearchService"]}(),function(){"use strict";function e(t,e,n,o){var i=this;function r(){if(document.activeElement.blur(),!i.submitPending&&!i.zone_form.$invalid){if(i.submitPending=!0,!i.zone.id)return e.Dns.save(i.zone).$promise.then(function(e){return t.hide(e),n.add(o.getString("Zone create scheduled")),e},function(e){return i.submitPending=!1,i.backendErrors=e.data},function(e){i.submitPending=!1,i.backendErrors=e.data});e.Dns.update({id:i.zone.id},i.zone).$promise.then(function(e){return t.hide(e),n.add(o.getString("Zone update scheduled")),e},function(e){i.submitPending=!1,i.backendErrors=e.data})}}function a(){return t.cancel()}i.$onInit=function(){i.saveZone=r,i.close=a,i.zone||(i.zone={region:i.selected_region})}}angular.module("fleio").controller("FlZoneEditController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(t,n,o,i,r,e,a,s,l){var c=this;function u(e){c.loadingDetails=!0,t.Dns.get({id:e,actions:"list_records"}).$promise.then(function(e){return c.recordsets=e,function(){for(var e=0;e<c.recordsets.recordsets.length;e++)for(var t=c.recordsets.recordsets[e],n=0;n<t.records.length;n++){var o,i=t.records[n].split(" ");o="MX"===t.type?{priority:i[0],server:i[1]}:"SSHFP"===t.type?{algorithm:i[0],type:i[1],fingerprint:i[2]}:"SRV"===t.type?{priority:i[0],weight:i[1],port:i[2],hostname:i[3]}:{text:t.records[n]},t.records[n]=o}}(),e}).catch(function(e){e&&e.data&&e.data.detail?l.add(e.data.detail):l.add("Error loading zone records")}).finally(function(){c.loadingDetails=!1})}function d(){t.Dns.get({id:c.zone.id}).$promise.then(function(e){c.zone=e})}function p(e,t){return r.show({templateUrl:"apps/oszones/flzoneedit.html",controller:"FlZoneEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:e,bindToController:!0,locals:{zone:angular.copy(t)}}).then(function(e){d()}).finally(function(){i.go(i.current,{dlg:"false"})}).catch(function(){})}function m(e){return n.yesNoDlg(o.getString("Are you sure?"),o.getString("Delete zone {{name}}",{name:e.name}),o.getString("Delete zone")).then(function(){return e.$delete().then(function(){return i.go("zones")})}).catch(function(){})}function g(){c.hasRecordSets()&&(c.recordsForm.$invalid||c.submitPending||(c.submitPending=!0,c.getRecordsToUpdate(),function(){var e=c.recordsetsList.length;for(;e--;){var t=c.recordsetsList[e];!0===t.deleted&&!0===t.created&&c.recordsetsList.splice(e,1)}}(),function(){for(var e=0;e<c.recordsetsList.length;e++)for(var t=c.recordsetsList[e],n=0;n<t.records.length;n++){for(var o=angular.copy(t.records[n]),i=Object.keys(o),r="",a=0;a<i.length;a++)r+=o[i[a]]+" ";r=r.slice(0,-1),t.records[n]=r}}(),l.add(o.getString("Recordsets update scheduled")),t.Dns.save({id:c.zone.id,actions:"synchronize_records"},c.recordsetsList).$promise.then(function(e){c.submitPending=!1,c.recordsets=e,c.backendErrors=null,c.recordsetsList=[],u(i.params.id)},function(e){c.submitPending=!1,c.backendErrors=e.data,c.recordsetsList=[],u(i.params.id)})))}function f(e,t){c.createRecordsListObj(t),n.yesNoDlg(o.getString("Are you sure?"),o.getString("Delete recordset {{recordset}}",{recordset:e.id}),o.getString("Delete recordset")).then(function(){e.deleted=!0})}function h(){var e="temp"+c.temporaryRecordCreateId;c.createRecordsListObj(e),c.recordsets.recordsets.push({temporary_id:e,status:"Unavailable",zone_id:c.zone.id,ttl:null,zone_name:c.zone.zone_name,type:c.recordsets.record_types[0],name:"",records:[{text:""}],deleted:!1,created:!0}),c.temporaryRecordCreateId+=1}function v(e){return void 0!==c.backendErrors&&null!==c.backendErrors&&void 0!==c.backendErrors[e.id]&&c.backendErrors[e.id]}function _(e,t){c.createRecordsListObj(t),e.records.push(S(e))}function b(e){e.records=[S(e)]}function S(e){return"MX"===e.type?{priority:"",server:""}:"SSHFP"===e.type?{algorithm:"",type:"",fingerprint:""}:"SRV"===e.type?{priority:"",weight:"",port:"",hostname:""}:{text:""}}function y(e,t,n){c.createRecordsListObj(n),1<e.records.length&&e.records.splice(t,1)}c.$onInit=function(){c.editZone=p,c.deleteZone=m,c.syncronizeRecords=g,c.deleteRecordSet=f,c.addRecordSet=h,c.addRecord=_,c.recordsetErrors=v,c.changeRecordType=b,c.removeRecord=y,c.toBeUpdatedRecords={},c.recordsetsList=[],c.temporaryRecordCreateId=0,c.zone&&i.params.id&&u(i.params.id),c.refreshTimer=a(d,3e4,[5e3,1e4]),c.refreshTimer.start(),e.init(function(){return c.refreshTimer.start()},function(){return c.refreshTimer.stop()}),c.TRANSLATED_STRINGS_MAP={delete:o.getString("Delete"),edit:o.getString("Edit zone"),no_permission:o.getString("You are not\nallowed to do this")}},c.$onDestroy=function(){return c.refreshTimer.teardown(),e.uninit()},c.hasRecordSets=function(){return c.recordsets&&c.recordsets.recordsets&&c.recordsets.recordsets.length},c.createRecordsListObj=function(e){void 0!==e&&(c.toBeUpdatedRecords[e]=!0)},c.getRecordsToUpdate=function(){for(var e=0;e<c.recordsets.recordsets.length;e++){var t=c.recordsets.recordsets[e];(c.toBeUpdatedRecords[t.id]||c.toBeUpdatedRecords[t.temporary_id]&&!0!==t.deleted)&&c.recordsetsList.push(t)}}}angular.module("fleio").component("flZoneDetails",{templateUrl:"apps/oszones/flzonedetails.html",controller:e,bindings:{zone:"<",permissions:"<"}}),e.$inject=["FlOsApi","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlDetectIdleService","FlOsTimer","$scope","FlNotificationService"]}(),function(){"use strict";function e(o,t,n,i,r,e,a,s,l){var c,u=this,d=i.current.name;function p(){o.SecurityGroups.get({id:u.securityGroup.id}).$promise.then(function(e){u.securityGroup=e})}function m(t,n){o.SecurityGroups.get({options:"create_options"}).$promise.then(function(e){return d!==i.current.name?e:(i.go(i.current,{dlg:"add"}),r.show({templateUrl:"apps/ossecuritygroups/flsecuritygroupedit.html",controller:"FlSecurityGroupEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{securityGroup:angular.copy(n),regions:e.regions,selected_region:e.selected_region}}).then(function(){c.boost()}).finally(function(){i.go(i.current,{dlg:"false"})}).catch(function(){}))})}function g(t,n){o.SecurityGroups.get().$promise.then(function(e){return d!==i.current.name?e:(i.go(i.current,{dlg:"add"}),r.show({templateUrl:"apps/ossecuritygroups/flsecuritygrouprulecreate.html",controller:"FlSecurityGroupRuleCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{securityGroup:angular.copy(n),securityGroups:angular.copy(e.objects)}}).then(function(){return c.boost()}))}).catch(function(e){e&&(u.backendErrors=e.data)})}function f(e){return t.yesNoDlg(n.getString("Are you sure?"),n.getString("Delete security group {{name}}",{name:e.name}),n.getString("Delete security group")).then(function(){return e.$delete().then(function(){return l.add(n.getString("Security group delete scheduled")),i.go("securityGroups")})}).catch(function(){})}function h(e){return t.yesNoDlg(n.getString("Are you sure?"),n.getString("Delete rule {{rule}}",{rule:e.id}),n.getString("Delete rule")).then(function(){return o.SecurityGroups.save({id:u.securityGroup.id,options:"delete_rule"},{rule_id:e.id}).$promise.then(function(e){l.add(n.getString("Rule delete scheduled")),c.boost()})}).catch(function(){})}u.$onInit=function(){u.editSecurityGroup=m,u.addRule=g,u.deleteSecurityGroup=f,u.deleteRule=h,(c=a(p,1e4)).start(),e.init(c.start.bind(c),c.stop.bind(c)),u.TRANSLATED_STRINGS_MAP={delete:n.getString("Delete"),delete_rule:n.getString("Delete rule"),edit:n.getString("Edit security group"),add_rule:n.getString("Add rule"),no_permission:n.getString("You are not\nallowed to do this")}},u.$onDestroy=function(){c.teardown(),e.uninit()}}angular.module("fleio").component("flSecurityGroupDetails",{templateUrl:"apps/ossecuritygroups/flsecuritygroupdetails.html",controller:e,bindings:{securityGroup:"<",permissions:"<"}}),e.$inject=["FlOsApi","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlDetectIdleService","FlOsTimer","$scope","FlNotificationService"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c){var u,d=this,p=a.current.name;function m(){return d.securityGroups.fetchData()}d.$onInit=function(){n.info.enabled=!0,n.info.label=o("Search security groups"),n.info.service=d.securityGroups,(u=e(m,1e4,!0,[1e3,2e3])).start(),t.init(u.start.bind(u),u.stop.bind(u)),d.TRANSLATED_STRINGS_MAP={create:r.getString("Create security group"),delete:r.getString("Delete"),edit:r.getString("Edit security group"),add_rule:r.getString("Add rule"),no_permission:r.getString("You are not\nallowed to do this")}},d.editSecurityGroup=function(t,n){l.SecurityGroups.get({options:"create_options"}).$promise.then(function(e){return p!==a.current.name?e:(a.go(a.current,{dlg:"add"}),s.show({templateUrl:"apps/ossecuritygroups/flsecuritygroupedit.html",controller:"FlSecurityGroupEditController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{securityGroup:angular.copy(n),regions:e.regions,selected_region:e.selected_region,can_create_resource:e.can_create_resource}}).then(function(){u.boost()}).finally(function(){a.go(a.current,{dlg:"false"})}).catch(function(){}))})},d.deleteSecurityGroup=function(e){return i.yesNoDlg(r.getString("Are you sure?"),r.getString("Delete security group {{name}}",{name:e.name}),r.getString("Delete security group")).then(function(){return e.$delete().then(function(){c.add(r.getString("Security group delete scheduled")),u.boost()})}).catch(function(){})},d.addRule=function(t,n){l.SecurityGroups.get().$promise.then(function(e){return p!==a.current.name?e:(a.go(a.current,{dlg:"add"}),s.show({templateUrl:"apps/ossecuritygroups/flsecuritygrouprulecreate.html",controller:"FlSecurityGroupRuleCreateController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,targetEvent:t,bindToController:!0,locals:{securityGroup:angular.copy(n),securityGroups:angular.copy(e.objects)}}))}).catch(function(e){e&&(d.backendErrors=e.data)})},d.$onDestroy=function(){u.teardown(),t.uninit()}}angular.module("fleio").component("flSecurityGroups",{templateUrl:"apps/ossecuritygroups/flsecuritygroups.html",controller:e,bindings:{securityGroups:"<"}}),e.$inject=["FlOsTimer","FlDetectIdleService","FlSearchService","gettext","FlUiUtilsService","gettextCatalog","$state","$mdDialog","FlOsApi","FlNotificationService"]}(),function(){"use strict";function e(t,e,n,o){var i=this;function r(){if(document.activeElement.blur(),!i.submitPending&&!i.securityGroup_form.$invalid){if(i.submitPending=!0,!i.securityGroup.id)return e.SecurityGroups.save(i.securityGroup).$promise.then(function(e){return t.hide(e),n.add(o.getString("Security group create scheduled")),e},function(e){return i.submitPending=!1,i.backendErrors=e.data},function(e){i.submitPending=!1,i.backendErrors=e.data});e.SecurityGroups.update({id:i.securityGroup.id},i.securityGroup).$promise.then(function(e){return t.hide(e),n.add(o.getString("Security group update scheduled")),e},function(e){i.submitPending=!1,i.backendErrors=e.data})}}function a(){return t.cancel()}i.$onInit=function(){i.saveSecurityGroup=r,i.close=a,i.securityGroup||(i.securityGroup={region:i.selected_region})}}angular.module("fleio").controller("FlSecurityGroupEditController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(n,o,i,r){var a=this;function e(){if(document.activeElement.blur(),!a.submitPending&&!a.rule_form.$invalid){if(a.port_field&&a.rule.port_range){var e=a.rule.port_range.split(":");1<e.length?(a.rule.port_range_min=e[0],a.rule.port_range_max=e[1]):a.rule.port_range_min=a.rule.port_range_max=e[0]}if("cidr"===a.remote?delete a.rule.remote_group_id:a.rule.remote_ip_prefix="",a.rule_types[a.rule_type].hasOwnProperty("protocol")&&(a.rule.protocol=a.rule_types[a.rule_type].protocol),a.rule_types[a.rule_type].hasOwnProperty("port_range"))if(-1!==a.rule_types[a.rule_type].port_range.indexOf(":")){var t=a.rule_types[a.rule_type].port_range.split(":");a.rule.port_range_min=t[0],a.rule.port_range_max=t[1]}else a.rule.port_range_min=a.rule_types[a.rule_type].port_range,a.rule.port_range_max=a.rule_types[a.rule_type].port_range;return a.icmp_type_field&&(a.rule.port_range_min=a.rule.icmp_type),a.icmp_code_field&&(a.rule.port_range_max=a.rule.icmp_code),"cidr"===a.remote&&delete a.rule.ethertype,a.submitPending=!0,o.SecurityGroups.save({id:a.securityGroup.id,options:"add_rule"},a.rule).$promise.then(function(e){return a.submitPending=!1,n.hide(e),i.add(r.getString("Add rule scheduled")),e}).catch(function(e){return a.backendErrors=e.data,e}).finally(function(){a.submitPending=!1})}}function t(e){a.rule.port_range=e?"1:65535":""}function s(e){var t=a.rule_types[e];if(a.rule_types[e].hasOwnProperty("fields"))a.port_field=-1!==t.fields.indexOf("port"),a.protocol_field=-1!==t.fields.indexOf("protocol"),a.icmp_type_field=-1!==t.fields.indexOf("icmp_type"),a.icmp_code_field=-1!==t.fields.indexOf("icmp_code");else{if(a.rule_types[e].hasOwnProperty("protocol")&&(a.rule.protocol=a.rule_types[a.rule_type].protocol),a.rule_types[e].hasOwnProperty("port_range"))if(-1!==a.rule_types[e].port_range.indexOf(":")){var n=a.rule_types[e].port_range.split(":");a.rule.port_range_min=n[0],a.rule.port_range_max=n[1]}else a.rule.port_range_min=a.rule_types[e].port_range,a.rule.port_range_max=a.rule_types[e].port_range;a.port_field=a.protocol_field=a.icmp_type_field=a.icmp_code_field=!1}}function l(){return n.cancel()}a.$onInit=function(){a.rule_types={},a.rule_types[r.getString("Custom TCP rule")]={fields:["port"],protocol:"TCP"},a.rule_types[r.getString("Custom UDP rule")]={fields:["port"],protocol:"UDP"},a.rule_types[r.getString("Custom ICMP rule")]={fields:["icmp_type","icmp_code"],protocol:"ICMP"},a.rule_types[r.getString("Other protocol")]={fields:["protocol","port"]},a.rule_types[r.getString("All TCP")]={port_range:"1:65535",protocol:"TCP"},a.rule_types[r.getString("All UDP")]={port_range:"1:65535",protocol:"UDP"},a.rule_types[r.getString("All ICMP")]={protocol:"ICMP"},a.rule_types.DNS={protocol:"UDP",port_range:"53"},a.rule_types.FTP={protocol:"TCP",port_range:"21"},a.rule_types.HTTP={protocol:"TCP",port_range:"80"},a.rule_types.HTTPS={protocol:"TCP",port_range:"443"},a.rule_types.IMAP={protocol:"TCP",port_range:"143"},a.rule_types.IMAPS={protocol:"TCP",port_range:"993"},a.rule_types.LDAP={protocol:"TCP",port_range:"389"},a.rule_types["MS SQL"]={protocol:"TCP",port_range:"1433"},a.rule_types.MySQL={protocol:"TCP",port_range:"3306"},a.rule_types.POP3={protocol:"TCP",port_range:"110"},a.rule_types.POP3S={protocol:"TCP",port_range:"995"},a.rule_types.RDP={protocol:"TCP",port_range:"3389"},a.rule_types.SFTP={protocol:"TCP",port_range:"115"},a.rule_types.SMTP={protocol:"TCP",port_range:"25"},a.rule_types.SMTPS={protocol:"TCP",port_range:"465"},a.rule_types.SSH={protocol:"TCP",port_range:"22"},a.rule_types.WHOIS={protocol:"TCP",port_range:"43"},a.saveRule=e,a.setPortRange=t,a.changeFields=s,a.close=l,a.rule_type=Object.keys(a.rule_types)[0],a.rule={direction:"ingress",security_group_id:a.securityGroup.id,remote_group_id:a.securityGroups.length?a.securityGroups[0].id:"",remote_ip_prefix:"0.0.0.0/0"},a.changeFields(a.rule_type)}}angular.module("fleio").controller("FlSecurityGroupRuleCreateController",e),e.$inject=["$mdDialog","FlOsApi","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){e.state("securityGroups",{url:t.joinBaseUrl("openstack/security_groups?page_size?ordering?search?filtering"),component:"flSecurityGroups",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-name",squash:!0},filtering:{value:"",squash:!0}},data:{stateInfo:{display:n("Security groups"),parent:"dashboard"},feature:"openstack.securitygroups",orderOptions:{name:n("Name"),created_at:n("Created at"),region:n("Region")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},region:{display:n("Region"),field_name:"region",type:"choices",choices:[]}}},resolve:{securityGroups:["$state","$stateParams","FlObjectList","FlOsApi",function(r,e,t,n){return n.SecurityGroups.get({options:"create_options"}).$promise.then(function(e){for(var t=e.regions,n=[],o=0,i=t.length;o<i;++o)n.push({display:t[o].id,value:t[o].id});r.get("securityGroups").data.filtering.region.choices=n}),t(n.SecurityGroups,e)}]}}).state("securityGroupDetails",{url:t.joinBaseUrl("openstack/security_groups/:id"),component:"flSecurityGroupDetails",authenticate:!0,resolve:{securityGroup:["$stateParams","FlOsApi","FlBreadCrumbService","FlResolveErrorHandler",function(e,t,n,o){return t.SecurityGroups.get(e).$promise.then(function(e){return n.setParams({securityGroup:e.name}),e}).catch(o.handleError)}],permissions:["$stateParams","FlOsApi",function(e,t){return t.SecurityGroups.get({options:"permissions"}).$promise}]},data:{feature:"openstack.securitygroups",stateInfo:{display:n("Security group {:securityGroup}"),parent:"securityGroups",default:n("Security group details")}}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(e,t){return e(t.api_url+"/billing/products/:id/:action",{id:"@id",action:"@action"})}function t(e,t){return e(t.api_url+"/billing/cart/items/:id/:action",{action:"@action",id:"@id"})}function n(e,t){return e(t.api_url+"/billing/cart/:action",{action:"@action"})}function o(e,t){return e(t.api_url+"/billing/order/:id/:action",{action:"@action"})}angular.module("fleio").factory("FlBillingCartProductsApi",e).factory("FlBillingCartApi",n).factory("FlBillingOrderProductApi",o).factory("FlBillingCartItemApi",t),e.$inject=["FlResourceService","CONFIG"],t.$inject=["FlResourceService","CONFIG"],n.$inject=["FlResourceService","CONFIG"],o.$inject=["FlResourceService","CONFIG"]}(),function(){"use strict";function e(t,n,o,r){var a=this;a.$onInit=function(){a.isDeleting=!1},a.goToProducts=function(){r.go("products")},a.checkAndProcessDomains=function(){var e,t,n=[];for(e=0;e<a.cart.items.length;e++)!(t=a.cart.items[e]).domain_name||"order_new"!==t.domain_action&&"transfer"!==t.domain_action||n.push(t.domain_name);for(e=0;e<a.cart.items.length;e++)if("domains"===(t=a.cart.items[e]).plugin_label){var o=n.indexOf(t.name);-1!==o&&n.splice(o,1)}for(e=0;e<a.cart.items.length;e++)if((t=a.cart.items[e]).domain_name&&("order_new"===t.domain_action||"transfer"===t.domain_action)&&-1!==n.indexOf(t.domain_name)){var i={cart_id:t.id,domain_name:t.domain_name,domain_action:t.domain_action};return r.go("domainOptions",i),!1}return!0},a.placeOrder=function(){a.checkAndProcessDomains()&&t.save({action:"order"}).$promise.then(function(e){r.go("billingInvoices"),o.add(e.detail)}).catch(function(e){return e.data.detail?o.add(e.data.detail):o.add(e.data)})},a.editItem=function(e){r.go("cartItem",{id:e})},a.deleteItem=function(e){a.isDeleting||(a.isDeleting=!0,n.delete({id:e}).$promise.finally(function(){t.get().$promise.then(function(e){a.cart=e}).finally(function(){a.isDeleting=!1})}))}}function t(n,o,i,e){var r=this;r.$onInit=function(){r.features=e.features},r.orderItem=function(e){var t={};e&&e.code?t.product_code=e.code:e&&e.id&&(t.product=e.id),e.requires_domain&&r.features["plugins.domains"]?i.go("selectDomain",t):i.go("orderProduct",t)},r.productOrder=function(t){var e={plan_id:t.id};t.is_free?e.cycle_id=null:e.cycle_id=t.cycles[0].id,n.save(e).$promise.then(function(e){return o.add(t.description+" ordered"),e}).catch(function(e){o.add("Error "+e)})}}angular.module("fleio").component("flBillingCart",{templateUrl:"apps/billing/cart/cart.html",controller:e,bindings:{cart:"<"}}).component("flBillingCartProducts",{templateUrl:"apps/billing/cart/products.html",controller:t,bindings:{products:"<"}}),e.$inject=["FlBillingCartApi","FlBillingCartItemApi","FlNotificationService","$state"],t.$inject=["FlBillingCartApi","FlNotificationService","$state","FlFeatureService"]}(),function(){"use strict";function e(n,o,e){var i=this;function t(e){var t={id:i.cartItem.id,action:"edit_options"};return e&&(t.cycle=e),n.get(t).$promise.then(function(e){return i.editOptions=e}).catch(function(e){console.error(e.message)})}i.$onInit=function(){i.configOptions={},i.cartItem.configurable_options.map(function(e){i.configOptions[e.option]=e.option_value}),i.cartItem.domain_action&&(i.showDomain=!0,"use_external"==i.cartItem.domain_action&&(i.editDomain=!0)),t()},i.selectNewCycle=function(){t(i.cartItem.cycle)},i.goToCart=function(){e.go("cart")},i.newProductSubmit=function(){if(!i.submitPending&&!i.newProduct.$invalid){for(var e in i.submitPending=!0,i.backendErrors=null,i.cartItem.configurable_options.map(function(e){e.option_value=i.configOptions[e.option]}),i.cfopts=[],i.configOptions)i.configOptions.hasOwnProperty(e)&&i.configOptions[e]&&i.cfopts.push({option:e,option_value:i.configOptions[e]});i.cartItem.configurable_options=i.cfopts,n.update(i.cartItem).$promise.then(function(e){var t="Product";return i.cartItem&&i.cartItem.display_description&&(t=i.cartItem.display_description),o.add(t+" saved to cart"),i.goToCart(),e}).catch(function(e){return i.backendErrors=e.data,e}).finally(function(e){return i.submitPending=!1,e})}}}angular.module("fleio").component("flBillingCartItem",{templateUrl:"apps/billing/cart/cartitem.html",controller:e,bindings:{cartItem:"<"}}),e.$inject=["FlBillingCartItemApi","FlNotificationService","$state"]}(),function(){"use strict";function e(t,n,o,i){var r=this;r.$onInit=function(){r.pluginData={},r.newProd={},r.configOptions={},r.cartItem=r.product,r.newProductCycle=r.product.selected_cycle},r.selectNewCycle=function(){var e={id:"create_options",product_code:r.product.code,cycle:r.newProductCycle};t.get(e).$promise.then(function(e){r.cartItem=e})},r.newProductSubmit=function(){if(!r.newProduct.$invalid){for(var e in r.newProd.product=r.product.id,r.newProd.cycle=r.newProductCycle,r.newProd.plugin_data=r.pluginData,r.newProd.configurable_options=[],r.configOptions)r.configOptions.hasOwnProperty(e)&&r.newProd.configurable_options.push({option:e,option_value:r.configOptions[e]});return r.newProd.domain_action=n.params.domain_action||null,r.newProd.domain_name=n.params.domain_name||null,t.save(r.newProd).$promise.then(function(e){if(o.add(i.getString("Product added to cart")),r.product.requires_domain&&("order_new"===n.params.domain_action||"transfer"===n.params.domain_action)){var t={};return t.cart_id=e.id,t.domain_name=n.params.domain_name,t.domain_action=n.params.domain_action,void n.go("domainOptions",t)}n.go("cart")}).catch(function(e){r.backendErrors=e.data})}}}angular.module("fleio").component("flBillingOrderProduct",{templateUrl:"apps/billing/cart/orderproduct.html",controller:e,bindings:{product:"<"}}),e.$inject=["FlBillingCartItemApi","$state","FlNotificationService","gettextCatalog"]}(),function(){"use strict";function e(e){var t=this;t.$onInit=function(){t.domain_action=e.params.domain_action,t.domain_data={domain_name:e.params.domain_name,clientCreateOptions:t.clientCreateOptions}}}angular.module("fleio").component("billingDomainOptions",{templateUrl:"apps/billing/cart/domainoptions.html",controller:e,bindings:{clientCreateOptions:"<"}}),e.$inject=["$state"]}(),function(){"use strict";function e(){this.$onInit=function(){}}angular.module("fleio").component("billingSelectDomain",{templateUrl:"apps/billing/cart/selectdomain.html",controller:e,bindings:{product:"<"}}),e.$inject=[]}(),function(){"use strict";function e(e,t,n){e.state("cart",{url:t.joinBaseUrl("cart"),component:"flBillingCart",data:{stateInfo:{display:n("Shopping cart"),parent:"dashboard"},feature:"billing.order"},resolve:{cart:["FlBillingCartApi","FlResolveErrorHandler",function(e,t){return e.get().$promise.catch(t.handleError)}]}}).state("cartItem",{url:t.joinBaseUrl("cart/items/:id"),component:"flBillingCartItem",data:{stateInfo:{display:n("Shopping cart"),parent:"cart"},feature:"billing.order"},resolve:{cartItem:["FlBillingCartItemApi","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.get(t).$promise.catch(n.handleError)}]}}).state("products",{url:t.joinBaseUrl("billing/order"),component:"flBillingCartProducts",data:{stateInfo:{display:n("Available products"),parent:"dashboard"},feature:"billing.order"},resolve:{products:["FlBillingCartProductsApi","FlResolveErrorHandler",function(e,t){return e.get().$promise.catch(t.handleError)}]}}).state("orderProduct",{url:t.joinBaseUrl("billing/orderproduct?product?product_code?domain_name?domain_action"),component:"flBillingOrderProduct",data:{stateInfo:{display:n("Configure product"),parent:"cart"},feature:"billing.order"},resolve:{product:["FlBillingCartItemApi","$stateParams","FlResolveErrorHandler",function(e,t,n){var o=t.product,i=t.product_code,r={id:"create_options"};if(i)r.product_code=i;else{if(!o)throw{redirect:"404"};r.product=o}return e.get(r).$promise.catch(n.handleError)}]}}).state("domainOptions",{url:t.joinBaseUrl("billing/domain-options?cart_id?domain_name?domain_action"),component:"billingDomainOptions",data:{stateInfo:{display:n("Domain options"),parent:"cart"},feature:"billing.order"},resolve:{clientCreateOptions:["FlClientApi",function(e){return e.get({options:"create_options"}).$promise}]}}).state("selectDomain",{url:t.joinBaseUrl("billing/selectDomain?product?product_code"),component:"billingSelectDomain",data:{stateInfo:{display:n("Select domain"),parent:"cart"},feature:"billing.order"},resolve:{product:["FlBillingCartItemApi","$stateParams","FlResolveErrorHandler",function(e,t,n){var o=t.product,i=t.product_code,r={id:"create_options"};if(i)r.product_code=i;else{if(!o)throw{redirect:"404"};r.product=o}return e.get(r).$promise.catch(n.handleError)}]}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}(),function(){"use strict";function e(o,e,t){var i=this;i.$onInit=function(){i.selectedProductOptions={},i.selectedProductAvailableOptions=[],i.configOptions=function(e){var t={};return e.forEach(function(e){t[e.option]=e.option_value}),t}(i.serviceUpgradeOptions.configurable_options),i.options=i.serviceUpgradeOptions,i.upgradeInProgress=i.serviceUpgradeOptions.existing_upgrade_invoice,i.newProductList=function(e){var n=[];return e&&e.upgrades&&e.upgrades.length&&e.upgrades.forEach(function(t){t.cycles&&t.cycles.length&&t.cycles.forEach(function(e){n.push({name:t.name+" "+e.display_name,display_name:t.name+"  "+e.display_name+" ("+e.fixed_price+" "+e.currency+")",description:t.description,cycle:e.id,product:t.id,configurable_options:t.configurable_options,id:e.id+t.id})})}),n}(i.serviceUpgradeOptions)},i.getCycleDisplayName=function(e){return e?e.display_name+" ("+e.fixed_price+" "+e.currency+")":"n/a"},i.getCycleProductDisplayName=function(e,t){return t?e.name+" "+t.display_name+" ("+t.fixed_price+" "+t.currency+")":"n/a"},i.getSelectedProductDisplay=function(){return i.newProductSelected?i.newProductSelected.display_name:t.getString("Select a product")},i.selectNewProductAndCycle=function(){i.newProductSelected&&(i.selectedProductOptions[i.newProductSelected.product]=i.newProductSelected.configurable_options,i.newProductSelected.configurable_options&&i.newProductSelected.configurable_options.length&&(i.selectedProductAvailableOptions=[],i.newProductSelected.configurable_options.forEach(function(e){i.selectedProductAvailableOptions.push(e.id+"")})))},i.cancel=function(){e.go("billingServicesDetails",{id:i.options.id})},i.updateProduct=function(){var e=i.serviceUpgradeOptions.id,t=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&-1<i.selectedProductAvailableOptions.indexOf(n)&&e[n]&&t.push({option:parseInt(n,10),option_value:e[n]});return t}(i.configOptions),n={product:i.newProductSelected.product,cycle:i.newProductSelected.cycle,configurable_options:t,confirm:!1};return o.Services.save({action:"upgrade",id:e},n).$promise.then(function(e){i.upgradeSummary=e,i.optionsSelected=!0}).catch(function(e){i.backendErrors=e.data})}}angular.module("fleio").component("flServiceChangeProduct",{templateUrl:"apps/billing/services/upgrade/flservicechangeproduct.component.html",controller:e,bindings:{serviceUpgradeOptions:"<"}}),e.$inject=["FlBilling","$state","gettextCatalog"]}(),function(){"use strict";function e(e,o){var i=this;i.$onInit=function(){i.options=i.serviceUpgradeOptions,i.options.cycle&&i.options.cycle.id&&(i.newServiceCycle=i.options.cycle.id),i.newProduct=i.options.product.id,i.upgrade={},i.optionsSelected=!1,i.upgradeSummary={},i.configOptions={},i.upgradeInProgress=i.serviceUpgradeOptions.existing_upgrade_invoice,i.serviceUpgradeOptions&&i.serviceUpgradeOptions.configurable_options&&i.serviceUpgradeOptions.configurable_options.length&&i.serviceUpgradeOptions.configurable_options.forEach(function(e){i.configOptions[e.option]=e.option_value})},i.cancel=function(){e.go("billingServicesDetails",{id:i.serviceUpgradeOptions.id})},i.selectProduct=function(e){var t=i.upgrade[e];if(t)return o.Services.save({action:"upgrade",id:i.serviceUpgradeOptions.id},{product:e,cycle:t}).$promise.then(function(e){i.upgradeSummary=e,i.optionsSelected=!0}).catch(console.error);console.error("Select a cycle")},i.changeServiceCycle=function(){return o.Services.save({action:"upgrade",id:i.serviceUpgradeOptions.id},{product:i.serviceUpgradeOptions.product.id,cycle:i.newServiceCycle}).$promise.then(function(e){i.upgradeSummary=e,i.optionsSelected=!0}).catch(console.error)},i.serviceUpgradeFormSubmit=function(){},i.currentServiceOptionsSubmit=function(){},i.updateConfigurableOptions=function(){var e=[];for(var t in i.configOptions)i.configOptions.hasOwnProperty(t)&&e.push({option:t,option_value:i.configOptions[t]});var n={product:i.serviceUpgradeOptions.product.id,cycle:i.newServiceCycle,configurable_options:e};return o.Services.save({action:"upgrade",id:i.serviceUpgradeOptions.id},n).$promise.then(function(e){i.upgradeSummary=e,i.optionsSelected=!0}).catch(function(e){i.backendErrors=e.data})}}angular.module("fleio").component("flServiceUpgrade",{templateUrl:"apps/billing/services/upgrade/flserviceupgrade.component.html",controller:e,bindings:{serviceUpgradeOptions:"<"}}),e.$inject=["$state","FlBilling"]}(),function(){"use strict";function e(i,r){var a=this;a.$onInit=function(){},a.requestUpgrade=function(){var e=a.upgradeSummary.product_id,t=a.upgradeSummary.cycle_id,n=a.upgradeSummary.service_id,o=!1;return e&&t&&n&&(o=!0),i.Services.save({action:"upgrade",id:n},{product:e,cycle:t,confirm:o,configurable_options:a.upgradeSummary.configurable_options}).$promise.then(function(e){r.go("billingInvoicesDetails",{id:e.invoice})}).catch(console.error)}}angular.module("fleio").component("flServiceUpgradeSummary",{templateUrl:"apps/billing/services/upgrade/flserviceupgradesummary.component.html",controller:e,bindings:{upgradeSummary:"<"}}),e.$inject=["FlBilling","$state"]}(),function(){"use strict";function e(e,n,o,i,t,r){var a=this;function s(){a.services.fetchData()}function l(e,t){return i.show({templateUrl:"apps/billing/services/cancellationrequest.html",controller:"FlServiceCancellationRequestController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{service:t},targetEvent:e}).then(function(){s()}).catch(function(){})}a.$onInit=function(){a.cancellationRequest=l,t.info.enabled=!0,t.info.label=r("Search services"),t.info.service=a.services},a.hasCancellationRequest=function(e){return e&&e.cancellation_request&&e.cancellation_request.id},a.doAction=function(e,t){n.Services.save({id:e,action:t}).$promise.then(function(e){s(),e.detail?o.add(e.detail):o.add(e)})}}angular.module("fleio").component("flBillingServices",{templateUrl:"apps/billing/services/services.html",controller:e,bindings:{services:"<"}}),e.$inject=["$state","FlBilling","FlNotificationService","$mdDialog","FlSearchService","gettext"]}(),function(){"use strict";function e(n,e,o,t,i){var r=this;function a(){n.Services.get(e).$promise.then(function(e){r.serviceDetails=e,r.serviceDetails.cycle&&1==r.serviceDetails.cycle.cycle_multiplier&&(r.serviceDetails.cycle.cycle_multiplier=1)})}r.$onInit=function(){i.getString("overdue"),i.getString("staff"),i.getString("userrequested"),r.serviceDetails.cycle&&1===r.serviceDetails.cycle.cycle_multiplier&&(r.serviceDetails.cycle.cycle_multiplier=1)},r.hasCancellationRequest=function(){return r.serviceDetails&&r.serviceDetails.cancellation_request&&r.serviceDetails.cancellation_request.id},r.cancellationRequest=function(e){return t.show({templateUrl:"apps/billing/services/cancellationrequest.html",controller:"FlServiceCancellationRequestController",controllerAs:"$ctrl",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{service:r.serviceDetails},targetEvent:e}).then(function(){a()}).catch(function(){})},r.doAction=function(e,t){n.Services.save({id:e,action:t}).$promise.then(function(e){a(),e.detail?o.add(e.detail):o.add(e)})}}angular.module("fleio").component("flBillingServicesDetails",{templateUrl:"apps/billing/services/servicedetails.html",controller:e,bindings:{serviceDetails:"<"}}),e.$inject=["FlBilling","$stateParams","FlNotificationService","$mdDialog","gettextCatalog"]}(),function(){"use strict";function e(e,t,n,o,i){var r=this;r.$onInit=function(){r.cancellationRequest={cancellation_type:"cycleend"}},r.saveCancellationRequest=function(){if(!r.submitPending&&!r.cancellationRequestForm.$invalid)return r.submitPending=!0,n.Services.save({id:o.id,action:"cancel"},r.cancellationRequest).$promise.then(function(){e.hide(),t.add(i.getString("Service cancellation requested"))}).catch(function(e){e&&(r.backendErrors=e.data,t.add(e.data[0]))}).finally(function(){r.submitPending=!1})},r.close=function(){return e.cancel()}}angular.module("fleio").controller("FlServiceCancellationRequestController",e),e.$inject=["$mdDialog","FlNotificationService","FlBilling","service","gettextCatalog"]}(),function(){"use strict";function e(e,t,n){e.state("billingServices",{url:t.joinBaseUrl("billing/services?page_size?ordering?filtering?search?status"),component:"flBillingServices",authenticate:!0,showSearch:!0,reloadOnSearch:!1,params:{page_size:{value:t.paginate_by,squash:!0},ordering:{value:"-id",squash:!0},filtering:{value:"",squash:!0}},data:{stateInfo:{display:n("Services"),parent:"dashboard"},feature:"billing.services",orderOptions:{display_name:n("Name"),created_at:n("Created at"),next_due_date:n("Next due date"),status:n("Status")},filtering:{created_at:{display:n("Created at"),field_name:"created_at",type:"date"},updated_at:{display:n("Updated at"),field_name:"updated_at",type:"date"},activated_at:{display:n("Activated at"),field_name:"activated_at",type:"date"},suspended_at:{display:n("Suspended at"),field_name:"suspended_at",type:"date"},terminated_at:{display:n("Terminated at"),field_name:"terminated_at",type:"date"},status:{display:n("Status"),field_name:"status",type:"choices",choices:[{display:n("Pending"),value:"pending"},{display:n("Active"),value:"active"},{display:n("Suspended"),value:"suspended"},{display:n("Terminated"),value:"terminated"},{display:n("Canceled"),value:"canceled"},{display:n("Fraud"),value:"fraud"},{display:n("Archived"),value:"archived"}]},next_due_date:{display:n("Next due date"),field_name:"next_due_date",type:"date"}}},resolve:{services:["$stateParams","FlObjectList","FlBilling","FlResolveErrorHandler",function(e,t,n,o){return t(n.Services,e).catch(o.handleError)}]}}).state("billingServiceUpgrade",{url:t.joinBaseUrl("billing/services/:id/change-options"),component:"flServiceUpgrade",authenticate:!0,data:{feature:"billing.services",stateInfo:{display:n("Change options"),parent:"billingServices"}},resolve:{serviceUpgradeOptions:["FlBilling","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.Services.get({id:t.id,action:"upgrade_options"}).$promise.catch(n.handleError)}]}}).state("billingServiceChangeProduct",{url:t.joinBaseUrl("billing/services/:id/change-product"),component:"flServiceChangeProduct",authenticate:!0,data:{feature:"billing.services",stateInfo:{display:n("Change product"),parent:"billingServices"}},resolve:{serviceUpgradeOptions:["FlBilling","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.Services.get({id:t.id,action:"upgrade_options"}).$promise.catch(n.handleError)}]}}).state("billingServicesDetails",{url:t.joinBaseUrl("billing/services/:id"),component:"flBillingServicesDetails",authenticate:!0,data:{feature:"billing.services",stateInfo:{display:n("Service details"),parent:"billingServices"}},resolve:{serviceDetails:["FlBilling","$stateParams","FlResolveErrorHandler",function(e,t,n){return e.Services.get(t).$promise.catch(n.handleError)}]}})}angular.module("fleio").config(e),e.$inject=["$stateProvider","CONFIG","gettext"]}();